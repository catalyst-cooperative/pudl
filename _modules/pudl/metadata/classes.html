<!doctype html>
<html class="no-js" lang="en" data-content_root="../../../">
  <head><meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light dark">
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-EXWBBTVMWK"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-EXWBBTVMWK');
    </script>
    <link rel="index" title="Index" href="../../../genindex.html"><link rel="search" title="Search" href="../../../search.html">
        <link rel="prefetch" href="../../../_static/catalyst_logo-200x200.png" as="image">

    <!-- Generated with Sphinx 9.1.0 and Furo 2025.12.19 -->
        <title>pudl.metadata.classes - PUDL 2026.2.1.dev10 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=d111a655" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo.css?v=7bdb33bb" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css?v=b1990d62" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo-extensions.css?v=8dab3a3b" />
    
    


<style>
  body {
    --color-code-background: #f2f2f2;
  --color-code-foreground: #1e1e1e;
  --color-announcement-background: yellow;
  --color-announcement-text: red;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-announcement-background: yellow;
  --color-announcement-text: red;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-announcement-background: yellow;
  --color-announcement-text: red;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle site navigation sidebar">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc" aria-label="Toggle table of contents sidebar">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>

<div class="announcement">
  <aside class="announcement-content">
     <b>Take our ~10 minute <a href="https://forms.gle/E9ou5fgMcR7YVRCRA">2026 Energy Data Ecosystem Survey!</b> 
  </aside>
</div>

<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <span class="icon"><svg><use href="#svg-menu"></use></svg></span>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../index.html"><div class="brand">PUDL 2026.2.1.dev10 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../index.html">
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../../../_static/catalyst_logo-200x200.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">PUDL 2026.2.1.dev10 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">About PUDL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../data_access.html">Data Access</a></li>
<li class="toctree-l1"><a class="reference external" href="https://data.catalyst.coop">PUDL Data Viewer</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../data_sources/index.html">Data Sources</a><input aria-label="Toggle navigation of Data Sources" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/censusdp1tract.html">Census DP1 – Profile of General Demographic Characteristics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/censuspep.html">Population Estimates Program's (PEP) Federal Information Processing Series (FIPS) Codes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/eiaapi.html">EIA Bulk API Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/eia176.html">EIA Form 176 – Annual Report of Natural and Supplemental Gas Supply and Disposition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/eia860.html">EIA Form 860 – Annual Electric Generator Report</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/eia861.html">EIA Form 861 – Annual Electric Power Industry Report</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/eia923.html">EIA Form 923 – Power Plant Operations Report</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/eia930.html">EIA Form 930 – Hourly and Daily Balancing Authority Operations Report</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/eiaaeo.html">EIA Annual Energy Outlook (AEO)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/epacamd_eia.html">EPA CAMD to EIA Power Sector Data Crosswalk</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/epacems.html">EPA Hourly Continuous Emission Monitoring System (CEMS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/ferc1.html">FERC Form 1 – Annual Report of Major Electric Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/ferc714.html">FERC Form 714 – Annual Electric Balancing Authority Area and Planning Area Report</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/ferceqr.html">FERC Form 920 – Electric Quarterly Report (EQR)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/gridpathratoolkit.html">GridPath Resource Adequacy Toolkit Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/nrelatb.html">NREL Annual Technology Baseline (ATB) for Electricity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/phmsagas.html">Pipelines and Hazardous Materials Safety Administration (PHMSA) Annual Natural Gas Report</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/rus12.html">USDA RUS Form 12 – Financial and Operating Report: Electric Power Supply</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/rus7.html">USDA RUS Form 7 – Financial and Operating Report: Electric Distribution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/sec10k.html">U.S. Securities and Exchange Commission (SEC) Form 10-K</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/vcerare.html">Vibrant Clean Energy Resource Adequacy Renewable Energy (RARE) Power Dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/other_data.html">Other Data in PUDL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/future_data.html">High Priority Target Datasets</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../data_dictionaries/index.html">Data Dictionaries</a><input aria-label="Toggle navigation of Data Dictionaries" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../data_dictionaries/pudl_db.html">PUDL Data Dictionary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_dictionaries/ferc1_db.html">Raw FERC Form 1 Data Dictionary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_dictionaries/codes_and_labels.html">PUDL Code Metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_dictionaries/usage_warnings.html">PUDL Usage Warnings</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../methodology/index.html">Methodology</a><input aria-label="Toggle navigation of Methodology" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../methodology/timeseries_imputation.html">Timeseries Imputation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../methodology/sec10k_modeling.html">SEC 10-K Ownership Data Extraction Modeling</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../CONTRIBUTING.html">Contributing</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../dev/index.html">Development</a><input aria-label="Toggle navigation of Development" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/dev_setup.html">Development Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/run_the_etl.html">Running the ETL Pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/dev_dagster.html">Developing with Dagster</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/project_management.html">Project Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/testing.html">Testing PUDL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/data_validation_quickstart.html">Data validation quickstart</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/data_validation_reference.html">Data validation reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/metadata.html">Metadata editing guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/build_docs.html">Building the Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/datastore.html">Working with the Datastore</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/clone_ferc1.html">Converting raw FERC data to SQLite</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/existing_data_updates.html">Existing Data Updates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/run_a_release.html">Run a Versioned Release</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/pudl_id_mapping.html">PUDL ID Mapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/naming_conventions.html">Naming Conventions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/data_guidelines.html">Data and ETL Design Guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/nightly_data_builds.html">Nightly Data Builds</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/ferceqr_data_builds.html">FERC EQR Data Builds</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/infrastructure_as_code.html">Infrastructure as Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/managing_external_contributions.html">Managing External Contributions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../LICENSE.html">Licensing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../code_of_conduct.html">Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release_notes.html">Release Notes</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../autoapi/index.html">API Reference</a><input aria-label="Toggle navigation of API Reference" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../autoapi/pudl/index.html">pudl</a><input aria-label="Toggle navigation of pudl" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/pudl/__main__/index.html">pudl.__main__</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/pudl/_version/index.html">pudl._version</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../autoapi/pudl/analysis/index.html">pudl.analysis</a><input aria-label="Toggle navigation of pudl.analysis" class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/analysis/allocate_gen_fuel/index.html">pudl.analysis.allocate_gen_fuel</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/analysis/fuel_by_plant/index.html">pudl.analysis.fuel_by_plant</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/analysis/mcoe/index.html">pudl.analysis.mcoe</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/analysis/ml_tools/index.html">pudl.analysis.ml_tools</a><input aria-label="Toggle navigation of pudl.analysis.ml_tools" class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/analysis/ml_tools/experiment_tracking/index.html">pudl.analysis.ml_tools.experiment_tracking</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/analysis/ml_tools/models/index.html">pudl.analysis.ml_tools.models</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/analysis/plant_parts_eia/index.html">pudl.analysis.plant_parts_eia</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/analysis/record_linkage/index.html">pudl.analysis.record_linkage</a><input aria-label="Toggle navigation of pudl.analysis.record_linkage" class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/analysis/record_linkage/classify_plants_ferc1/index.html">pudl.analysis.record_linkage.classify_plants_ferc1</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/analysis/record_linkage/eia_ferc1_inputs/index.html">pudl.analysis.record_linkage.eia_ferc1_inputs</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/analysis/record_linkage/eia_ferc1_model_config/index.html">pudl.analysis.record_linkage.eia_ferc1_model_config</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/analysis/record_linkage/eia_ferc1_record_linkage/index.html">pudl.analysis.record_linkage.eia_ferc1_record_linkage</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/analysis/record_linkage/eia_ferc1_train/index.html">pudl.analysis.record_linkage.eia_ferc1_train</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/analysis/record_linkage/embed_dataframe/index.html">pudl.analysis.record_linkage.embed_dataframe</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/analysis/record_linkage/link_cross_year/index.html">pudl.analysis.record_linkage.link_cross_year</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/analysis/record_linkage/name_cleaner/index.html">pudl.analysis.record_linkage.name_cleaner</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/analysis/service_territory/index.html">pudl.analysis.service_territory</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/analysis/spatial/index.html">pudl.analysis.spatial</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/analysis/state_demand/index.html">pudl.analysis.state_demand</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/analysis/timeseries_cleaning/index.html">pudl.analysis.timeseries_cleaning</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/analysis/timeseries_evaluation/index.html">pudl.analysis.timeseries_evaluation</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../autoapi/pudl/convert/index.html">pudl.convert</a><input aria-label="Toggle navigation of pudl.convert" class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/convert/censusdp1tract_to_sqlite/index.html">pudl.convert.censusdp1tract_to_sqlite</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/convert/metadata_to_rst/index.html">pudl.convert.metadata_to_rst</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/pudl/dbt_wrapper/index.html">pudl.dbt_wrapper</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../autoapi/pudl/etl/index.html">pudl.etl</a><input aria-label="Toggle navigation of pudl.etl" class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/etl/asset_checks/index.html">pudl.etl.asset_checks</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/etl/check_foreign_keys/index.html">pudl.etl.check_foreign_keys</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/etl/cli/index.html">pudl.etl.cli</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/etl/eia_bulk_elec_assets/index.html">pudl.etl.eia_bulk_elec_assets</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/etl/ferceqr_deployment/index.html">pudl.etl.ferceqr_deployment</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/etl/glue_assets/index.html">pudl.etl.glue_assets</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/etl/static_assets/index.html">pudl.etl.static_assets</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../autoapi/pudl/extract/index.html">pudl.extract</a><input aria-label="Toggle navigation of pudl.extract" class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/censuspep/index.html">pudl.extract.censuspep</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/csv/index.html">pudl.extract.csv</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/dbf/index.html">pudl.extract.dbf</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/eia176/index.html">pudl.extract.eia176</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/eia191/index.html">pudl.extract.eia191</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/eia757a/index.html">pudl.extract.eia757a</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/eia860/index.html">pudl.extract.eia860</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/eia860m/index.html">pudl.extract.eia860m</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/eia861/index.html">pudl.extract.eia861</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/eia923/index.html">pudl.extract.eia923</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/eia930/index.html">pudl.extract.eia930</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/eiaaeo/index.html">pudl.extract.eiaaeo</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/eiaapi/index.html">pudl.extract.eiaapi</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/epacems/index.html">pudl.extract.epacems</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/excel/index.html">pudl.extract.excel</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/extractor/index.html">pudl.extract.extractor</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/ferc/index.html">pudl.extract.ferc</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/ferc1/index.html">pudl.extract.ferc1</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/ferc2/index.html">pudl.extract.ferc2</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/ferc6/index.html">pudl.extract.ferc6</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/ferc60/index.html">pudl.extract.ferc60</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/ferc714/index.html">pudl.extract.ferc714</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/ferccid/index.html">pudl.extract.ferccid</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/ferceqr/index.html">pudl.extract.ferceqr</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/gridpathratoolkit/index.html">pudl.extract.gridpathratoolkit</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/nrelatb/index.html">pudl.extract.nrelatb</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/parquet/index.html">pudl.extract.parquet</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/phmsagas/index.html">pudl.extract.phmsagas</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/rus12/index.html">pudl.extract.rus12</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/rus7/index.html">pudl.extract.rus7</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/sec10k/index.html">pudl.extract.sec10k</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/vcerare/index.html">pudl.extract.vcerare</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/xbrl/index.html">pudl.extract.xbrl</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../autoapi/pudl/ferc_to_sqlite/index.html">pudl.ferc_to_sqlite</a><input aria-label="Toggle navigation of pudl.ferc_to_sqlite" class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/ferc_to_sqlite/cli/index.html">pudl.ferc_to_sqlite.cli</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../autoapi/pudl/glue/index.html">pudl.glue</a><input aria-label="Toggle navigation of pudl.glue" class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/glue/ferc1_eia/index.html">pudl.glue.ferc1_eia</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/glue/ferc714/index.html">pudl.glue.ferc714</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/pudl/helpers/index.html">pudl.helpers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/pudl/io_managers/index.html">pudl.io_managers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/pudl/logging_helpers/index.html">pudl.logging_helpers</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../autoapi/pudl/metadata/index.html">pudl.metadata</a><input aria-label="Toggle navigation of pudl.metadata" class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/metadata/classes/index.html">pudl.metadata.classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/metadata/codes/index.html">pudl.metadata.codes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/metadata/constants/index.html">pudl.metadata.constants</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/metadata/descriptions/index.html">pudl.metadata.descriptions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/metadata/dfs/index.html">pudl.metadata.dfs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/metadata/enums/index.html">pudl.metadata.enums</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/metadata/fields/index.html">pudl.metadata.fields</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/metadata/helpers/index.html">pudl.metadata.helpers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/metadata/labels/index.html">pudl.metadata.labels</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/metadata/resource_helpers/index.html">pudl.metadata.resource_helpers</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/index.html">pudl.metadata.resources</a><input aria-label="Toggle navigation of pudl.metadata.resources" class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/allocate_gen_fuel/index.html">pudl.metadata.resources.allocate_gen_fuel</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/censusdp1tract/index.html">pudl.metadata.resources.censusdp1tract</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/eia/index.html">pudl.metadata.resources.eia</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/eia176/index.html">pudl.metadata.resources.eia176</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/eia860/index.html">pudl.metadata.resources.eia860</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/eia860m/index.html">pudl.metadata.resources.eia860m</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/eia861/index.html">pudl.metadata.resources.eia861</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/eia923/index.html">pudl.metadata.resources.eia923</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/eia930/index.html">pudl.metadata.resources.eia930</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/eiaaeo/index.html">pudl.metadata.resources.eiaaeo</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/eiaapi/index.html">pudl.metadata.resources.eiaapi</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/epacems/index.html">pudl.metadata.resources.epacems</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/ferc1/index.html">pudl.metadata.resources.ferc1</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/ferc1_eia_record_linkage/index.html">pudl.metadata.resources.ferc1_eia_record_linkage</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/ferc714/index.html">pudl.metadata.resources.ferc714</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/ferccid/index.html">pudl.metadata.resources.ferccid</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/ferceqr/index.html">pudl.metadata.resources.ferceqr</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/glue/index.html">pudl.metadata.resources.glue</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/gridpathratoolkit/index.html">pudl.metadata.resources.gridpathratoolkit</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/nrelatb/index.html">pudl.metadata.resources.nrelatb</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/phmsagas/index.html">pudl.metadata.resources.phmsagas</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/pudl/index.html">pudl.metadata.resources.pudl</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/rus12/index.html">pudl.metadata.resources.rus12</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/rus7/index.html">pudl.metadata.resources.rus7</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/sec10k/index.html">pudl.metadata.resources.sec10k</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/vcerare/index.html">pudl.metadata.resources.vcerare</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/metadata/sources/index.html">pudl.metadata.sources</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/metadata/warnings/index.html">pudl.metadata.warnings</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../autoapi/pudl/output/index.html">pudl.output</a><input aria-label="Toggle navigation of pudl.output" class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/output/censusdp1tract/index.html">pudl.output.censusdp1tract</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/output/eia/index.html">pudl.output.eia</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/output/eia860/index.html">pudl.output.eia860</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/output/eia923/index.html">pudl.output.eia923</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/output/eia930/index.html">pudl.output.eia930</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/output/eiaapi/index.html">pudl.output.eiaapi</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/output/ferc1/index.html">pudl.output.ferc1</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/output/ferc714/index.html">pudl.output.ferc714</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/output/sec10k/index.html">pudl.output.sec10k</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/output/sql/index.html">pudl.output.sql</a><input aria-label="Toggle navigation of pudl.output.sql" class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/output/sql/helpers/index.html">pudl.output.sql.helpers</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../autoapi/pudl/package_data/index.html">pudl.package_data</a><input aria-label="Toggle navigation of pudl.package_data" class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/package_data/censuspep/index.html">pudl.package_data.censuspep</a><input aria-label="Toggle navigation of pudl.package_data.censuspep" class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/package_data/censuspep/column_maps/index.html">pudl.package_data.censuspep.column_maps</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/package_data/eia176/index.html">pudl.package_data.eia176</a><input aria-label="Toggle navigation of pudl.package_data.eia176" class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" role="switch" type="checkbox"/><label for="toctree-checkbox-21"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/package_data/eia176/column_maps/index.html">pudl.package_data.eia176.column_maps</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/package_data/eia191/index.html">pudl.package_data.eia191</a><input aria-label="Toggle navigation of pudl.package_data.eia191" class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" role="switch" type="checkbox"/><label for="toctree-checkbox-22"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/package_data/eia191/column_maps/index.html">pudl.package_data.eia191.column_maps</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/package_data/eia757a/index.html">pudl.package_data.eia757a</a><input aria-label="Toggle navigation of pudl.package_data.eia757a" class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" role="switch" type="checkbox"/><label for="toctree-checkbox-23"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/package_data/eia757a/column_maps/index.html">pudl.package_data.eia757a.column_maps</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/package_data/eia860/index.html">pudl.package_data.eia860</a><input aria-label="Toggle navigation of pudl.package_data.eia860" class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" role="switch" type="checkbox"/><label for="toctree-checkbox-24"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/package_data/eia860/column_maps/index.html">pudl.package_data.eia860.column_maps</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/package_data/eia860m/index.html">pudl.package_data.eia860m</a><input aria-label="Toggle navigation of pudl.package_data.eia860m" class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" role="switch" type="checkbox"/><label for="toctree-checkbox-25"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/package_data/eia860m/column_maps/index.html">pudl.package_data.eia860m.column_maps</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/package_data/eia861/index.html">pudl.package_data.eia861</a><input aria-label="Toggle navigation of pudl.package_data.eia861" class="toctree-checkbox" id="toctree-checkbox-26" name="toctree-checkbox-26" role="switch" type="checkbox"/><label for="toctree-checkbox-26"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/package_data/eia861/column_maps/index.html">pudl.package_data.eia861.column_maps</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/package_data/eia923/index.html">pudl.package_data.eia923</a><input aria-label="Toggle navigation of pudl.package_data.eia923" class="toctree-checkbox" id="toctree-checkbox-27" name="toctree-checkbox-27" role="switch" type="checkbox"/><label for="toctree-checkbox-27"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/package_data/eia923/column_maps/index.html">pudl.package_data.eia923.column_maps</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/package_data/eia930/index.html">pudl.package_data.eia930</a><input aria-label="Toggle navigation of pudl.package_data.eia930" class="toctree-checkbox" id="toctree-checkbox-28" name="toctree-checkbox-28" role="switch" type="checkbox"/><label for="toctree-checkbox-28"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/package_data/eia930/column_maps/index.html">pudl.package_data.eia930.column_maps</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/package_data/epacems/index.html">pudl.package_data.epacems</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/package_data/ferc1/index.html">pudl.package_data.ferc1</a><input aria-label="Toggle navigation of pudl.package_data.ferc1" class="toctree-checkbox" id="toctree-checkbox-29" name="toctree-checkbox-29" role="switch" type="checkbox"/><label for="toctree-checkbox-29"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/package_data/ferc1/row_maps/index.html">pudl.package_data.ferc1.row_maps</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/package_data/glue/index.html">pudl.package_data.glue</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/package_data/phmsagas/index.html">pudl.package_data.phmsagas</a><input aria-label="Toggle navigation of pudl.package_data.phmsagas" class="toctree-checkbox" id="toctree-checkbox-30" name="toctree-checkbox-30" role="switch" type="checkbox"/><label for="toctree-checkbox-30"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/package_data/phmsagas/column_maps/index.html">pudl.package_data.phmsagas.column_maps</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/package_data/rus12/index.html">pudl.package_data.rus12</a><input aria-label="Toggle navigation of pudl.package_data.rus12" class="toctree-checkbox" id="toctree-checkbox-31" name="toctree-checkbox-31" role="switch" type="checkbox"/><label for="toctree-checkbox-31"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/package_data/rus12/column_maps/index.html">pudl.package_data.rus12.column_maps</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/package_data/rus7/index.html">pudl.package_data.rus7</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/package_data/settings/index.html">pudl.package_data.settings</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/package_data/test/index.html">pudl.package_data.test</a><input aria-label="Toggle navigation of pudl.package_data.test" class="toctree-checkbox" id="toctree-checkbox-32" name="toctree-checkbox-32" role="switch" type="checkbox"/><label for="toctree-checkbox-32"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/package_data/test/column_maps/index.html">pudl.package_data.test.column_maps</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/package_data/vcerare/index.html">pudl.package_data.vcerare</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/pudl/resources/index.html">pudl.resources</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../autoapi/pudl/scripts/index.html">pudl.scripts</a><input aria-label="Toggle navigation of pudl.scripts" class="toctree-checkbox" id="toctree-checkbox-33" name="toctree-checkbox-33" role="switch" type="checkbox"/><label for="toctree-checkbox-33"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/scripts/auto_match_utilities/index.html">pudl.scripts.auto_match_utilities</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/scripts/dbt_helper/index.html">pudl.scripts.dbt_helper</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/scripts/generate_pudl_duckdb/index.html">pudl.scripts.generate_pudl_duckdb</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/scripts/pudl_null_cols/index.html">pudl.scripts.pudl_null_cols</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/scripts/resource_description/index.html">pudl.scripts.resource_description</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/scripts/zenodo_data_release/index.html">pudl.scripts.zenodo_data_release</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/pudl/settings/index.html">pudl.settings</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../autoapi/pudl/transform/index.html">pudl.transform</a><input aria-label="Toggle navigation of pudl.transform" class="toctree-checkbox" id="toctree-checkbox-34" name="toctree-checkbox-34" role="switch" type="checkbox"/><label for="toctree-checkbox-34"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/censuspep/index.html">pudl.transform.censuspep</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/classes/index.html">pudl.transform.classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/eia/index.html">pudl.transform.eia</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/eia176/index.html">pudl.transform.eia176</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/eia860/index.html">pudl.transform.eia860</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/eia860m/index.html">pudl.transform.eia860m</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/eia861/index.html">pudl.transform.eia861</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/eia923/index.html">pudl.transform.eia923</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/eia930/index.html">pudl.transform.eia930</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/eiaaeo/index.html">pudl.transform.eiaaeo</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/eiaapi/index.html">pudl.transform.eiaapi</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/epacems/index.html">pudl.transform.epacems</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/ferc/index.html">pudl.transform.ferc</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/ferc1/index.html">pudl.transform.ferc1</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/ferc714/index.html">pudl.transform.ferc714</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/ferccid/index.html">pudl.transform.ferccid</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/ferceqr/index.html">pudl.transform.ferceqr</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/gridpathratoolkit/index.html">pudl.transform.gridpathratoolkit</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/nrelatb/index.html">pudl.transform.nrelatb</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/transform/params/index.html">pudl.transform.params</a><input aria-label="Toggle navigation of pudl.transform.params" class="toctree-checkbox" id="toctree-checkbox-35" name="toctree-checkbox-35" role="switch" type="checkbox"/><label for="toctree-checkbox-35"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/transform/params/ferc1/index.html">pudl.transform.params.ferc1</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/phmsagas/index.html">pudl.transform.phmsagas</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/rus/index.html">pudl.transform.rus</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/rus12/index.html">pudl.transform.rus12</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/rus7/index.html">pudl.transform.rus7</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/sec10k/index.html">pudl.transform.sec10k</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/vcerare/index.html">pudl.transform.vcerare</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/pudl/validate/index.html">pudl.validate</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../autoapi/pudl/workspace/index.html">pudl.workspace</a><input aria-label="Toggle navigation of pudl.workspace" class="toctree-checkbox" id="toctree-checkbox-36" name="toctree-checkbox-36" role="switch" type="checkbox"/><label for="toctree-checkbox-36"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/workspace/datastore/index.html">pudl.workspace.datastore</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/workspace/resource_cache/index.html">pudl.workspace.resource_cache</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/workspace/setup/index.html">pudl.workspace.setup</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../bibliography.html">Bibliography</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <h1>Source code for pudl.metadata.classes</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Metadata data classes.&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">copy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections.abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Iterable</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">cached_property</span><span class="p">,</span> <span class="n">lru_cache</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hashlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">sha1</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">re</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pattern</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Annotated</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">Self</span><span class="p">,</span> <span class="n">TypeVar</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">duckdb</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">frictionless</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">geopandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gpd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jinja2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandera.pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pr</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">polars</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pl</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyarrow</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pa</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pydantic</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sa</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pandas._libs.missing</span><span class="w"> </span><span class="kn">import</span> <span class="n">NAType</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">AnyHttpUrl</span><span class="p">,</span>
    <span class="n">BaseModel</span><span class="p">,</span>
    <span class="n">ConfigDict</span><span class="p">,</span>
    <span class="n">DirectoryPath</span><span class="p">,</span>
    <span class="n">EmailStr</span><span class="p">,</span>
    <span class="n">StrictBool</span><span class="p">,</span>
    <span class="n">StrictFloat</span><span class="p">,</span>
    <span class="n">StrictInt</span><span class="p">,</span>
    <span class="n">StrictStr</span><span class="p">,</span>
    <span class="n">StringConstraints</span><span class="p">,</span>
    <span class="n">ValidationInfo</span><span class="p">,</span>
    <span class="n">field_serializer</span><span class="p">,</span>
    <span class="n">field_validator</span><span class="p">,</span>
    <span class="n">model_validator</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pudl.logging_helpers</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pudl.metadata</span><span class="w"> </span><span class="kn">import</span> <span class="n">descriptions</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pudl.metadata.codes</span><span class="w"> </span><span class="kn">import</span> <span class="n">CODE_METADATA</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pudl.metadata.constants</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">CONSTRAINT_DTYPES</span><span class="p">,</span>
    <span class="n">CONTRIBUTORS</span><span class="p">,</span>
    <span class="n">FIELD_DTYPES_DUCKDB</span><span class="p">,</span>
    <span class="n">FIELD_DTYPES_PANDAS</span><span class="p">,</span>
    <span class="n">FIELD_DTYPES_POLARS</span><span class="p">,</span>
    <span class="n">FIELD_DTYPES_PYARROW</span><span class="p">,</span>
    <span class="n">FIELD_DTYPES_SQL</span><span class="p">,</span>
    <span class="n">LICENSES</span><span class="p">,</span>
    <span class="n">PERIODS</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pudl.metadata.fields</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">FIELD_METADATA</span><span class="p">,</span>
    <span class="n">FIELD_METADATA_BY_GROUP</span><span class="p">,</span>
    <span class="n">FIELD_METADATA_BY_RESOURCE</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pudl.metadata.helpers</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">expand_periodic_column_names</span><span class="p">,</span>
    <span class="n">format_errors</span><span class="p">,</span>
    <span class="n">groupby_aggregate</span><span class="p">,</span>
    <span class="n">most_and_more_frequent</span><span class="p">,</span>
    <span class="n">split_period</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pudl.metadata.resources</span><span class="w"> </span><span class="kn">import</span> <span class="n">FOREIGN_KEYS</span><span class="p">,</span> <span class="n">RESOURCE_METADATA</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pudl.metadata.sources</span><span class="w"> </span><span class="kn">import</span> <span class="n">SOURCES</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pudl.workspace.datastore</span><span class="w"> </span><span class="kn">import</span> <span class="n">Datastore</span><span class="p">,</span> <span class="n">ZenodoDoi</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pudl.workspace.setup</span><span class="w"> </span><span class="kn">import</span> <span class="n">PudlPaths</span>

<div class="viewcode-block" id="logger">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.logger">[docs]</a>
<span class="n">logger</span> <span class="o">=</span> <span class="n">pudl</span><span class="o">.</span><span class="n">logging_helpers</span><span class="o">.</span><span class="n">get_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span></div>


<span class="c1"># The &#39;schema&#39; field in Resource shadows BaseModel.schema() (deprecated in Pydantic v2).</span>
<span class="c1"># This is intentional to mirror the Frictionless Data standard and avoid the need to</span>
<span class="c1"># define an inconvenient alias.</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span>
    <span class="n">action</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span>
    <span class="n">message</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;Field name &quot;schema&quot; in &quot;Resource&quot; shadows an attribute in parent&#39;</span><span class="p">,</span>
    <span class="n">category</span><span class="o">=</span><span class="ne">UserWarning</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># ---- Helpers ---- #</span>


<div class="viewcode-block" id="_unique">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl._unique">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">_unique</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a list of all unique values, in order of first appearance.</span>

<span class="sd">    Args:</span>
<span class="sd">        args: Iterables of values.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; _unique([0, 2], (2, 1))</span>
<span class="sd">        [0, 2, 1]</span>
<span class="sd">        &gt;&gt;&gt; _unique([{&#39;x&#39;: 0, &#39;y&#39;: 1}, {&#39;y&#39;: 1, &#39;x&#39;: 0}], [{&#39;z&#39;: 2}])</span>
<span class="sd">        [{&#39;x&#39;: 0, &#39;y&#39;: 1}, {&#39;z&#39;: 2}]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">parent</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">child</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
                <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">values</span></div>



<div class="viewcode-block" id="_format_for_sql">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl._format_for_sql">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">_format_for_sql</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">identifier</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>  <span class="c1"># noqa: C901</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Format value for use in raw SQL(ite).</span>

<span class="sd">    Args:</span>
<span class="sd">        x: Value to format.</span>
<span class="sd">        identifier: Whether ``x`` represents an identifier</span>
<span class="sd">            (e.g. table, column) name.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; _format_for_sql(&#39;table_name&#39;, identifier=True)</span>
<span class="sd">        &#39;&quot;table_name&quot;&#39;</span>
<span class="sd">        &gt;&gt;&gt; _format_for_sql(&#39;any string&#39;)</span>
<span class="sd">        &quot;&#39;any string&#39;&quot;</span>
<span class="sd">        &gt;&gt;&gt; _format_for_sql(&quot;Single&#39;s quote&quot;)</span>
<span class="sd">        &quot;&#39;Single&#39;&#39;s quote&#39;&quot;</span>
<span class="sd">        &gt;&gt;&gt; _format_for_sql(None)</span>
<span class="sd">        &#39;null&#39;</span>
<span class="sd">        &gt;&gt;&gt; _format_for_sql(1)</span>
<span class="sd">        &#39;1&#39;</span>
<span class="sd">        &gt;&gt;&gt; _format_for_sql(True)</span>
<span class="sd">        &#39;True&#39;</span>
<span class="sd">        &gt;&gt;&gt; _format_for_sql(False)</span>
<span class="sd">        &#39;False&#39;</span>
<span class="sd">        &gt;&gt;&gt; _format_for_sql(re.compile(&quot;^[^&#39;]*$&quot;))</span>
<span class="sd">        &quot;&#39;^[^&#39;&#39;]*$&#39;&quot;</span>
<span class="sd">        &gt;&gt;&gt; _format_for_sql(datetime.date(2020, 1, 2))</span>
<span class="sd">        &quot;&#39;2020-01-02&#39;&quot;</span>
<span class="sd">        &gt;&gt;&gt; _format_for_sql(datetime.datetime(2020, 1, 2, 3, 4, 5, 6))</span>
<span class="sd">        &quot;&#39;2020-01-02 03:04:05&#39;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">identifier</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="c1"># Table and column names are escaped with double quotes (&quot;)</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Identifier must be a string&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;null&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">):</span>
        <span class="c1"># NOTE: nan and (-)inf are TEXT in sqlite but numeric in postgresSQL</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;TRUE&quot;</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;FALSE&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">Pattern</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">pattern</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
        <span class="c1"># Check datetime.datetime first, since also datetime.date</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot format type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="si">}</span><span class="s2"> for SQL&quot;</span><span class="p">)</span>
    <span class="c1"># Single quotes (&#39;) are escaped by doubling them (&#39;&#39;)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&#39;&#39;&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&#39;&quot;</span></div>



<div class="viewcode-block" id="_get_jinja_environment">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl._get_jinja_environment">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">_get_jinja_environment</span><span class="p">(</span><span class="n">template_dir</span><span class="p">:</span> <span class="n">DirectoryPath</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">template_dir</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">template_dir</span> <span class="o">/</span> <span class="s2">&quot;templates&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;templates&quot;</span>
    <span class="n">environment</span> <span class="o">=</span> <span class="n">jinja2</span><span class="o">.</span><span class="n">Environment</span><span class="p">(</span>
        <span class="n">loader</span><span class="o">=</span><span class="n">jinja2</span><span class="o">.</span><span class="n">FileSystemLoader</span><span class="p">(</span><span class="n">path</span><span class="p">),</span>
        <span class="n">autoescape</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">environment</span></div>



<span class="c1"># ---- Class attribute types ---- #</span>

<span class="c1"># NOTE: Using regex=r&quot;^\S(.*\S)*$&quot; to fail on whitespace is too slow</span>
<div class="viewcode-block" id="String">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.String">[docs]</a>
<span class="n">String</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span>
    <span class="nb">str</span><span class="p">,</span> <span class="n">StringConstraints</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;^\S+(\s+\S+)*$&quot;</span><span class="p">)</span>
<span class="p">]</span></div>

<span class="sd">&quot;&quot;&quot;Non-empty :class:`str` with no trailing or leading whitespace.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="SnakeCase">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.SnakeCase">[docs]</a>
<span class="n">SnakeCase</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span>
    <span class="nb">str</span><span class="p">,</span>
    <span class="n">StringConstraints</span><span class="p">(</span>
        <span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;^[a-z_][a-z0-9_]*(_[a-z0-9]+)*$&quot;</span>
    <span class="p">),</span>
<span class="p">]</span></div>

<span class="sd">&quot;&quot;&quot;Snake-case variable name :class:`str` (e.g. &#39;pudl&#39;, &#39;entity_eia860&#39;).&quot;&quot;&quot;</span>

<div class="viewcode-block" id="PositiveInt">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.PositiveInt">[docs]</a>
<span class="n">PositiveInt</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">pydantic</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">)]</span></div>

<span class="sd">&quot;&quot;&quot;Positive :class:`int`.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="PositiveFloat">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.PositiveFloat">[docs]</a>
<span class="n">PositiveFloat</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">pydantic</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">)]</span></div>

<span class="sd">&quot;&quot;&quot;Positive :class:`float`.&quot;&quot;&quot;</span>


<div class="viewcode-block" id="T">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.T">[docs]</a>
<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="StrictList">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.StrictList">[docs]</a>
<span class="n">StrictList</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">T</span><span class="p">],</span> <span class="n">pydantic</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span></div>



<span class="sd">&quot;&quot;&quot;Non-empty :class:`list`.</span>

<span class="sd">Allows :class:`list`, :class:`tuple`, :class:`set`, :class:`frozenset`,</span>
<span class="sd">:class:`collections.deque`, or generators and casts to a :class:`list`.</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="c1"># ---- Class attribute validators ---- #</span>


<div class="viewcode-block" id="_check_unique">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl._check_unique">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">_check_unique</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check that input list has unique values.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">value</span><span class="p">[:</span><span class="n">i</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;contains duplicate </span><span class="si">{</span><span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">value</span></div>



<div class="viewcode-block" id="_validator">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl._validator">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">_validator</span><span class="p">(</span><span class="o">*</span><span class="n">names</span><span class="p">,</span> <span class="n">fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Construct reusable Pydantic validator.</span>

<span class="sd">    Args:</span>
<span class="sd">        names: Names of attributes to validate.</span>
<span class="sd">        fn: Validation function (see :meth:`pydantic.field_validator`).</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; class Class(BaseModel):</span>
<span class="sd">        ...     x: list = None</span>
<span class="sd">        ...     _check_unique = _validator(&quot;x&quot;, fn=_check_unique)</span>
<span class="sd">        &gt;&gt;&gt; Class(x=[0, 0])</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ValidationError: ...</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">field_validator</span><span class="p">(</span><span class="o">*</span><span class="n">names</span><span class="p">)(</span><span class="n">fn</span><span class="p">)</span></div>



<span class="c1">########################################################################################</span>
<span class="c1"># PUDL Metadata Classes</span>
<span class="c1">########################################################################################</span>
<div class="viewcode-block" id="PudlMeta">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.PudlMeta">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PudlMeta</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A base model that configures some options for PUDL metadata classes.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="PudlMeta.model_config">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.PudlMeta.model_config">[docs]</a>
    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span>
        <span class="n">extra</span><span class="o">=</span><span class="s2">&quot;forbid&quot;</span><span class="p">,</span>
        <span class="n">validate_default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">validate_assignment</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="FieldConstraints">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.FieldConstraints">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">FieldConstraints</span><span class="p">(</span><span class="n">PudlMeta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Field constraints (`resource.schema.fields[...].constraints`).</span>

<span class="sd">    See https://specs.frictionlessdata.io/table-schema/#constraints.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="FieldConstraints.required">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.FieldConstraints.required">[docs]</a>
    <span class="n">required</span><span class="p">:</span> <span class="n">StrictBool</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="FieldConstraints.unique">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.FieldConstraints.unique">[docs]</a>
    <span class="n">unique</span><span class="p">:</span> <span class="n">StrictBool</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="FieldConstraints.min_length">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.FieldConstraints.min_length">[docs]</a>
    <span class="n">min_length</span><span class="p">:</span> <span class="n">PositiveInt</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="FieldConstraints.max_length">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.FieldConstraints.max_length">[docs]</a>
    <span class="n">max_length</span><span class="p">:</span> <span class="n">PositiveInt</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="FieldConstraints.minimum">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.FieldConstraints.minimum">[docs]</a>
    <span class="n">minimum</span><span class="p">:</span> <span class="n">StrictInt</span> <span class="o">|</span> <span class="n">StrictFloat</span> <span class="o">|</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span> <span class="o">|</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="FieldConstraints.maximum">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.FieldConstraints.maximum">[docs]</a>
    <span class="n">maximum</span><span class="p">:</span> <span class="n">StrictInt</span> <span class="o">|</span> <span class="n">StrictFloat</span> <span class="o">|</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span> <span class="o">|</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="FieldConstraints.pattern">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.FieldConstraints.pattern">[docs]</a>
    <span class="n">pattern</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">Pattern</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="FieldConstraints.enum">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.FieldConstraints.enum">[docs]</a>
    <span class="n">enum</span><span class="p">:</span> <span class="p">(</span>
        <span class="n">StrictList</span><span class="p">[</span>
            <span class="n">String</span>
            <span class="o">|</span> <span class="n">StrictInt</span>
            <span class="o">|</span> <span class="n">StrictFloat</span>
            <span class="o">|</span> <span class="n">StrictBool</span>
            <span class="o">|</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span>
            <span class="o">|</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span>
        <span class="p">]</span>
        <span class="o">|</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">=</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="FieldConstraints._check_unique">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.FieldConstraints._check_unique">[docs]</a>
    <span class="n">_check_unique</span> <span class="o">=</span> <span class="n">_validator</span><span class="p">(</span><span class="s2">&quot;enum&quot;</span><span class="p">,</span> <span class="n">fn</span><span class="o">=</span><span class="n">_check_unique</span><span class="p">)</span></div>


    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;max_length&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="FieldConstraints._check_max_length">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.FieldConstraints._check_max_length">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_check_max_length</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">info</span><span class="p">:</span> <span class="n">ValidationInfo</span><span class="p">):</span>
        <span class="n">minimum</span><span class="p">,</span> <span class="n">maximum</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;min_length&quot;</span><span class="p">),</span> <span class="n">value</span>
        <span class="k">if</span> <span class="n">minimum</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">maximum</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">minimum</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">maximum</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;must be same type as min_length&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">maximum</span> <span class="o">&lt;</span> <span class="n">minimum</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;must be greater or equal to min_length&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span></div>


    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;maximum&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="FieldConstraints._check_max">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.FieldConstraints._check_max">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_check_max</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">info</span><span class="p">:</span> <span class="n">ValidationInfo</span><span class="p">):</span>
        <span class="n">minimum</span><span class="p">,</span> <span class="n">maximum</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;minimum&quot;</span><span class="p">),</span> <span class="n">value</span>
        <span class="k">if</span> <span class="n">minimum</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">maximum</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">minimum</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">maximum</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;must be same type as minimum&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">maximum</span> <span class="o">&lt;</span> <span class="n">minimum</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;must be greater or equal to minimum&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span></div>


<div class="viewcode-block" id="FieldConstraints.to_pandera_checks">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.FieldConstraints.to_pandera_checks">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_pandera_checks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">pr</span><span class="o">.</span><span class="n">Check</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert these constraints to pandera Column checks.&quot;&quot;&quot;</span>
        <span class="n">checks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">checks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pr</span><span class="o">.</span><span class="n">Check</span><span class="o">.</span><span class="n">str_length</span><span class="p">(</span><span class="n">min_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">min_length</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">checks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pr</span><span class="o">.</span><span class="n">Check</span><span class="o">.</span><span class="n">str_length</span><span class="p">(</span><span class="n">max_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_length</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">minimum</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">checks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pr</span><span class="o">.</span><span class="n">Check</span><span class="o">.</span><span class="n">ge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minimum</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">maximum</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">checks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pr</span><span class="o">.</span><span class="n">Check</span><span class="o">.</span><span class="n">le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maximum</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">checks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pr</span><span class="o">.</span><span class="n">Check</span><span class="o">.</span><span class="n">str_matches</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enum</span><span class="p">:</span>
            <span class="n">checks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pr</span><span class="o">.</span><span class="n">Check</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">enum</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">checks</span></div>
</div>



<div class="viewcode-block" id="FieldHarvest">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.FieldHarvest">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">FieldHarvest</span><span class="p">(</span><span class="n">PudlMeta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Field harvest parameters (`resource.schema.fields[...].harvest`).&quot;&quot;&quot;</span>

    <span class="c1"># NOTE: Callables with defaults must use pydantic.Field() to not bind to self</span>
<div class="viewcode-block" id="FieldHarvest.aggregate">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.FieldHarvest.aggregate">[docs]</a>
    <span class="n">aggregate</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">],</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">]</span> <span class="o">=</span> <span class="n">pydantic</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">most_and_more_frequent</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">min_frequency</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
    <span class="p">)</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;Computes a single value from all field values in a group.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="FieldHarvest.tolerance">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.FieldHarvest.tolerance">[docs]</a>
    <span class="n">tolerance</span><span class="p">:</span> <span class="n">PositiveFloat</span> <span class="o">=</span> <span class="mf">0.0</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fraction of invalid groups above which result is considered invalid.&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="Encoder">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Encoder">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Encoder</span><span class="p">(</span><span class="n">PudlMeta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A class that allows us to standardize reported categorical codes.</span>

<span class="sd">    Often the original data we are integrating uses short codes to indicate a</span>
<span class="sd">    categorical value, like ``ST`` in place of &quot;steam turbine&quot; or ``LIG`` in place of</span>
<span class="sd">    &quot;lignite coal&quot;. Many of these coded fields contain non-standard codes due to</span>
<span class="sd">    data-entry errors. The codes have also evolved over the years.</span>

<span class="sd">    In order to allow easy comparison of records across all years and tables, we define</span>
<span class="sd">    a standard set of codes, a mapping from non-standard codes to standard codes (where</span>
<span class="sd">    possible), and a set of known but unfixable codes which will be ignored and replaced</span>
<span class="sd">    with NA values. These definitions can be found in :mod:`pudl.metadata.codes` and we</span>
<span class="sd">    refer to these as coding tables.</span>

<span class="sd">    In our metadata structures, each coding table is defined just like any other DB</span>
<span class="sd">    table, with the addition of an associated ``Encoder`` object defining the standard,</span>
<span class="sd">    fixable, and ignored codes.</span>

<span class="sd">    In addition, a :class:`Package` class that has been instantiated using the</span>
<span class="sd">    :meth:`Package.from_resource_ids` method will associate an ``Encoder`` object with any</span>
<span class="sd">    column that has a foreign key constraint referring to a coding table (This</span>
<span class="sd">    column-level encoder is same as the encoder associated with the referenced table).</span>
<span class="sd">    This ``Encoder`` can be used to standardize the codes found within the column.</span>

<span class="sd">    :class:`Field` and :class:`Resource` objects have ``encode()`` methods that will</span>
<span class="sd">    use the column-level encoders to recode the original values, either for a single</span>
<span class="sd">    column or for all coded columns within a Resource, given either a corresponding</span>
<span class="sd">    :class:`pandas.Series` or :class:`pandas.DataFrame` containing actual values.</span>

<span class="sd">    If any unrecognized values are encountered, an exception will be raised, alerting</span>
<span class="sd">    us that a new code has been identified, and needs to be classified as fixable or</span>
<span class="sd">    to be ignored.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Encoder.df">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Encoder.df">[docs]</a>
    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;A table associating short codes with long descriptions and other information.</span>

<span class="sd">    Each coding table contains at least a ``code`` column containing the standard codes</span>
<span class="sd">    and a ``description`` column with a human readable explanation of what the code</span>
<span class="sd">    stands for. Additional metadata pertaining to the codes and their categories may</span>
<span class="sd">    also appear in this dataframe, which will be loaded into the PUDL DB as a static</span>
<span class="sd">    table. The ``code`` column is a natural primary key and must contain no duplicate</span>
<span class="sd">    values.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Encoder.ignored_codes">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Encoder.ignored_codes">[docs]</a>
    <span class="n">ignored_codes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">StrictInt</span> <span class="o">|</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;A list of non-standard codes which appear in the data, and will be set to NA.</span>

<span class="sd">    These codes may be the result of data entry errors, and we are unable to map them to</span>
<span class="sd">    the appropriate canonical code. They are discarded from the raw input data.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Encoder.code_fixes">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Encoder.code_fixes">[docs]</a>
    <span class="n">code_fixes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">StrictInt</span> <span class="o">|</span> <span class="n">String</span><span class="p">,</span> <span class="n">StrictInt</span> <span class="o">|</span> <span class="n">String</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;A dictionary mapping non-standard codes to canonical, standardized codes.</span>

<span class="sd">    The intended meanings of some non-standard codes are clear, and therefore they can</span>
<span class="sd">    be mapped to the standardized, canonical codes with confidence. Sometimes these are</span>
<span class="sd">    the result of data entry errors or changes in the standard codes over time.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Encoder.name">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Encoder.name">[docs]</a>
    <span class="n">name</span><span class="p">:</span> <span class="n">String</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;The name of the code.&quot;&quot;&quot;</span>

    <span class="c1"># Required to allow DataFrame</span>
<div class="viewcode-block" id="Encoder.model_config">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Encoder.model_config">[docs]</a>
    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span><span class="n">arbitrary_types_allowed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;df&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Encoder._df_is_encoding_table">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Encoder._df_is_encoding_table">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_df_is_encoding_table</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Verify that the coding table provides both codes and descriptions.&quot;&quot;&quot;</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="s2">&quot;code&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">or</span> <span class="s2">&quot;description&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="s2">&quot;Encoding tables must contain both &#39;code&#39; &amp; &#39;description&#39; columns.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">code</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">unique</span><span class="p">()):</span>
            <span class="n">dupes</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Duplicate codes </span><span class="si">{</span><span class="n">dupes</span><span class="si">}</span><span class="s2"> found in coding table&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">format_errors</span><span class="p">(</span><span class="o">*</span><span class="n">errors</span><span class="p">,</span> <span class="n">pydantic</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">df</span></div>


    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;ignored_codes&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Encoder._good_and_ignored_codes_are_disjoint">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Encoder._good_and_ignored_codes_are_disjoint">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_good_and_ignored_codes_are_disjoint</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">ignored_codes</span><span class="p">,</span> <span class="n">info</span><span class="p">:</span> <span class="n">ValidationInfo</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check that there&#39;s no overlap between good and ignored codes.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;df&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">info</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ignored_codes</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">overlap</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;df&quot;</span><span class="p">][</span><span class="s2">&quot;code&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">ignored_codes</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">overlap</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Overlap found between good and ignored codes: </span><span class="si">{</span><span class="n">overlap</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">format_errors</span><span class="p">(</span><span class="o">*</span><span class="n">errors</span><span class="p">,</span> <span class="n">pydantic</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ignored_codes</span></div>


    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;code_fixes&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Encoder._good_and_fixable_codes_are_disjoint">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Encoder._good_and_fixable_codes_are_disjoint">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_good_and_fixable_codes_are_disjoint</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">code_fixes</span><span class="p">,</span> <span class="n">info</span><span class="p">:</span> <span class="n">ValidationInfo</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check that there&#39;s no overlap between the good and fixable codes.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;df&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">info</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">code_fixes</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">overlap</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;df&quot;</span><span class="p">][</span><span class="s2">&quot;code&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">code_fixes</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">overlap</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Overlap found between good and fixable codes: </span><span class="si">{</span><span class="n">overlap</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">format_errors</span><span class="p">(</span><span class="o">*</span><span class="n">errors</span><span class="p">,</span> <span class="n">pydantic</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">code_fixes</span></div>


    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;code_fixes&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Encoder._fixable_and_ignored_codes_are_disjoint">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Encoder._fixable_and_ignored_codes_are_disjoint">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_fixable_and_ignored_codes_are_disjoint</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">code_fixes</span><span class="p">,</span> <span class="n">info</span><span class="p">:</span> <span class="n">ValidationInfo</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check that there&#39;s no overlap between the ignored and fixable codes.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;ignored_codes&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">info</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">code_fixes</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">overlap</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">code_fixes</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;ignored_codes&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">overlap</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Overlap found between fixable and ignored codes: </span><span class="si">{</span><span class="n">overlap</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">format_errors</span><span class="p">(</span><span class="o">*</span><span class="n">errors</span><span class="p">,</span> <span class="n">pydantic</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">code_fixes</span></div>


    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;code_fixes&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Encoder._check_fixed_codes_are_good_codes">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Encoder._check_fixed_codes_are_good_codes">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_check_fixed_codes_are_good_codes</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">code_fixes</span><span class="p">,</span> <span class="n">info</span><span class="p">:</span> <span class="n">ValidationInfo</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check that every fixed code is also one of the good codes.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;df&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">info</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">code_fixes</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">bad_codes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">code_fixes</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;df&quot;</span><span class="p">][</span><span class="s2">&quot;code&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">bad_codes</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Some fixed codes aren&#39;t in the list of good codes: </span><span class="si">{</span><span class="n">bad_codes</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">format_errors</span><span class="p">(</span><span class="o">*</span><span class="n">errors</span><span class="p">,</span> <span class="n">pydantic</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">code_fixes</span></div>


    <span class="nd">@property</span>
<div class="viewcode-block" id="Encoder.code_map">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Encoder.code_map">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">code_map</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">NAType</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A mapping of all known codes to their standardized values, or NA.&quot;&quot;&quot;</span>
        <span class="n">code_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">code</span><span class="p">:</span> <span class="n">code</span> <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;code&quot;</span><span class="p">]}</span>
        <span class="n">code_map</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code_fixes</span><span class="p">)</span>
        <span class="n">code_map</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ignored_codes</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">code_map</span></div>


<div class="viewcode-block" id="Encoder.encode">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Encoder.encode">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">encode</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">col</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
        <span class="n">dtype</span><span class="p">:</span> <span class="nb">type</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply the stored code mapping to an input Series.&quot;&quot;&quot;</span>
        <span class="c1"># Every value in the Series should appear in the map. If that&#39;s not the</span>
        <span class="c1"># case we want to hear about it so we don&#39;t wipe out data unknowingly.</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Encoding </span><span class="si">{</span><span class="n">col</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">unknown_codes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">dropna</span><span class="p">())</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code_map</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">unknown_codes</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Found unknown codes while encoding </span><span class="si">{</span><span class="n">col</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">unknown_codes</span><span class="si">=}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Expected: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">code_map</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Distribution: </span><span class="si">{</span><span class="n">col</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="n">col</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code_map</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dtype</span><span class="p">:</span>
            <span class="n">col</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">col</span></div>


    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Encoder.dict_from_id">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Encoder.dict_from_id">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">dict_from_id</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Look up the encoder by coding table name in the metadata.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">RESOURCE_METADATA</span><span class="p">[</span><span class="n">x</span><span class="p">])</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;encoder&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>


    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Encoder.from_id">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Encoder.from_id">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_id</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Encoder&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct an Encoder based on ``Resource.name`` of a coding table.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="bp">cls</span><span class="o">.</span><span class="n">dict_from_id</span><span class="p">(</span><span class="n">x</span><span class="p">))</span></div>


    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Encoder.from_code_id">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Encoder.from_code_id">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_code_id</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Encoder&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct an Encoder by looking up name of coding table in codes metadata.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">CODE_METADATA</span><span class="p">[</span><span class="n">x</span><span class="p">]),</span> <span class="n">name</span><span class="o">=</span><span class="n">x</span><span class="p">)</span></div>


<div class="viewcode-block" id="Encoder.to_rst">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Encoder.to_rst">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_rst</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">top_dir</span><span class="p">:</span> <span class="n">DirectoryPath</span><span class="p">,</span> <span class="n">csv_subdir</span><span class="p">:</span> <span class="n">DirectoryPath</span><span class="p">,</span> <span class="n">is_header</span><span class="p">:</span> <span class="n">StrictBool</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">String</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Output dataframe to a csv for use in jinja template.</span>

<span class="sd">        Then output to an RST file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">top_dir</span><span class="p">)</span> <span class="o">/</span> <span class="n">csv_subdir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">_get_jinja_environment</span><span class="p">(</span><span class="n">top_dir</span><span class="p">)</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span>
            <span class="s2">&quot;codemetadata.rst.jinja&quot;</span>
        <span class="p">)</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span>
            <span class="n">Encoder</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="c1"># just get the resolved resource summary &amp; drop all the other sections of the description</span>
            <span class="n">description</span><span class="o">=</span><span class="n">PUDL_PACKAGE</span><span class="o">.</span><span class="n">get_resource</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">description</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">csv_filepath</span><span class="o">=</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="n">csv_subdir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">),</span>
            <span class="n">is_header</span><span class="o">=</span><span class="n">is_header</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">rendered</span></div>


<div class="viewcode-block" id="Encoder.generate_encodable_data">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Encoder.generate_encodable_data">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">generate_encodable_data</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Self</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Produce a series of data which can be encoded by this encoder.</span>

<span class="sd">        Selects values randomly from valid, ignored, and fixable codes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
            <span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;code&quot;</span><span class="p">])</span>
                <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ignored_codes</span><span class="p">)</span>
                <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code_fixes</span><span class="p">),</span>
                <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="Field">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Field">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Field</span><span class="p">(</span><span class="n">PudlMeta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Field (`resource.schema.fields[...]`).</span>

<span class="sd">    See https://specs.frictionlessdata.io/table-schema/#field-descriptors.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; field = Field(name=&#39;x&#39;, type=&#39;string&#39;, description=&#39;X&#39;, constraints={&#39;enum&#39;: [&#39;x&#39;, &#39;y&#39;]})</span>
<span class="sd">        &gt;&gt;&gt; field.to_pandas_dtype()</span>
<span class="sd">        CategoricalDtype(categories=[&#39;x&#39;, &#39;y&#39;], ordered=False, categories_dtype=object)</span>
<span class="sd">        &gt;&gt;&gt; field.to_sql()</span>
<span class="sd">        Column(&#39;x&#39;, Enum(&#39;x&#39;, &#39;y&#39;), CheckConstraint(...), table=None, comment=&#39;X&#39;)</span>
<span class="sd">        &gt;&gt;&gt; field = Field.from_id(&#39;utility_id_eia&#39;)</span>
<span class="sd">        &gt;&gt;&gt; field.name</span>
<span class="sd">        &#39;utility_id_eia&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Field.name">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Field.name">[docs]</a>
    <span class="n">name</span><span class="p">:</span> <span class="n">SnakeCase</span></div>

    <span class="c1"># Shadows built-in type.</span>
<div class="viewcode-block" id="Field.type">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Field.type">[docs]</a>
    <span class="nb">type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span>
        <span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="s2">&quot;number&quot;</span><span class="p">,</span> <span class="s2">&quot;integer&quot;</span><span class="p">,</span> <span class="s2">&quot;boolean&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;datetime&quot;</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span>
    <span class="p">]</span></div>

<div class="viewcode-block" id="Field.title">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Field.title">[docs]</a>
    <span class="n">title</span><span class="p">:</span> <span class="n">String</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></div>

    <span class="c1"># Alias required to avoid shadowing Python built-in format()</span>
<div class="viewcode-block" id="Field.format_">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Field.format_">[docs]</a>
    <span class="n">format_</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pydantic</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">alias</span><span class="o">=</span><span class="s2">&quot;format&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Field.description">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Field.description">[docs]</a>
    <span class="n">description</span><span class="p">:</span> <span class="n">String</span></div>

<div class="viewcode-block" id="Field.unit">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Field.unit">[docs]</a>
    <span class="n">unit</span><span class="p">:</span> <span class="n">String</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Field.constraints">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Field.constraints">[docs]</a>
    <span class="n">constraints</span><span class="p">:</span> <span class="n">FieldConstraints</span> <span class="o">=</span> <span class="n">FieldConstraints</span><span class="p">()</span></div>

<div class="viewcode-block" id="Field.harvest">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Field.harvest">[docs]</a>
    <span class="n">harvest</span><span class="p">:</span> <span class="n">FieldHarvest</span> <span class="o">=</span> <span class="n">FieldHarvest</span><span class="p">()</span></div>

<div class="viewcode-block" id="Field.encoder">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Field.encoder">[docs]</a>
    <span class="n">encoder</span><span class="p">:</span> <span class="n">Encoder</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></div>


    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;constraints&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Field._check_constraints">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Field._check_constraints">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_check_constraints</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">info</span><span class="p">:</span> <span class="n">ValidationInfo</span><span class="p">):</span>  <span class="c1"># noqa: C901</span>
        <span class="k">if</span> <span class="s2">&quot;type&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">info</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;min_length&quot;</span><span class="p">,</span> <span class="s2">&quot;max_length&quot;</span><span class="p">,</span> <span class="s2">&quot;pattern&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">dtype</span> <span class="o">!=</span> <span class="s2">&quot;string&quot;</span><span class="p">:</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> not supported by </span><span class="si">{</span><span class="n">dtype</span><span class="si">}</span><span class="s2"> field&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;minimum&quot;</span><span class="p">,</span> <span class="s2">&quot;maximum&quot;</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dtype</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="s2">&quot;boolean&quot;</span><span class="p">):</span>
                    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> not supported by </span><span class="si">{</span><span class="n">dtype</span><span class="si">}</span><span class="s2"> field&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">CONSTRAINT_DTYPES</span><span class="p">[</span><span class="n">dtype</span><span class="p">]):</span>
                    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> not </span><span class="si">{</span><span class="n">dtype</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">enum</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">enum</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">CONSTRAINT_DTYPES</span><span class="p">[</span><span class="n">dtype</span><span class="p">]):</span>
                    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;enum value </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2"> not </span><span class="si">{</span><span class="n">dtype</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">format_errors</span><span class="p">(</span><span class="o">*</span><span class="n">errors</span><span class="p">,</span> <span class="n">pydantic</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">value</span></div>


    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;encoder&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Field._check_encoder">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Field._check_encoder">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_check_encoder</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">info</span><span class="p">:</span> <span class="n">ValidationInfo</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;type&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">info</span><span class="o">.</span><span class="n">data</span> <span class="ow">or</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="s2">&quot;integer&quot;</span><span class="p">]:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Encoding only supported for string and integer fields, found </span><span class="si">{</span><span class="n">dtype</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">format_errors</span><span class="p">(</span><span class="o">*</span><span class="n">errors</span><span class="p">,</span> <span class="n">pydantic</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">value</span></div>


    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Field.dict_from_id">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Field.dict_from_id">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">dict_from_id</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct dictionary from PUDL identifier (`Field.name`).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">FIELD_METADATA</span><span class="p">[</span><span class="n">x</span><span class="p">])}</span></div>


    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Field.from_id">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Field.from_id">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_id</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Field&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct from PUDL identifier (`Field.name`).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="bp">cls</span><span class="o">.</span><span class="n">dict_from_id</span><span class="p">(</span><span class="n">x</span><span class="p">))</span></div>


<div class="viewcode-block" id="Field.to_duckdb_dtype">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Field.to_duckdb_dtype">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_duckdb_dtype</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">conn</span><span class="p">:</span> <span class="n">duckdb</span><span class="o">.</span><span class="n">DuckDBPyConnection</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">duckdb</span><span class="o">.</span><span class="n">sqltypes</span><span class="o">.</span><span class="n">DuckDBPyType</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return duckdb data type.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">enum</span><span class="p">:</span>
            <span class="n">quoted_enum</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s2">&#39;&quot;</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">enum</span><span class="p">]</span>
            <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;CREATE TYPE </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_type as ENUM (</span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">quoted_enum</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">conn</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_type&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">FIELD_DTYPES_DUCKDB</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">]</span></div>


<div class="viewcode-block" id="Field.to_polars_dtype">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Field.to_polars_dtype">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_polars_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataType</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return polars data type.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">enum</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pl</span><span class="o">.</span><span class="n">Enum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">enum</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">FIELD_DTYPES_POLARS</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">]</span></div>


<div class="viewcode-block" id="Field.to_pandas_dtype">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Field.to_pandas_dtype">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_pandas_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">compact</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">CategoricalDtype</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return Pandas data type.</span>

<span class="sd">        Args:</span>
<span class="sd">            compact: Whether to return a low-memory data type (32-bit integer or float).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">enum</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">CategoricalDtype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">enum</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">compact</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;integer&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Int32&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;number&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;float32&quot;</span>
        <span class="k">return</span> <span class="n">FIELD_DTYPES_PANDAS</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">]</span></div>


<div class="viewcode-block" id="Field.to_sql_dtype">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Field.to_sql_dtype">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_sql_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">type</span><span class="p">:</span>  <span class="c1"># noqa: A003</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return SQLAlchemy data type.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">enum</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;string&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">sa</span><span class="o">.</span><span class="n">Enum</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">enum</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">FIELD_DTYPES_SQL</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">]</span></div>


<div class="viewcode-block" id="Field.to_pyarrow_dtype">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Field.to_pyarrow_dtype">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_pyarrow_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataType</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return PyArrow data type.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">enum</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;string&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pa</span><span class="o">.</span><span class="n">dictionary</span><span class="p">(</span><span class="n">pa</span><span class="o">.</span><span class="n">int32</span><span class="p">(),</span> <span class="n">pa</span><span class="o">.</span><span class="n">string</span><span class="p">(),</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">FIELD_DTYPES_PYARROW</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">]</span></div>


<div class="viewcode-block" id="Field.to_pyarrow">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Field.to_pyarrow">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_pyarrow</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pa</span><span class="o">.</span><span class="n">Field</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a PyArrow Field appropriate to the field.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">pa</span><span class="o">.</span><span class="n">field</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">to_pyarrow_dtype</span><span class="p">(),</span>
            <span class="n">nullable</span><span class="o">=</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">required</span><span class="p">),</span>
            <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">},</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Field.to_sql">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Field.to_sql">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_sql</span><span class="p">(</span>  <span class="c1"># noqa: C901</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dialect</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;sqlite&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;sqlite&quot;</span><span class="p">,</span>
        <span class="n">check_types</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">check_values</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sa</span><span class="o">.</span><span class="n">Column</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return equivalent SQL column.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">dialect</span> <span class="o">!=</span> <span class="s2">&quot;sqlite&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dialect </span><span class="si">{</span><span class="n">dialect</span><span class="si">}</span><span class="s2"> is not supported&quot;</span><span class="p">)</span>
        <span class="n">checks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">_format_for_sql</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">identifier</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">check_types</span><span class="p">:</span>
            <span class="c1"># Required with TYPEOF since TYPEOF(NULL) = &#39;null&#39;</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">required</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> IS NULL OR &quot;</span>
            <span class="c1"># Field type</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;string&quot;</span><span class="p">:</span>
                <span class="n">checks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">TYPEOF(</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">) = &#39;text&#39;&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;integer&quot;</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">):</span>
                <span class="n">checks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">TYPEOF(</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">) = &#39;integer&#39;&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;number&quot;</span><span class="p">:</span>
                <span class="n">checks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">TYPEOF(</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">) = &#39;real&#39;&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;boolean&quot;</span><span class="p">:</span>
                <span class="c1"># Just IN (0, 1) accepts floats equal to 0, 1 (0.0, 1.0)</span>
                <span class="n">checks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">(TYPEOF(</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">) = &#39;integer&#39; AND </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> IN (0, 1))&quot;</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;date&quot;</span><span class="p">:</span>
                <span class="n">checks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> IS DATE(</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;datetime&quot;</span><span class="p">:</span>
                <span class="n">checks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> IS DATETIME(</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">check_values</span><span class="p">:</span>
            <span class="c1"># Field constraints</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">min_length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">checks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;LENGTH(</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">) &gt;= </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">min_length</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">max_length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">checks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;LENGTH(</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">) &lt;= </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">max_length</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">minimum</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">minimum</span> <span class="o">=</span> <span class="n">_format_for_sql</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">minimum</span><span class="p">)</span>
                <span class="n">checks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> &gt;= </span><span class="si">{</span><span class="n">minimum</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">maximum</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">maximum</span> <span class="o">=</span> <span class="n">_format_for_sql</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">maximum</span><span class="p">)</span>
                <span class="n">checks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> &lt;= </span><span class="si">{</span><span class="n">maximum</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">pattern</span><span class="p">:</span>
                <span class="n">pattern</span> <span class="o">=</span> <span class="n">_format_for_sql</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">pattern</span><span class="p">)</span>
                <span class="c1"># Need to escape colons in regex to avoid this issue:</span>
                <span class="c1"># https://github.com/sqlalchemy/sqlalchemy/discussions/12498</span>
                <span class="n">checks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> REGEXP </span><span class="si">{</span><span class="n">pattern</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="w"> </span><span class="sa">r</span><span class="s1">&#39;\:&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">enum</span><span class="p">:</span>
                <span class="n">enum</span> <span class="o">=</span> <span class="p">[</span><span class="n">_format_for_sql</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">enum</span><span class="p">]</span>
                <span class="n">checks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> IN (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">enum</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">to_sql_dtype</span><span class="p">(),</span>
            <span class="o">*</span><span class="p">[</span>
                <span class="n">sa</span><span class="o">.</span><span class="n">CheckConstraint</span><span class="p">(</span>
                    <span class="n">check</span><span class="p">,</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">sha1</span><span class="p">(</span><span class="n">check</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()[:</span><span class="mi">8</span><span class="p">],</span>  <span class="c1"># noqa: S324</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">check</span> <span class="ow">in</span> <span class="n">checks</span>
            <span class="p">],</span>
            <span class="n">nullable</span><span class="o">=</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">required</span><span class="p">,</span>
            <span class="n">unique</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">unique</span><span class="p">,</span>
            <span class="n">comment</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Field.encode">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Field.encode">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="nb">type</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>  <span class="c1"># noqa: A003</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Recode the Field if it has an associated encoder.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span> <span class="k">else</span> <span class="n">col</span></div>


<div class="viewcode-block" id="Field.to_pandera_column">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Field.to_pandera_column">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_pandera_column</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pr</span><span class="o">.</span><span class="n">Column</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Encode this field def as a Pandera column.&quot;&quot;&quot;</span>
        <span class="n">constraints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span>
        <span class="n">checks</span> <span class="o">=</span> <span class="n">constraints</span><span class="o">.</span><span class="n">to_pandera_checks</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">constraints</span><span class="o">.</span><span class="n">enum</span><span class="p">:</span>
            <span class="n">column_type</span> <span class="o">=</span> <span class="s2">&quot;category&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;geometry&quot;</span><span class="p">:</span>
            <span class="n">column_type</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">GeometryDtype</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">column_type</span> <span class="o">=</span> <span class="n">FIELD_DTYPES_PANDAS</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">pr</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
            <span class="n">column_type</span><span class="p">,</span>
            <span class="n">checks</span><span class="o">=</span><span class="n">checks</span><span class="p">,</span>
            <span class="n">nullable</span><span class="o">=</span><span class="ow">not</span> <span class="n">constraints</span><span class="o">.</span><span class="n">required</span><span class="p">,</span>
            <span class="n">unique</span><span class="o">=</span><span class="n">constraints</span><span class="o">.</span><span class="n">unique</span><span class="p">,</span>
        <span class="p">)</span></div>
</div>



<span class="c1"># ---- Classes: Resource ---- #</span>


<div class="viewcode-block" id="ForeignKeyReference">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.ForeignKeyReference">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ForeignKeyReference</span><span class="p">(</span><span class="n">PudlMeta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Foreign key reference (`resource.schema.foreign_keys[...].reference`).</span>

<span class="sd">    See https://specs.frictionlessdata.io/table-schema/#foreign-keys.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ForeignKeyReference.resource">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.ForeignKeyReference.resource">[docs]</a>
    <span class="n">resource</span><span class="p">:</span> <span class="n">SnakeCase</span></div>

<div class="viewcode-block" id="ForeignKeyReference.fields">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.ForeignKeyReference.fields">[docs]</a>
    <span class="n">fields</span><span class="p">:</span> <span class="n">StrictList</span><span class="p">[</span><span class="n">SnakeCase</span><span class="p">]</span></div>


<div class="viewcode-block" id="ForeignKeyReference._check_unique">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.ForeignKeyReference._check_unique">[docs]</a>
    <span class="n">_check_unique</span> <span class="o">=</span> <span class="n">_validator</span><span class="p">(</span><span class="s2">&quot;fields&quot;</span><span class="p">,</span> <span class="n">fn</span><span class="o">=</span><span class="n">_check_unique</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="ForeignKey">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.ForeignKey">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ForeignKey</span><span class="p">(</span><span class="n">PudlMeta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Foreign key (`resource.schema.foreign_keys[...]`).</span>

<span class="sd">    See https://specs.frictionlessdata.io/table-schema/#foreign-keys.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ForeignKey.fields">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.ForeignKey.fields">[docs]</a>
    <span class="n">fields</span><span class="p">:</span> <span class="n">StrictList</span><span class="p">[</span><span class="n">SnakeCase</span><span class="p">]</span></div>

<div class="viewcode-block" id="ForeignKey.reference">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.ForeignKey.reference">[docs]</a>
    <span class="n">reference</span><span class="p">:</span> <span class="n">ForeignKeyReference</span></div>


<div class="viewcode-block" id="ForeignKey._check_unique">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.ForeignKey._check_unique">[docs]</a>
    <span class="n">_check_unique</span> <span class="o">=</span> <span class="n">_validator</span><span class="p">(</span><span class="s2">&quot;fields&quot;</span><span class="p">,</span> <span class="n">fn</span><span class="o">=</span><span class="n">_check_unique</span><span class="p">)</span></div>


    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;reference&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="ForeignKey._check_fields_equal_length">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.ForeignKey._check_fields_equal_length">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_check_fields_equal_length</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">info</span><span class="p">:</span> <span class="n">ValidationInfo</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;fields&quot;</span> <span class="ow">in</span> <span class="n">info</span><span class="o">.</span><span class="n">data</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">fields</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;fields and reference.fields are not equal length&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span></div>


<div class="viewcode-block" id="ForeignKey.is_simple">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.ForeignKey.is_simple">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_simple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Indicate whether the FK relationship contains a single column.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span></div>


<div class="viewcode-block" id="ForeignKey.to_sql">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.ForeignKey.to_sql">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_sql</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sa</span><span class="o">.</span><span class="n">ForeignKeyConstraint</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return equivalent SQL Foreign Key.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">sa</span><span class="o">.</span><span class="n">ForeignKeyConstraint</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">,</span>
            <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">reference</span><span class="o">.</span><span class="n">resource</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference</span><span class="o">.</span><span class="n">fields</span><span class="p">],</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="Schema">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Schema">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Schema</span><span class="p">(</span><span class="n">PudlMeta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Table schema (`resource.schema`).</span>

<span class="sd">    See https://specs.frictionlessdata.io/table-schema.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Schema.fields">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Schema.fields">[docs]</a>
    <span class="n">fields</span><span class="p">:</span> <span class="n">StrictList</span><span class="p">[</span><span class="n">Field</span><span class="p">]</span></div>

<div class="viewcode-block" id="Schema.missing_values">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Schema.missing_values">[docs]</a>
    <span class="n">missing_values</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">StrictStr</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span></div>

<div class="viewcode-block" id="Schema.primary_key">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Schema.primary_key">[docs]</a>
    <span class="n">primary_key</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SnakeCase</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="Schema.foreign_keys">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Schema.foreign_keys">[docs]</a>
    <span class="n">foreign_keys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ForeignKey</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span></div>


<div class="viewcode-block" id="Schema._check_unique">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Schema._check_unique">[docs]</a>
    <span class="n">_check_unique</span> <span class="o">=</span> <span class="n">_validator</span><span class="p">(</span>
        <span class="s2">&quot;missing_values&quot;</span><span class="p">,</span> <span class="s2">&quot;primary_key&quot;</span><span class="p">,</span> <span class="s2">&quot;foreign_keys&quot;</span><span class="p">,</span> <span class="n">fn</span><span class="o">=</span><span class="n">_check_unique</span>
    <span class="p">)</span></div>


    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;fields&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Schema._check_field_names_unique">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Schema._check_field_names_unique">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_check_field_names_unique</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Field</span><span class="p">]):</span>
        <span class="n">_check_unique</span><span class="p">([</span><span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">fields</span></div>


    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;primary_key&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Schema._check_primary_key_in_fields">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Schema._check_primary_key_in_fields">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_check_primary_key_in_fields</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">pk</span><span class="p">,</span> <span class="n">info</span><span class="p">:</span> <span class="n">ValidationInfo</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Verify that all primary key elements also appear in the schema fields.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pk</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;fields&quot;</span> <span class="ow">in</span> <span class="n">info</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="n">missing</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">info</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]]</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">pk</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                    <span class="c1"># Flag primary key fields as required</span>
                    <span class="n">field</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">][</span><span class="n">names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">name</span><span class="p">)]</span>
                    <span class="n">field</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">required</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">missing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;names </span><span class="si">{</span><span class="n">missing</span><span class="si">}</span><span class="s2"> missing from fields&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pk</span></div>


    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="Schema._check_foreign_key_in_fields">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Schema._check_foreign_key_in_fields">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_check_foreign_key_in_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Verify that all foreign key elements also appear in the schema fields.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">foreign_keys</span><span class="p">:</span>
            <span class="n">schema_field_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">fk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">foreign_keys</span><span class="p">:</span>
                <span class="n">missing_field_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">fk</span><span class="o">.</span><span class="n">fields</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">schema_field_names</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">missing_field_names</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Foreign key fields </span><span class="si">{</span><span class="n">missing_field_names</span><span class="si">}</span><span class="s2"> not found in schema.&quot;</span>
                    <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="Schema.to_pandera">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Schema.to_pandera">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_pandera</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pr</span><span class="o">.</span><span class="n">DataFrameSchema</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Turn PUDL Schema into Pandera schema, so dagster can understand it.&quot;&quot;&quot;</span>
        <span class="c1"># 2024-02-09: pr.Check doesn&#39;t have interop with Pydantic type system</span>
        <span class="c1"># yet, so we encode as Callable, then cast.</span>

        <span class="k">return</span> <span class="n">pr</span><span class="o">.</span><span class="n">DataFrameSchema</span><span class="p">(</span>
            <span class="p">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">field</span><span class="o">.</span><span class="n">to_pandera_column</span><span class="p">()</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">},</span>
            <span class="n">unique</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span><span class="p">,</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="License">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.License">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">License</span><span class="p">(</span><span class="n">PudlMeta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Data license (`package|resource.licenses[...]`).</span>

<span class="sd">    See https://specs.frictionlessdata.io/data-package/#licenses.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="License.name">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.License.name">[docs]</a>
    <span class="n">name</span><span class="p">:</span> <span class="n">String</span></div>

<div class="viewcode-block" id="License.title">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.License.title">[docs]</a>
    <span class="n">title</span><span class="p">:</span> <span class="n">String</span></div>

<div class="viewcode-block" id="License.path">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.License.path">[docs]</a>
    <span class="n">path</span><span class="p">:</span> <span class="n">AnyHttpUrl</span></div>


    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="License.dict_from_id">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.License.dict_from_id">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">dict_from_id</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct dictionary from PUDL identifier.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">LICENSES</span><span class="p">[</span><span class="n">x</span><span class="p">])</span></div>


    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="License.from_id">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.License.from_id">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_id</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;License&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct from PUDL identifier.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="bp">cls</span><span class="o">.</span><span class="n">dict_from_id</span><span class="p">(</span><span class="n">x</span><span class="p">))</span></div>
</div>



<div class="viewcode-block" id="Contributor">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Contributor">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Contributor</span><span class="p">(</span><span class="n">PudlMeta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Data contributor (`package.contributors[...]`).</span>

<span class="sd">    See https://specs.frictionlessdata.io/data-package/#contributors.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Contributor.title">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Contributor.title">[docs]</a>
    <span class="n">title</span><span class="p">:</span> <span class="n">String</span></div>

<div class="viewcode-block" id="Contributor.path">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Contributor.path">[docs]</a>
    <span class="n">path</span><span class="p">:</span> <span class="n">AnyHttpUrl</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Contributor.email">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Contributor.email">[docs]</a>
    <span class="n">email</span><span class="p">:</span> <span class="n">EmailStr</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Contributor.role">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Contributor.role">[docs]</a>
    <span class="n">role</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;author&quot;</span><span class="p">,</span> <span class="s2">&quot;contributor&quot;</span><span class="p">,</span> <span class="s2">&quot;maintainer&quot;</span><span class="p">,</span> <span class="s2">&quot;publisher&quot;</span><span class="p">,</span> <span class="s2">&quot;wrangler&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;contributor&quot;</span>
    <span class="p">)</span></div>

<div class="viewcode-block" id="Contributor.zenodo_role">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Contributor.zenodo_role">[docs]</a>
    <span class="n">zenodo_role</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span>
        <span class="s2">&quot;contact person&quot;</span><span class="p">,</span>
        <span class="s2">&quot;data collector&quot;</span><span class="p">,</span>
        <span class="s2">&quot;data curator&quot;</span><span class="p">,</span>
        <span class="s2">&quot;data manager&quot;</span><span class="p">,</span>
        <span class="s2">&quot;distributor&quot;</span><span class="p">,</span>
        <span class="s2">&quot;editor&quot;</span><span class="p">,</span>
        <span class="s2">&quot;hosting institution&quot;</span><span class="p">,</span>
        <span class="s2">&quot;other&quot;</span><span class="p">,</span>
        <span class="s2">&quot;producer&quot;</span><span class="p">,</span>
        <span class="s2">&quot;project leader&quot;</span><span class="p">,</span>
        <span class="s2">&quot;project member&quot;</span><span class="p">,</span>
        <span class="s2">&quot;registration agency&quot;</span><span class="p">,</span>
        <span class="s2">&quot;registration authority&quot;</span><span class="p">,</span>
        <span class="s2">&quot;related person&quot;</span><span class="p">,</span>
        <span class="s2">&quot;researcher&quot;</span><span class="p">,</span>
        <span class="s2">&quot;rights holder&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sponsor&quot;</span><span class="p">,</span>
        <span class="s2">&quot;supervisor&quot;</span><span class="p">,</span>
        <span class="s2">&quot;work package leader&quot;</span><span class="p">,</span>
    <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;project member&quot;</span></div>

<div class="viewcode-block" id="Contributor.organization">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Contributor.organization">[docs]</a>
    <span class="n">organization</span><span class="p">:</span> <span class="n">String</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Contributor.orcid">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Contributor.orcid">[docs]</a>
    <span class="n">orcid</span><span class="p">:</span> <span class="n">String</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></div>


    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Contributor.dict_from_id">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Contributor.dict_from_id">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">dict_from_id</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct dictionary from PUDL identifier.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">CONTRIBUTORS</span><span class="p">[</span><span class="n">x</span><span class="p">])</span></div>


    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Contributor.from_id">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Contributor.from_id">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_id</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Contributor&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct from PUDL identifier.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="bp">cls</span><span class="o">.</span><span class="n">dict_from_id</span><span class="p">(</span><span class="n">x</span><span class="p">))</span></div>


<div class="viewcode-block" id="Contributor.__hash__">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Contributor.__hash__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Implements simple hash method.</span>

<span class="sd">        Allows use of ``set()`` on a list of Contributor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span></div>
</div>



<div class="viewcode-block" id="DataSource">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.DataSource">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">DataSource</span><span class="p">(</span><span class="n">PudlMeta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A data source that has been integrated into PUDL.</span>

<span class="sd">    This metadata is used for:</span>

<span class="sd">    * Generating PUDL documentation.</span>
<span class="sd">    * Annotating long-term archives of the raw input data on Zenodo.</span>
<span class="sd">    * Defining what data partitions can be processed using PUDL.</span>

<span class="sd">    It can also be used to populate the &quot;source&quot; fields of frictionless</span>
<span class="sd">    data packages and data resources (`package|resource.sources[...]`).</span>

<span class="sd">    See https://specs.frictionlessdata.io/data-package/#sources.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="DataSource.name">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.DataSource.name">[docs]</a>
    <span class="n">name</span><span class="p">:</span> <span class="n">SnakeCase</span></div>

<div class="viewcode-block" id="DataSource.title">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.DataSource.title">[docs]</a>
    <span class="n">title</span><span class="p">:</span> <span class="n">String</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="DataSource.description">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.DataSource.description">[docs]</a>
    <span class="n">description</span><span class="p">:</span> <span class="n">String</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="DataSource.keywords">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.DataSource.keywords">[docs]</a>
    <span class="n">keywords</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="DataSource.path">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.DataSource.path">[docs]</a>
    <span class="n">path</span><span class="p">:</span> <span class="n">AnyHttpUrl</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="DataSource.contributors">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.DataSource.contributors">[docs]</a>
    <span class="n">contributors</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Contributor</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="DataSource.license_raw">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.DataSource.license_raw">[docs]</a>
    <span class="n">license_raw</span><span class="p">:</span> <span class="n">License</span></div>

<div class="viewcode-block" id="DataSource.license_pudl">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.DataSource.license_pudl">[docs]</a>
    <span class="n">license_pudl</span><span class="p">:</span> <span class="n">License</span></div>

<div class="viewcode-block" id="DataSource.concept_doi">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.DataSource.concept_doi">[docs]</a>
    <span class="n">concept_doi</span><span class="p">:</span> <span class="n">ZenodoDoi</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="DataSource.working_partitions">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.DataSource.working_partitions">[docs]</a>
    <span class="n">working_partitions</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">SnakeCase</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="DataSource.source_file_dict">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.DataSource.source_file_dict">[docs]</a>
    <span class="n">source_file_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">SnakeCase</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span></div>

    <span class="c1"># agency: Agency  # needs to be defined</span>
<div class="viewcode-block" id="DataSource.email">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.DataSource.email">[docs]</a>
    <span class="n">email</span><span class="p">:</span> <span class="n">EmailStr</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="DataSource.get_resource_ids">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.DataSource.get_resource_ids">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_resource_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compile list of resource IDs associated with this data source.&quot;&quot;&quot;</span>
        <span class="n">resources</span> <span class="o">=</span> <span class="n">RESOURCE_METADATA</span>

        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="n">name</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">resources</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;etl_group&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="DataSource.get_temporal_coverage">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.DataSource.get_temporal_coverage">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_temporal_coverage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">partitions</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a string describing the time span covered by the data source.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">partitions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">partitions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">working_partitions</span>
        <span class="k">if</span> <span class="s2">&quot;years&quot;</span> <span class="ow">in</span> <span class="n">partitions</span><span class="p">:</span>
            <span class="n">temporal_coverage</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">min</span><span class="p">(</span><span class="n">partitions</span><span class="p">[</span><span class="s1">&#39;years&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="nb">max</span><span class="p">(</span><span class="n">partitions</span><span class="p">[</span><span class="s1">&#39;years&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="s2">&quot;half_years&quot;</span> <span class="ow">in</span> <span class="n">partitions</span><span class="p">:</span>
            <span class="n">temporal_coverage</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">min</span><span class="p">(</span><span class="n">partitions</span><span class="p">[</span><span class="s1">&#39;half_years&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="nb">max</span><span class="p">(</span><span class="n">partitions</span><span class="p">[</span><span class="s1">&#39;half_years&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;year_quarters&quot;</span> <span class="ow">in</span> <span class="n">partitions</span><span class="p">:</span>
            <span class="n">temporal_coverage</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">min</span><span class="p">(</span><span class="n">partitions</span><span class="p">[</span><span class="s1">&#39;year_quarters&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="nb">max</span><span class="p">(</span><span class="n">partitions</span><span class="p">[</span><span class="s1">&#39;year_quarters&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;year_month&quot;</span> <span class="ow">in</span> <span class="n">partitions</span><span class="p">:</span>
            <span class="n">temporal_coverage</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;through </span><span class="si">{</span><span class="n">partitions</span><span class="p">[</span><span class="s1">&#39;year_month&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">temporal_coverage</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">return</span> <span class="n">temporal_coverage</span></div>


<div class="viewcode-block" id="DataSource.add_datastore_metadata">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.DataSource.add_datastore_metadata">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_datastore_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datastore</span><span class="p">:</span> <span class="n">Datastore</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get source file metadata from the datastore.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">datastore</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">datastore</span> <span class="o">=</span> <span class="n">Datastore</span><span class="p">(</span><span class="n">local_cache_path</span><span class="o">=</span><span class="n">PudlPaths</span><span class="p">()</span><span class="o">.</span><span class="n">data_dir</span><span class="p">)</span>
        <span class="n">dp_desc</span> <span class="o">=</span> <span class="n">datastore</span><span class="o">.</span><span class="n">get_datapackage_descriptor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">partitions</span> <span class="o">=</span> <span class="n">dp_desc</span><span class="o">.</span><span class="n">get_partitions</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;year&quot;</span> <span class="ow">in</span> <span class="n">partitions</span><span class="p">:</span>
            <span class="n">partitions</span><span class="p">[</span><span class="s2">&quot;years&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">partitions</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="s2">&quot;year_month&quot;</span> <span class="ow">in</span> <span class="n">partitions</span><span class="p">:</span>
            <span class="n">partitions</span><span class="p">[</span><span class="s2">&quot;year_month&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">partitions</span><span class="p">[</span><span class="s2">&quot;year_month&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source_file_dict</span><span class="p">[</span><span class="s2">&quot;download_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dp_desc</span><span class="o">.</span><span class="n">get_download_size</span><span class="p">()</span></div>


<div class="viewcode-block" id="DataSource.to_rst">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.DataSource.to_rst">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_rst</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">docs_dir</span><span class="p">:</span> <span class="n">DirectoryPath</span><span class="p">,</span>
        <span class="n">source_resources</span><span class="p">:</span> <span class="s2">&quot;list[Resource]&quot;</span><span class="p">,</span>
        <span class="n">extra_resources</span><span class="p">:</span> <span class="s2">&quot;list[Resource]&quot;</span><span class="p">,</span>
        <span class="n">output_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">datastore</span><span class="p">:</span> <span class="n">Datastore</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Output a representation of the data source in RST for documentation.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_datastore_metadata</span><span class="p">(</span><span class="n">datastore</span><span class="o">=</span><span class="n">datastore</span><span class="p">)</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">_get_jinja_environment</span><span class="p">(</span><span class="n">docs_dir</span><span class="p">)</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_child.rst.jinja&quot;</span>
        <span class="p">)</span>
        <span class="n">data_source_dir</span> <span class="o">=</span> <span class="n">docs_dir</span> <span class="o">/</span> <span class="s2">&quot;data_sources&quot;</span>
        <span class="n">download_paths</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">path</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="n">data_source_dir</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="nb">list</span><span class="p">((</span><span class="n">data_source_dir</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.pdf&quot;</span><span class="p">))</span>
                <span class="o">+</span> <span class="nb">list</span><span class="p">((</span><span class="n">data_source_dir</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.html&quot;</span><span class="p">))</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span>
        <span class="p">]</span>
        <span class="c1"># If PHMSA, also include .txt files in documentation</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;phmsagas&quot;</span><span class="p">:</span>
            <span class="n">download_paths</span> <span class="o">+=</span> <span class="p">[</span>
                <span class="n">path</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="n">data_source_dir</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">list</span><span class="p">((</span><span class="n">data_source_dir</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.txt&quot;</span><span class="p">)))</span>
                <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span>
            <span class="p">]</span>
        <span class="n">download_paths</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">download_paths</span><span class="p">)</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span>
            <span class="n">source</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">source_resources</span><span class="o">=</span><span class="n">source_resources</span><span class="p">,</span>
            <span class="n">extra_resources</span><span class="o">=</span><span class="n">extra_resources</span><span class="p">,</span>
            <span class="n">download_paths</span><span class="o">=</span><span class="n">download_paths</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">output_path</span><span class="p">:</span>
            <span class="n">Path</span><span class="p">(</span><span class="n">output_path</span><span class="p">)</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">rendered</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">rendered</span><span class="p">)</span></div>


    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="DataSource.dict_from_id">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.DataSource.dict_from_id">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">dict_from_id</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sources</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Look up the source by source name in the metadata.&quot;&quot;&quot;</span>
        <span class="c1"># If ID ends with _xbrl strip end to find data source</span>
        <span class="n">lookup_id</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_xbrl&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">sources</span><span class="p">[</span><span class="n">lookup_id</span><span class="p">])}</span></div>


    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="DataSource.from_id">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.DataSource.from_id">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_id</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sources</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">SOURCES</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;DataSource&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct Source by source name in the metadata.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="bp">cls</span><span class="o">.</span><span class="n">dict_from_id</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sources</span><span class="o">=</span><span class="n">sources</span><span class="p">))</span></div>
</div>



<div class="viewcode-block" id="ResourceHarvest">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.ResourceHarvest">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ResourceHarvest</span><span class="p">(</span><span class="n">PudlMeta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Resource harvest parameters (`resource.harvest`).&quot;&quot;&quot;</span>

<div class="viewcode-block" id="ResourceHarvest.harvest">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.ResourceHarvest.harvest">[docs]</a>
    <span class="n">harvest</span><span class="p">:</span> <span class="n">StrictBool</span> <span class="o">=</span> <span class="kc">False</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;Whether to harvest from dataframes based on field names.</span>

<span class="sd">    If ``False``, the dataframe with the same name is used and the process is limited to</span>
<span class="sd">    dropping unwanted fields.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ResourceHarvest.tolerance">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.ResourceHarvest.tolerance">[docs]</a>
    <span class="n">tolerance</span><span class="p">:</span> <span class="n">PositiveFloat</span> <span class="o">=</span> <span class="mf">0.0</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fraction of invalid fields above which result is considered invalid.&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="PudlResourceDescriptor">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.PudlResourceDescriptor">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PudlResourceDescriptor</span><span class="p">(</span><span class="n">PudlMeta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The form we expect the RESOURCE_METADATA elements to take.</span>

<span class="sd">    This differs from :class:`Resource` and :class:`Schema`, etc., in that we represent</span>
<span class="sd">    many complex types (:class:`Field`, :class:`DataSource`, etc.) with string IDs that</span>
<span class="sd">    we then turn into instances of those types with lookups. We also use</span>
<span class="sd">    ``foreign_key_rules`` to generate the actual ``foreign_key`` relationships that are</span>
<span class="sd">    represented in a :class:`Schema`.</span>

<span class="sd">    This is all very useful in that we can describe the resources more concisely!</span>

<span class="sd">    TODO: In the future, we could convert from a :class:`PudlResourceDescriptor` to</span>
<span class="sd">    various standard formats, such as a Frictionless resource or a :mod:`pandera`</span>
<span class="sd">    schema. This would require some of the logic currently in :class:`Resource` to move</span>
<span class="sd">    into this class.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="PudlResourceDescriptor.PudlSchemaDescriptor">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.PudlResourceDescriptor.PudlSchemaDescriptor">[docs]</a>
    <span class="k">class</span><span class="w"> </span><span class="nc">PudlSchemaDescriptor</span><span class="p">(</span><span class="n">PudlMeta</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Container to hold the schema shape.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="PudlResourceDescriptor.PudlSchemaDescriptor.PudlForeignKeyRules">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.PudlResourceDescriptor.PudlSchemaDescriptor.PudlForeignKeyRules">[docs]</a>
        <span class="k">class</span><span class="w"> </span><span class="nc">PudlForeignKeyRules</span><span class="p">(</span><span class="n">PudlMeta</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Container to describe what foreign key rules look like.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="PudlResourceDescriptor.PudlSchemaDescriptor.PudlForeignKeyRules.field_id_lists">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.PudlResourceDescriptor.PudlSchemaDescriptor.PudlForeignKeyRules.field_id_lists">[docs]</a>
            <span class="n">field_id_lists</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">pydantic</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">alias</span><span class="o">=</span><span class="s2">&quot;fields&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">[])</span></div>

<div class="viewcode-block" id="PudlResourceDescriptor.PudlSchemaDescriptor.PudlForeignKeyRules.exclude_ids">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.PudlResourceDescriptor.PudlSchemaDescriptor.PudlForeignKeyRules.exclude_ids">[docs]</a>
            <span class="n">exclude_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">pydantic</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">alias</span><span class="o">=</span><span class="s2">&quot;exclude&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">[])</span></div>
</div>


<div class="viewcode-block" id="PudlResourceDescriptor.PudlSchemaDescriptor.field_ids">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.PudlResourceDescriptor.PudlSchemaDescriptor.field_ids">[docs]</a>
        <span class="n">field_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">pydantic</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">alias</span><span class="o">=</span><span class="s2">&quot;fields&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">[])</span></div>

<div class="viewcode-block" id="PudlResourceDescriptor.PudlSchemaDescriptor.primary_key_ids">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.PudlResourceDescriptor.PudlSchemaDescriptor.primary_key_ids">[docs]</a>
        <span class="n">primary_key_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">pydantic</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">alias</span><span class="o">=</span><span class="s2">&quot;primary_key&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">[])</span></div>

<div class="viewcode-block" id="PudlResourceDescriptor.PudlSchemaDescriptor.foreign_key_rules">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.PudlResourceDescriptor.PudlSchemaDescriptor.foreign_key_rules">[docs]</a>
        <span class="n">foreign_key_rules</span><span class="p">:</span> <span class="n">PudlForeignKeyRules</span> <span class="o">=</span> <span class="n">PudlForeignKeyRules</span><span class="p">()</span></div>
</div>


<div class="viewcode-block" id="PudlResourceDescriptor.PudlCodeMetadata">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.PudlResourceDescriptor.PudlCodeMetadata">[docs]</a>
    <span class="k">class</span><span class="w"> </span><span class="nc">PudlCodeMetadata</span><span class="p">(</span><span class="n">PudlMeta</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Describes a bunch of codes.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="PudlResourceDescriptor.PudlCodeMetadata.CodeDataFrame">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.PudlResourceDescriptor.PudlCodeMetadata.CodeDataFrame">[docs]</a>
        <span class="k">class</span><span class="w"> </span><span class="nc">CodeDataFrame</span><span class="p">(</span><span class="n">pr</span><span class="o">.</span><span class="n">DataFrameModel</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;The DataFrame we use to represent code/label/description associations.&quot;&quot;&quot;</span>

            <span class="c1"># TODO (daz) 2024-02-09: each of these | Nones are one-offs. Fix</span>
            <span class="c1"># the frickin data instead.</span>
<div class="viewcode-block" id="PudlResourceDescriptor.PudlCodeMetadata.CodeDataFrame.code">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.PudlResourceDescriptor.PudlCodeMetadata.CodeDataFrame.code">[docs]</a>
            <span class="n">code</span><span class="p">:</span> <span class="n">pr</span><span class="o">.</span><span class="n">typing</span><span class="o">.</span><span class="n">Series</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span></div>

<div class="viewcode-block" id="PudlResourceDescriptor.PudlCodeMetadata.CodeDataFrame.label">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.PudlResourceDescriptor.PudlCodeMetadata.CodeDataFrame.label">[docs]</a>
            <span class="n">label</span><span class="p">:</span> <span class="n">pr</span><span class="o">.</span><span class="n">typing</span><span class="o">.</span><span class="n">Series</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="PudlResourceDescriptor.PudlCodeMetadata.CodeDataFrame.description">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.PudlResourceDescriptor.PudlCodeMetadata.CodeDataFrame.description">[docs]</a>
            <span class="n">description</span><span class="p">:</span> <span class="n">pr</span><span class="o">.</span><span class="n">typing</span><span class="o">.</span><span class="n">Series</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></div>

<div class="viewcode-block" id="PudlResourceDescriptor.PudlCodeMetadata.CodeDataFrame.operational_status">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.PudlResourceDescriptor.PudlCodeMetadata.CodeDataFrame.operational_status">[docs]</a>
            <span class="n">operational_status</span><span class="p">:</span> <span class="n">pr</span><span class="o">.</span><span class="n">typing</span><span class="o">.</span><span class="n">Series</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span></div>
</div>


<div class="viewcode-block" id="PudlResourceDescriptor.PudlCodeMetadata.df">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.PudlResourceDescriptor.PudlCodeMetadata.df">[docs]</a>
        <span class="n">df</span><span class="p">:</span> <span class="n">pr</span><span class="o">.</span><span class="n">typing</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">[</span><span class="n">CodeDataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="p">[]}</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="PudlResourceDescriptor.PudlCodeMetadata.code_fixes">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.PudlResourceDescriptor.PudlCodeMetadata.code_fixes">[docs]</a>
        <span class="n">code_fixes</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="PudlResourceDescriptor.PudlCodeMetadata.ignored_codes">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.PudlResourceDescriptor.PudlCodeMetadata.ignored_codes">[docs]</a>
        <span class="n">ignored_codes</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="PudlResourceDescriptor.PudlCodeMetadata.model_config">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.PudlResourceDescriptor.PudlCodeMetadata.model_config">[docs]</a>
        <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span><span class="n">arbitrary_types_allowed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


        <span class="nd">@field_serializer</span><span class="p">(</span><span class="s2">&quot;df&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="PudlResourceDescriptor.PudlCodeMetadata.serialize_df">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.PudlResourceDescriptor.PudlCodeMetadata.serialize_df">[docs]</a>
        <span class="k">def</span><span class="w"> </span><span class="nf">serialize_df</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pr</span><span class="o">.</span><span class="n">typing</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">[</span><span class="n">CodeDataFrame</span><span class="p">],</span> <span class="n">_info</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Return DataFrame to avoid warnings from default serializer.&quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="n">df</span></div>
</div>


<div class="viewcode-block" id="PudlResourceDescriptor.PudlDescriptionComponents">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.PudlResourceDescriptor.PudlDescriptionComponents">[docs]</a>
    <span class="k">class</span><span class="w"> </span><span class="nc">PudlDescriptionComponents</span><span class="p">(</span><span class="n">PudlMeta</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Container to hold description configuration information.</span>

<span class="sd">        All of these parameters have reasonable defaults for most resources if left</span>
<span class="sd">        unset.  You must specify :attr:`PudlResourceDescriptor.description` as a</span>
<span class="sd">        dictionary, but you do not have to put anything in it so long as the resource id</span>
<span class="sd">        follows the standard pattern.</span>
<span class="sd">        &quot;&quot;&quot;</span>

<div class="viewcode-block" id="PudlResourceDescriptor.PudlDescriptionComponents.table_type_code">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.PudlResourceDescriptor.PudlDescriptionComponents.table_type_code">[docs]</a>
        <span class="n">table_type_code</span><span class="p">:</span> <span class="p">(</span>
            <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;assn&quot;</span><span class="p">,</span> <span class="s2">&quot;codes&quot;</span><span class="p">,</span> <span class="s2">&quot;entity&quot;</span><span class="p">,</span> <span class="s2">&quot;scd&quot;</span><span class="p">,</span> <span class="s2">&quot;timeseries&quot;</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span>
        <span class="p">)</span> <span class="o">=</span> <span class="kc">None</span></div>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;Indicates the type of asset stored in this resource.</span>

<span class="sd">        If None or otherwise left unset, will be filled in with a default type parsed</span>
<span class="sd">        from the resource id string.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="PudlResourceDescriptor.PudlDescriptionComponents.timeseries_resolution_code">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.PudlResourceDescriptor.PudlDescriptionComponents.timeseries_resolution_code">[docs]</a>
        <span class="n">timeseries_resolution_code</span><span class="p">:</span> <span class="p">(</span>
            <span class="n">Literal</span><span class="p">[</span>
                <span class="s2">&quot;quarterly&quot;</span><span class="p">,</span>
                <span class="s2">&quot;yearly&quot;</span><span class="p">,</span>
                <span class="s2">&quot;monthly&quot;</span><span class="p">,</span>
                <span class="s2">&quot;hourly&quot;</span><span class="p">,</span>
            <span class="p">]</span>
            <span class="o">|</span> <span class="kc">None</span>
        <span class="p">)</span> <span class="o">=</span> <span class="kc">None</span></div>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;If this resource has</span>
<span class="sd">        :attr:`~PudlResourceDescriptor.PudlDescriptionComponents.table_type_code`</span>
<span class="sd">        timeseries, indicates the temporal resolution, otherwise None.  If</span>
<span class="sd">        :attr:`~PudlResourceDescriptor.PudlDescriptionComponents.table_type_code` is</span>
<span class="sd">        timeseries and this value is None or otherwise left unset, will be filled in</span>
<span class="sd">        with a default resolution parsed from the resource id string.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="PudlResourceDescriptor.PudlDescriptionComponents.layer_code">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.PudlResourceDescriptor.PudlDescriptionComponents.layer_code">[docs]</a>
        <span class="n">layer_code</span><span class="p">:</span> <span class="p">(</span>
            <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;raw&quot;</span><span class="p">,</span> <span class="s2">&quot;_core&quot;</span><span class="p">,</span> <span class="s2">&quot;core&quot;</span><span class="p">,</span> <span class="s2">&quot;out&quot;</span><span class="p">,</span> <span class="s2">&quot;out_narrow&quot;</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span>
        <span class="p">)</span> <span class="o">=</span> <span class="kc">None</span></div>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;Indicates the degree of processing applied to the data in this resource.  If</span>
<span class="sd">        None or otherwise left unset, will be filled in with a default layer parsed from</span>
<span class="sd">        the resource id string.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="PudlResourceDescriptor.PudlDescriptionComponents.source_code">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.PudlResourceDescriptor.PudlDescriptionComponents.source_code">[docs]</a>
        <span class="n">source_code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></div>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;Indicates the source we wish to display for this resource; distinct from</span>
<span class="sd">        :attr:`PudlResourceDescriptor.source_ids` because here we want the majority</span>
<span class="sd">        source (or grouped source if truly mixed) and not a complete list of all sources</span>
<span class="sd">        used for this resource.  If set, should be a known data source shortcode like</span>
<span class="sd">        &quot;eia923&quot; or one of the grouped shortcodes from</span>
<span class="sd">        :data:`~pudl.metadata.descriptions.source_descriptions`.  If None or otherwise</span>
<span class="sd">        left unset, will be filled in with a default source parsed from the resource id</span>
<span class="sd">        string.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="PudlResourceDescriptor.PudlDescriptionComponents.usage_warnings">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.PudlResourceDescriptor.PudlDescriptionComponents.usage_warnings">[docs]</a>
        <span class="n">usage_warnings</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></div>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;List of string keys (for common warnings; see :mod:`warnings`) and dicts (for</span>
<span class="sd">        custom warnings) stating necessary precautions for using this resource.</span>

<span class="sd">        Usage Warnings are a way for us to quickly and skim-ably tell users about</span>
<span class="sd">        analysis hazards when using a particular table.  It has two goals:</span>

<span class="sd">        1. help users quickly reach a point of success in their use of our data, and</span>
<span class="sd">        2. reduce the incidence of repeated questions and bug-like reports due to these</span>
<span class="sd">           inescapable hazards.</span>

<span class="sd">        Reserve this field for severe and/or frequent problems an unfamiliar user may</span>
<span class="sd">        encounter, and list lighter or edge-case problems in</span>
<span class="sd">        :attr:`~PudlResourceDescriptor.PudlDescriptionComponents.additional_details_text`.</span>

<span class="sd">        The list can contain two kinds of entries:</span>

<span class="sd">        * a string, which should match one of the keys in</span>
<span class="sd">          :data:`~pudl.metadata.warnings.USAGE_WARNINGS`</span>
<span class="sd">        * a dict, which should contain two keys:</span>

<span class="sd">          * &quot;type&quot; - a short code for the warning, which doesn&#39;t need to be unique and</span>
<span class="sd">            will only appear in preview &amp; debugging tooling, not to users</span>
<span class="sd">          * &quot;description&quot; - the one-to-two-sentence summary of a warning used only on</span>
<span class="sd">            this particular resource</span>

<span class="sd">        The system will automatically detect and include the following warnings based on</span>
<span class="sd">        the resource id string and schema information (see</span>
<span class="sd">        :meth:`~pudl.metadata.descriptions.ResourceDescriptionBuilder._assemble_usage_warnings`):</span>

<span class="sd">        * multiple_inputs</span>
<span class="sd">        * ferc_is_hard</span>

<span class="sd">        Any items provided here will be listed before the automatically detected</span>
<span class="sd">        warnings.</span>

<span class="sd">        If None or otherwise left unset, will be filled in with auto warnings only. If</span>
<span class="sd">        no auto warnings apply, hides the Usage Warnings section entirely.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="PudlResourceDescriptor.PudlDescriptionComponents.additional_summary_text">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.PudlResourceDescriptor.PudlDescriptionComponents.additional_summary_text">[docs]</a>
        <span class="n">additional_summary_text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></div>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;A brief (~one-line) description of the contents of this resource.</span>
<span class="sd">        If None or otherwise left unset, will be left blank.</span>

<span class="sd">        If filled, should support whichever of the following scenarios is most</span>
<span class="sd">        appropriate for this resource:</span>

<span class="sd">        * the :attr:`~PudlResourceDescriptor.PudlDescriptionComponents.table_type_code`</span>
<span class="sd">          is set or can be automatically detected: this value should complete the</span>
<span class="sd">          sentence corresponding to</span>
<span class="sd">          :data:`~pudl.metadata.descriptions.table_type_fragments` for this resource&#39;s</span>
<span class="sd">          :attr:`~PudlResourceDescriptor.PudlDescriptionComponents.table_type_code`</span>
<span class="sd">        * the :attr:`~PudlResourceDescriptor.PudlDescriptionComponents.table_type_code`</span>
<span class="sd">          is None/unset *and* the resource is not named according to a standard table</span>
<span class="sd">          type listed in :data:`~pudl.metadata.descriptions.table_type_fragments`: this</span>
<span class="sd">          value should be a complete sentence summarizing the contents of this resource</span>
<span class="sd">          at a similar level of detail.</span>

<span class="sd">        &quot;&quot;&quot;</span>
<div class="viewcode-block" id="PudlResourceDescriptor.PudlDescriptionComponents.additional_layer_text">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.PudlResourceDescriptor.PudlDescriptionComponents.additional_layer_text">[docs]</a>
        <span class="n">additional_layer_text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></div>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;Unusual details about this resource&#39;s level of processing that don&#39;t fall</span>
<span class="sd">        into the normal definition of raw/core/_core/out/etc.  If None or otherwise left</span>
<span class="sd">        unset, will be left blank.  This should only be set in truly obscure situations.</span>
<span class="sd">        If set, should be a complete sentence.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="PudlResourceDescriptor.PudlDescriptionComponents.additional_source_text">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.PudlResourceDescriptor.PudlDescriptionComponents.additional_source_text">[docs]</a>
        <span class="n">additional_source_text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></div>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;A brief refinement on the source data for this table, such as indicating the</span>
<span class="sd">        Schedule or other section number.  If None or otherwise left unset, will be left</span>
<span class="sd">        blank.  If set, should make sense when displayed directly after the title of a</span>
<span class="sd">        datasource (see :data:`~pudl.metadata.descriptions.source_descriptions`);</span>
<span class="sd">        parentheticals work best here.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="PudlResourceDescriptor.PudlDescriptionComponents.additional_primary_key_text">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.PudlResourceDescriptor.PudlDescriptionComponents.additional_primary_key_text">[docs]</a>
        <span class="n">additional_primary_key_text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></div>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;For resources with no primary key, a brief summary of what each row contains,</span>
<span class="sd">        and perhaps why a primary key doesn&#39;t make sense for this table.  If None or</span>
<span class="sd">        otherwise left unset, will be left blank.  If set, should be a complete sentence</span>
<span class="sd">        or two.</span>

<span class="sd">        This is generally not set when there is a primary key for the table.  If a</span>
<span class="sd">        primary key is available,</span>
<span class="sd">        :attr:`~PudlResourceDescriptor.PudlDescriptionComponents.additional_primary_key_text`</span>
<span class="sd">        will appear after the comma-delimited list of primary key columns.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="PudlResourceDescriptor.PudlDescriptionComponents.additional_details_text">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.PudlResourceDescriptor.PudlDescriptionComponents.additional_details_text">[docs]</a>
        <span class="n">additional_details_text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></div>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;All other information about this resource&#39;s construction and intended use,</span>
<span class="sd">        including guidelines and recommendations for best results.  If None or otherwise</span>
<span class="sd">        left unset, will be left blank; hides the Additional Details section entirely.</span>

<span class="sd">        Q3 2025 Migration Mode variance: if :attr:`PudlResourceDescriptor.description`</span>
<span class="sd">        is a string, it gets moved here so you can see the old description content in</span>
<span class="sd">        the Additional Details section of the preview.</span>

<span class="sd">        May also include more-detailed explanations of listed usage warnings.&quot;&quot;&quot;</span></div>

        <span class="c1"># TODO: drop migration mode variance after migration is complete</span>

    <span class="c1"># TODO (daz) 2024-02-09: with a name like &quot;title&quot; you might imagine all</span>
    <span class="c1"># resources would have one...</span>
<div class="viewcode-block" id="PudlResourceDescriptor.title">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.PudlResourceDescriptor.title">[docs]</a>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></div>

    <span class="c1"># TODO: the str type is legacy support and should be removed once we get all the metadata migrated</span>
<div class="viewcode-block" id="PudlResourceDescriptor.description">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.PudlResourceDescriptor.description">[docs]</a>
    <span class="n">description</span><span class="p">:</span> <span class="n">PudlDescriptionComponents</span> <span class="o">|</span> <span class="nb">str</span></div>

<div class="viewcode-block" id="PudlResourceDescriptor.schema_">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.PudlResourceDescriptor.schema_">[docs]</a>
    <span class="n">schema_</span><span class="p">:</span> <span class="n">PudlSchemaDescriptor</span> <span class="o">=</span> <span class="n">pydantic</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">alias</span><span class="o">=</span><span class="s2">&quot;schema&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="PudlResourceDescriptor.encoder">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.PudlResourceDescriptor.encoder">[docs]</a>
    <span class="n">encoder</span><span class="p">:</span> <span class="n">PudlCodeMetadata</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="PudlResourceDescriptor.source_ids">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.PudlResourceDescriptor.source_ids">[docs]</a>
    <span class="n">source_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">pydantic</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">alias</span><span class="o">=</span><span class="s2">&quot;sources&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="PudlResourceDescriptor.etl_group_id">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.PudlResourceDescriptor.etl_group_id">[docs]</a>
    <span class="n">etl_group_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">pydantic</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">alias</span><span class="o">=</span><span class="s2">&quot;etl_group&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="PudlResourceDescriptor.field_namespace_id">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.PudlResourceDescriptor.field_namespace_id">[docs]</a>
    <span class="n">field_namespace_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">pydantic</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">alias</span><span class="o">=</span><span class="s2">&quot;field_namespace&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="PudlResourceDescriptor.create_database_schema">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.PudlResourceDescriptor.create_database_schema">[docs]</a>
    <span class="n">create_database_schema</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="PudlResourceDescriptor.path">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.PudlResourceDescriptor.path">[docs]</a>
    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="PudlResourceDescriptor.extrapaths">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.PudlResourceDescriptor.extrapaths">[docs]</a>
    <span class="n">extrapaths</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></div>
</div>



<div class="viewcode-block" id="Resource">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Resource">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Resource</span><span class="p">(</span><span class="n">PudlMeta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tabular data resource (`package.resources[...]`).</span>

<span class="sd">    See https://specs.frictionlessdata.io/tabular-data-resource.</span>

<span class="sd">    Examples:</span>
<span class="sd">        A simple example illustrates the conversion to SQLAlchemy objects.</span>

<span class="sd">        &gt;&gt;&gt; fields = [{&#39;name&#39;: &#39;x&#39;, &#39;type&#39;: &#39;year&#39;, &#39;description&#39;: &#39;X&#39;}, {&#39;name&#39;: &#39;y&#39;, &#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;Y&#39;}]</span>
<span class="sd">        &gt;&gt;&gt; fkeys = [{&#39;fields&#39;: [&#39;x&#39;, &#39;y&#39;], &#39;reference&#39;: {&#39;resource&#39;: &#39;b&#39;, &#39;fields&#39;: [&#39;x&#39;, &#39;y&#39;]}}]</span>
<span class="sd">        &gt;&gt;&gt; schema = {&#39;fields&#39;: fields, &#39;primary_key&#39;: [&#39;x&#39;], &#39;foreign_keys&#39;: fkeys}</span>
<span class="sd">        &gt;&gt;&gt; resource = Resource(name=&#39;a&#39;, schema=schema, description=&#39;A&#39;)</span>
<span class="sd">        &gt;&gt;&gt; table = resource.to_sql()</span>
<span class="sd">        &gt;&gt;&gt; table.columns.x</span>
<span class="sd">        Column(&#39;x&#39;, Integer(), ForeignKey(&#39;b.x&#39;), CheckConstraint(...), table=&lt;a&gt;, primary_key=True, nullable=False, comment=&#39;X&#39;)</span>
<span class="sd">        &gt;&gt;&gt; table.columns.y</span>
<span class="sd">        Column(&#39;y&#39;, Text(), ForeignKey(&#39;b.y&#39;), CheckConstraint(...), table=&lt;a&gt;, comment=&#39;Y&#39;)</span>

<span class="sd">        To illustrate harvesting operations,</span>
<span class="sd">        say we have a resource with two fields - a primary key (`id`) and a data field -</span>
<span class="sd">        which we want to harvest from two different dataframes.</span>

<span class="sd">        &gt;&gt;&gt; from pudl.metadata.helpers import unique, as_dict</span>
<span class="sd">        &gt;&gt;&gt; fields = [</span>
<span class="sd">        ...     {&#39;name&#39;: &#39;id&#39;, &#39;type&#39;: &#39;integer&#39;, &#39;description&#39;: &#39;ID&#39;},</span>
<span class="sd">        ...     {&#39;name&#39;: &#39;x&#39;, &#39;type&#39;: &#39;integer&#39;, &#39;harvest&#39;: {&#39;aggregate&#39;: unique, &#39;tolerance&#39;: 0.25}, &#39;description&#39;: &#39;X&#39;}</span>
<span class="sd">        ... ]</span>
<span class="sd">        &gt;&gt;&gt; resource = Resource(**{</span>
<span class="sd">        ...     &#39;name&#39;: &#39;a&#39;,</span>
<span class="sd">        ...     &#39;harvest&#39;: {&#39;harvest&#39;: True},</span>
<span class="sd">        ...     &#39;schema&#39;: {&#39;fields&#39;: fields, &#39;primary_key&#39;: [&#39;id&#39;]},</span>
<span class="sd">        ...     &#39;description&#39;: &#39;A&#39;,</span>
<span class="sd">        ... })</span>
<span class="sd">        &gt;&gt;&gt; dfs = {</span>
<span class="sd">        ...     &#39;a&#39;: pd.DataFrame({&#39;id&#39;: [1, 1, 2, 2], &#39;x&#39;: [1, 1, 2, 2]}),</span>
<span class="sd">        ...     &#39;b&#39;: pd.DataFrame({&#39;id&#39;: [2, 3, 3], &#39;x&#39;: [3, 4, 4]})</span>
<span class="sd">        ... }</span>

<span class="sd">        Skip aggregation to access all the rows concatenated from the input dataframes.</span>
<span class="sd">        The names of the input dataframes are used as the index.</span>

<span class="sd">        &gt;&gt;&gt; df, _ = resource.harvest_dfs(dfs, aggregate=False)</span>
<span class="sd">        &gt;&gt;&gt; df</span>
<span class="sd">            id  x</span>
<span class="sd">        df</span>
<span class="sd">        a    1  1</span>
<span class="sd">        a    1  1</span>
<span class="sd">        a    2  2</span>
<span class="sd">        a    2  2</span>
<span class="sd">        b    2  3</span>
<span class="sd">        b    3  4</span>
<span class="sd">        b    3  4</span>

<span class="sd">        Field names and data types are enforced.</span>

<span class="sd">        &gt;&gt;&gt; resource.to_pandas_dtypes() == df.dtypes.apply(str).to_dict()</span>
<span class="sd">        True</span>

<span class="sd">        Alternatively, aggregate by primary key</span>
<span class="sd">        (the default when :attr:`harvest`. ``harvest=True``)</span>
<span class="sd">        and report aggregation errors.</span>

<span class="sd">        &gt;&gt;&gt; df, report = resource.harvest_dfs(dfs)</span>
<span class="sd">        &gt;&gt;&gt; df</span>
<span class="sd">               x</span>
<span class="sd">        id</span>
<span class="sd">        1      1</span>
<span class="sd">        2   &lt;NA&gt;</span>
<span class="sd">        3      4</span>
<span class="sd">        &gt;&gt;&gt; report[&#39;stats&#39;]</span>
<span class="sd">        {&#39;all&#39;: 2, &#39;invalid&#39;: 1, &#39;tolerance&#39;: 0.0, &#39;actual&#39;: 0.5}</span>
<span class="sd">        &gt;&gt;&gt; report[&#39;fields&#39;][&#39;x&#39;][&#39;stats&#39;]</span>
<span class="sd">        {&#39;all&#39;: 3, &#39;invalid&#39;: 1, &#39;tolerance&#39;: 0.25, &#39;actual&#39;: 0.33...}</span>
<span class="sd">        &gt;&gt;&gt; report[&#39;fields&#39;][&#39;x&#39;][&#39;errors&#39;]</span>
<span class="sd">        id</span>
<span class="sd">        2    Not unique.</span>
<span class="sd">        Name: x, dtype: object</span>

<span class="sd">        Customize the error values in the error report.</span>

<span class="sd">        &gt;&gt;&gt; error = lambda x, e: as_dict(x)</span>
<span class="sd">        &gt;&gt;&gt; df, report = resource.harvest_dfs(</span>
<span class="sd">        ...    dfs, aggregate_kwargs={&#39;raised&#39;: False, &#39;error&#39;: error}</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; report[&#39;fields&#39;][&#39;x&#39;][&#39;errors&#39;]</span>
<span class="sd">        id</span>
<span class="sd">        2    {&#39;a&#39;: [2, 2], &#39;b&#39;: [3]}</span>
<span class="sd">        Name: x, dtype: object</span>

<span class="sd">        Limit harvesting to the input dataframe of the same name</span>
<span class="sd">        by setting :attr:`harvest`. ``harvest=False``.</span>

<span class="sd">        &gt;&gt;&gt; resource.harvest.harvest = False</span>
<span class="sd">        &gt;&gt;&gt; df, _ = resource.harvest_dfs(dfs, aggregate_kwargs={&#39;raised&#39;: False})</span>
<span class="sd">        &gt;&gt;&gt; df</span>
<span class="sd">            id  x</span>
<span class="sd">        df</span>
<span class="sd">        a    1  1</span>
<span class="sd">        a    1  1</span>
<span class="sd">        a    2  2</span>
<span class="sd">        a    2  2</span>

<span class="sd">        Harvesting can also handle conversion to longer time periods.</span>
<span class="sd">        Period harvesting requires primary key fields with a ``datetime`` data type,</span>
<span class="sd">        except for ``year`` fields which can be integer.</span>

<span class="sd">        &gt;&gt;&gt; fields = [{&#39;name&#39;: &#39;report_year&#39;, &#39;type&#39;: &#39;year&#39;, &#39;description&#39;: &#39;Report year&#39;}]</span>
<span class="sd">        &gt;&gt;&gt; resource = Resource(**{</span>
<span class="sd">        ...     &#39;name&#39;: &#39;table&#39;, &#39;harvest&#39;: {&#39;harvest&#39;: True},</span>
<span class="sd">        ...     &#39;schema&#39;: {&#39;fields&#39;: fields, &#39;primary_key&#39;: [&#39;report_year&#39;]},</span>
<span class="sd">        ...     &#39;description&#39;: &#39;Table&#39;,</span>
<span class="sd">        ... })</span>
<span class="sd">        &gt;&gt;&gt; df = pd.DataFrame({&#39;report_date&#39;: [&#39;2000-02-02&#39;, &#39;2000-03-03&#39;]})</span>
<span class="sd">        &gt;&gt;&gt; resource.format_df(df)</span>
<span class="sd">          report_year</span>
<span class="sd">        0  2000-01-01</span>
<span class="sd">        1  2000-01-01</span>
<span class="sd">        &gt;&gt;&gt; df = pd.DataFrame({&#39;report_year&#39;: [2000, 2000]})</span>
<span class="sd">        &gt;&gt;&gt; resource.format_df(df)</span>
<span class="sd">          report_year</span>
<span class="sd">        0  2000-01-01</span>
<span class="sd">        1  2000-01-01</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Resource.name">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Resource.name">[docs]</a>
    <span class="n">name</span><span class="p">:</span> <span class="n">SnakeCase</span></div>

<div class="viewcode-block" id="Resource.title">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Resource.title">[docs]</a>
    <span class="n">title</span><span class="p">:</span> <span class="n">String</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Resource.description">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Resource.description">[docs]</a>
    <span class="n">description</span><span class="p">:</span> <span class="n">String</span></div>

<div class="viewcode-block" id="Resource.harvest">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Resource.harvest">[docs]</a>
    <span class="n">harvest</span><span class="p">:</span> <span class="n">ResourceHarvest</span> <span class="o">=</span> <span class="n">ResourceHarvest</span><span class="p">()</span></div>

<div class="viewcode-block" id="Resource.schema">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Resource.schema">[docs]</a>
    <span class="n">schema</span><span class="p">:</span> <span class="n">Schema</span></div>

    <span class="c1"># Alias required to avoid shadowing Python built-in format()</span>
<div class="viewcode-block" id="Resource.format_">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Resource.format_">[docs]</a>
    <span class="n">format_</span><span class="p">:</span> <span class="n">String</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">pydantic</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">alias</span><span class="o">=</span><span class="s2">&quot;format&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="Resource.mediatype">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Resource.mediatype">[docs]</a>
    <span class="n">mediatype</span><span class="p">:</span> <span class="n">String</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Resource.dialect">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Resource.dialect">[docs]</a>
    <span class="n">dialect</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Resource.profile">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Resource.profile">[docs]</a>
    <span class="n">profile</span><span class="p">:</span> <span class="n">String</span> <span class="o">=</span> <span class="s2">&quot;tabular-data-resource&quot;</span></div>

<div class="viewcode-block" id="Resource.contributors">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Resource.contributors">[docs]</a>
    <span class="n">contributors</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Contributor</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="Resource.licenses">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Resource.licenses">[docs]</a>
    <span class="n">licenses</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">License</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="Resource.sources">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Resource.sources">[docs]</a>
    <span class="n">sources</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">DataSource</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="Resource.keywords">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Resource.keywords">[docs]</a>
    <span class="n">keywords</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">String</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="Resource.encoder">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Resource.encoder">[docs]</a>
    <span class="n">encoder</span><span class="p">:</span> <span class="n">Encoder</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Resource.path">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Resource.path">[docs]</a>
    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">pydantic</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.parquet&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Resource.extrapaths">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Resource.extrapaths">[docs]</a>
    <span class="n">extrapaths</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Resource.field_namespace">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Resource.field_namespace">[docs]</a>
    <span class="n">field_namespace</span><span class="p">:</span> <span class="p">(</span>
        <span class="n">Literal</span><span class="p">[</span>
            <span class="s2">&quot;censusdp1tract&quot;</span><span class="p">,</span>
            <span class="s2">&quot;eia&quot;</span><span class="p">,</span>
            <span class="s2">&quot;eiaaeo&quot;</span><span class="p">,</span>
            <span class="s2">&quot;eiaapi&quot;</span><span class="p">,</span>
            <span class="s2">&quot;epacems&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ferc&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ferc1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ferc714&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ferceqr&quot;</span><span class="p">,</span>
            <span class="s2">&quot;glue&quot;</span><span class="p">,</span>
            <span class="s2">&quot;gridpathratoolkit&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ppe&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pudl&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nrelatb&quot;</span><span class="p">,</span>
            <span class="s2">&quot;vcerare&quot;</span><span class="p">,</span>
            <span class="s2">&quot;phmsagas&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sec&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rus&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="o">|</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Resource.etl_group">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Resource.etl_group">[docs]</a>
    <span class="n">etl_group</span><span class="p">:</span> <span class="p">(</span>
        <span class="n">Literal</span><span class="p">[</span>
            <span class="s2">&quot;censusdp1tract&quot;</span><span class="p">,</span>
            <span class="s2">&quot;eia176&quot;</span><span class="p">,</span>
            <span class="s2">&quot;eia860&quot;</span><span class="p">,</span>
            <span class="s2">&quot;eia861&quot;</span><span class="p">,</span>
            <span class="s2">&quot;eia861_disabled&quot;</span><span class="p">,</span>
            <span class="s2">&quot;eia923&quot;</span><span class="p">,</span>
            <span class="s2">&quot;eia930&quot;</span><span class="p">,</span>
            <span class="s2">&quot;eiaaeo&quot;</span><span class="p">,</span>
            <span class="s2">&quot;entity_eia&quot;</span><span class="p">,</span>
            <span class="s2">&quot;epacems&quot;</span><span class="p">,</span>
            <span class="s2">&quot;entity_ferc&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ferc1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ferc1_disabled&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ferc714&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ferceqr&quot;</span><span class="p">,</span>
            <span class="s2">&quot;glue&quot;</span><span class="p">,</span>
            <span class="s2">&quot;gridpathratoolkit&quot;</span><span class="p">,</span>
            <span class="s2">&quot;outputs&quot;</span><span class="p">,</span>
            <span class="s2">&quot;static_ferc1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;static_eia&quot;</span><span class="p">,</span>
            <span class="s2">&quot;static_eia_disabled&quot;</span><span class="p">,</span>
            <span class="s2">&quot;eiaapi&quot;</span><span class="p">,</span>
            <span class="s2">&quot;state_demand&quot;</span><span class="p">,</span>
            <span class="s2">&quot;static_pudl&quot;</span><span class="p">,</span>
            <span class="s2">&quot;service_territories&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nrelatb&quot;</span><span class="p">,</span>
            <span class="s2">&quot;vcerare&quot;</span><span class="p">,</span>
            <span class="s2">&quot;phmsagas&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sec10k&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rus7&quot;</span><span class="p">,</span>
            <span class="s2">&quot;static_rus&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rus12&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="o">|</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Resource.create_database_schema">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Resource.create_database_schema">[docs]</a>
    <span class="n">create_database_schema</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="Resource._check_unique">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Resource._check_unique">[docs]</a>
    <span class="n">_check_unique</span> <span class="o">=</span> <span class="n">_validator</span><span class="p">(</span>
        <span class="s2">&quot;contributors&quot;</span><span class="p">,</span> <span class="s2">&quot;keywords&quot;</span><span class="p">,</span> <span class="s2">&quot;licenses&quot;</span><span class="p">,</span> <span class="s2">&quot;sources&quot;</span><span class="p">,</span> <span class="n">fn</span><span class="o">=</span><span class="n">_check_unique</span>
    <span class="p">)</span></div>


    <span class="nd">@property</span>
<div class="viewcode-block" id="Resource.sphinx_ref_name">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Resource.sphinx_ref_name">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">sphinx_ref_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get legal Sphinx ref name.</span>

<span class="sd">        Sphinx throws an error when creating a cross ref target for</span>
<span class="sd">        a resource that has a preceding underscore. It is</span>
<span class="sd">        also possible for resources to have identical names</span>
<span class="sd">        when the preceding underscore is removed. This function</span>
<span class="sd">        adds a preceding &#39;i&#39; to cross ref targets for resources</span>
<span class="sd">        with preceding underscores. The &#39;i&#39; will not be rendered</span>
<span class="sd">        in the docs, only in the .rst files the hyperlinks.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;i</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span></div>


    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;schema&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Resource._check_harvest_primary_key">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Resource._check_harvest_primary_key">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_check_harvest_primary_key</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">info</span><span class="p">:</span> <span class="n">ValidationInfo</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">info</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;harvest&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">harvest</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">value</span><span class="o">.</span><span class="n">primary_key</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Harvesting requires a primary key&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span></div>


    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Resource.dict_from_id">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Resource.dict_from_id">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">dict_from_id</span><span class="p">(</span><span class="n">resource_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct dictionary from PUDL identifier (`resource.name`).&quot;&quot;&quot;</span>
        <span class="n">descriptor</span> <span class="o">=</span> <span class="n">PudlResourceDescriptor</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span>
            <span class="n">RESOURCE_METADATA</span><span class="p">[</span><span class="n">resource_id</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">Resource</span><span class="o">.</span><span class="n">dict_from_resource_descriptor</span><span class="p">(</span><span class="n">resource_id</span><span class="p">,</span> <span class="n">descriptor</span><span class="p">)</span></div>


    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Resource.dict_from_resource_descriptor">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Resource.dict_from_resource_descriptor">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">dict_from_resource_descriptor</span><span class="p">(</span>  <span class="c1"># noqa: C901</span>
        <span class="n">resource_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">descriptor</span><span class="p">:</span> <span class="n">PudlResourceDescriptor</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a Resource-shaped dict from a PudlResourceDescriptor.</span>

<span class="sd">        * ``schema.fields``</span>

<span class="sd">          * Field names are expanded (:meth:`Field.from_id`).</span>
<span class="sd">          * Field attributes are replaced with any specific to the</span>
<span class="sd">            ``resource.group`` and ``field.name``.</span>

<span class="sd">        * ``sources``: Source ids are expanded (:meth:`Source.from_id`).</span>
<span class="sd">        * ``licenses``: License ids are expanded (:meth:`License.from_id`).</span>
<span class="sd">        * ``contributors``: Contributor ids are fetched by source ids,</span>
<span class="sd">          then expanded (:meth:`Contributor.from_id`).</span>
<span class="sd">        * ``keywords``: Keywords are fetched by source ids.</span>
<span class="sd">        * ``schema.foreign_keys``: Foreign keys are fetched by resource name.</span>
<span class="sd">        * ``description``: Full description text block is rendered from its component parts.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">descriptor</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">by_alias</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">resource_id</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;schema&quot;</span><span class="p">]</span>
        <span class="c1"># Expand fields</span>
        <span class="k">if</span> <span class="s2">&quot;fields&quot;</span> <span class="ow">in</span> <span class="n">schema</span><span class="p">:</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">schema</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]:</span>
                <span class="c1"># Lookup field by name</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">Field</span><span class="o">.</span><span class="n">dict_from_id</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="c1"># Update with any custom group-level metadata</span>
                <span class="n">namespace</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;field_namespace&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">FIELD_METADATA_BY_GROUP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="p">{}):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">value</span><span class="p">,</span> <span class="o">**</span><span class="n">FIELD_METADATA_BY_GROUP</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="n">name</span><span class="p">]}</span>
                <span class="c1"># Update with any custom resource-level metadata</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">FIELD_METADATA_BY_RESOURCE</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">resource_id</span><span class="p">,</span> <span class="p">{}):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">value</span><span class="p">,</span> <span class="o">**</span><span class="n">FIELD_METADATA_BY_RESOURCE</span><span class="p">[</span><span class="n">resource_id</span><span class="p">][</span><span class="n">name</span><span class="p">]}</span>
                <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">schema</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fields</span>
        <span class="c1"># Expand sources</span>
        <span class="n">sources</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sources&quot;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;sources&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">DataSource</span><span class="o">.</span><span class="n">from_id</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">sources</span> <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">SOURCES</span>
        <span class="p">]</span>
        <span class="c1"># Expand licenses (assign CC-BY-4.0 by default)</span>
        <span class="n">licenses</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;licenses&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;cc-by-4.0&quot;</span><span class="p">])</span>
        <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;licenses&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">License</span><span class="o">.</span><span class="n">dict_from_id</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">licenses</span><span class="p">]</span>
        <span class="c1"># Lookup and insert contributors</span>
        <span class="k">if</span> <span class="s2">&quot;contributors&quot;</span> <span class="ow">in</span> <span class="n">schema</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Resource metadata contains explicit contributors&quot;</span><span class="p">)</span>
        <span class="n">contributors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="n">sources</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">source</span> <span class="ow">in</span> <span class="n">SOURCES</span><span class="p">:</span>
                <span class="n">contributors</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">DataSource</span><span class="o">.</span><span class="n">from_id</span><span class="p">(</span><span class="n">source</span><span class="p">)</span><span class="o">.</span><span class="n">contributors</span><span class="p">)</span>
        <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;contributors&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">contributors</span><span class="p">)</span>
        <span class="c1"># Lookup and insert keywords</span>
        <span class="k">if</span> <span class="s2">&quot;keywords&quot;</span> <span class="ow">in</span> <span class="n">schema</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Resource metadata contains explicit keywords&quot;</span><span class="p">)</span>
        <span class="n">keywords</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="n">sources</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">source</span> <span class="ow">in</span> <span class="n">SOURCES</span><span class="p">:</span>
                <span class="n">keywords</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">DataSource</span><span class="o">.</span><span class="n">from_id</span><span class="p">(</span><span class="n">source</span><span class="p">)</span><span class="o">.</span><span class="n">keywords</span><span class="p">)</span>
        <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;keywords&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">keywords</span><span class="p">))</span>
        <span class="c1"># Insert foreign keys</span>
        <span class="n">schema</span><span class="p">[</span><span class="s2">&quot;foreign_keys&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FOREIGN_KEYS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">resource_id</span><span class="p">,</span> <span class="p">[])</span>
        <span class="c1"># Delete foreign key rules</span>
        <span class="k">if</span> <span class="s2">&quot;foreign_key_rules&quot;</span> <span class="ow">in</span> <span class="n">schema</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">schema</span><span class="p">[</span><span class="s2">&quot;foreign_key_rules&quot;</span><span class="p">]</span>

        <span class="c1"># overwrite description components with rendered text block</span>
        <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">descriptions</span><span class="o">.</span><span class="n">ResourceDescriptionBuilder</span><span class="p">(</span>
                <span class="n">resource_id</span><span class="p">,</span>
                <span class="n">obj</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">build</span><span class="p">()</span>
            <span class="o">.</span><span class="n">jinja_render</span><span class="p">(</span><span class="n">_get_jinja_environment</span><span class="p">())</span>
        <span class="p">)</span>

        <span class="c1"># Add encoders to columns as appropriate, based on FKs.</span>
        <span class="c1"># Foreign key relationships determine the set of codes to use</span>
        <span class="k">for</span> <span class="n">fk</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;schema&quot;</span><span class="p">][</span><span class="s2">&quot;foreign_keys&quot;</span><span class="p">]:</span>
            <span class="c1"># Only referenced tables with an associated encoder indicate</span>
            <span class="c1"># that the column we&#39;re looking at should have an encoder</span>
            <span class="c1"># attached to it. All of these FK relationships must have simple</span>
            <span class="c1"># single-column keys.</span>
            <span class="n">encoder</span> <span class="o">=</span> <span class="n">Encoder</span><span class="o">.</span><span class="n">dict_from_id</span><span class="p">(</span><span class="n">fk</span><span class="p">[</span><span class="s2">&quot;reference&quot;</span><span class="p">][</span><span class="s2">&quot;resource&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fk</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">encoder</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Encoder for table with a composite primary key: &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fk</span><span class="p">[</span><span class="s1">&#39;reference&#39;</span><span class="p">][</span><span class="s1">&#39;resource&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fk</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">encoder</span><span class="p">:</span>
                <span class="c1"># fk[&quot;fields&quot;] is a one element list, get the one element:</span>
                <span class="n">field</span> <span class="o">=</span> <span class="n">fk</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;schema&quot;</span><span class="p">][</span><span class="s2">&quot;fields&quot;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">f</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">field</span><span class="p">:</span>
                        <span class="n">f</span><span class="p">[</span><span class="s2">&quot;encoder&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">encoder</span>
                        <span class="k">break</span>

        <span class="k">return</span> <span class="n">obj</span></div>


    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Resource.from_id">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Resource.from_id">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_id</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Resource&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct from PUDL identifier (`resource.name`).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="bp">cls</span><span class="o">.</span><span class="n">dict_from_id</span><span class="p">(</span><span class="n">x</span><span class="p">))</span></div>


<div class="viewcode-block" id="Resource.get_field">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Resource.get_field">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Field</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return field with the given name if it&#39;s part of the Resources.&quot;&quot;&quot;</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">fields</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The field </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> is not part of the </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> schema.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="n">names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">name</span><span class="p">)]</span></div>


<div class="viewcode-block" id="Resource.get_field_names">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Resource.get_field_names">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_field_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a list of all the field names in the resource schema.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">fields</span><span class="p">]</span></div>


<div class="viewcode-block" id="Resource.to_sql">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Resource.to_sql">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_sql</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">metadata</span><span class="p">:</span> <span class="n">sa</span><span class="o">.</span><span class="n">MetaData</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">check_types</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">check_values</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sa</span><span class="o">.</span><span class="n">Table</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return equivalent SQL Table.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">metadata</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">MetaData</span><span class="p">()</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">f</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span>
                <span class="n">check_types</span><span class="o">=</span><span class="n">check_types</span><span class="p">,</span>
                <span class="n">check_values</span><span class="o">=</span><span class="n">check_values</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">fields</span>
        <span class="p">]</span>
        <span class="n">constraints</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">primary_key</span><span class="p">:</span>
            <span class="n">constraints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sa</span><span class="o">.</span><span class="n">PrimaryKeyConstraint</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">primary_key</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">foreign_keys</span><span class="p">:</span>
            <span class="n">constraints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">to_sql</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">sa</span><span class="o">.</span><span class="n">Table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="o">*</span><span class="n">columns</span><span class="p">,</span> <span class="o">*</span><span class="n">constraints</span><span class="p">)</span></div>


<div class="viewcode-block" id="Resource.to_frictionless">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Resource.to_frictionless">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_frictionless</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert to a Frictionless Resource.&quot;&quot;&quot;</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="n">frictionless</span><span class="o">.</span><span class="n">Schema</span><span class="p">(</span>
            <span class="n">fields</span><span class="o">=</span><span class="p">[</span>
                <span class="n">frictionless</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">fields</span>
            <span class="p">],</span>
            <span class="n">primary_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">primary_key</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">frictionless</span><span class="o">.</span><span class="n">Resource</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
            <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">,</span>
            <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
            <span class="n">extrapaths</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">extrapaths</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Resource.to_pyarrow">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Resource.to_pyarrow">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_pyarrow</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pa</span><span class="o">.</span><span class="n">Schema</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct a PyArrow schema for the resource.&quot;&quot;&quot;</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">to_pyarrow</span><span class="p">()</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">fields</span><span class="p">]</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">primary_key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">metadata</span> <span class="o">|=</span> <span class="p">{</span><span class="s2">&quot;primary_key&quot;</span><span class="p">:</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">primary_key</span><span class="p">)}</span>
        <span class="k">return</span> <span class="n">pa</span><span class="o">.</span><span class="n">schema</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span></div>


<div class="viewcode-block" id="Resource.to_duckdb_dtypes">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Resource.to_duckdb_dtypes">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_duckdb_dtypes</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">conn</span><span class="p">:</span> <span class="n">duckdb</span><span class="o">.</span><span class="n">DuckDBPyConnection</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">duckdb</span><span class="o">.</span><span class="n">sqltypes</span><span class="o">.</span><span class="n">DuckDBPyType</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return Polars data type of each field by field name.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">to_duckdb_dtype</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">fields</span><span class="p">}</span></div>


<div class="viewcode-block" id="Resource.to_polars_dtypes">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Resource.to_polars_dtypes">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_polars_dtypes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataType</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return Polars data type of each field by field name.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">to_polars_dtype</span><span class="p">()</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">fields</span><span class="p">}</span></div>


<div class="viewcode-block" id="Resource.to_pandas_dtypes">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Resource.to_pandas_dtypes">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_pandas_dtypes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">CategoricalDtype</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return Pandas data type of each field by field name.</span>

<span class="sd">        Args:</span>
<span class="sd">            kwargs: Arguments to :meth:`Field.to_pandas_dtype`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">to_pandas_dtype</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">fields</span><span class="p">}</span></div>


<div class="viewcode-block" id="Resource.match_primary_key">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Resource.match_primary_key">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">match_primary_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Match primary key fields to input field names.</span>

<span class="sd">        An exact match is required unless :attr:`harvest` .`harvest=True`,</span>
<span class="sd">        in which case periodic names may also match a basename with a smaller period.</span>

<span class="sd">        Args:</span>
<span class="sd">            names: Field names.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Field names are not unique.</span>
<span class="sd">            ValueError: Multiple field names match primary key field.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The name matching each primary key field (if any) as a :class:`dict`,</span>
<span class="sd">            or ``None`` if not all primary key fields have a match.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; fields = [{&#39;name&#39;: &#39;x_year&#39;, &#39;type&#39;: &#39;year&#39;, &#39;description&#39;: &#39;Year&#39;}]</span>
<span class="sd">            &gt;&gt;&gt; schema = {&#39;fields&#39;: fields, &#39;primary_key&#39;: [&#39;x_year&#39;]}</span>
<span class="sd">            &gt;&gt;&gt; resource = Resource(name=&#39;r&#39;, schema=schema, description=&#39;R&#39;)</span>

<span class="sd">            By default, when :attr:`harvest` .`harvest=False`,</span>
<span class="sd">            exact matches are required.</span>

<span class="sd">            &gt;&gt;&gt; resource.harvest.harvest</span>
<span class="sd">            False</span>
<span class="sd">            &gt;&gt;&gt; resource.match_primary_key([&#39;x_month&#39;]) is None</span>
<span class="sd">            True</span>
<span class="sd">            &gt;&gt;&gt; resource.match_primary_key([&#39;x_year&#39;, &#39;x_month&#39;])</span>
<span class="sd">            {&#39;x_year&#39;: &#39;x_year&#39;}</span>

<span class="sd">            When :attr:`harvest` .`harvest=True`,</span>
<span class="sd">            in the absence of an exact match,</span>
<span class="sd">            periodic names may also match a basename with a smaller period.</span>

<span class="sd">            &gt;&gt;&gt; resource.harvest.harvest = True</span>
<span class="sd">            &gt;&gt;&gt; resource.match_primary_key([&#39;x_year&#39;, &#39;x_month&#39;])</span>
<span class="sd">            {&#39;x_year&#39;: &#39;x_year&#39;}</span>
<span class="sd">            &gt;&gt;&gt; resource.match_primary_key([&#39;x_month&#39;])</span>
<span class="sd">            {&#39;x_month&#39;: &#39;x_year&#39;}</span>
<span class="sd">            &gt;&gt;&gt; resource.match_primary_key([&#39;x_month&#39;, &#39;x_date&#39;])</span>
<span class="sd">            Traceback (most recent call last):</span>
<span class="sd">            ValueError: ... {&#39;x_month&#39;, &#39;x_date&#39;} match primary key field &#39;x_year&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">names</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Field names are not unique&quot;</span><span class="p">)</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">primary_key</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">harvest</span><span class="o">.</span><span class="n">harvest</span><span class="p">:</span>
            <span class="n">remaining</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
            <span class="n">matches</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                <span class="n">match</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">remaining</span><span class="p">:</span>
                    <span class="c1"># Use exact match if present</span>
                    <span class="n">match</span> <span class="o">=</span> <span class="n">key</span>
                <span class="k">elif</span> <span class="n">split_period</span><span class="p">(</span><span class="n">key</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="c1"># Try periodic alternatives</span>
                    <span class="n">periods</span> <span class="o">=</span> <span class="n">expand_periodic_column_names</span><span class="p">([</span><span class="n">key</span><span class="p">])</span>
                    <span class="n">matching</span> <span class="o">=</span> <span class="n">remaining</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">periods</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matching</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Multiple field names </span><span class="si">{</span><span class="n">matching</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;match primary key field &#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
                        <span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matching</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">match</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">matching</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                    <span class="n">matches</span><span class="p">[</span><span class="n">match</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span>
                    <span class="n">remaining</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">match</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">matches</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">names</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">matches</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="Resource.format_df">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Resource.format_df">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">format_df</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">|</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">|</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Format a dataframe according to the resources&#39;s table schema.</span>

<span class="sd">        * DataFrame columns not in the schema are dropped.</span>
<span class="sd">        * Any columns missing from the DataFrame are added with the right dtype, but</span>
<span class="sd">          will be empty.</span>
<span class="sd">        * All columns are cast to their specified pandas dtypes.</span>
<span class="sd">        * Primary key columns must be present and non-null.</span>
<span class="sd">        * Periodic primary key fields are snapped to the start of the desired period.</span>
<span class="sd">        * If the primary key fields could not be matched to columns in ``df``</span>
<span class="sd">          (:meth:`match_primary_key`) or if ``df=None``, an empty dataframe is returned.</span>

<span class="sd">        Args:</span>
<span class="sd">            df: Dataframe to format.</span>
<span class="sd">            kwargs: Arguments to :meth:`Field.to_pandas_dtypes`.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dataframe with column names and data types matching the resource fields.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dtypes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_pandas_dtypes</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">df</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="n">n</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match_primary_key</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">matches</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Primary key present but no matches were found</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_df</span><span class="p">()</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1"># Rename periodic key columns (if any) to the requested period</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">matches</span><span class="p">)</span>
        <span class="c1"># Cast integer year fields to datetime</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">field</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;year&quot;</span>
                <span class="ow">and</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">df</span>
                <span class="ow">and</span> <span class="n">pd</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_integer_dtype</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>
            <span class="p">):</span>
                <span class="n">df</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;%Y&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">],</span> <span class="n">pd</span><span class="o">.</span><span class="n">CategoricalDtype</span><span class="p">):</span>
                <span class="n">uncategorized</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">value</span>
                    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">categories</span>
                <span class="p">]</span>
                <span class="k">if</span> <span class="n">uncategorized</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Values in </span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> column are not included in &quot;</span>
                        <span class="s2">&quot;categorical values in field enum constraint &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;and will be converted to nulls (</span><span class="si">{</span><span class="n">uncategorized</span><span class="si">}</span><span class="s2">).&quot;</span>
                    <span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
            <span class="c1"># Reorder columns and insert missing columns</span>
            <span class="n">df</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">dtypes</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="c1"># Coerce columns to correct data type</span>
            <span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># Convert periodic key columns to the requested period</span>
        <span class="k">for</span> <span class="n">df_key</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">matches</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">period</span> <span class="o">=</span> <span class="n">split_period</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">period</span> <span class="ow">and</span> <span class="n">df_key</span> <span class="o">!=</span> <span class="n">key</span><span class="p">:</span>
                <span class="n">df</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">PERIODS</span><span class="p">[</span><span class="n">period</span><span class="p">](</span><span class="n">df</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">df</span></div>


<div class="viewcode-block" id="Resource.enforce_schema">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Resource.enforce_schema">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">enforce_schema</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">|</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">|</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Drop columns not in the DB schema and enforce specified types.&quot;&quot;&quot;</span>
        <span class="n">expected_cols</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_field_names</span><span class="p">())</span>
        <span class="n">missing_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">expected_cols</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">missing_cols</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: Missing columns found when enforcing table &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;schema: </span><span class="si">{</span><span class="n">missing_cols</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Log warning if columns in dataframe are getting dropped in write</span>
        <span class="n">dropped_columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">expected_cols</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">dropped_columns</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;The following columns are getting dropped when the table is written:&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dropped_columns</span><span class="si">}</span><span class="s2">. This is often the intended behavior. If you want &quot;</span>
                <span class="s2">&quot;to keep any of these columns, add them to the metadata.resources &quot;</span>
                <span class="s2">&quot;fields and update alembic.&quot;</span>
            <span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_df</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">pk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">primary_key</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">pk</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span>
                <span class="n">dupes</span> <span class="o">:=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="n">pk</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">pk</span><span class="p">)</span>
            <span class="p">)</span><span class="o">.</span><span class="n">empty</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">dupes</span><span class="p">)</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="si">}</span><span class="s2"> duplicate primary keys (</span><span class="si">{</span><span class="n">pk</span><span class="si">=}</span><span class="s2">) &quot;</span>
                <span class="s2">&quot;when enforcing schema:</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dupes</span><span class="o">.</span><span class="n">head</span><span class="p">()</span><span class="si">}{</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">...&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">dupes</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">pk</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">nulls</span> <span class="o">:=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">pk</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)])</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> Null values found in primary key columns.</span><span class="se">\n</span><span class="si">{</span><span class="n">nulls</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span></div>


<div class="viewcode-block" id="Resource.aggregate_df">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Resource.aggregate_df">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">aggregate_df</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">raised</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">error</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Aggregate dataframe by primary key.</span>

<span class="sd">        The dataframe is grouped by primary key fields</span>
<span class="sd">        and aggregated with the aggregate function of each field</span>
<span class="sd">        (:attr:`schema_`. ``fields[*].harvest.aggregate``).</span>

<span class="sd">        The report is formatted as follows:</span>

<span class="sd">        * ``valid`` (bool): Whether resource is valid.</span>
<span class="sd">        * ``stats`` (dict): Error statistics for resource fields.</span>
<span class="sd">        * ``fields`` (dict):</span>

<span class="sd">          * ``&lt;field_name&gt;`` (str)</span>

<span class="sd">            * ``valid`` (bool): Whether field is valid.</span>
<span class="sd">            * ``stats`` (dict): Error statistics for field groups.</span>
<span class="sd">            * ``errors`` (:class:`pandas.Series`): Error values indexed by primary key.</span>

<span class="sd">          * ...</span>

<span class="sd">        Each ``stats`` (dict) contains the following:</span>

<span class="sd">        * ``all`` (int): Number of entities (field or field group).</span>
<span class="sd">        * ``invalid`` (int): Invalid number of entities.</span>
<span class="sd">        * ``tolerance`` (float): Fraction of invalid entities below which</span>
<span class="sd">          parent entity is considered valid.</span>
<span class="sd">        * ``actual`` (float): Actual fraction of invalid entities.</span>

<span class="sd">        Args:</span>
<span class="sd">            df: Dataframe to aggregate. It is assumed to have column names and</span>
<span class="sd">              data types matching the resource fields.</span>
<span class="sd">            raised: Whether aggregation errors are raised or</span>
<span class="sd">               replaced with :obj:`np.nan` and returned in an error report.</span>
<span class="sd">            error: A function with signature ``f(x, e) -&gt; Any``,</span>
<span class="sd">              where ``x`` are the original field values as a :class:`pandas.Series`</span>
<span class="sd">              and ``e`` is the original error.</span>
<span class="sd">              If provided, the returned value is reported instead of ``e``.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: A primary key is required for aggregating.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The aggregated dataframe indexed by primary key fields,</span>
<span class="sd">            and an aggregation report (descripted above)</span>
<span class="sd">            that includes all aggregation errors and whether the result</span>
<span class="sd">            meets the resource&#39;s and fields&#39; tolerance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">primary_key</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;A primary key is required for aggregating&quot;</span><span class="p">)</span>
        <span class="n">aggfuncs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">harvest</span><span class="o">.</span><span class="n">aggregate</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">fields</span>
            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">primary_key</span>
        <span class="p">}</span>
        <span class="n">df</span><span class="p">,</span> <span class="n">report</span> <span class="o">=</span> <span class="n">groupby_aggregate</span><span class="p">(</span>
            <span class="n">df</span><span class="p">,</span>
            <span class="n">by</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">primary_key</span><span class="p">,</span>
            <span class="n">aggfuncs</span><span class="o">=</span><span class="n">aggfuncs</span><span class="p">,</span>
            <span class="n">raised</span><span class="o">=</span><span class="n">raised</span><span class="p">,</span>
            <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">report</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_aggregation_report</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">report</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span><span class="p">,</span> <span class="n">report</span></div>


<div class="viewcode-block" id="Resource._build_aggregation_report">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Resource._build_aggregation_report">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_build_aggregation_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">errors</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Build report from aggregation errors.</span>

<span class="sd">        Args:</span>
<span class="sd">            df: Harvested dataframe (see :meth:`harvest_dfs`).</span>
<span class="sd">            errors: Aggregation errors (see :func:`groupby_aggregate`).</span>

<span class="sd">        Returns:</span>
<span class="sd">            Aggregation report, as described in :meth:`aggregate_df`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nrows</span><span class="p">,</span> <span class="n">ncols</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">freports</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
            <span class="n">nerrors</span> <span class="o">=</span> <span class="n">errors</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">errors</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">stats</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;all&quot;</span><span class="p">:</span> <span class="n">nrows</span><span class="p">,</span>
                <span class="s2">&quot;invalid&quot;</span><span class="p">:</span> <span class="n">nerrors</span><span class="p">,</span>
                <span class="s2">&quot;tolerance&quot;</span><span class="p">:</span> <span class="n">field</span><span class="o">.</span><span class="n">harvest</span><span class="o">.</span><span class="n">tolerance</span><span class="p">,</span>
                <span class="s2">&quot;actual&quot;</span><span class="p">:</span> <span class="n">nerrors</span> <span class="o">/</span> <span class="n">nrows</span> <span class="k">if</span> <span class="n">nrows</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">freports</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;valid&quot;</span><span class="p">:</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;actual&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;tolerance&quot;</span><span class="p">],</span>
                <span class="s2">&quot;stats&quot;</span><span class="p">:</span> <span class="n">stats</span><span class="p">,</span>
                <span class="s2">&quot;errors&quot;</span><span class="p">:</span> <span class="n">errors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
            <span class="p">}</span>
        <span class="n">nerrors</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="ow">not</span> <span class="n">f</span><span class="p">[</span><span class="s2">&quot;valid&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">freports</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;all&quot;</span><span class="p">:</span> <span class="n">ncols</span><span class="p">,</span>
            <span class="s2">&quot;invalid&quot;</span><span class="p">:</span> <span class="n">nerrors</span><span class="p">,</span>
            <span class="s2">&quot;tolerance&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">harvest</span><span class="o">.</span><span class="n">tolerance</span><span class="p">,</span>
            <span class="s2">&quot;actual&quot;</span><span class="p">:</span> <span class="n">nerrors</span> <span class="o">/</span> <span class="n">ncols</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;valid&quot;</span><span class="p">:</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;actual&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;tolerance&quot;</span><span class="p">],</span>
            <span class="s2">&quot;stats&quot;</span><span class="p">:</span> <span class="n">stats</span><span class="p">,</span>
            <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="n">freports</span><span class="p">,</span>
        <span class="p">}</span></div>


<div class="viewcode-block" id="Resource.harvest_dfs">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Resource.harvest_dfs">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">harvest_dfs</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dfs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span>
        <span class="n">aggregate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">aggregate_kwargs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{},</span>
        <span class="n">format_kwargs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{},</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Harvest from named dataframes.</span>

<span class="sd">        For standard resources (:attr:`harvest`. ``harvest=False``), the columns</span>
<span class="sd">        matching all primary key fields and any data fields are extracted from</span>
<span class="sd">        the input dataframe of the same name.</span>

<span class="sd">        For harvested resources (:attr:`harvest`. ``harvest=True``), the columns</span>
<span class="sd">        matching all primary key fields and any data fields are extracted from</span>
<span class="sd">        each compatible input dataframe, and concatenated into a single</span>
<span class="sd">        dataframe.  Periodic key fields (e.g. &#39;report_month&#39;) are matched to any</span>
<span class="sd">        column of the same name with an equal or smaller period (e.g.</span>
<span class="sd">        &#39;report_day&#39;) and snapped to the start of the desired period.</span>

<span class="sd">        If ``aggregate=False``, rows are indexed by the name of the input dataframe.</span>
<span class="sd">        If ``aggregate=True``, rows are indexed by primary key fields.</span>

<span class="sd">        Args:</span>
<span class="sd">            dfs: Dataframes to harvest.</span>
<span class="sd">            aggregate: Whether to aggregate the harvested rows by their primary key.</span>
<span class="sd">                By default, this is ``True`` if ``self.harvest.harvest=True`` and</span>
<span class="sd">                ``False`` otherwise.</span>
<span class="sd">            aggregate_kwargs: Optional arguments to :meth:`aggregate_df`.</span>
<span class="sd">            format_kwargs: Optional arguments to :meth:`format_df`.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dataframe harvested from the dataframes, with column names and</span>
<span class="sd">            data types matching the resource fields, alongside an aggregation</span>
<span class="sd">            report.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">aggregate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">aggregate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">harvest</span><span class="o">.</span><span class="n">harvest</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">harvest</span><span class="o">.</span><span class="n">harvest</span><span class="p">:</span>
            <span class="c1"># Harvest resource from all inputs where all primary key fields are present</span>
            <span class="n">samples</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dfs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">samples</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_df</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="o">**</span><span class="n">format_kwargs</span><span class="p">)</span>
                <span class="c1"># Pass input names to aggregate via the index</span>
                <span class="n">samples</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">([</span><span class="n">name</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">samples</span><span class="p">[</span><span class="n">name</span><span class="p">]),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;df&quot;</span><span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">samples</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">dfs</span><span class="p">:</span>
            <span class="c1"># Subset resource from input of same name</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_df</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">],</span> <span class="o">**</span><span class="n">format_kwargs</span><span class="p">)</span>
            <span class="c1"># Pass input names to aggregate via the index</span>
            <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">*</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;df&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_df</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">format_kwargs</span><span class="p">),</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">aggregate</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggregate_df</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="o">**</span><span class="n">aggregate_kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span><span class="p">,</span> <span class="p">{}</span></div>


<div class="viewcode-block" id="Resource.to_rst">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Resource.to_rst">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_rst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs_dir</span><span class="p">:</span> <span class="n">DirectoryPath</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Output to an RST file.&quot;&quot;&quot;</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">_get_jinja_environment</span><span class="p">(</span><span class="n">docs_dir</span><span class="p">)</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="s2">&quot;resource.rst.jinja&quot;</span><span class="p">)</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">resource</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">rendered</span><span class="p">)</span></div>


<div class="viewcode-block" id="Resource.encode">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Resource.encode">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Standardize coded columns using the foreign column they refer to.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">encoder</span> <span class="ow">and</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Recoding </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">df</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
                    <span class="n">col</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">field</span><span class="o">.</span><span class="n">to_pandas_dtype</span><span class="p">()</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span></div>
</div>



<span class="c1"># ---- Package ---- #</span>


<div class="viewcode-block" id="Package">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Package">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Package</span><span class="p">(</span><span class="n">PudlMeta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tabular data package.</span>

<span class="sd">    See https://specs.frictionlessdata.io/data-package.</span>

<span class="sd">    Examples:</span>
<span class="sd">        Foreign keys between resources are checked for completeness and consistency.</span>

<span class="sd">        &gt;&gt;&gt; fields = [{&#39;name&#39;: &#39;x&#39;, &#39;type&#39;: &#39;year&#39;, &#39;description&#39;: &#39;X&#39;}, {&#39;name&#39;: &#39;y&#39;, &#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;Y&#39;}]</span>
<span class="sd">        &gt;&gt;&gt; fkey = {&#39;fields&#39;: [&#39;x&#39;, &#39;y&#39;], &#39;reference&#39;: {&#39;resource&#39;: &#39;b&#39;, &#39;fields&#39;: [&#39;x&#39;, &#39;y&#39;]}}</span>
<span class="sd">        &gt;&gt;&gt; schema = {&#39;fields&#39;: fields, &#39;primary_key&#39;: [&#39;x&#39;], &#39;foreign_keys&#39;: [fkey]}</span>
<span class="sd">        &gt;&gt;&gt; a = Resource(name=&#39;a&#39;, schema=schema, description=&#39;A&#39;)</span>
<span class="sd">        &gt;&gt;&gt; b = Resource(name=&#39;b&#39;, schema=Schema(fields=fields, primary_key=[&#39;x&#39;]), description=&#39;B&#39;)</span>
<span class="sd">        &gt;&gt;&gt; Package(name=&#39;ab&#39;, resources=[a, b])</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ValidationError: ...</span>
<span class="sd">        &gt;&gt;&gt; b.schema.primary_key = [&#39;x&#39;, &#39;y&#39;]</span>
<span class="sd">        &gt;&gt;&gt; package = Package(name=&#39;ab&#39;, resources=[a, b])</span>

<span class="sd">        SQL Alchemy can sort tables, based on foreign keys,</span>
<span class="sd">        in the order in which they need to be loaded into a database.</span>

<span class="sd">        &gt;&gt;&gt; metadata = package.to_sql()</span>
<span class="sd">        &gt;&gt;&gt; [table.name for table in metadata.sorted_tables]</span>
<span class="sd">        [&#39;b&#39;, &#39;a&#39;]</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Package.name">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Package.name">[docs]</a>
    <span class="n">name</span><span class="p">:</span> <span class="n">String</span></div>

<div class="viewcode-block" id="Package.title">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Package.title">[docs]</a>
    <span class="n">title</span><span class="p">:</span> <span class="n">String</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Package.description">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Package.description">[docs]</a>
    <span class="n">description</span><span class="p">:</span> <span class="n">String</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Package.keywords">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Package.keywords">[docs]</a>
    <span class="n">keywords</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">String</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="Package.homepage">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Package.homepage">[docs]</a>
    <span class="n">homepage</span><span class="p">:</span> <span class="n">AnyHttpUrl</span> <span class="o">=</span> <span class="n">AnyHttpUrl</span><span class="p">(</span><span class="s2">&quot;https://catalyst.coop/pudl&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Package.created">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Package.created">[docs]</a>
    <span class="n">created</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">UTC</span><span class="p">)</span></div>

<div class="viewcode-block" id="Package.contributors">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Package.contributors">[docs]</a>
    <span class="n">contributors</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Contributor</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="Package.sources">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Package.sources">[docs]</a>
    <span class="n">sources</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">DataSource</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="Package.licenses">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Package.licenses">[docs]</a>
    <span class="n">licenses</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">License</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="Package.resources">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Package.resources">[docs]</a>
    <span class="n">resources</span><span class="p">:</span> <span class="n">StrictList</span><span class="p">[</span><span class="n">Resource</span><span class="p">]</span></div>

<div class="viewcode-block" id="Package.profile">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Package.profile">[docs]</a>
    <span class="n">profile</span><span class="p">:</span> <span class="n">String</span> <span class="o">=</span> <span class="s2">&quot;tabular-data-package&quot;</span></div>

<div class="viewcode-block" id="Package.model_config">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Package.model_config">[docs]</a>
    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span><span class="n">validate_assignment</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;resources&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Package._check_foreign_keys">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Package._check_foreign_keys">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_check_foreign_keys</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">resources</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Resource</span><span class="p">]):</span>
        <span class="n">rnames</span> <span class="o">=</span> <span class="p">[</span><span class="n">resource</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">resource</span> <span class="ow">in</span> <span class="n">resources</span><span class="p">]</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">resource</span> <span class="ow">in</span> <span class="n">resources</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">foreign_key</span> <span class="ow">in</span> <span class="n">resource</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">foreign_keys</span><span class="p">:</span>
                <span class="n">rname</span> <span class="o">=</span> <span class="n">foreign_key</span><span class="o">.</span><span class="n">reference</span><span class="o">.</span><span class="n">resource</span>
                <span class="n">tag</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">resource</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">rname</span><span class="si">}</span><span class="s2">]&quot;</span>
                <span class="k">if</span> <span class="n">rname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rnames</span><span class="p">:</span>
                    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s2">: Reference not found&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="n">reference</span> <span class="o">=</span> <span class="n">resources</span><span class="p">[</span><span class="n">rnames</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">rname</span><span class="p">)]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">reference</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">primary_key</span><span class="p">:</span>
                    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s2">: Reference missing primary key&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="n">missing</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">x</span>
                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">foreign_key</span><span class="o">.</span><span class="n">reference</span><span class="o">.</span><span class="n">fields</span>
                    <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">reference</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">primary_key</span>
                <span class="p">]</span>
                <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
                    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s2">: Reference primary key missing </span><span class="si">{</span><span class="n">missing</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="n">format_errors</span><span class="p">(</span><span class="o">*</span><span class="n">errors</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Foreign keys&quot;</span><span class="p">,</span> <span class="n">pydantic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">resources</span></div>


    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="Package._populate_from_resources">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Package._populate_from_resources">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_populate_from_resources</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Populate Package attributes from similar deduplicated Resource attributes.</span>

<span class="sd">        Resources and Packages share some descriptive attributes. When building a</span>
<span class="sd">        Package out of a collection of Resources, we want the Package to reflect the</span>
<span class="sd">        union of all the analogous values found in the Resources, but we don&#39;t want</span>
<span class="sd">        any duplicates. We may also get values directly from the Package inputs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;keywords&quot;</span><span class="p">,</span> <span class="s2">&quot;contributors&quot;</span><span class="p">,</span> <span class="s2">&quot;sources&quot;</span><span class="p">,</span> <span class="s2">&quot;licenses&quot;</span><span class="p">):</span>
            <span class="n">package_value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
            <span class="n">resource_values</span> <span class="o">=</span> <span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">resource</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resources</span><span class="p">]</span>
            <span class="n">deduped_values</span> <span class="o">=</span> <span class="n">_unique</span><span class="p">(</span><span class="n">package_value</span><span class="p">,</span> <span class="o">*</span><span class="n">resource_values</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">deduped_values</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>


    <span class="nd">@classmethod</span>
    <span class="nd">@lru_cache</span>
<div class="viewcode-block" id="Package.from_resource_ids">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Package.from_resource_ids">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_resource_ids</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">resource_ids</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">RESOURCE_METADATA</span><span class="p">)),</span>
        <span class="n">resolve_foreign_keys</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">excluded_etl_groups</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Package&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct a collection of Resources from PUDL identifiers (`resource.name`).</span>

<span class="sd">        Identify any fields that have foreign key relationships referencing the</span>
<span class="sd">        coding tables defined in :mod:`pudl.metadata.codes` and if so, associate the</span>
<span class="sd">        coding table&#39;s encoder with those columns for later use cleaning them up.</span>

<span class="sd">        The result is cached, since we so often need to generate the metadata for</span>
<span class="sd">        the full collection of PUDL tables.</span>

<span class="sd">        Args:</span>
<span class="sd">            resource_ids: Resource PUDL identifiers (`resource.name`). Needs to</span>
<span class="sd">                be a Tuple so that the set of identifiers is hashable, allowing</span>
<span class="sd">                return value caching through lru_cache.</span>
<span class="sd">            resolve_foreign_keys: Whether to add resources as needed based on</span>
<span class="sd">                foreign keys.</span>
<span class="sd">            excluded_etl_groups: Collection of ETL groups used to filter resources</span>
<span class="sd">                out of Package.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">resources</span> <span class="o">=</span> <span class="p">[</span><span class="n">Resource</span><span class="o">.</span><span class="n">dict_from_id</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">resource_ids</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">resolve_foreign_keys</span><span class="p">:</span>
            <span class="c1"># Add missing resources based on foreign keys</span>
            <span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">resource_ids</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">resources</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">resource</span> <span class="ow">in</span> <span class="n">resources</span><span class="p">[</span><span class="n">i</span><span class="p">:]:</span>
                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">resource</span><span class="p">[</span><span class="s2">&quot;schema&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;foreign_keys&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;reference&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;resource&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">name</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                            <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="n">i</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">resources</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">i</span><span class="p">:</span>
                    <span class="n">resources</span> <span class="o">+=</span> <span class="p">[</span><span class="n">Resource</span><span class="o">.</span><span class="n">dict_from_id</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">:]]</span>

        <span class="k">if</span> <span class="n">excluded_etl_groups</span><span class="p">:</span>
            <span class="n">resources</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">resource</span>
                <span class="k">for</span> <span class="n">resource</span> <span class="ow">in</span> <span class="n">resources</span>
                <span class="k">if</span> <span class="n">resource</span><span class="p">[</span><span class="s2">&quot;etl_group&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">excluded_etl_groups</span>
            <span class="p">]</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;pudl&quot;</span><span class="p">,</span> <span class="n">resources</span><span class="o">=</span><span class="n">resources</span><span class="p">)</span></div>


    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Package.get_etl_group_tables">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Package.get_etl_group_tables">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_etl_group_tables</span><span class="p">(</span>
        <span class="n">etl_group</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a sorted tuple of table names for an etl_group.</span>

<span class="sd">        Args:</span>
<span class="sd">            etl_group: the etl_group key.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A sorted tuple of table names for the etl_group.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">resource_ids</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
            <span class="nb">sorted</span><span class="p">(</span>
                <span class="p">(</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">RESOURCE_METADATA</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s2">&quot;etl_group&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">etl_group</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">resource_ids</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;There are no resources for ETL group: </span><span class="si">{</span><span class="n">etl_group</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">resource_ids</span></div>


<div class="viewcode-block" id="Package.get_resource">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Package.get_resource">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Resource</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the resource with the given name if it is in the Package.&quot;&quot;&quot;</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">resource</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">resource</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resources</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resources</span><span class="p">[</span><span class="n">names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">name</span><span class="p">)]</span></div>


<div class="viewcode-block" id="Package.to_rst">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Package.to_rst">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_rst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs_dir</span><span class="p">:</span> <span class="n">DirectoryPath</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Output to an RST file.&quot;&quot;&quot;</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">_get_jinja_environment</span><span class="p">(</span><span class="n">docs_dir</span><span class="p">)</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="s2">&quot;package.rst.jinja&quot;</span><span class="p">)</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">package</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">path</span><span class="p">:</span>
            <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">rendered</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">rendered</span><span class="p">)</span></div>


<div class="viewcode-block" id="Package.to_sql">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Package.to_sql">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_sql</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">check_types</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">check_values</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sa</span><span class="o">.</span><span class="n">MetaData</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return equivalent SQL MetaData.&quot;&quot;&quot;</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">MetaData</span><span class="p">(</span>
            <span class="n">naming_convention</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;ix&quot;</span><span class="p">:</span> <span class="s2">&quot;ix_</span><span class="si">%(column_0_label)s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;uq&quot;</span><span class="p">:</span> <span class="s2">&quot;uq_</span><span class="si">%(table_name)s</span><span class="s2">_</span><span class="si">%(column_0_name)s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ck&quot;</span><span class="p">:</span> <span class="s2">&quot;ck_</span><span class="si">%(table_name)s</span><span class="s2">_</span><span class="si">%(constraint_name)s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;fk&quot;</span><span class="p">:</span> <span class="s2">&quot;fk_</span><span class="si">%(table_name)s</span><span class="s2">_</span><span class="si">%(column_0_name)s</span><span class="s2">_</span><span class="si">%(referred_table_name)s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;pk&quot;</span><span class="p">:</span> <span class="s2">&quot;pk_</span><span class="si">%(table_name)s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">resource</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resources</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">resource</span><span class="o">.</span><span class="n">create_database_schema</span><span class="p">:</span>
                <span class="n">_</span> <span class="o">=</span> <span class="n">resource</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span>
                    <span class="n">metadata</span><span class="p">,</span>
                    <span class="n">check_types</span><span class="o">=</span><span class="n">check_types</span><span class="p">,</span>
                    <span class="n">check_values</span><span class="o">=</span><span class="n">check_values</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">metadata</span></div>


<div class="viewcode-block" id="Package.get_sorted_resources">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Package.get_sorted_resources">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_sorted_resources</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StrictList</span><span class="p">[</span><span class="n">Resource</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a list of sorted Resources.</span>

<span class="sd">        Currently Resources are listed in reverse alphabetical order based</span>
<span class="sd">        on their name which results in the following order to promote output</span>
<span class="sd">        tables to users and push intermediate tables to the bottom of the</span>
<span class="sd">        docs: output, core, intermediate.</span>
<span class="sd">        In the future we might want to have more fine grain control over how</span>
<span class="sd">        Resources are sorted.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A sorted list of resources.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">resources</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resources</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">sort_resource_names</span><span class="p">(</span><span class="n">resource</span><span class="p">:</span> <span class="n">Resource</span><span class="p">):</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^(_out_|out_|core_)&quot;</span><span class="p">)</span>

            <span class="n">matches</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">matches</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

            <span class="n">prefix_order</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;out_&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;core_&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;_out_&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
            <span class="k">return</span> <span class="n">prefix_order</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">))</span>

        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">resources</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">sort_resource_names</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


    <span class="nd">@cached_property</span>
<div class="viewcode-block" id="Package.encoders">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Package.encoders">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">encoders</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">SnakeCase</span><span class="p">,</span> <span class="n">Encoder</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compile a mapping of field names to their encoders, if they exist.</span>

<span class="sd">        This dictionary will be used many times, so it makes sense to build it once</span>
<span class="sd">        when the Package is instantiated so it can be reused.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">encoded_fields</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">field</span>
            <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resources</span>
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">fields</span>
            <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">encoder</span>
        <span class="p">]</span>
        <span class="n">encoders</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">SnakeCase</span><span class="p">,</span> <span class="n">Encoder</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">encoded_fields</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">encoders</span><span class="p">:</span>
                <span class="n">encoders</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">encoder</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># We have a field which shows up in multiple tables, and we want to</span>
                <span class="c1"># verify that the encoders are the same across all of them.</span>
                <span class="n">pd</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_frame_equal</span><span class="p">(</span><span class="n">encoders</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">df</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">df</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">encoders</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">code_fixes</span> <span class="o">==</span> <span class="n">field</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">code_fixes</span>
                <span class="k">assert</span> <span class="n">encoders</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">ignored_codes</span> <span class="o">==</span> <span class="n">field</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">ignored_codes</span>
        <span class="k">return</span> <span class="n">encoders</span></div>


<div class="viewcode-block" id="Package.encode">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Package.encode">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">copy</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clean up all coded columns in a dataframe based on PUDL coding tables.</span>

<span class="sd">        Running with ``copy=False`` is intended for memory-intensive data frames where no</span>
<span class="sd">        upstream process retains a reference to the data. Use care with this option,</span>
<span class="sd">        and keep an eye out for spooky data changes showing up in unexpected places.</span>

<span class="sd">        Args:</span>
<span class="sd">            df: DataFrame whose code columns are being cleaned up.</span>
<span class="sd">            copy: (Default True) Return a copy, making no changes to the original data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dataframe with clean code columns.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">encoded_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">if</span> <span class="n">copy</span> <span class="k">else</span> <span class="n">df</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">encoded_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoders</span><span class="p">:</span>
                <span class="n">encoded_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoders</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
                    <span class="n">encoded_df</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">Field</span><span class="o">.</span><span class="n">from_id</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">to_pandas_dtype</span><span class="p">()</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">encoded_df</span></div>


<div class="viewcode-block" id="Package.to_frictionless">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.Package.to_frictionless">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_frictionless</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">exclude_pattern</span><span class="p">:</span> <span class="n">Pattern</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">include_pattern</span><span class="p">:</span> <span class="n">Pattern</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">frictionless</span><span class="o">.</span><span class="n">Package</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert to a Frictionless Datapackage.</span>

<span class="sd">        Allows filtering out specific resources by passing regex patterns to include</span>
<span class="sd">        or exclude resources by name. This is used to generate an independent</span>
<span class="sd">        &#39;datapackage.json&#39; file for ``ferceqr`` assets, which are distributed separately</span>
<span class="sd">        from the rest of PUDL. This method will only look for table names that exactly</span>
<span class="sd">        match the supplied patterns, not substring matches.</span>

<span class="sd">        Args:</span>
<span class="sd">            exclude_pattern: Exclude resources whose names exactly match this pattern.</span>
<span class="sd">            include_pattern: Only include resources whose names exactly match this pattern.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">resources</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">to_frictionless</span><span class="p">()</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resources</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">exclude_pattern</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">resources</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">resources</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">exclude_pattern</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="p">]</span>
        <span class="k">if</span> <span class="n">include_pattern</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">resources</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">resources</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">include_pattern</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="p">]</span>

        <span class="k">return</span> <span class="n">frictionless</span><span class="o">.</span><span class="n">Package</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">resources</span><span class="o">=</span><span class="n">resources</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="PUDL_PACKAGE">
<a class="viewcode-back" href="../../../autoapi/pudl/etl/index.html#pudl.etl.PUDL_PACKAGE">[docs]</a>
<span class="n">PUDL_PACKAGE</span> <span class="o">=</span> <span class="n">Package</span><span class="o">.</span><span class="n">from_resource_ids</span><span class="p">()</span></div>

<span class="sd">&quot;&quot;&quot;Define a global PUDL package object for use across the entire codebase.</span>

<span class="sd">This needs to happen after the definition of the Package class above, and it is used in</span>
<span class="sd">some of the class definitions below, but having it defined in the middle of this module</span>
<span class="sd">is kind of obscure, so it is imported in the __init__.py for this subpackage and then</span>
<span class="sd">imported in other modules from that more prominent location.</span>
<span class="sd">&quot;&quot;&quot;</span>


<div class="viewcode-block" id="CodeMetadata">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.CodeMetadata">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">CodeMetadata</span><span class="p">(</span><span class="n">PudlMeta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A list of Encoders for standardizing and documenting categorical codes.</span>

<span class="sd">    Used to export static coding metadata to PUDL documentation automatically</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="CodeMetadata.encoder_list">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.CodeMetadata.encoder_list">[docs]</a>
    <span class="n">encoder_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Encoder</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span></div>


    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="CodeMetadata.from_code_ids">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.CodeMetadata.from_code_ids">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_code_ids</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">code_ids</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;CodeMetadata&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct a list of encoders from code dictionaries.</span>

<span class="sd">        Args:</span>
<span class="sd">            code_ids: A list of Code PUDL identifiers, keys to entries in the</span>
<span class="sd">                CODE_METADATA dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">encoder_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">code_ids</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">CODE_METADATA</span><span class="p">:</span>
                <span class="n">encoder_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Encoder</span><span class="o">.</span><span class="n">from_code_id</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">encoder_list</span><span class="o">=</span><span class="n">encoder_list</span><span class="p">)</span></div>


<div class="viewcode-block" id="CodeMetadata.to_rst">
<a class="viewcode-back" href="../../../autoapi/pudl/metadata/classes/index.html#pudl.etl.CodeMetadata.to_rst">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_rst</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">top_dir</span><span class="p">:</span> <span class="n">DirectoryPath</span><span class="p">,</span> <span class="n">csv_subdir</span><span class="p">:</span> <span class="n">DirectoryPath</span><span class="p">,</span> <span class="n">rst_path</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Iterate through encoders and output to an RST file.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">Path</span><span class="p">(</span><span class="n">rst_path</span><span class="p">)</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">encoder</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoder_list</span><span class="p">):</span>
                <span class="n">header</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">0</span>
                <span class="n">rendered</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">to_rst</span><span class="p">(</span>
                    <span class="n">top_dir</span><span class="o">=</span><span class="n">top_dir</span><span class="p">,</span> <span class="n">csv_subdir</span><span class="o">=</span><span class="n">csv_subdir</span><span class="p">,</span> <span class="n">is_header</span><span class="o">=</span><span class="n">header</span>
                <span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">rendered</span><span class="p">)</span></div>
</div>

</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2016-2026, Catalyst Cooperative, CC-BY-4.0
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script src="../../../_static/documentation_options.js?v=11fc87b4"></script>
    <script src="../../../_static/doctools.js?v=fd6eb6e6"></script>
    <script src="../../../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script src="../../../_static/scripts/furo.js?v=46bd48cc"></script>
    </body>
</html>