<!doctype html>
<html class="no-js" lang="en" data-content_root="../../../">
  <head><meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light dark">
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-EXWBBTVMWK"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-EXWBBTVMWK');
    </script>
    <link rel="index" title="Index" href="../../../genindex.html"><link rel="search" title="Search" href="../../../search.html">
        <link rel="prefetch" href="../../../_static/catalyst_logo-200x200.png" as="image">

    <!-- Generated with Sphinx 9.1.0 and Furo 2025.12.19 -->
        <title>pudl.transform.eia860 - PUDL 2026.2.1.dev10 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=d111a655" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo.css?v=7bdb33bb" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css?v=b1990d62" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo-extensions.css?v=8dab3a3b" />
    
    


<style>
  body {
    --color-code-background: #f2f2f2;
  --color-code-foreground: #1e1e1e;
  --color-announcement-background: yellow;
  --color-announcement-text: red;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-announcement-background: yellow;
  --color-announcement-text: red;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-announcement-background: yellow;
  --color-announcement-text: red;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle site navigation sidebar">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc" aria-label="Toggle table of contents sidebar">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>

<div class="announcement">
  <aside class="announcement-content">
     <b>Take our ~10 minute <a href="https://forms.gle/E9ou5fgMcR7YVRCRA">2026 Energy Data Ecosystem Survey!</b> 
  </aside>
</div>

<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <span class="icon"><svg><use href="#svg-menu"></use></svg></span>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../index.html"><div class="brand">PUDL 2026.2.1.dev10 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../index.html">
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../../../_static/catalyst_logo-200x200.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">PUDL 2026.2.1.dev10 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">About PUDL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../data_access.html">Data Access</a></li>
<li class="toctree-l1"><a class="reference external" href="https://data.catalyst.coop">PUDL Data Viewer</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../data_sources/index.html">Data Sources</a><input aria-label="Toggle navigation of Data Sources" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/censusdp1tract.html">Census DP1 – Profile of General Demographic Characteristics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/censuspep.html">Population Estimates Program's (PEP) Federal Information Processing Series (FIPS) Codes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/eiaapi.html">EIA Bulk API Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/eia176.html">EIA Form 176 – Annual Report of Natural and Supplemental Gas Supply and Disposition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/eia860.html">EIA Form 860 – Annual Electric Generator Report</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/eia861.html">EIA Form 861 – Annual Electric Power Industry Report</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/eia923.html">EIA Form 923 – Power Plant Operations Report</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/eia930.html">EIA Form 930 – Hourly and Daily Balancing Authority Operations Report</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/eiaaeo.html">EIA Annual Energy Outlook (AEO)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/epacamd_eia.html">EPA CAMD to EIA Power Sector Data Crosswalk</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/epacems.html">EPA Hourly Continuous Emission Monitoring System (CEMS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/ferc1.html">FERC Form 1 – Annual Report of Major Electric Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/ferc714.html">FERC Form 714 – Annual Electric Balancing Authority Area and Planning Area Report</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/ferceqr.html">FERC Form 920 – Electric Quarterly Report (EQR)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/gridpathratoolkit.html">GridPath Resource Adequacy Toolkit Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/nrelatb.html">NREL Annual Technology Baseline (ATB) for Electricity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/phmsagas.html">Pipelines and Hazardous Materials Safety Administration (PHMSA) Annual Natural Gas Report</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/rus12.html">USDA RUS Form 12 – Financial and Operating Report: Electric Power Supply</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/rus7.html">USDA RUS Form 7 – Financial and Operating Report: Electric Distribution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/sec10k.html">U.S. Securities and Exchange Commission (SEC) Form 10-K</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/vcerare.html">Vibrant Clean Energy Resource Adequacy Renewable Energy (RARE) Power Dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/other_data.html">Other Data in PUDL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/future_data.html">High Priority Target Datasets</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../data_dictionaries/index.html">Data Dictionaries</a><input aria-label="Toggle navigation of Data Dictionaries" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../data_dictionaries/pudl_db.html">PUDL Data Dictionary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_dictionaries/ferc1_db.html">Raw FERC Form 1 Data Dictionary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_dictionaries/codes_and_labels.html">PUDL Code Metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_dictionaries/usage_warnings.html">PUDL Usage Warnings</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../methodology/index.html">Methodology</a><input aria-label="Toggle navigation of Methodology" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../methodology/timeseries_imputation.html">Timeseries Imputation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../methodology/sec10k_modeling.html">SEC 10-K Ownership Data Extraction Modeling</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../CONTRIBUTING.html">Contributing</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../dev/index.html">Development</a><input aria-label="Toggle navigation of Development" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/dev_setup.html">Development Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/run_the_etl.html">Running the ETL Pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/dev_dagster.html">Developing with Dagster</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/project_management.html">Project Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/testing.html">Testing PUDL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/data_validation_quickstart.html">Data validation quickstart</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/data_validation_reference.html">Data validation reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/metadata.html">Metadata editing guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/build_docs.html">Building the Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/datastore.html">Working with the Datastore</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/clone_ferc1.html">Converting raw FERC data to SQLite</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/existing_data_updates.html">Existing Data Updates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/run_a_release.html">Run a Versioned Release</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/pudl_id_mapping.html">PUDL ID Mapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/naming_conventions.html">Naming Conventions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/data_guidelines.html">Data and ETL Design Guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/nightly_data_builds.html">Nightly Data Builds</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/ferceqr_data_builds.html">FERC EQR Data Builds</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/infrastructure_as_code.html">Infrastructure as Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/managing_external_contributions.html">Managing External Contributions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../LICENSE.html">Licensing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../code_of_conduct.html">Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release_notes.html">Release Notes</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../autoapi/index.html">API Reference</a><input aria-label="Toggle navigation of API Reference" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../autoapi/pudl/index.html">pudl</a><input aria-label="Toggle navigation of pudl" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/pudl/__main__/index.html">pudl.__main__</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/pudl/_version/index.html">pudl._version</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../autoapi/pudl/analysis/index.html">pudl.analysis</a><input aria-label="Toggle navigation of pudl.analysis" class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/analysis/allocate_gen_fuel/index.html">pudl.analysis.allocate_gen_fuel</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/analysis/fuel_by_plant/index.html">pudl.analysis.fuel_by_plant</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/analysis/mcoe/index.html">pudl.analysis.mcoe</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/analysis/ml_tools/index.html">pudl.analysis.ml_tools</a><input aria-label="Toggle navigation of pudl.analysis.ml_tools" class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/analysis/ml_tools/experiment_tracking/index.html">pudl.analysis.ml_tools.experiment_tracking</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/analysis/ml_tools/models/index.html">pudl.analysis.ml_tools.models</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/analysis/plant_parts_eia/index.html">pudl.analysis.plant_parts_eia</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/analysis/record_linkage/index.html">pudl.analysis.record_linkage</a><input aria-label="Toggle navigation of pudl.analysis.record_linkage" class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/analysis/record_linkage/classify_plants_ferc1/index.html">pudl.analysis.record_linkage.classify_plants_ferc1</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/analysis/record_linkage/eia_ferc1_inputs/index.html">pudl.analysis.record_linkage.eia_ferc1_inputs</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/analysis/record_linkage/eia_ferc1_model_config/index.html">pudl.analysis.record_linkage.eia_ferc1_model_config</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/analysis/record_linkage/eia_ferc1_record_linkage/index.html">pudl.analysis.record_linkage.eia_ferc1_record_linkage</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/analysis/record_linkage/eia_ferc1_train/index.html">pudl.analysis.record_linkage.eia_ferc1_train</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/analysis/record_linkage/embed_dataframe/index.html">pudl.analysis.record_linkage.embed_dataframe</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/analysis/record_linkage/link_cross_year/index.html">pudl.analysis.record_linkage.link_cross_year</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/analysis/record_linkage/name_cleaner/index.html">pudl.analysis.record_linkage.name_cleaner</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/analysis/service_territory/index.html">pudl.analysis.service_territory</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/analysis/spatial/index.html">pudl.analysis.spatial</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/analysis/state_demand/index.html">pudl.analysis.state_demand</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/analysis/timeseries_cleaning/index.html">pudl.analysis.timeseries_cleaning</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/analysis/timeseries_evaluation/index.html">pudl.analysis.timeseries_evaluation</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../autoapi/pudl/convert/index.html">pudl.convert</a><input aria-label="Toggle navigation of pudl.convert" class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/convert/censusdp1tract_to_sqlite/index.html">pudl.convert.censusdp1tract_to_sqlite</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/convert/metadata_to_rst/index.html">pudl.convert.metadata_to_rst</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/pudl/dbt_wrapper/index.html">pudl.dbt_wrapper</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../autoapi/pudl/etl/index.html">pudl.etl</a><input aria-label="Toggle navigation of pudl.etl" class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/etl/asset_checks/index.html">pudl.etl.asset_checks</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/etl/check_foreign_keys/index.html">pudl.etl.check_foreign_keys</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/etl/cli/index.html">pudl.etl.cli</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/etl/eia_bulk_elec_assets/index.html">pudl.etl.eia_bulk_elec_assets</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/etl/ferceqr_deployment/index.html">pudl.etl.ferceqr_deployment</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/etl/glue_assets/index.html">pudl.etl.glue_assets</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/etl/static_assets/index.html">pudl.etl.static_assets</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../autoapi/pudl/extract/index.html">pudl.extract</a><input aria-label="Toggle navigation of pudl.extract" class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/censuspep/index.html">pudl.extract.censuspep</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/csv/index.html">pudl.extract.csv</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/dbf/index.html">pudl.extract.dbf</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/eia176/index.html">pudl.extract.eia176</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/eia191/index.html">pudl.extract.eia191</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/eia757a/index.html">pudl.extract.eia757a</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/eia860/index.html">pudl.extract.eia860</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/eia860m/index.html">pudl.extract.eia860m</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/eia861/index.html">pudl.extract.eia861</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/eia923/index.html">pudl.extract.eia923</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/eia930/index.html">pudl.extract.eia930</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/eiaaeo/index.html">pudl.extract.eiaaeo</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/eiaapi/index.html">pudl.extract.eiaapi</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/epacems/index.html">pudl.extract.epacems</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/excel/index.html">pudl.extract.excel</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/extractor/index.html">pudl.extract.extractor</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/ferc/index.html">pudl.extract.ferc</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/ferc1/index.html">pudl.extract.ferc1</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/ferc2/index.html">pudl.extract.ferc2</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/ferc6/index.html">pudl.extract.ferc6</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/ferc60/index.html">pudl.extract.ferc60</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/ferc714/index.html">pudl.extract.ferc714</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/ferccid/index.html">pudl.extract.ferccid</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/ferceqr/index.html">pudl.extract.ferceqr</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/gridpathratoolkit/index.html">pudl.extract.gridpathratoolkit</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/nrelatb/index.html">pudl.extract.nrelatb</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/parquet/index.html">pudl.extract.parquet</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/phmsagas/index.html">pudl.extract.phmsagas</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/rus12/index.html">pudl.extract.rus12</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/rus7/index.html">pudl.extract.rus7</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/sec10k/index.html">pudl.extract.sec10k</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/vcerare/index.html">pudl.extract.vcerare</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/xbrl/index.html">pudl.extract.xbrl</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../autoapi/pudl/ferc_to_sqlite/index.html">pudl.ferc_to_sqlite</a><input aria-label="Toggle navigation of pudl.ferc_to_sqlite" class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/ferc_to_sqlite/cli/index.html">pudl.ferc_to_sqlite.cli</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../autoapi/pudl/glue/index.html">pudl.glue</a><input aria-label="Toggle navigation of pudl.glue" class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/glue/ferc1_eia/index.html">pudl.glue.ferc1_eia</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/glue/ferc714/index.html">pudl.glue.ferc714</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/pudl/helpers/index.html">pudl.helpers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/pudl/io_managers/index.html">pudl.io_managers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/pudl/logging_helpers/index.html">pudl.logging_helpers</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../autoapi/pudl/metadata/index.html">pudl.metadata</a><input aria-label="Toggle navigation of pudl.metadata" class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/metadata/classes/index.html">pudl.metadata.classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/metadata/codes/index.html">pudl.metadata.codes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/metadata/constants/index.html">pudl.metadata.constants</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/metadata/descriptions/index.html">pudl.metadata.descriptions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/metadata/dfs/index.html">pudl.metadata.dfs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/metadata/enums/index.html">pudl.metadata.enums</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/metadata/fields/index.html">pudl.metadata.fields</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/metadata/helpers/index.html">pudl.metadata.helpers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/metadata/labels/index.html">pudl.metadata.labels</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/metadata/resource_helpers/index.html">pudl.metadata.resource_helpers</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/index.html">pudl.metadata.resources</a><input aria-label="Toggle navigation of pudl.metadata.resources" class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/allocate_gen_fuel/index.html">pudl.metadata.resources.allocate_gen_fuel</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/censusdp1tract/index.html">pudl.metadata.resources.censusdp1tract</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/eia/index.html">pudl.metadata.resources.eia</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/eia176/index.html">pudl.metadata.resources.eia176</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/eia860/index.html">pudl.metadata.resources.eia860</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/eia860m/index.html">pudl.metadata.resources.eia860m</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/eia861/index.html">pudl.metadata.resources.eia861</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/eia923/index.html">pudl.metadata.resources.eia923</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/eia930/index.html">pudl.metadata.resources.eia930</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/eiaaeo/index.html">pudl.metadata.resources.eiaaeo</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/eiaapi/index.html">pudl.metadata.resources.eiaapi</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/epacems/index.html">pudl.metadata.resources.epacems</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/ferc1/index.html">pudl.metadata.resources.ferc1</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/ferc1_eia_record_linkage/index.html">pudl.metadata.resources.ferc1_eia_record_linkage</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/ferc714/index.html">pudl.metadata.resources.ferc714</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/ferccid/index.html">pudl.metadata.resources.ferccid</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/ferceqr/index.html">pudl.metadata.resources.ferceqr</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/glue/index.html">pudl.metadata.resources.glue</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/gridpathratoolkit/index.html">pudl.metadata.resources.gridpathratoolkit</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/nrelatb/index.html">pudl.metadata.resources.nrelatb</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/phmsagas/index.html">pudl.metadata.resources.phmsagas</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/pudl/index.html">pudl.metadata.resources.pudl</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/rus12/index.html">pudl.metadata.resources.rus12</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/rus7/index.html">pudl.metadata.resources.rus7</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/sec10k/index.html">pudl.metadata.resources.sec10k</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/vcerare/index.html">pudl.metadata.resources.vcerare</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/metadata/sources/index.html">pudl.metadata.sources</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/metadata/warnings/index.html">pudl.metadata.warnings</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../autoapi/pudl/output/index.html">pudl.output</a><input aria-label="Toggle navigation of pudl.output" class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/output/censusdp1tract/index.html">pudl.output.censusdp1tract</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/output/eia/index.html">pudl.output.eia</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/output/eia860/index.html">pudl.output.eia860</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/output/eia923/index.html">pudl.output.eia923</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/output/eia930/index.html">pudl.output.eia930</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/output/eiaapi/index.html">pudl.output.eiaapi</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/output/ferc1/index.html">pudl.output.ferc1</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/output/ferc714/index.html">pudl.output.ferc714</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/output/sec10k/index.html">pudl.output.sec10k</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/output/sql/index.html">pudl.output.sql</a><input aria-label="Toggle navigation of pudl.output.sql" class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/output/sql/helpers/index.html">pudl.output.sql.helpers</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../autoapi/pudl/package_data/index.html">pudl.package_data</a><input aria-label="Toggle navigation of pudl.package_data" class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/package_data/censuspep/index.html">pudl.package_data.censuspep</a><input aria-label="Toggle navigation of pudl.package_data.censuspep" class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/package_data/censuspep/column_maps/index.html">pudl.package_data.censuspep.column_maps</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/package_data/eia176/index.html">pudl.package_data.eia176</a><input aria-label="Toggle navigation of pudl.package_data.eia176" class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" role="switch" type="checkbox"/><label for="toctree-checkbox-21"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/package_data/eia176/column_maps/index.html">pudl.package_data.eia176.column_maps</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/package_data/eia191/index.html">pudl.package_data.eia191</a><input aria-label="Toggle navigation of pudl.package_data.eia191" class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" role="switch" type="checkbox"/><label for="toctree-checkbox-22"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/package_data/eia191/column_maps/index.html">pudl.package_data.eia191.column_maps</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/package_data/eia757a/index.html">pudl.package_data.eia757a</a><input aria-label="Toggle navigation of pudl.package_data.eia757a" class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" role="switch" type="checkbox"/><label for="toctree-checkbox-23"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/package_data/eia757a/column_maps/index.html">pudl.package_data.eia757a.column_maps</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/package_data/eia860/index.html">pudl.package_data.eia860</a><input aria-label="Toggle navigation of pudl.package_data.eia860" class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" role="switch" type="checkbox"/><label for="toctree-checkbox-24"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/package_data/eia860/column_maps/index.html">pudl.package_data.eia860.column_maps</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/package_data/eia860m/index.html">pudl.package_data.eia860m</a><input aria-label="Toggle navigation of pudl.package_data.eia860m" class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" role="switch" type="checkbox"/><label for="toctree-checkbox-25"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/package_data/eia860m/column_maps/index.html">pudl.package_data.eia860m.column_maps</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/package_data/eia861/index.html">pudl.package_data.eia861</a><input aria-label="Toggle navigation of pudl.package_data.eia861" class="toctree-checkbox" id="toctree-checkbox-26" name="toctree-checkbox-26" role="switch" type="checkbox"/><label for="toctree-checkbox-26"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/package_data/eia861/column_maps/index.html">pudl.package_data.eia861.column_maps</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/package_data/eia923/index.html">pudl.package_data.eia923</a><input aria-label="Toggle navigation of pudl.package_data.eia923" class="toctree-checkbox" id="toctree-checkbox-27" name="toctree-checkbox-27" role="switch" type="checkbox"/><label for="toctree-checkbox-27"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/package_data/eia923/column_maps/index.html">pudl.package_data.eia923.column_maps</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/package_data/eia930/index.html">pudl.package_data.eia930</a><input aria-label="Toggle navigation of pudl.package_data.eia930" class="toctree-checkbox" id="toctree-checkbox-28" name="toctree-checkbox-28" role="switch" type="checkbox"/><label for="toctree-checkbox-28"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/package_data/eia930/column_maps/index.html">pudl.package_data.eia930.column_maps</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/package_data/epacems/index.html">pudl.package_data.epacems</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/package_data/ferc1/index.html">pudl.package_data.ferc1</a><input aria-label="Toggle navigation of pudl.package_data.ferc1" class="toctree-checkbox" id="toctree-checkbox-29" name="toctree-checkbox-29" role="switch" type="checkbox"/><label for="toctree-checkbox-29"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/package_data/ferc1/row_maps/index.html">pudl.package_data.ferc1.row_maps</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/package_data/glue/index.html">pudl.package_data.glue</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/package_data/phmsagas/index.html">pudl.package_data.phmsagas</a><input aria-label="Toggle navigation of pudl.package_data.phmsagas" class="toctree-checkbox" id="toctree-checkbox-30" name="toctree-checkbox-30" role="switch" type="checkbox"/><label for="toctree-checkbox-30"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/package_data/phmsagas/column_maps/index.html">pudl.package_data.phmsagas.column_maps</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/package_data/rus12/index.html">pudl.package_data.rus12</a><input aria-label="Toggle navigation of pudl.package_data.rus12" class="toctree-checkbox" id="toctree-checkbox-31" name="toctree-checkbox-31" role="switch" type="checkbox"/><label for="toctree-checkbox-31"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/package_data/rus12/column_maps/index.html">pudl.package_data.rus12.column_maps</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/package_data/rus7/index.html">pudl.package_data.rus7</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/package_data/settings/index.html">pudl.package_data.settings</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/package_data/test/index.html">pudl.package_data.test</a><input aria-label="Toggle navigation of pudl.package_data.test" class="toctree-checkbox" id="toctree-checkbox-32" name="toctree-checkbox-32" role="switch" type="checkbox"/><label for="toctree-checkbox-32"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/package_data/test/column_maps/index.html">pudl.package_data.test.column_maps</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/package_data/vcerare/index.html">pudl.package_data.vcerare</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/pudl/resources/index.html">pudl.resources</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../autoapi/pudl/scripts/index.html">pudl.scripts</a><input aria-label="Toggle navigation of pudl.scripts" class="toctree-checkbox" id="toctree-checkbox-33" name="toctree-checkbox-33" role="switch" type="checkbox"/><label for="toctree-checkbox-33"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/scripts/auto_match_utilities/index.html">pudl.scripts.auto_match_utilities</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/scripts/dbt_helper/index.html">pudl.scripts.dbt_helper</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/scripts/generate_pudl_duckdb/index.html">pudl.scripts.generate_pudl_duckdb</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/scripts/pudl_null_cols/index.html">pudl.scripts.pudl_null_cols</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/scripts/resource_description/index.html">pudl.scripts.resource_description</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/scripts/zenodo_data_release/index.html">pudl.scripts.zenodo_data_release</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/pudl/settings/index.html">pudl.settings</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../autoapi/pudl/transform/index.html">pudl.transform</a><input aria-label="Toggle navigation of pudl.transform" class="toctree-checkbox" id="toctree-checkbox-34" name="toctree-checkbox-34" role="switch" type="checkbox"/><label for="toctree-checkbox-34"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/censuspep/index.html">pudl.transform.censuspep</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/classes/index.html">pudl.transform.classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/eia/index.html">pudl.transform.eia</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/eia176/index.html">pudl.transform.eia176</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/eia860/index.html">pudl.transform.eia860</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/eia860m/index.html">pudl.transform.eia860m</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/eia861/index.html">pudl.transform.eia861</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/eia923/index.html">pudl.transform.eia923</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/eia930/index.html">pudl.transform.eia930</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/eiaaeo/index.html">pudl.transform.eiaaeo</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/eiaapi/index.html">pudl.transform.eiaapi</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/epacems/index.html">pudl.transform.epacems</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/ferc/index.html">pudl.transform.ferc</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/ferc1/index.html">pudl.transform.ferc1</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/ferc714/index.html">pudl.transform.ferc714</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/ferccid/index.html">pudl.transform.ferccid</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/ferceqr/index.html">pudl.transform.ferceqr</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/gridpathratoolkit/index.html">pudl.transform.gridpathratoolkit</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/nrelatb/index.html">pudl.transform.nrelatb</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/transform/params/index.html">pudl.transform.params</a><input aria-label="Toggle navigation of pudl.transform.params" class="toctree-checkbox" id="toctree-checkbox-35" name="toctree-checkbox-35" role="switch" type="checkbox"/><label for="toctree-checkbox-35"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/transform/params/ferc1/index.html">pudl.transform.params.ferc1</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/phmsagas/index.html">pudl.transform.phmsagas</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/rus/index.html">pudl.transform.rus</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/rus12/index.html">pudl.transform.rus12</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/rus7/index.html">pudl.transform.rus7</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/sec10k/index.html">pudl.transform.sec10k</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/vcerare/index.html">pudl.transform.vcerare</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/pudl/validate/index.html">pudl.validate</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../autoapi/pudl/workspace/index.html">pudl.workspace</a><input aria-label="Toggle navigation of pudl.workspace" class="toctree-checkbox" id="toctree-checkbox-36" name="toctree-checkbox-36" role="switch" type="checkbox"/><label for="toctree-checkbox-36"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/workspace/datastore/index.html">pudl.workspace.datastore</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/workspace/resource_cache/index.html">pudl.workspace.resource_cache</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/workspace/setup/index.html">pudl.workspace.setup</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../bibliography.html">Bibliography</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <h1>Source code for pudl.transform.eia860</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Module to perform data cleaning functions on EIA860 data tables.&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dagster</span><span class="w"> </span><span class="kn">import</span> <span class="n">asset</span><span class="p">,</span> <span class="n">asset_check</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pudl</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pudl.helpers</span><span class="w"> </span><span class="kn">import</span> <span class="n">drop_records_with_null_in_column</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pudl.metadata</span><span class="w"> </span><span class="kn">import</span> <span class="n">PUDL_PACKAGE</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pudl.metadata.classes</span><span class="w"> </span><span class="kn">import</span> <span class="n">DataSource</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pudl.metadata.codes</span><span class="w"> </span><span class="kn">import</span> <span class="n">CODE_METADATA</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pudl.metadata.dfs</span><span class="w"> </span><span class="kn">import</span> <span class="n">POLITICAL_SUBDIVISIONS</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pudl.metadata.fields</span><span class="w"> </span><span class="kn">import</span> <span class="n">apply_pudl_dtypes</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pudl.transform.eia861</span><span class="w"> </span><span class="kn">import</span> <span class="n">clean_nerc</span>

<div class="viewcode-block" id="logger">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/eia860/index.html#pudl.transform.eia860.logger">[docs]</a>
<span class="n">logger</span> <span class="o">=</span> <span class="n">pudl</span><span class="o">.</span><span class="n">logging_helpers</span><span class="o">.</span><span class="n">get_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span></div>



<span class="nd">@asset</span>
<div class="viewcode-block" id="_core_eia860__ownership">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/eia860/index.html#pudl.transform.eia860._core_eia860__ownership">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">_core_eia860__ownership</span><span class="p">(</span><span class="n">raw_eia860__ownership</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pull and transform the ownership table.</span>

<span class="sd">    Transformations include:</span>

<span class="sd">    * Replace . values with NA.</span>
<span class="sd">    * Convert pre-2012 ownership percentages to proportions to match post-2012</span>
<span class="sd">      reporting.</span>

<span class="sd">    Args:</span>
<span class="sd">        raw_eia860__ownership: The raw ``raw_eia860__ownership`` dataframe.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Cleaned ``_core_eia860__ownership`` dataframe ready for harvesting.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Preliminary clean and get rid of unnecessary &#39;year&#39; column</span>
    <span class="n">own_df</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">raw_eia860__ownership</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">standardize_na_values</span><span class="p">)</span>
        <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">convert_to_date</span><span class="p">)</span>
        <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">])</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">own_df</span><span class="o">.</span><span class="n">report_date</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">min</span><span class="p">(</span>
        <span class="n">DataSource</span><span class="o">.</span><span class="n">from_id</span><span class="p">(</span><span class="s2">&quot;eia860&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">working_partitions</span><span class="p">[</span><span class="s2">&quot;years&quot;</span><span class="p">]</span>
    <span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;EIA 860 transform step is only known to work for &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;year </span><span class="si">{</span><span class="nb">min</span><span class="p">(</span><span class="n">DataSource</span><span class="o">.</span><span class="n">from_id</span><span class="p">(</span><span class="s1">&#39;eia860&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">working_partitions</span><span class="p">[</span><span class="s1">&#39;years&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2"> and later, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;but found data from year </span><span class="si">{</span><span class="nb">min</span><span class="p">(</span><span class="n">own_df</span><span class="o">.</span><span class="n">report_date</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Prior to 2012, ownership was reported as a percentage, rather than</span>
    <span class="c1"># as a proportion, so we need to divide those values by 100.</span>
    <span class="n">own_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">own_df</span><span class="o">.</span><span class="n">report_date</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;</span> <span class="mi">2012</span><span class="p">,</span> <span class="s2">&quot;fraction_owned&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">own_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">own_df</span><span class="o">.</span><span class="n">report_date</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;</span> <span class="mi">2012</span><span class="p">,</span> <span class="s2">&quot;fraction_owned&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">100</span>
    <span class="p">)</span>

    <span class="c1"># This has to come before the fancy indexing below, otherwise the plant_id_eia</span>
    <span class="c1"># is still a float.</span>
    <span class="n">own_df</span> <span class="o">=</span> <span class="n">apply_pudl_dtypes</span><span class="p">(</span><span class="n">own_df</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s2">&quot;eia&quot;</span><span class="p">)</span>

    <span class="c1"># A small number of generators are reported multiple times in the ownership</span>
    <span class="c1"># table due to the use of leading zeroes in their integer generator_id values</span>
    <span class="c1"># which are stored as strings (since some generators use strings). This</span>
    <span class="c1"># makes sure that we only keep a single copy of those duplicated records which</span>
    <span class="c1"># we&#39;ve identified as falling into this category. We refrain from doing a wholesale</span>
    <span class="c1"># drop_duplicates() so that if duplicates are introduced by some other mechanism</span>
    <span class="c1"># we&#39;ll be notified.</span>

    <span class="c1"># The plant &amp; generator ID values we know have duplicates to remove.</span>
    <span class="n">known_dupes</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">own_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s2">&quot;plant_id_eia&quot;</span><span class="p">,</span> <span class="s2">&quot;generator_id&quot;</span><span class="p">])</span>
        <span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
        <span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="mi">56032</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">)]</span>
    <span class="p">)</span>
    <span class="c1"># Index of own_df w/ duplicated records removed.</span>
    <span class="n">without_known_dupes_idx</span> <span class="o">=</span> <span class="n">own_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">&quot;plant_id_eia&quot;</span><span class="p">,</span> <span class="s2">&quot;generator_id&quot;</span><span class="p">]</span>
    <span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">known_dupes</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="c1"># own_df w/ duplicated records removed.</span>
    <span class="n">without_known_dupes</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">own_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s2">&quot;plant_id_eia&quot;</span><span class="p">,</span> <span class="s2">&quot;generator_id&quot;</span><span class="p">])</span>
        <span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">without_known_dupes_idx</span><span class="p">]</span>
        <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="c1"># Drop duplicates from the known dupes using the whole primary key</span>
    <span class="n">own_pk</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;report_date&quot;</span><span class="p">,</span>
        <span class="s2">&quot;plant_id_eia&quot;</span><span class="p">,</span>
        <span class="s2">&quot;generator_id&quot;</span><span class="p">,</span>
        <span class="s2">&quot;owner_utility_id_eia&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">deduped</span> <span class="o">=</span> <span class="n">known_dupes</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="n">own_pk</span><span class="p">)</span>
    <span class="c1"># Bring these two parts back together:</span>
    <span class="n">own_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">without_known_dupes</span><span class="p">,</span> <span class="n">deduped</span><span class="p">])</span>
    <span class="c1"># Check whether we have truly deduplicated the dataframe.</span>
    <span class="n">remaining_dupes</span> <span class="o">=</span> <span class="n">own_df</span><span class="p">[</span><span class="n">own_df</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="n">own_pk</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">remaining_dupes</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Duplicate ownership slices found in _core_eia860__ownership: </span><span class="si">{</span><span class="n">remaining_dupes</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Remove a couple of records known to have (literal) &quot;nan&quot; values in the</span>
    <span class="c1"># generator_id column, which is part of the table&#39;s natural primary key.</span>
    <span class="c1"># These &quot;nan&quot; strings get converted to true pd.NA values when the column</span>
    <span class="c1"># datatypes are applied, which violates the primary key constraints.</span>
    <span class="c1"># See https://github.com/catalyst-cooperative/pudl/issues/1207</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span>
            <span class="n">own_df</span><span class="o">.</span><span class="n">report_date</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">-01-01&quot;</span>
                    <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                        <span class="mi">2018</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">pudl</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">Eia860Settings</span><span class="p">()</span><span class="o">.</span><span class="n">years</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="p">)</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">own_df</span><span class="o">.</span><span class="n">plant_id_eia</span> <span class="o">==</span> <span class="mi">62844</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">own_df</span><span class="o">.</span><span class="n">owner_utility_id_eia</span> <span class="o">==</span> <span class="mi">62745</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">own_df</span><span class="o">.</span><span class="n">generator_id</span> <span class="o">==</span> <span class="s2">&quot;nan&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">own_df</span> <span class="o">=</span> <span class="n">own_df</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">nulls</span> <span class="o">:=</span> <span class="n">own_df</span><span class="p">[</span><span class="n">own_df</span><span class="o">.</span><span class="n">generator_id</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Found records with null IDs in _core_eia860__ownership: </span><span class="si">{</span><span class="n">nulls</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="c1"># In 2010 there are several hundred utilities that appear to be incorrectly</span>
    <span class="c1"># reporting the owner_utility_id_eia value *also* in the utility_id_eia</span>
    <span class="c1"># column. This results in duplicate operator IDs associated with a given</span>
    <span class="c1"># generator in a particular year, which should never happen. We identify</span>
    <span class="c1"># these values and set them to NA so they don&#39;t mess up the harvested</span>
    <span class="c1"># relationships between plants and utilities:</span>
    <span class="c1"># See https://github.com/catalyst-cooperative/pudl/issues/1116</span>
    <span class="n">duplicate_operators</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">own_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;report_date&quot;</span><span class="p">,</span> <span class="s2">&quot;plant_id_eia&quot;</span><span class="p">,</span> <span class="s2">&quot;generator_id&quot;</span><span class="p">]</span>
        <span class="p">)</span><span class="o">.</span><span class="n">operator_utility_id_eia</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="o">.</span><span class="n">nunique</span><span class="p">)</span>
    <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
    <span class="n">own_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">duplicate_operators</span><span class="p">,</span> <span class="s2">&quot;operator_utility_id_eia&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NA</span>

    <span class="c1"># The above fix won&#39;t catch owner_utility_id_eia values in the</span>
    <span class="c1"># utility_id_eia (operator) column when there&#39;s only a single</span>
    <span class="c1"># owner-operator. But also, when there&#39;s a single owner-operator they shouldn&#39;t</span>
    <span class="c1"># even be reporting in this table. So we can also drop those utility_id_eia</span>
    <span class="c1"># values without losing any valuable information here. The utility_id_eia</span>
    <span class="c1"># column here is only useful for entity harvesting &amp; resolution purposes</span>
    <span class="c1"># since the (report_date, plant_id_eia) tuple fully defines the operator id.</span>
    <span class="c1"># See https://github.com/catalyst-cooperative/pudl/issues/1116</span>
    <span class="n">single_owner_operator</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">own_df</span><span class="o">.</span><span class="n">operator_utility_id_eia</span> <span class="o">==</span> <span class="n">own_df</span><span class="o">.</span><span class="n">owner_utility_id_eia</span>
    <span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">own_df</span><span class="o">.</span><span class="n">fraction_owned</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">own_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">single_owner_operator</span><span class="p">,</span> <span class="s2">&quot;operator_utility_id_eia&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NA</span>
    <span class="n">own_df</span> <span class="o">=</span> <span class="n">PUDL_PACKAGE</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">own_df</span><span class="p">)</span>
    <span class="c1"># CN is an invalid political subdivision code used by a few respondents to indicate</span>
    <span class="c1"># that the owner is in Canada. At least we can recover the country:</span>
    <span class="n">state_to_country</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">x</span><span class="o">.</span><span class="n">subdivision_code</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">country_code</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">POLITICAL_SUBDIVISIONS</span><span class="o">.</span><span class="n">itertuples</span><span class="p">()</span>
    <span class="p">}</span> <span class="o">|</span> <span class="p">{</span><span class="s2">&quot;CN&quot;</span><span class="p">:</span> <span class="s2">&quot;CAN&quot;</span><span class="p">}</span>
    <span class="n">own_df</span><span class="p">[</span><span class="s2">&quot;owner_country&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">own_df</span><span class="p">[</span><span class="s2">&quot;owner_state&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">state_to_country</span><span class="p">)</span>
    <span class="n">own_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">own_df</span><span class="o">.</span><span class="n">owner_state</span> <span class="o">==</span> <span class="s2">&quot;CN&quot;</span><span class="p">,</span> <span class="s2">&quot;owner_state&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NA</span>

    <span class="k">return</span> <span class="n">own_df</span></div>



<span class="nd">@asset</span>
<div class="viewcode-block" id="_core_eia860__generators">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/eia860/index.html#pudl.transform.eia860._core_eia860__generators">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">_core_eia860__generators</span><span class="p">(</span>
    <span class="n">raw_eia860__generator_proposed</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">raw_eia860__generator_existing</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">raw_eia860__generator_retired</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">raw_eia860__generator</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pull and transform the generators table.</span>

<span class="sd">    There are three tabs that the generator records come from (proposed, existing,</span>
<span class="sd">    retired). Pre 2009, the existing and retired data are lumped together under a single</span>
<span class="sd">    generator file with one tab. We pull each tab into one dataframe and include an</span>
<span class="sd">    ``operational_status`` to indicate which tab the record came from. We use</span>
<span class="sd">    ``operational_status`` to parse the pre 2009 files as well.</span>

<span class="sd">    Transformations include:</span>

<span class="sd">    * Replace . values with NA.</span>
<span class="sd">    * Update ``operational_status_code`` to reflect plant status as either proposed,</span>
<span class="sd">      existing or retired.</span>
<span class="sd">    * Drop values with NA for plant and generator id.</span>
<span class="sd">    * Replace 0 values with NA where appropriate.</span>
<span class="sd">    * Convert Y/N/X values to boolean True/False.</span>
<span class="sd">    * Convert U/Unknown values to NA.</span>
<span class="sd">    * Map full spelling onto code values.</span>
<span class="sd">    * Create a fuel_type_code_pudl field that organizes fuel types into</span>
<span class="sd">      clean, distinguishable categories.</span>

<span class="sd">    Args:</span>
<span class="sd">        raw_eia860__generator_proposed: The raw ``raw_eia860__generator_proposed`` dataframe.</span>
<span class="sd">        raw_eia860__generator_existing: The raw ``raw_eia860__generator_existing`` dataframe.</span>
<span class="sd">        raw_eia860__generator_retired: The raw ``raw_eia860__generator_retired`` dataframe.</span>
<span class="sd">        raw_eia860__generator: The raw ``raw_eia860__generator`` dataframe.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Cleaned ``_core_eia860__generators`` dataframe ready for harvesting.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Groupby objects were creating chained assignment warning that is N/A</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">chained_assignment</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># There are three sets of generator data reported in the EIA860 table,</span>
    <span class="c1"># planned, existing, and retired generators. We&#39;re going to concatenate</span>
    <span class="c1"># them all together into a single big table, with a column that indicates</span>
    <span class="c1"># which one of these tables the data came from, since they all have almost</span>
    <span class="c1"># exactly the same structure</span>
    <span class="n">gp_df</span> <span class="o">=</span> <span class="n">raw_eia860__generator_proposed</span>
    <span class="n">ge_df</span> <span class="o">=</span> <span class="n">raw_eia860__generator_existing</span>
    <span class="n">gr_df</span> <span class="o">=</span> <span class="n">raw_eia860__generator_retired</span>
    <span class="n">g_df</span> <span class="o">=</span> <span class="n">raw_eia860__generator</span>
    <span class="c1"># the retired tab of eia860 does not have a operational_status_code column.</span>
    <span class="c1"># we still want these gens to have a code (and subsequently a</span>
    <span class="c1"># operational_status). We could do this by fillna w/ the retirement_date, but</span>
    <span class="c1"># this way seems more straightforward.</span>
    <span class="n">gr_df</span><span class="p">[</span><span class="s2">&quot;operational_status_code&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gr_df</span><span class="p">[</span><span class="s2">&quot;operational_status_code&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;RE&quot;</span><span class="p">)</span>
    <span class="c1"># Prep dicts for column based pd.replace:</span>
    <span class="c1"># A subset of the columns have zero values, where NA is appropriate:</span>
    <span class="n">nulls_replace_cols</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">col</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot; &quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="s2">&quot;planned_generator_retirement_month&quot;</span><span class="p">,</span>
            <span class="s2">&quot;planned_generator_retirement_year&quot;</span><span class="p">,</span>
            <span class="s2">&quot;planned_uprate_month&quot;</span><span class="p">,</span>
            <span class="s2">&quot;planned_uprate_year&quot;</span><span class="p">,</span>
            <span class="s2">&quot;other_modifications_month&quot;</span><span class="p">,</span>
            <span class="s2">&quot;other_modifications_year&quot;</span><span class="p">,</span>
            <span class="s2">&quot;planned_derate_month&quot;</span><span class="p">,</span>
            <span class="s2">&quot;planned_derate_year&quot;</span><span class="p">,</span>
            <span class="s2">&quot;planned_repower_month&quot;</span><span class="p">,</span>
            <span class="s2">&quot;planned_repower_year&quot;</span><span class="p">,</span>
            <span class="s2">&quot;planned_net_summer_capacity_derate_mw&quot;</span><span class="p">,</span>
            <span class="s2">&quot;planned_net_summer_capacity_uprate_mw&quot;</span><span class="p">,</span>
            <span class="s2">&quot;planned_net_winter_capacity_derate_mw&quot;</span><span class="p">,</span>
            <span class="s2">&quot;planned_net_winter_capacity_uprate_mw&quot;</span><span class="p">,</span>
            <span class="s2">&quot;planned_new_capacity_mw&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nameplate_power_factor&quot;</span><span class="p">,</span>
            <span class="s2">&quot;minimum_load_mw&quot;</span><span class="p">,</span>
            <span class="s2">&quot;winter_capacity_mw&quot;</span><span class="p">,</span>
            <span class="s2">&quot;summer_capacity_mw&quot;</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">}</span>
    <span class="n">boolean_columns_to_fix</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;duct_burners&quot;</span><span class="p">,</span>
        <span class="s2">&quot;can_burn_multiple_fuels&quot;</span><span class="p">,</span>
        <span class="s2">&quot;deliver_power_transgrid&quot;</span><span class="p">,</span>
        <span class="s2">&quot;synchronized_transmission_grid&quot;</span><span class="p">,</span>
        <span class="s2">&quot;solid_fuel_gasification&quot;</span><span class="p">,</span>
        <span class="s2">&quot;pulverized_coal_tech&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fluidized_bed_tech&quot;</span><span class="p">,</span>
        <span class="s2">&quot;subcritical_tech&quot;</span><span class="p">,</span>
        <span class="s2">&quot;supercritical_tech&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ultrasupercritical_tech&quot;</span><span class="p">,</span>
        <span class="s2">&quot;carbon_capture&quot;</span><span class="p">,</span>
        <span class="s2">&quot;stoker_tech&quot;</span><span class="p">,</span>
        <span class="s2">&quot;other_combustion_tech&quot;</span><span class="p">,</span>
        <span class="s2">&quot;can_cofire_fuels&quot;</span><span class="p">,</span>
        <span class="s2">&quot;can_switch_oil_gas&quot;</span><span class="p">,</span>
        <span class="s2">&quot;can_switch_when_operating&quot;</span><span class="p">,</span>
        <span class="s2">&quot;bypass_heat_recovery&quot;</span><span class="p">,</span>
        <span class="s2">&quot;associated_combined_heat_power&quot;</span><span class="p">,</span>
        <span class="s2">&quot;planned_modifications&quot;</span><span class="p">,</span>
        <span class="s2">&quot;other_planned_modifications&quot;</span><span class="p">,</span>
        <span class="s2">&quot;uprate_derate_during_year&quot;</span><span class="p">,</span>
        <span class="s2">&quot;previously_canceled&quot;</span><span class="p">,</span>
        <span class="s2">&quot;owned_by_non_utility&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summer_capacity_estimate&quot;</span><span class="p">,</span>
        <span class="s2">&quot;winter_capacity_estimate&quot;</span><span class="p">,</span>
        <span class="s2">&quot;distributed_generation&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ferc_cogen_status&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ferc_small_power_producer&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ferc_exempt_wholesale_generator&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ferc_qualifying_facility&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">gens_df</span> <span class="o">=</span> <span class="p">(</span>
        <span class="c1"># pandas complains when you pass in empty dfs, but it&#39;s surprisingly more</span>
        <span class="c1"># memory-expensive to skip the empty dfs and manually add the columns</span>
        <span class="c1"># we need from them back in, so the complainer stays.</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">ge_df</span><span class="p">,</span> <span class="n">gp_df</span><span class="p">,</span> <span class="n">gr_df</span><span class="p">,</span> <span class="n">g_df</span><span class="p">],</span> <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">standardize_na_values</span><span class="p">)</span>
        <span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;generator_id&quot;</span><span class="p">,</span> <span class="s2">&quot;plant_id_eia&quot;</span><span class="p">])</span>
        <span class="o">.</span><span class="n">pipe</span><span class="p">(</span>
            <span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">fix_boolean_columns</span><span class="p">,</span>
            <span class="n">boolean_columns_to_fix</span><span class="o">=</span><span class="n">boolean_columns_to_fix</span><span class="p">,</span>
            <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">gens_df</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">to_replace</span><span class="o">=</span><span class="n">nulls_replace_cols</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># noqa: PD002</span>
    <span class="n">gens_df</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">gens_df</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">month_year_to_date</span><span class="p">)</span>
        <span class="o">.</span><span class="n">pipe</span><span class="p">(</span>
            <span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">simplify_strings</span><span class="p">,</span>
            <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;rto_iso_lmp_node_id&quot;</span><span class="p">,</span> <span class="s2">&quot;rto_iso_location_wholesale_reporting_id&quot;</span><span class="p">],</span>
            <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">convert_to_date</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="c1"># This manual fix is required before encoding because there&#39;s not a unique mapping</span>
    <span class="c1"># PA -&gt; PACW in Oregon</span>
    <span class="n">gens_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
        <span class="p">(</span><span class="n">gens_df</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s2">&quot;OR&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">gens_df</span><span class="o">.</span><span class="n">balancing_authority_code_eia</span> <span class="o">==</span> <span class="s2">&quot;PA&quot;</span><span class="p">),</span>
        <span class="s2">&quot;balancing_authority_code_eia&quot;</span><span class="p">,</span>
    <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;PACW&quot;</span>
    <span class="c1"># PA -&gt; PACE in Utah</span>
    <span class="n">gens_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
        <span class="p">(</span><span class="n">gens_df</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s2">&quot;UT&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">gens_df</span><span class="o">.</span><span class="n">balancing_authority_code_eia</span> <span class="o">==</span> <span class="s2">&quot;PA&quot;</span><span class="p">),</span>
        <span class="s2">&quot;balancing_authority_code_eia&quot;</span><span class="p">,</span>
    <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;PACE&quot;</span>
    <span class="n">gens_df</span> <span class="o">=</span> <span class="n">PUDL_PACKAGE</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">gens_df</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># spot fix one or two assumed to be bad technology description. It&#39;s assumed to be wrong</span>
    <span class="c1"># because we learned via pudl.output.eia.fill_generator_technology_description</span>
    <span class="c1"># that all other combos of PM code and ESC have a different technology. See #4788</span>
    <span class="c1"># we have to do this after encoding bc we are dealing with codes</span>
    <span class="n">bad_tech_mask</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">gens_df</span><span class="o">.</span><span class="n">technology_description</span> <span class="o">==</span> <span class="s2">&quot;All Other&quot;</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">gens_df</span><span class="o">.</span><span class="n">prime_mover_code</span> <span class="o">==</span> <span class="s2">&quot;OT&quot;</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">gens_df</span><span class="o">.</span><span class="n">energy_source_code_1</span> <span class="o">==</span> <span class="s2">&quot;OG&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">expected_bad_tech_len_min</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="mi">2025</span> <span class="ow">in</span> <span class="n">gens_df</span><span class="o">.</span><span class="n">report_date</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="n">expected_bad_tech_len_max</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">expected_bad_tech_len_min</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">3</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
        <span class="n">expected_bad_tech_len_min</span>
        <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">gens_df</span><span class="p">[</span><span class="n">bad_tech_mask</span><span class="p">])</span>
        <span class="o">&lt;=</span> <span class="n">expected_bad_tech_len_max</span>
    <span class="p">):</span>
        <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Spot fixing: We expect to find between </span><span class="si">{</span><span class="n">expected_bad_tech_len_min</span><span class="si">}</span><span class="s2"> &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;and </span><span class="si">{</span><span class="n">expected_bad_tech_len_max</span><span class="si">}</span><span class="s2"> records &quot;</span>
            <span class="s2">&quot;which has what we assume is an incorrect technology description, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;but we found: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">gens_df</span><span class="p">[</span><span class="n">bad_tech_mask</span><span class="p">])</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="si">{</span><span class="n">gens_df</span><span class="p">[</span><span class="n">bad_tech_mask</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="n">gens_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">bad_tech_mask</span><span class="p">,</span> <span class="s2">&quot;technology_description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Other Gases&quot;</span>

    <span class="n">gens_df</span><span class="p">[</span><span class="s2">&quot;fuel_type_code_pudl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gens_df</span><span class="o">.</span><span class="n">energy_source_code_1</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
        <span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">label_map</span><span class="p">(</span>
            <span class="n">CODE_METADATA</span><span class="p">[</span><span class="s2">&quot;core_eia__codes_energy_sources&quot;</span><span class="p">][</span><span class="s2">&quot;df&quot;</span><span class="p">],</span>
            <span class="n">from_col</span><span class="o">=</span><span class="s2">&quot;code&quot;</span><span class="p">,</span>
            <span class="n">to_col</span><span class="o">=</span><span class="s2">&quot;fuel_type_code_pudl&quot;</span><span class="p">,</span>
            <span class="n">null_value</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">gens_df</span><span class="p">[</span><span class="s2">&quot;operational_status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gens_df</span><span class="o">.</span><span class="n">operational_status_code</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
        <span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">label_map</span><span class="p">(</span>
            <span class="n">CODE_METADATA</span><span class="p">[</span><span class="s2">&quot;core_eia__codes_operational_status&quot;</span><span class="p">][</span><span class="s2">&quot;df&quot;</span><span class="p">],</span>
            <span class="n">from_col</span><span class="o">=</span><span class="s2">&quot;code&quot;</span><span class="p">,</span>
            <span class="n">to_col</span><span class="o">=</span><span class="s2">&quot;operational_status&quot;</span><span class="p">,</span>
            <span class="n">null_value</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="c1"># spot fix (remove) a plant with no information about it that EIA confirmed was an error.</span>
    <span class="c1"># See issue #4769.</span>
    <span class="n">bad_gen_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">gens_df</span><span class="p">[</span><span class="s2">&quot;report_date&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;2024-01-01&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span>
        <span class="n">gens_df</span><span class="p">[</span><span class="s2">&quot;plant_id_eia&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">68815</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">len_observed</span> <span class="o">:=</span> <span class="nb">len</span><span class="p">(</span><span class="n">gens_df</span><span class="p">[</span><span class="n">bad_gen_mask</span><span class="p">]))</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span>
            <span class="s2">&quot;Spot fixing: We expect to find 1 record for plant_id_eia 68815 in &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;2024-01-01, but found </span><span class="si">{</span><span class="n">len_observed</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="n">gens_df</span> <span class="o">=</span> <span class="n">gens_df</span><span class="p">[</span><span class="o">~</span><span class="n">bad_gen_mask</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">gens_df</span></div>



<span class="nd">@asset</span>
<div class="viewcode-block" id="_core_eia860__generators_solar">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/eia860/index.html#pudl.transform.eia860._core_eia860__generators_solar">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">_core_eia860__generators_solar</span><span class="p">(</span>
    <span class="n">raw_eia860__generator_solar_existing</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">raw_eia860__generator_solar_retired</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Transform the solar-specific generators table.</span>

<span class="sd">    Many of the same transforms to the core generators table are applied here.</span>
<span class="sd">    Most of the unique solar columns are booleans.</span>

<span class="sd">    Notes for possible future cleaning:</span>

<span class="sd">    * Both the ``tilt_angle`` and ``azimuth_angle`` columns have a small number of</span>
<span class="sd">      negative values (both under 40 records). This seems off, but not impossible?</span>
<span class="sd">    * A lot of the boolean columns in this table are mostly null. It is probably</span>
<span class="sd">      that a lot of the nulls should correspond to False&#39;s, but there is no sure way</span>
<span class="sd">      to know, so nulls seem more appropriate.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">solar_existing</span> <span class="o">=</span> <span class="n">raw_eia860__generator_solar_existing</span>
    <span class="n">solar_retired</span> <span class="o">=</span> <span class="n">raw_eia860__generator_solar_retired</span>
    <span class="c1"># every boolean column in the raw solar tables has a uses prefix</span>
    <span class="n">boolean_columns_to_fix</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">solar_existing</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;^uses_&quot;</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">mismatched_bool_cols</span> <span class="o">:=</span> <span class="nb">set</span><span class="p">(</span><span class="n">boolean_columns_to_fix</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span>
        <span class="nb">set</span><span class="p">(</span><span class="n">solar_retired</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;^uses_&quot;</span><span class="p">))</span>
    <span class="p">):</span>
        <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span>
            <span class="s2">&quot;We expect that the raw existing and retired assets to have the exact same &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;boolean columns with prefix of uses_ but we found </span><span class="si">{</span><span class="n">mismatched_bool_cols</span><span class="si">=}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="n">solar_df</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">solar_existing</span><span class="p">,</span> <span class="n">solar_retired</span><span class="p">],</span> <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">standardize_na_values</span><span class="p">)</span>
        <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">fix_boolean_columns</span><span class="p">,</span> <span class="n">boolean_columns_to_fix</span><span class="p">)</span>
        <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">month_year_to_date</span><span class="p">)</span>
        <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">convert_to_date</span><span class="p">)</span>
        <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">PUDL_PACKAGE</span><span class="o">.</span><span class="n">encode</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">solar_df</span><span class="p">[</span><span class="s2">&quot;operational_status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">solar_df</span><span class="o">.</span><span class="n">operational_status_code</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
        <span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">label_map</span><span class="p">(</span>
            <span class="n">CODE_METADATA</span><span class="p">[</span><span class="s2">&quot;core_eia__codes_operational_status&quot;</span><span class="p">][</span><span class="s2">&quot;df&quot;</span><span class="p">],</span>
            <span class="n">from_col</span><span class="o">=</span><span class="s2">&quot;code&quot;</span><span class="p">,</span>
            <span class="n">to_col</span><span class="o">=</span><span class="s2">&quot;operational_status&quot;</span><span class="p">,</span>
            <span class="n">null_value</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="c1"># spot fix (remove) a plant with no information about it that EIA confirmed was an error.</span>
    <span class="c1"># See issue #4769. The plant is solar so we have to remove it from here too.</span>
    <span class="n">bad_gen_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">solar_df</span><span class="p">[</span><span class="s2">&quot;report_date&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;2024-01-01&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span>
        <span class="n">solar_df</span><span class="p">[</span><span class="s2">&quot;plant_id_eia&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">68815</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">len_observed</span> <span class="o">:=</span> <span class="nb">len</span><span class="p">(</span><span class="n">solar_df</span><span class="p">[</span><span class="n">bad_gen_mask</span><span class="p">]))</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span>
            <span class="s2">&quot;Spot fixing: We expect to find 1 record for plant_id_eia 68815 in &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;2024-01-01, but found </span><span class="si">{</span><span class="n">len_observed</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="n">solar_df</span> <span class="o">=</span> <span class="n">solar_df</span><span class="p">[</span><span class="o">~</span><span class="n">bad_gen_mask</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">solar_df</span></div>



<span class="nd">@asset</span>
<div class="viewcode-block" id="_core_eia860__generators_energy_storage">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/eia860/index.html#pudl.transform.eia860._core_eia860__generators_energy_storage">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">_core_eia860__generators_energy_storage</span><span class="p">(</span>
    <span class="n">raw_eia860__generator_energy_storage_existing</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">raw_eia860__generator_energy_storage_proposed</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">raw_eia860__generator_energy_storage_retired</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Transform the energy storage specific generators table.&quot;&quot;&quot;</span>
    <span class="n">storage_ex</span> <span class="o">=</span> <span class="n">raw_eia860__generator_energy_storage_existing</span>
    <span class="n">storage_pr</span> <span class="o">=</span> <span class="n">raw_eia860__generator_energy_storage_proposed</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span>
        <span class="n">drop_records_with_null_in_column</span><span class="p">,</span>
        <span class="n">column</span><span class="o">=</span><span class="s2">&quot;generator_id&quot;</span><span class="p">,</span>
        <span class="n">num_of_expected_nulls</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>  <span class="c1"># Plant ID 62844 in 2023-4</span>
    <span class="p">)</span>
    <span class="n">storage_re</span> <span class="o">=</span> <span class="n">raw_eia860__generator_energy_storage_retired</span>

    <span class="c1"># every boolean column in the raw storage tables has a served_ or stored_ prefix</span>
    <span class="n">boolean_columns_to_fix</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">storage_ex</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;^served_|^stored_|^is_&quot;</span><span class="p">))</span>

    <span class="n">storage_df</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">storage_ex</span><span class="p">,</span> <span class="n">storage_pr</span><span class="p">,</span> <span class="n">storage_re</span><span class="p">],</span> <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">standardize_na_values</span><span class="p">)</span>
        <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">month_year_to_date</span><span class="p">)</span>
        <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">convert_to_date</span><span class="p">)</span>
        <span class="o">.</span><span class="n">pipe</span><span class="p">(</span>
            <span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">fix_boolean_columns</span><span class="p">,</span>
            <span class="n">boolean_columns_to_fix</span><span class="o">=</span><span class="n">boolean_columns_to_fix</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">PUDL_PACKAGE</span><span class="o">.</span><span class="n">encode</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">storage_df</span><span class="p">[</span><span class="s2">&quot;operational_status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">storage_df</span><span class="o">.</span><span class="n">operational_status_code</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
            <span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">label_map</span><span class="p">(</span>
                <span class="n">CODE_METADATA</span><span class="p">[</span><span class="s2">&quot;core_eia__codes_operational_status&quot;</span><span class="p">][</span><span class="s2">&quot;df&quot;</span><span class="p">],</span>
                <span class="n">from_col</span><span class="o">=</span><span class="s2">&quot;code&quot;</span><span class="p">,</span>
                <span class="n">to_col</span><span class="o">=</span><span class="s2">&quot;operational_status&quot;</span><span class="p">,</span>
                <span class="n">null_value</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Capitalize the direct_support generator IDs</span>
    <span class="c1"># We harvest these values into our generator tables, but they aren&#39;t as</span>
    <span class="c1"># well-normalized as the directly reported generator IDs. The differences in</span>
    <span class="c1"># capitalization were marking a larger number of generators as non-existent</span>
    <span class="c1"># than are actually the case (e.g., a plant reporting both generator GEN1 and Gen1).</span>
    <span class="c1"># See PR#3699 and PR#4332. We manually fix a known list of these.</span>

    <span class="c1"># Any remaining &#39;fake&#39; generator IDs get dropped in _out_eia__yearly_generators</span>

    <span class="n">known_bad_caps</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;SunB&quot;</span><span class="p">,</span>
        <span class="s2">&quot;EcheB&quot;</span><span class="p">,</span>
        <span class="s2">&quot;MayB&quot;</span><span class="p">,</span>
        <span class="s2">&quot;IssaP&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Matad&quot;</span><span class="p">,</span>
        <span class="s2">&quot;WolfB&quot;</span><span class="p">,</span>
        <span class="s2">&quot;IrisB&quot;</span><span class="p">,</span>
        <span class="s2">&quot;TwinB&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">filter_condition</span> <span class="o">=</span> <span class="p">(</span><span class="n">storage_df</span><span class="o">.</span><span class="n">report_date</span> <span class="o">==</span> <span class="s2">&quot;2024-01-01&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span>
        <span class="n">storage_df</span><span class="o">.</span><span class="n">generator_id_direct_support_1</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">known_bad_caps</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">storage_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">filter_condition</span><span class="p">,</span> <span class="s2">&quot;generator_id_direct_support_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">storage_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
        <span class="n">filter_condition</span><span class="p">,</span> <span class="s2">&quot;generator_id_direct_support_1&quot;</span>
    <span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">storage_df</span></div>



<span class="nd">@asset</span>
<div class="viewcode-block" id="_core_eia860__generators_wind">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/eia860/index.html#pudl.transform.eia860._core_eia860__generators_wind">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">_core_eia860__generators_wind</span><span class="p">(</span>
    <span class="n">raw_eia860__generator_wind_existing</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">raw_eia860__generator_wind_retired</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Transform the wind-specific generators table.</span>

<span class="sd">    Many of the same transforms to the core generators table are applied here.</span>

<span class="sd">    Some notes for possible cleaning later:</span>

<span class="sd">    * technology_description: this field didn&#39;t exist in 2013. We could try to backfill.</span>
<span class="sd">      this is an annual scd so it&#39;ll get slurped up there and backfilling does happen</span>
<span class="sd">      in the output layer via :func:`pudl.output.eia.fill_generator_technology_description`</span>
<span class="sd">    * turbines_num: this field doesn&#39;t show up in this table for 2013 and 2014, but it does</span>
<span class="sd">      exist in the 2001-2012 generators tab. This is an annual generator scd.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">wind_ex</span> <span class="o">=</span> <span class="n">raw_eia860__generator_wind_existing</span>
    <span class="n">wind_re</span> <span class="o">=</span> <span class="n">raw_eia860__generator_wind_retired</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span>
        <span class="n">drop_records_with_null_in_column</span><span class="p">,</span>
        <span class="n">column</span><span class="o">=</span><span class="s2">&quot;generator_id&quot;</span><span class="p">,</span>
        <span class="n">num_of_expected_nulls</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">wind_df</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">wind_ex</span><span class="p">,</span> <span class="n">wind_re</span><span class="p">],</span> <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">standardize_na_values</span><span class="p">)</span>
        <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">month_year_to_date</span><span class="p">)</span>
        <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">convert_to_date</span><span class="p">)</span>
        <span class="o">.</span><span class="n">pipe</span><span class="p">(</span>
            <span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">simplify_strings</span><span class="p">,</span>
            <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;predominant_turbine_manufacturer&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">convert_dtypes</span><span class="p">()</span>  <span class="c1"># converting here before the wind encoding bc int&#39;s are codes</span>
        <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">PUDL_PACKAGE</span><span class="o">.</span><span class="n">encode</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">wind_df</span><span class="p">[</span><span class="s2">&quot;operational_status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wind_df</span><span class="o">.</span><span class="n">operational_status_code</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
        <span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">label_map</span><span class="p">(</span>
            <span class="n">CODE_METADATA</span><span class="p">[</span><span class="s2">&quot;core_eia__codes_operational_status&quot;</span><span class="p">][</span><span class="s2">&quot;df&quot;</span><span class="p">],</span>
            <span class="n">from_col</span><span class="o">=</span><span class="s2">&quot;code&quot;</span><span class="p">,</span>
            <span class="n">to_col</span><span class="o">=</span><span class="s2">&quot;operational_status&quot;</span><span class="p">,</span>
            <span class="n">null_value</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">wind_df</span></div>



<span class="nd">@asset</span>
<div class="viewcode-block" id="_core_eia860__generators_multifuel">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/eia860/index.html#pudl.transform.eia860._core_eia860__generators_multifuel">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">_core_eia860__generators_multifuel</span><span class="p">(</span>
    <span class="n">raw_eia860__multifuel_existing</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">raw_eia860__multifuel_proposed</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">raw_eia860__multifuel_retired</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Transform the multifuel generators table.&quot;&quot;&quot;</span>
    <span class="n">multifuel_ex</span> <span class="o">=</span> <span class="n">raw_eia860__multifuel_existing</span>
    <span class="n">multifuel_pr</span> <span class="o">=</span> <span class="n">raw_eia860__multifuel_proposed</span>
    <span class="n">multifuel_re</span> <span class="o">=</span> <span class="n">raw_eia860__multifuel_retired</span>

    <span class="n">boolean_columns_to_fix</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;can_burn_multiple_fuels&quot;</span><span class="p">,</span>
        <span class="s2">&quot;can_cofire_fuels&quot;</span><span class="p">,</span>
        <span class="s2">&quot;can_switch_oil_gas&quot;</span><span class="p">,</span>
        <span class="s2">&quot;can_switch_when_operating&quot;</span><span class="p">,</span>
        <span class="s2">&quot;has_factors_that_limit_switching&quot;</span><span class="p">,</span>
        <span class="s2">&quot;has_storage_limits&quot;</span><span class="p">,</span>
        <span class="s2">&quot;has_air_permit_limits&quot;</span><span class="p">,</span>
        <span class="s2">&quot;has_other_factors_that_limit_switching&quot;</span><span class="p">,</span>
        <span class="s2">&quot;can_cofire_oil_and_gas&quot;</span><span class="p">,</span>
        <span class="s2">&quot;can_cofire_100_oil&quot;</span><span class="p">,</span>
        <span class="s2">&quot;can_fuel_switch&quot;</span><span class="p">,</span>
        <span class="s2">&quot;has_regulatory_limits&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="c1"># A subset of the columns have zero values, where NA is appropriate:</span>
    <span class="n">nulls_replace_cols</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">col</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot; &quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="s2">&quot;winter_capacity_mw&quot;</span><span class="p">,</span>
            <span class="s2">&quot;summer_capacity_mw&quot;</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">}</span>

    <span class="n">multifuel_df</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">multifuel_ex</span><span class="p">,</span> <span class="n">multifuel_pr</span><span class="p">,</span> <span class="n">multifuel_re</span><span class="p">],</span> <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;generator_id&quot;</span><span class="p">,</span> <span class="s2">&quot;plant_id_eia&quot;</span><span class="p">])</span>
        <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">standardize_na_values</span><span class="p">)</span>
        <span class="o">.</span><span class="n">pipe</span><span class="p">(</span>
            <span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">fix_boolean_columns</span><span class="p">,</span>
            <span class="n">boolean_columns_to_fix</span><span class="o">=</span><span class="n">boolean_columns_to_fix</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">to_replace</span><span class="o">=</span><span class="n">nulls_replace_cols</span><span class="p">)</span>
        <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">month_year_to_date</span><span class="p">)</span>
        <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">convert_to_date</span><span class="p">)</span>
        <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">PUDL_PACKAGE</span><span class="o">.</span><span class="n">encode</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">multifuel_df</span><span class="p">[</span><span class="s2">&quot;fuel_type_code_pudl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">multifuel_df</span><span class="o">.</span><span class="n">energy_source_code_1</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
            <span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">label_map</span><span class="p">(</span>
                <span class="n">CODE_METADATA</span><span class="p">[</span><span class="s2">&quot;core_eia__codes_energy_sources&quot;</span><span class="p">][</span><span class="s2">&quot;df&quot;</span><span class="p">],</span>
                <span class="n">from_col</span><span class="o">=</span><span class="s2">&quot;code&quot;</span><span class="p">,</span>
                <span class="n">to_col</span><span class="o">=</span><span class="s2">&quot;fuel_type_code_pudl&quot;</span><span class="p">,</span>
                <span class="n">null_value</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">multifuel_df</span><span class="p">[</span><span class="s2">&quot;operational_status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">multifuel_df</span><span class="o">.</span><span class="n">operational_status_code</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
            <span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">label_map</span><span class="p">(</span>
                <span class="n">CODE_METADATA</span><span class="p">[</span><span class="s2">&quot;core_eia__codes_operational_status&quot;</span><span class="p">][</span><span class="s2">&quot;df&quot;</span><span class="p">],</span>
                <span class="n">from_col</span><span class="o">=</span><span class="s2">&quot;code&quot;</span><span class="p">,</span>
                <span class="n">to_col</span><span class="o">=</span><span class="s2">&quot;operational_status&quot;</span><span class="p">,</span>
                <span class="n">null_value</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># There are some pesky duplicate rows from the plant_id 56032 gen_id 1</span>
    <span class="c1"># The rows are almost identical, so this gets rid of the duplicates.</span>
    <span class="c1"># It only drops known duplicates from 56032 so we can spot any other</span>
    <span class="c1"># irregularities in the future.</span>
    <span class="n">dupe_pk_rows_to_drop</span> <span class="o">=</span> <span class="n">multifuel_df</span><span class="p">[</span>
        <span class="n">multifuel_df</span><span class="p">[[</span><span class="s2">&quot;report_date&quot;</span><span class="p">,</span> <span class="s2">&quot;plant_id_eia&quot;</span><span class="p">,</span> <span class="s2">&quot;generator_id&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">multifuel_df</span><span class="p">[</span><span class="s2">&quot;plant_id_eia&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">56032</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">multifuel_df</span> <span class="o">=</span> <span class="n">multifuel_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">dupe_pk_rows_to_drop</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">multifuel_df</span></div>



<span class="nd">@asset</span>
<div class="viewcode-block" id="_core_eia860__plants">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/eia860/index.html#pudl.transform.eia860._core_eia860__plants">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">_core_eia860__plants</span><span class="p">(</span><span class="n">raw_eia860__plant</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pull and transform the plants table.</span>

<span class="sd">    Much of the static plant information is reported repeatedly, and scattered across</span>
<span class="sd">    several different pages of EIA 923. The data frame which this function uses is</span>
<span class="sd">    assembled from those many different pages, and passed in via the same dictionary of</span>
<span class="sd">    dataframes that all the other ingest functions use for uniformity.</span>

<span class="sd">    Transformations include:</span>

<span class="sd">    * Replace . values with NA.</span>
<span class="sd">    * Homogenize spelling of county names.</span>
<span class="sd">    * Convert Y/N/X values to boolean True/False.</span>

<span class="sd">    Args:</span>
<span class="sd">        raw_eia860__plant: The raw ``raw_eia860__plant`` dataframe.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Cleaned ``_core_eia860__plants`` dataframe ready for harvesting.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Populating the &#39;_core_eia860__plants&#39; table</span>
    <span class="n">p_df</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">raw_eia860__plant</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">standardize_na_values</span><span class="p">)</span>
        <span class="o">.</span><span class="n">astype</span><span class="p">({</span><span class="s2">&quot;zip_code&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">})</span>
        <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;iso_rto&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;columns&quot;</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Spelling, punctuation, and capitalization of county names can vary from</span>
    <span class="c1"># year to year. We homogenize them here to facilitate correct value</span>
    <span class="c1"># harvesting.</span>
    <span class="n">p_df</span><span class="p">[</span><span class="s2">&quot;county&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">p_df</span><span class="o">.</span><span class="n">county</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[^a-z,A-Z]+&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s+&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
    <span class="p">)</span>

    <span class="c1"># A subset of the columns have &quot;X&quot; values, where other columns_to_fix</span>
    <span class="c1"># have &quot;N&quot; values. Replacing these values with &quot;N&quot; will make for uniform</span>
    <span class="c1"># values that can be converted to Boolean True and False pairs.</span>

    <span class="n">p_df</span><span class="o">.</span><span class="n">ash_impoundment_lined</span> <span class="o">=</span> <span class="n">p_df</span><span class="o">.</span><span class="n">ash_impoundment_lined</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">to_replace</span><span class="o">=</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;N&quot;</span>
    <span class="p">)</span>
    <span class="n">p_df</span><span class="o">.</span><span class="n">natural_gas_storage</span> <span class="o">=</span> <span class="n">p_df</span><span class="o">.</span><span class="n">natural_gas_storage</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">to_replace</span><span class="o">=</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;N&quot;</span>
    <span class="p">)</span>
    <span class="n">p_df</span><span class="o">.</span><span class="n">liquefied_natural_gas_storage</span> <span class="o">=</span> <span class="n">p_df</span><span class="o">.</span><span class="n">liquefied_natural_gas_storage</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">to_replace</span><span class="o">=</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;N&quot;</span>
    <span class="p">)</span>

    <span class="n">boolean_columns_to_fix</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;ferc_cogen_status&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ferc_small_power_producer&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ferc_exempt_wholesale_generator&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ash_impoundment&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ash_impoundment_lined&quot;</span><span class="p">,</span>
        <span class="s2">&quot;energy_storage&quot;</span><span class="p">,</span>
        <span class="s2">&quot;natural_gas_storage&quot;</span><span class="p">,</span>
        <span class="s2">&quot;liquefied_natural_gas_storage&quot;</span><span class="p">,</span>
        <span class="s2">&quot;has_net_metering&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">boolean_columns_to_fix</span><span class="p">:</span>
        <span class="n">p_df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">p_df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span>
            <span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">to_replace</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="s2">&quot;NaN&quot;</span><span class="p">],</span> <span class="n">value</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">])</span>
        <span class="p">)</span>

    <span class="n">p_df</span> <span class="o">=</span> <span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">convert_to_date</span><span class="p">(</span><span class="n">p_df</span><span class="p">)</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span>
        <span class="n">clean_nerc</span><span class="p">,</span> <span class="n">idx_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;plant_id_eia&quot;</span><span class="p">,</span> <span class="s2">&quot;report_date&quot;</span><span class="p">,</span> <span class="s2">&quot;nerc_region&quot;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">p_df</span></div>



<span class="nd">@asset</span>
<div class="viewcode-block" id="_core_eia860__boiler_generator_assn">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/eia860/index.html#pudl.transform.eia860._core_eia860__boiler_generator_assn">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">_core_eia860__boiler_generator_assn</span><span class="p">(</span>
    <span class="n">raw_eia860__boiler_generator_assn</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pull and transform the boilder generator association table.</span>

<span class="sd">    Transformations include:</span>

<span class="sd">    * Drop non-data rows with EIA notes.</span>
<span class="sd">    * Drop duplicate rows.</span>

<span class="sd">    Args:</span>
<span class="sd">        raw_eia860__boiler_generator_assn: Each entry in this dictionary of DataFrame</span>
<span class="sd">            objects corresponds to a page from the EIA860 form, as reported in the Excel</span>
<span class="sd">            spreadsheets they distribute.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Cleaned ``_core_eia860__boiler_generator_assn`` dataframe ready for harvesting.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Populating the &#39;core_eia860__scd_generators&#39; table</span>
    <span class="n">b_g_df</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">convert_to_date</span><span class="p">(</span><span class="n">raw_eia860__boiler_generator_assn</span><span class="p">)</span>
        <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">convert_cols_dtypes</span><span class="p">,</span> <span class="n">data_source</span><span class="o">=</span><span class="s2">&quot;eia&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">b_g_df</span></div>



<span class="nd">@asset</span>
<div class="viewcode-block" id="_core_eia860__utilities">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/eia860/index.html#pudl.transform.eia860._core_eia860__utilities">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">_core_eia860__utilities</span><span class="p">(</span><span class="n">raw_eia860__utility</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pull and transform the utilities table.</span>

<span class="sd">    Transformations include:</span>

<span class="sd">    * Replace . values with NA.</span>
<span class="sd">    * Fix typos in state abbreviations, convert to uppercase.</span>
<span class="sd">    * Drop address_3 field (all NA).</span>
<span class="sd">    * Combine phone number columns into one field and set values that don&#39;t mimic real</span>
<span class="sd">      US phone numbers to NA.</span>
<span class="sd">    * Convert Y/N/X values to boolean True/False.</span>
<span class="sd">    * Map full spelling onto code values.</span>

<span class="sd">    Args:</span>
<span class="sd">        raw_eia860__utility: The raw ``raw_eia860__utility`` dataframe.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Cleaned ``_core_eia860__utilities`` dataframe ready for harvesting.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Populating the &#39;_core_eia860__utilities&#39; table</span>
    <span class="n">u_df</span> <span class="o">=</span> <span class="n">raw_eia860__utility</span>

    <span class="c1"># Replace empty strings, whitespace, and &#39;.&#39; fields with real NA values</span>
    <span class="n">u_df</span> <span class="o">=</span> <span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">standardize_na_values</span><span class="p">(</span><span class="n">u_df</span><span class="p">)</span>
    <span class="n">u_df</span><span class="p">[</span><span class="s2">&quot;state&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">u_df</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="n">u_df</span><span class="p">[</span><span class="s2">&quot;state&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">u_df</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;QB&quot;</span><span class="p">:</span> <span class="s2">&quot;QC&quot;</span><span class="p">,</span>  <span class="c1"># wrong abbreviation for Quebec</span>
            <span class="s2">&quot;Y&quot;</span><span class="p">:</span> <span class="s2">&quot;NY&quot;</span><span class="p">,</span>  <span class="c1"># Typo</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="c1"># Remove Address 3 column that is all NA</span>
    <span class="n">u_df</span> <span class="o">=</span> <span class="n">u_df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;address_3&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Combine phone number columns into one</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_make_phone_number</span><span class="p">(</span><span class="n">col1</span><span class="p">,</span> <span class="n">col2</span><span class="p">,</span> <span class="n">col3</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Make and validate full phone number separated by dashes.&quot;&quot;&quot;</span>
        <span class="n">p_num</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">col1</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;-&quot;</span>
            <span class="o">+</span> <span class="n">col2</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;-&quot;</span>
            <span class="o">+</span> <span class="n">col3</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># Turn anything that doesn&#39;t match a US phone number format to NA</span>
        <span class="c1"># using noqa to get past flake8 test that give a false positive thinking</span>
        <span class="c1"># that the regex string is supposed to be an f-string and is missing</span>
        <span class="c1"># the it&#39;s designated prefix.</span>
        <span class="k">return</span> <span class="n">p_num</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;^(?!.*\d</span><span class="si">{3}</span><span class="s2">-\d</span><span class="si">{3}</span><span class="s2">-\d</span><span class="si">{4}</span><span class="s2">).*$&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">)</span>

    <span class="n">u_df</span> <span class="o">=</span> <span class="n">u_df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
        <span class="n">phone_number</span><span class="o">=</span><span class="n">_make_phone_number</span><span class="p">(</span>
            <span class="n">u_df</span><span class="o">.</span><span class="n">phone_number_first</span><span class="p">,</span> <span class="n">u_df</span><span class="o">.</span><span class="n">phone_number_mid</span><span class="p">,</span> <span class="n">u_df</span><span class="o">.</span><span class="n">phone_number_last</span>
        <span class="p">),</span>
        <span class="n">phone_number_2</span><span class="o">=</span><span class="n">_make_phone_number</span><span class="p">(</span>
            <span class="n">u_df</span><span class="o">.</span><span class="n">phone_number_first_2</span><span class="p">,</span> <span class="n">u_df</span><span class="o">.</span><span class="n">phone_number_mid_2</span><span class="p">,</span> <span class="n">u_df</span><span class="o">.</span><span class="n">phone_number_last_2</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="n">boolean_columns_to_fix</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;plants_reported_owner&quot;</span><span class="p">,</span>
        <span class="s2">&quot;plants_reported_operator&quot;</span><span class="p">,</span>
        <span class="s2">&quot;plants_reported_asset_manager&quot;</span><span class="p">,</span>
        <span class="s2">&quot;plants_reported_other_relationship&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">boolean_columns_to_fix</span><span class="p">:</span>
        <span class="n">u_df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">u_df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span>
            <span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">to_replace</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="s2">&quot;NaN&quot;</span><span class="p">],</span> <span class="n">value</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">])</span>
        <span class="p">)</span>

    <span class="n">u_df</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">u_df</span><span class="o">.</span><span class="n">astype</span><span class="p">({</span><span class="s2">&quot;utility_id_eia&quot;</span><span class="p">:</span> <span class="s2">&quot;Int64&quot;</span><span class="p">})</span>
        <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">convert_to_date</span><span class="p">)</span>
        <span class="o">.</span><span class="n">fillna</span><span class="p">({</span><span class="s2">&quot;entity_type&quot;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">})</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">u_df</span></div>



<span class="nd">@asset</span>
<div class="viewcode-block" id="_core_eia860__boilers">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/eia860/index.html#pudl.transform.eia860._core_eia860__boilers">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">_core_eia860__boilers</span><span class="p">(</span>
    <span class="n">raw_eia860__emission_control_strategies</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">raw_eia860__boiler_info</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pull and transform the boilers table.</span>

<span class="sd">    Transformations include:</span>

<span class="sd">    * Replace . values with NA.</span>
<span class="sd">    * Convert Y/N/NA values to boolean True/False.</span>
<span class="sd">    * Combine month and year columns into date columns.</span>
<span class="sd">    * Add boiler manufacturer name column.</span>
<span class="sd">    * Convert pre-2012 efficiency percentages to proportions to match post-2012</span>
<span class="sd">      reporting.</span>

<span class="sd">    Args:</span>
<span class="sd">        raw_eia860__emission_control_strategies: DataFrame extracted from EIA forms</span>
<span class="sd">            earlier in the ETL process.</span>
<span class="sd">        raw_eia860__boiler_info: DataFrame extracted from EIA forms earlier in the ETL</span>
<span class="sd">            process.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The transformed boilers table.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Populating the &#39;core_eia860__scd_boilers&#39; table</span>
    <span class="n">b_df</span> <span class="o">=</span> <span class="n">raw_eia860__boiler_info</span>
    <span class="n">ecs</span> <span class="o">=</span> <span class="n">raw_eia860__emission_control_strategies</span>

    <span class="c1"># Combine and replace empty strings, whitespace, and &#39;.&#39; fields with real NA values</span>

    <span class="n">b_df</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">b_df</span><span class="p">,</span> <span class="n">ecs</span><span class="p">],</span> <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;boiler_id&quot;</span><span class="p">,</span> <span class="s2">&quot;plant_id_eia&quot;</span><span class="p">])</span>
        <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">standardize_na_values</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Defensive check: if any values in boiler_fuel_code_5 - boiler_fuel_code_8,</span>
    <span class="c1"># raise error.</span>
    <span class="n">cols_to_check</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;boiler_fuel_code_5&quot;</span><span class="p">,</span>
        <span class="s2">&quot;boiler_fuel_code_6&quot;</span><span class="p">,</span>
        <span class="s2">&quot;boiler_fuel_code_7&quot;</span><span class="p">,</span>
        <span class="s2">&quot;boiler_fuel_code_8&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="k">if</span> <span class="n">b_df</span><span class="p">[</span><span class="n">cols_to_check</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;There are non-null values in boiler_fuel_code #5-8.&quot;</span>
            <span class="s2">&quot;These are currently getting dropped from the final dataframe.&quot;</span>
            <span class="s2">&quot;Please revise the table schema to include these columns.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Replace 0&#39;s with NaN for certain columns.</span>
    <span class="n">zero_columns_to_fix</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;firing_rate_using_coal_tons_per_hour&quot;</span><span class="p">,</span>
        <span class="s2">&quot;firing_rate_using_gas_mcf_per_hour&quot;</span><span class="p">,</span>
        <span class="s2">&quot;firing_rate_using_oil_bbls_per_hour&quot;</span><span class="p">,</span>
        <span class="s2">&quot;firing_rate_using_other_fuels&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fly_ash_reinjection&quot;</span><span class="p">,</span>
        <span class="s2">&quot;hrsg&quot;</span><span class="p">,</span>
        <span class="s2">&quot;new_source_review&quot;</span><span class="p">,</span>
        <span class="s2">&quot;turndown_ratio&quot;</span><span class="p">,</span>
        <span class="s2">&quot;waste_heat_input_mmbtu_per_hour&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">zero_columns_to_fix</span><span class="p">:</span>
        <span class="n">b_df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">b_df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">to_replace</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

    <span class="c1"># Fix unlikely year values for compliance year columns</span>
    <span class="n">year_cols_to_fix</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;compliance_year_nox&quot;</span><span class="p">,</span>
        <span class="s2">&quot;compliance_year_so2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;compliance_year_mercury&quot;</span><span class="p">,</span>
        <span class="s2">&quot;compliance_year_particulate&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">year_cols_to_fix</span><span class="p">:</span>
        <span class="n">b_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">b_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">1900</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NA</span>

    <span class="c1"># Convert boolean columns from Y/N to True/False.</span>
    <span class="n">boolean_columns_to_fix</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;hrsg&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fly_ash_reinjection&quot;</span><span class="p">,</span>
        <span class="s2">&quot;new_source_review&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mercury_emission_control&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ACI&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BH&quot;</span><span class="p">,</span>
        <span class="s2">&quot;DS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;EP&quot;</span><span class="p">,</span>
        <span class="s2">&quot;FGD&quot;</span><span class="p">,</span>
        <span class="s2">&quot;LIJ&quot;</span><span class="p">,</span>
        <span class="s2">&quot;WS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BP&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BR&quot;</span><span class="p">,</span>
        <span class="s2">&quot;EC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;EH&quot;</span><span class="p">,</span>
        <span class="s2">&quot;EK&quot;</span><span class="p">,</span>
        <span class="s2">&quot;EW&quot;</span><span class="p">,</span>
        <span class="s2">&quot;OT&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">boolean_columns_to_fix</span><span class="p">:</span>
        <span class="n">b_df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">b_df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span>
            <span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                <span class="n">to_replace</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="s2">&quot;NaN&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">],</span> <span class="n">value</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># 2009-2012 data uses boolean columns for mercury equipment that</span>
    <span class="c1"># later are converted to strategy codes. Here we convert them manually.</span>

    <span class="n">mercury_boolean_cols</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;ACI&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BH&quot;</span><span class="p">,</span>
        <span class="s2">&quot;DS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;EP&quot;</span><span class="p">,</span>
        <span class="s2">&quot;FGD&quot;</span><span class="p">,</span>
        <span class="s2">&quot;LIJ&quot;</span><span class="p">,</span>
        <span class="s2">&quot;WS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BP&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BR&quot;</span><span class="p">,</span>
        <span class="s2">&quot;EC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;EH&quot;</span><span class="p">,</span>
        <span class="s2">&quot;EK&quot;</span><span class="p">,</span>
        <span class="s2">&quot;EW&quot;</span><span class="p">,</span>
        <span class="s2">&quot;OT&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="c1"># Get list of True columns</span>
    <span class="n">b_df</span><span class="p">[</span><span class="s2">&quot;agg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">b_df</span><span class="p">[</span><span class="n">mercury_boolean_cols</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="kc">True</span><span class="p">)]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>

    <span class="c1"># Split list into columns</span>
    <span class="n">b_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">b_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s2">&quot;agg&quot;</span><span class="p">),</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">b_df</span><span class="p">[</span><span class="s2">&quot;agg&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">index</span><span class="o">=</span><span class="n">b_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="o">.</span><span class="n">add_prefix</span><span class="p">(</span><span class="s2">&quot;mercury_strategy_&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">),</span>
        <span class="p">],</span>
        <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Add three new mercury_strategy columns</span>
    <span class="p">(</span>
        <span class="n">b_df</span><span class="p">[</span><span class="s2">&quot;mercury_control_existing_strategy_4&quot;</span><span class="p">],</span>
        <span class="n">b_df</span><span class="p">[</span><span class="s2">&quot;mercury_control_existing_strategy_5&quot;</span><span class="p">],</span>
        <span class="n">b_df</span><span class="p">[</span><span class="s2">&quot;mercury_control_existing_strategy_6&quot;</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">(</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">b_df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="s2">&quot;mercury_strategy_&quot;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># Get digit from column</span>
        <span class="c1"># Fill strategy codes using columns</span>
        <span class="n">b_df</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;mercury_control_existing_strategy_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">b_df</span><span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;mercury_control_existing_strategy_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">b_df</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>

    <span class="c1"># Convert month and year columns to date.</span>
    <span class="n">b_df</span> <span class="o">=</span> <span class="n">b_df</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">month_year_to_date</span><span class="p">)</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">convert_to_date</span><span class="p">)</span>

    <span class="c1"># Add boiler manufacturer name to column</span>
    <span class="n">b_df</span><span class="p">[</span><span class="s2">&quot;boiler_manufacturer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">b_df</span><span class="o">.</span><span class="n">boiler_manufacturer_code</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
        <span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">label_map</span><span class="p">(</span>
            <span class="n">CODE_METADATA</span><span class="p">[</span><span class="s2">&quot;core_eia__codes_environmental_equipment_manufacturers&quot;</span><span class="p">][</span>
                <span class="s2">&quot;df&quot;</span>
            <span class="p">],</span>
            <span class="n">from_col</span><span class="o">=</span><span class="s2">&quot;code&quot;</span><span class="p">,</span>
            <span class="n">to_col</span><span class="o">=</span><span class="s2">&quot;description&quot;</span><span class="p">,</span>
            <span class="n">null_value</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">b_df</span><span class="p">[</span><span class="s2">&quot;nox_control_manufacturer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">b_df</span><span class="o">.</span><span class="n">nox_control_manufacturer_code</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
        <span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">label_map</span><span class="p">(</span>
            <span class="n">CODE_METADATA</span><span class="p">[</span><span class="s2">&quot;core_eia__codes_environmental_equipment_manufacturers&quot;</span><span class="p">][</span>
                <span class="s2">&quot;df&quot;</span>
            <span class="p">],</span>
            <span class="n">from_col</span><span class="o">=</span><span class="s2">&quot;code&quot;</span><span class="p">,</span>
            <span class="n">to_col</span><span class="o">=</span><span class="s2">&quot;description&quot;</span><span class="p">,</span>
            <span class="n">null_value</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Convert max steam flow from &#39;1000 lbs per hour&#39; to &#39;lbs per hour&#39;</span>
    <span class="n">b_df</span><span class="p">[</span><span class="s2">&quot;max_steam_flow_1000_lbs_per_hour&quot;</span><span class="p">]</span> <span class="o">*=</span> <span class="mi">1000</span>
    <span class="n">b_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">b_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="s2">&quot;1000_lbs_per_hour&quot;</span><span class="p">,</span> <span class="s2">&quot;lbs_per_hour&quot;</span>
    <span class="p">)</span>  <span class="c1"># Rename columns</span>
    <span class="n">b_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;max_steam_flow_lbs_per_hour&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">b_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
        <span class="p">:,</span> <span class="s2">&quot;max_steam_flow_lbs_per_hour&quot;</span>
    <span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Prior to 2012, efficiency was reported as a percentage, rather than</span>
    <span class="c1"># as a proportion, so we need to divide those values by 100.</span>
    <span class="n">b_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">b_df</span><span class="o">.</span><span class="n">report_date</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;</span> <span class="mi">2012</span><span class="p">,</span> <span class="s2">&quot;efficiency_100pct_load&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">b_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">b_df</span><span class="o">.</span><span class="n">report_date</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;</span> <span class="mi">2012</span><span class="p">,</span> <span class="s2">&quot;efficiency_100pct_load&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">100</span>
    <span class="p">)</span>
    <span class="n">b_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">b_df</span><span class="o">.</span><span class="n">report_date</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;</span> <span class="mi">2012</span><span class="p">,</span> <span class="s2">&quot;efficiency_50pct_load&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">b_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">b_df</span><span class="o">.</span><span class="n">report_date</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;</span> <span class="mi">2012</span><span class="p">,</span> <span class="s2">&quot;efficiency_50pct_load&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">100</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">b_df</span></div>



<span class="nd">@asset</span>
<div class="viewcode-block" id="_core_eia860__emissions_control_equipment">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/eia860/index.html#pudl.transform.eia860._core_eia860__emissions_control_equipment">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">_core_eia860__emissions_control_equipment</span><span class="p">(</span>
    <span class="n">raw_eia860__emissions_control_equipment</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pull and transform the emissions control equipment table.&quot;&quot;&quot;</span>
    <span class="c1"># Replace empty strings, whitespace, and &#39;.&#39; fields with real NA values</span>
    <span class="n">emce_df</span> <span class="o">=</span> <span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">standardize_na_values</span><span class="p">(</span>
        <span class="n">raw_eia860__emissions_control_equipment</span>
    <span class="p">)</span>

    <span class="c1"># Spot fix bad months</span>
    <span class="n">emce_df</span><span class="p">[</span><span class="s2">&quot;emission_control_operating_month&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">emce_df</span><span class="p">[</span>
        <span class="s2">&quot;emission_control_operating_month&quot;</span>
    <span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="s2">&quot;88&quot;</span><span class="p">:</span> <span class="s2">&quot;8&quot;</span><span class="p">})</span>
    <span class="c1"># Fill in values with a year not a month based on later years that do have a month</span>
    <span class="c1"># I thought about doing some sort of backfill here, but decided not to because</span>
    <span class="c1"># emission_control_id_pudl is not guaranteed to be consistent over time</span>
    <span class="n">bad_month_1</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">emce_df</span><span class="p">[</span><span class="s2">&quot;report_year&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2013</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">emce_df</span><span class="p">[</span><span class="s2">&quot;plant_id_eia&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">10346</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">emce_df</span><span class="p">[</span><span class="s2">&quot;nox_control_id_eia&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;BOIL01&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">bad_month_2</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">emce_df</span><span class="p">[</span><span class="s2">&quot;report_year&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2013</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">emce_df</span><span class="p">[</span><span class="s2">&quot;plant_id_eia&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">10202</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">emce_df</span><span class="p">[</span><span class="s2">&quot;particulate_control_id_eia&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;5PMDC&quot;</span><span class="p">,</span> <span class="s2">&quot;5PPPT&quot;</span><span class="p">]))</span>
    <span class="p">)</span>
    <span class="n">bad_month_3</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">emce_df</span><span class="p">[</span><span class="s2">&quot;report_year&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2013</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">emce_df</span><span class="p">[</span><span class="s2">&quot;plant_id_eia&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3131</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">emce_df</span><span class="p">[</span><span class="s2">&quot;emission_control_operating_year&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;2005&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">bad_month_4</span> <span class="o">=</span> <span class="p">(</span><span class="n">emce_df</span><span class="p">[</span><span class="s2">&quot;report_year&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2013</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">emce_df</span><span class="p">[</span><span class="s2">&quot;plant_id_eia&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">10405</span><span class="p">)</span>
    <span class="n">bad_month_5</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">emce_df</span><span class="p">[</span><span class="s2">&quot;report_year&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2013</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">emce_df</span><span class="p">[</span><span class="s2">&quot;plant_id_eia&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">50661</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">emce_df</span><span class="p">[</span><span class="s2">&quot;nox_control_id_eia&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;ASNCR&quot;</span><span class="p">,</span> <span class="s2">&quot;BSNCR&quot;</span><span class="p">]))</span>
    <span class="p">)</span>
    <span class="n">bad_month_6</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">emce_df</span><span class="p">[</span><span class="s2">&quot;report_year&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2013</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">emce_df</span><span class="p">[</span><span class="s2">&quot;plant_id_eia&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4054</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">emce_df</span><span class="p">[</span><span class="s2">&quot;emission_control_operating_year&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;2011&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">bad_month_7</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">emce_df</span><span class="p">[</span><span class="s2">&quot;report_year&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2013</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">emce_df</span><span class="p">[</span><span class="s2">&quot;plant_id_eia&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">50544</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">emce_df</span><span class="p">[</span><span class="s2">&quot;emission_control_operating_year&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;1990&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">bad_month_8</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">emce_df</span><span class="p">[</span><span class="s2">&quot;report_year&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2013</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">emce_df</span><span class="p">[</span><span class="s2">&quot;plant_id_eia&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">50189</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">emce_df</span><span class="p">[</span><span class="s2">&quot;particulate_control_id_eia&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;EGS1&quot;</span><span class="p">,</span> <span class="s2">&quot;EGS2&quot;</span><span class="p">,</span> <span class="s2">&quot;ESP1CB&quot;</span><span class="p">]))</span>
    <span class="p">)</span>

    <span class="c1"># Add this conditional in case we&#39;re doing the fast ETL with one year of data</span>
    <span class="c1"># (in which case the assertions will fail)</span>
    <span class="k">if</span> <span class="mi">2013</span> <span class="ow">in</span> <span class="n">emce_df</span><span class="o">.</span><span class="n">report_year</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">emce_df</span><span class="p">[</span><span class="n">bad_month_1</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="n">emce_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">bad_month_1</span><span class="p">,</span> <span class="s2">&quot;emission_control_operating_month&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">emce_df</span><span class="p">[</span><span class="n">bad_month_2</span><span class="p">])</span> <span class="o">==</span> <span class="mi">4</span>
        <span class="n">emce_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">bad_month_2</span><span class="p">,</span> <span class="s2">&quot;emission_control_operating_month&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">emce_df</span><span class="p">[</span><span class="n">bad_month_3</span><span class="p">])</span> <span class="o">==</span> <span class="mi">4</span>
        <span class="n">emce_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">bad_month_3</span><span class="p">,</span> <span class="s2">&quot;emission_control_operating_month&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">emce_df</span><span class="p">[</span><span class="n">bad_month_4</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="n">emce_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">bad_month_4</span><span class="p">,</span> <span class="s2">&quot;emission_control_operating_month&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">emce_df</span><span class="p">[</span><span class="n">bad_month_5</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span>
        <span class="n">emce_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">bad_month_5</span><span class="p">,</span> <span class="s2">&quot;emission_control_operating_month&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">emce_df</span><span class="p">[</span><span class="n">bad_month_6</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span>
        <span class="n">emce_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">bad_month_6</span><span class="p">,</span> <span class="s2">&quot;emission_control_operating_month&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">emce_df</span><span class="p">[</span><span class="n">bad_month_7</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="n">emce_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">bad_month_7</span><span class="p">,</span> <span class="s2">&quot;emission_control_operating_month&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">emce_df</span><span class="p">[</span><span class="n">bad_month_8</span><span class="p">])</span> <span class="o">==</span> <span class="mi">9</span>
        <span class="n">emce_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">bad_month_8</span><span class="p">,</span> <span class="s2">&quot;emission_control_operating_month&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span>

    <span class="c1"># Convert month-year columns to a single date column</span>
    <span class="n">emce_df</span> <span class="o">=</span> <span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">convert_to_date</span><span class="p">(</span>
        <span class="n">df</span><span class="o">=</span><span class="n">emce_df</span><span class="p">,</span>
        <span class="n">date_col</span><span class="o">=</span><span class="s2">&quot;emission_control_operating_date&quot;</span><span class="p">,</span>
        <span class="n">year_col</span><span class="o">=</span><span class="s2">&quot;emission_control_operating_year&quot;</span><span class="p">,</span>
        <span class="n">month_col</span><span class="o">=</span><span class="s2">&quot;emission_control_operating_month&quot;</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span>
        <span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">convert_to_date</span><span class="p">,</span>
        <span class="n">date_col</span><span class="o">=</span><span class="s2">&quot;emission_control_retirement_date&quot;</span><span class="p">,</span>
        <span class="n">year_col</span><span class="o">=</span><span class="s2">&quot;emission_control_retirement_year&quot;</span><span class="p">,</span>
        <span class="n">month_col</span><span class="o">=</span><span class="s2">&quot;emission_control_retirement_month&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Convert acid gas control column to boolean</span>
    <span class="n">emce_df</span> <span class="o">=</span> <span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">convert_col_to_bool</span><span class="p">(</span>
        <span class="n">df</span><span class="o">=</span><span class="n">emce_df</span><span class="p">,</span> <span class="n">col_name</span><span class="o">=</span><span class="s2">&quot;acid_gas_control&quot;</span><span class="p">,</span> <span class="n">true_values</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Y&quot;</span><span class="p">],</span> <span class="n">false_values</span><span class="o">=</span><span class="p">[]</span>
    <span class="p">)</span>
    <span class="c1"># Add a emission_control_id_pudl as a primary key. This is not unique over years.</span>
    <span class="c1"># We could maybe try and do this, but not doing it now.</span>
    <span class="n">emce_df</span><span class="p">[</span><span class="s2">&quot;emission_control_id_pudl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">emce_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;report_year&quot;</span><span class="p">,</span> <span class="s2">&quot;plant_id_eia&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">cumcount</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="p">)</span>
    <span class="c1"># Fix outlier value in emission_control_equipment_cost. We know this is an</span>
    <span class="c1"># outlier because it is the highest value reported in the dataset and</span>
    <span class="c1"># the other years from the same plant show that it likely contains three</span>
    <span class="c1"># extra zeros. We use the primary keys to spot fix the value.</span>
    <span class="n">outlier_primary_keys</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">emce_df</span><span class="p">[</span><span class="s2">&quot;report_year&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2017</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">emce_df</span><span class="p">[</span><span class="s2">&quot;plant_id_eia&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">57794</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">emce_df</span><span class="p">[</span><span class="s2">&quot;emission_control_equipment_cost&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3200000</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">emce_df</span><span class="p">[</span><span class="n">outlier_primary_keys</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;Only expecting two spot fixed values here&quot;</span><span class="p">)</span>

    <span class="n">emce_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
        <span class="n">outlier_primary_keys</span><span class="p">,</span>
        <span class="s2">&quot;emission_control_equipment_cost&quot;</span><span class="p">,</span>
    <span class="p">]</span> <span class="o">=</span> <span class="mi">3200</span>

    <span class="c1"># Convert thousands of dollars to dollars:</span>
    <span class="n">emce_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;emission_control_equipment_cost&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="mf">1000.0</span> <span class="o">*</span> <span class="n">emce_df</span><span class="p">[</span><span class="s2">&quot;emission_control_equipment_cost&quot;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">emce_df</span></div>



<span class="nd">@asset</span>
<div class="viewcode-block" id="_core_eia860__boiler_emissions_control_equipment_assn">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/eia860/index.html#pudl.transform.eia860._core_eia860__boiler_emissions_control_equipment_assn">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">_core_eia860__boiler_emissions_control_equipment_assn</span><span class="p">(</span>
    <span class="n">raw_eia860__boiler_so2</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">raw_eia860__boiler_mercury</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">raw_eia860__boiler_nox</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">raw_eia860__boiler_particulate</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pull and transform the emissions control &lt;&gt; boiler ID link tables.</span>

<span class="sd">    Args:</span>
<span class="sd">        raw_eia860__boiler_so2: Raw EIA 860 boiler to SO2 emission control equipment</span>
<span class="sd">            association table.</span>
<span class="sd">        raw_eia860__boiler_mercury: Raw EIA 860 boiler to mercury emission control</span>
<span class="sd">            equipment association table.</span>
<span class="sd">        raw_eia860__boiler_nox: Raw EIA 860 boiler to nox emission control equipment</span>
<span class="sd">            association table.</span>
<span class="sd">        raw_eia860__boiler_particulate: Raw EIA 860 boiler to particulate emission</span>
<span class="sd">            control equipment association table.</span>
<span class="sd">        raw_eia860__boiler_cooling: Raw EIA 860 boiler to cooling equipment association</span>
<span class="sd">            table.</span>
<span class="sd">        raw_eia860__boiler_stack_flue: Raw EIA 860 boiler to stack flue equipment</span>
<span class="sd">            association table.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A combination of all the emission control equipment association tables.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">raw_tables</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">raw_eia860__boiler_so2</span><span class="p">,</span>
        <span class="n">raw_eia860__boiler_mercury</span><span class="p">,</span>
        <span class="n">raw_eia860__boiler_nox</span><span class="p">,</span>
        <span class="n">raw_eia860__boiler_particulate</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">dfs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">raw_tables</span><span class="p">:</span>
        <span class="c1"># There are some utilities that report the same emissions control equipment.</span>
        <span class="c1"># Drop duplicate rows where the only difference is utility.</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span>
            <span class="n">subset</span><span class="o">=</span><span class="p">[</span>
                <span class="n">x</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">columns</span>
                <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;utility_id_eia&quot;</span><span class="p">,</span> <span class="s2">&quot;utility_name_eia&quot;</span><span class="p">]</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="c1"># Melt the table so that the control id column is in one row and the type of</span>
        <span class="c1"># control id (the pollutant type) is in another column. This makes it easier</span>
        <span class="c1"># combine all of the tables for different pollutants.</span>
        <span class="n">value_col</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">table</span> <span class="k">if</span> <span class="s2">&quot;control_id_eia&quot;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">]</span>
        <span class="n">id_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">table</span> <span class="k">if</span> <span class="s2">&quot;control_id_eia&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">col</span><span class="p">]</span>
        <span class="c1"># Each table should only have one column with control_id_eia in the name</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">value_col</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span>
            <span class="n">table</span><span class="p">,</span>
            <span class="n">value_vars</span><span class="o">=</span><span class="n">value_col</span><span class="p">,</span>
            <span class="n">id_vars</span><span class="o">=</span><span class="n">id_cols</span><span class="p">,</span>
            <span class="n">var_name</span><span class="o">=</span><span class="s2">&quot;emission_control_id_type&quot;</span><span class="p">,</span>
            <span class="n">value_name</span><span class="o">=</span><span class="s2">&quot;emission_control_id_eia&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
    <span class="n">bece_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dfs</span><span class="p">)</span>

    <span class="c1"># The report_year column must be report_date in order for the harvcesting process</span>
    <span class="c1"># to work on this table. It later gets converted back to report_year.</span>
    <span class="n">bece_df</span> <span class="o">=</span> <span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">convert_to_date</span><span class="p">(</span>
        <span class="n">df</span><span class="o">=</span><span class="n">bece_df</span><span class="p">,</span> <span class="n">year_col</span><span class="o">=</span><span class="s2">&quot;report_year&quot;</span><span class="p">,</span> <span class="n">date_col</span><span class="o">=</span><span class="s2">&quot;report_date&quot;</span>
    <span class="p">)</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
        <span class="c1"># Remove the string _control_id_eia from the control_id_type column so it just</span>
        <span class="c1"># shows the prefix (i.e., the name of the pollutant: so2, nox, etc.)</span>
        <span class="n">emission_control_id_type</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">emission_control_id_type</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
            <span class="s2">&quot;_control_id_eia&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="c1"># There are some records that don&#39;t have an emission control id that are not</span>
    <span class="c1"># helpful so we drop them.</span>
    <span class="n">bece_df</span> <span class="o">=</span> <span class="n">bece_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s2">&quot;emission_control_id_eia&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">bece_df</span></div>



<span class="nd">@asset</span>
<div class="viewcode-block" id="_core_eia860__boiler_cooling">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/eia860/index.html#pudl.transform.eia860._core_eia860__boiler_cooling">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">_core_eia860__boiler_cooling</span><span class="p">(</span>
    <span class="n">raw_eia860__boiler_cooling</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pull and transform the EIA 860 boiler to cooler ID table.</span>

<span class="sd">    Args:</span>
<span class="sd">        raw_eia860__boiler_cooling: Raw EIA 860 boiler to cooler ID association table.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A cleaned and normalized version of the EIA boiler to cooler ID table.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Replace empty strings, whitespace, and &#39;.&#39; fields with real NA values</span>
    <span class="n">bc_assn</span> <span class="o">=</span> <span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">standardize_na_values</span><span class="p">(</span><span class="n">raw_eia860__boiler_cooling</span><span class="p">)</span>
    <span class="c1"># Replace the report year col with a report date col for the harvesting process</span>
    <span class="n">bc_assn</span> <span class="o">=</span> <span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">convert_to_date</span><span class="p">(</span>
        <span class="n">df</span><span class="o">=</span><span class="n">bc_assn</span><span class="p">,</span> <span class="n">year_col</span><span class="o">=</span><span class="s2">&quot;report_year&quot;</span><span class="p">,</span> <span class="n">date_col</span><span class="o">=</span><span class="s2">&quot;report_date&quot;</span>
    <span class="p">)</span>
    <span class="c1"># Drop rows with no cooling ID and just in case, drop duplicate</span>
    <span class="n">bc_assn</span> <span class="o">=</span> <span class="n">bc_assn</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s2">&quot;cooling_id_eia&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">bc_assn</span></div>



<span class="nd">@asset</span>
<div class="viewcode-block" id="_core_eia860__boiler_stack_flue">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/eia860/index.html#pudl.transform.eia860._core_eia860__boiler_stack_flue">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">_core_eia860__boiler_stack_flue</span><span class="p">(</span>
    <span class="n">raw_eia860__boiler_stack_flue</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pull and transform the EIA 860 boiler to stack flue ID table.</span>

<span class="sd">    Args:</span>
<span class="sd">        raw_eia860__boiler_stack_flue: Raw EIA 860 boiler to stack flue ID association</span>
<span class="sd">            table.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A cleaned and normalized version of the EIA boiler to stack flue ID table.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Replace empty strings, whitespace, and &#39;.&#39; fields with real NA values</span>
    <span class="n">bsf_assn</span> <span class="o">=</span> <span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">standardize_na_values</span><span class="p">(</span><span class="n">raw_eia860__boiler_stack_flue</span><span class="p">)</span>
    <span class="c1"># Replace the report year col with a report date col for the harvesting process</span>
    <span class="n">bsf_assn</span> <span class="o">=</span> <span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">convert_to_date</span><span class="p">(</span>
        <span class="n">df</span><span class="o">=</span><span class="n">bsf_assn</span><span class="p">,</span> <span class="n">year_col</span><span class="o">=</span><span class="s2">&quot;report_year&quot;</span><span class="p">,</span> <span class="n">date_col</span><span class="o">=</span><span class="s2">&quot;report_date&quot;</span>
    <span class="p">)</span>
    <span class="c1"># Drop duplicates</span>
    <span class="n">bsf_assn</span> <span class="o">=</span> <span class="n">bsf_assn</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
    <span class="c1"># Create a primary key column for stack flue IDs.</span>
    <span class="c1"># Prior to 2013, EIA reported a stack_id_eia and a flue_id_eia. Sometimes there</span>
    <span class="c1"># was a m:m relationship between these values. 2013 and later, EIA published a</span>
    <span class="c1"># stack_flue_id_eia column the represented either the stack or flue id.</span>
    <span class="c1"># In order to create a primary key with no NA values, we create a new</span>
    <span class="c1"># stack_flue_id_pudl column. We do this instead of backfilling stack_flue_id_pudl</span>
    <span class="c1"># because stack_flue_id_pudl would not be a unique identifier in older years due to</span>
    <span class="c1"># the m:m relationship between stack_id and flue_id. We also don&#39;t forward fill</span>
    <span class="c1"># the individual stack or flue id columns because we can&#39;t be sure whether a</span>
    <span class="c1"># stack_flue_id_eia value is the stack or flue id. And we don&#39;t want to</span>
    <span class="c1"># missrepresent complicated relationships between stacks and flues. Also there&#39;s</span>
    <span class="c1"># several instances where flue_id_eia is NA (hence the last fillna(x.stack_id_eia))</span>
    <span class="n">bsf_assn</span> <span class="o">=</span> <span class="n">bsf_assn</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
        <span class="n">stack_flue_id_pudl</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">stack_flue_id_eia</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span>
            <span class="n">x</span><span class="o">.</span><span class="n">stack_id_eia</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">flue_id_eia</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">stack_id_eia</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">bsf_assn</span></div>



<span class="nd">@asset</span><span class="p">(</span><span class="n">io_manager_key</span><span class="o">=</span><span class="s2">&quot;pudl_io_manager&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="_core_eia860__cooling_equipment">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/eia860/index.html#pudl.transform.eia860._core_eia860__cooling_equipment">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">_core_eia860__cooling_equipment</span><span class="p">(</span>
    <span class="n">raw_eia860__cooling_equipment</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">_core_censuspep__yearly_geocodes</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Transform the EIA 860 cooling equipment table.</span>

<span class="sd">    - spot clean year values before converting to dates</span>
<span class="sd">    - standardize water rate units to gallons per minute (2009-2013 used cubic</span>
<span class="sd">      feet per second)</span>
<span class="sd">    - convert kilodollars to normal dollars</span>

<span class="sd">    Note that the &quot;power_requirement_mw&quot; field is erroneously reported as</span>
<span class="sd">    &quot;_kwh&quot; in the raw data for 2009, 2010, and 2011, even though the values are</span>
<span class="sd">    in MW. This is corroborated by the values for these plants matching up with</span>
<span class="sd">    the stated MW values in later years. Additionally, the PDF form for those</span>
<span class="sd">    years indicates that the value should be in MW, and KWh isn&#39;t even a power</span>
<span class="sd">    measurement.</span>

<span class="sd">    In 2009, we have two incorrectly entered ``cooling_type`` values of ``HR``,</span>
<span class="sd">    for utility ID 14328, plant IDs 56532/56476, and cooling ID ACC1. This</span>
<span class="sd">    corresponds to the Colusa and Gateway generating stations run by PG&amp;E. In</span>
<span class="sd">    all later years, these cooling facilities are marked as ``DC``, or &quot;dry</span>
<span class="sd">    cooling&quot;; however, ``HR`` looks like the codes for hybrid systems (the</span>
<span class="sd">    others are ``HRC``, ``HRF``, ``HRI``). As such we drop the ``HR`` code</span>
<span class="sd">    completely in ``pudl.metadata.codes``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ce_df</span> <span class="o">=</span> <span class="n">raw_eia860__cooling_equipment</span>

    <span class="c1"># Generic cleaning</span>
    <span class="n">ce_df</span> <span class="o">=</span> <span class="n">ce_df</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">standardize_na_values</span><span class="p">)</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span>
        <span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">add_fips_ids</span><span class="p">,</span> <span class="n">_core_censuspep__yearly_geocodes</span>
    <span class="p">)</span>

    <span class="c1"># Spot cleaning and date conversion</span>
    <span class="n">ce_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
        <span class="n">ce_df</span><span class="p">[</span><span class="s2">&quot;chlorine_equipment_operating_year&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">971</span><span class="p">,</span>
        <span class="s2">&quot;chlorine_equipment_operating_year&quot;</span><span class="p">,</span>
    <span class="p">]</span> <span class="o">=</span> <span class="mi">1971</span>
    <span class="n">ce_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ce_df</span><span class="p">[</span><span class="s2">&quot;pond_operating_year&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;pond_operating_year&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">ce_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ce_df</span><span class="p">[</span><span class="s2">&quot;tower_operating_year&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">974</span><span class="p">,</span> <span class="s2">&quot;tower_operating_year&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1974</span>
    <span class="n">ce_df</span> <span class="o">=</span> <span class="n">ce_df</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">month_year_to_date</span><span class="p">)</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span>
        <span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">convert_to_date</span>
    <span class="p">)</span>

    <span class="c1"># There&#39;s one row which has an NA cooling_id_eia, which we mark as &quot;PLANT&quot;</span>
    <span class="c1"># to allow it to be in a DB primary key.</span>
    <span class="n">ce_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
        <span class="p">(</span><span class="n">ce_df</span><span class="p">[</span><span class="s2">&quot;plant_id_eia&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6285</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">ce_df</span><span class="p">[</span><span class="s2">&quot;utility_id_eia&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">7353</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">ce_df</span><span class="p">[</span><span class="s2">&quot;report_date&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;2016-01-01&quot;</span><span class="p">),</span>
        <span class="s2">&quot;cooling_id_eia&quot;</span><span class="p">,</span>
    <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;PLANT&quot;</span>

    <span class="c1"># Convert cubic feet/second to gallons/minute</span>
    <span class="n">cfs_in_gpm</span> <span class="o">=</span> <span class="mf">448.8311688</span>
    <span class="n">ce_df</span> <span class="o">=</span> <span class="n">ce_df</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;tower_water_rate_100pct_gallons_per_minute&quot;</span><span class="p">:</span> <span class="n">ce_df</span><span class="o">.</span><span class="n">tower_water_rate_100pct_cubic_feet_per_second</span>
            <span class="o">*</span> <span class="n">cfs_in_gpm</span><span class="p">,</span>
            <span class="s2">&quot;intake_rate_100pct_gallons_per_minute&quot;</span><span class="p">:</span> <span class="n">ce_df</span><span class="o">.</span><span class="n">intake_rate_100pct_cubic_feet_per_second</span>
            <span class="o">*</span> <span class="n">cfs_in_gpm</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span>
        <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
            <span class="s2">&quot;tower_water_rate_100pct_cubic_feet_per_second&quot;</span><span class="p">,</span>
            <span class="s2">&quot;intake_rate_100pct_cubic_feet_per_second&quot;</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">)</span>

    <span class="c1"># Convert thousands of dollars to dollars and remove suffix from column name</span>
    <span class="n">ce_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">ce_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_thousand_dollars&quot;</span><span class="p">)]</span> <span class="o">*=</span> <span class="mi">1000</span>
    <span class="n">ce_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">ce_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_thousand_dollars&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># Encoding is required here because this table is not yet getting harvested.</span>
    <span class="k">return</span> <span class="n">apply_pudl_dtypes</span><span class="p">(</span><span class="n">ce_df</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s2">&quot;eia&quot;</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">PUDL_PACKAGE</span><span class="o">.</span><span class="n">encode</span><span class="p">)</span></div>



<span class="nd">@asset_check</span><span class="p">(</span><span class="n">asset</span><span class="o">=</span><span class="n">_core_eia860__cooling_equipment</span><span class="p">,</span> <span class="n">blocking</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<div class="viewcode-block" id="cooling_equipment_continuity">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/eia860/index.html#pudl.transform.eia860.cooling_equipment_continuity">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">cooling_equipment_continuity</span><span class="p">(</span><span class="n">cooling_equipment</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check to see if columns vary as slowly as expected.</span>

<span class="sd">    2024-03-04: pond cost, tower cost, and tower cost all have one-off</span>
<span class="sd">    discontinuities that are worth investigating, but we&#39;re punting on that</span>
<span class="sd">    investigation since we&#39;re out of time.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">pudl</span><span class="o">.</span><span class="n">validate</span><span class="o">.</span><span class="n">group_mean_continuity_check</span><span class="p">(</span>
        <span class="n">df</span><span class="o">=</span><span class="n">cooling_equipment</span><span class="p">,</span>
        <span class="n">thresholds</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;intake_rate_100pct_gallons_per_minute&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
            <span class="s2">&quot;outlet_distance_shore_feet&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
            <span class="s2">&quot;outlet_distance_surface_feet&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
            <span class="s2">&quot;pond_cost&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
            <span class="s2">&quot;pond_surface_area_acres&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
            <span class="s2">&quot;pond_volume_acre_feet&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span>
            <span class="s2">&quot;power_requirement_mw&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
            <span class="s2">&quot;plant_summer_capacity_mw&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
            <span class="s2">&quot;tower_cost&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
            <span class="s2">&quot;tower_water_rate_100pct_gallons_per_minute&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="n">groupby_col</span><span class="o">=</span><span class="s2">&quot;report_date&quot;</span><span class="p">,</span>
        <span class="n">n_outliers_allowed</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span></div>



<span class="nd">@asset</span><span class="p">(</span><span class="n">io_manager_key</span><span class="o">=</span><span class="s2">&quot;pudl_io_manager&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="_core_eia860__fgd_equipment">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/eia860/index.html#pudl.transform.eia860._core_eia860__fgd_equipment">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">_core_eia860__fgd_equipment</span><span class="p">(</span>
    <span class="n">raw_eia860__fgd_equipment</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">_core_censuspep__yearly_geocodes</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Transform the EIA 860 FGD equipment table.</span>

<span class="sd">    Transformations include:</span>
<span class="sd">    - convert string booleans to boolean dtypes, and mixed strings/numbers to numbers</span>
<span class="sd">    - convert kilodollars to normal dollars</span>
<span class="sd">    - handle mixed reporting of percentages</span>
<span class="sd">    - spot fix a duplicated SO2 control ID</span>
<span class="sd">    - change an old water code to preserve detail of reporting over time</span>
<span class="sd">    - add manufacturer name based on the code reported</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fgd_df</span> <span class="o">=</span> <span class="n">raw_eia860__fgd_equipment</span>

    <span class="c1"># Generic cleaning</span>
    <span class="n">fgd_df</span> <span class="o">=</span> <span class="n">fgd_df</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">standardize_na_values</span><span class="p">)</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span>
        <span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">add_fips_ids</span><span class="p">,</span> <span class="n">_core_censuspep__yearly_geocodes</span>
    <span class="p">)</span>

    <span class="c1"># Spot cleaning and date conversion</span>
    <span class="n">fgd_df</span> <span class="o">=</span> <span class="n">fgd_df</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">month_year_to_date</span><span class="p">)</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span>
        <span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">convert_to_date</span>
    <span class="p">)</span>

    <span class="c1"># Handle mixed boolean types in control flag column</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="s2">&quot;byproduct_recovery&quot;</span><span class="p">,</span>
        <span class="s2">&quot;flue_gas_bypass_fgd&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sludge_pond&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sludge_pond_lined&quot;</span><span class="p">,</span>
    <span class="p">]:</span>
        <span class="n">fgd_df</span> <span class="o">=</span> <span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">convert_col_to_bool</span><span class="p">(</span>
            <span class="n">df</span><span class="o">=</span><span class="n">fgd_df</span><span class="p">,</span>
            <span class="n">col_name</span><span class="o">=</span><span class="n">col</span><span class="p">,</span>
            <span class="n">true_values</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">],</span>
            <span class="n">false_values</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">],</span>
        <span class="p">)</span>

    <span class="c1"># Convert thousands of dollars to dollars and remove suffix from column name</span>
    <span class="n">fgd_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">fgd_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_thousand_dollars&quot;</span><span class="p">)]</span> <span class="o">*=</span> <span class="mi">1000</span>
    <span class="n">fgd_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">fgd_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_thousand_dollars&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># Deal with mixed 0-1 and 0-100 percentage reporting</span>
    <span class="n">pct_cols</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;flue_gas_entering_fgd_pct_of_total&quot;</span><span class="p">,</span>
        <span class="s2">&quot;so2_removal_efficiency_design&quot;</span><span class="p">,</span>
        <span class="s2">&quot;specifications_of_coal_ash&quot;</span><span class="p">,</span>
        <span class="s2">&quot;specifications_of_coal_sulfur&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">fgd_df</span> <span class="o">=</span> <span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">standardize_percentages_ratio</span><span class="p">(</span>
        <span class="n">frac_df</span><span class="o">=</span><span class="n">fgd_df</span><span class="p">,</span> <span class="n">mixed_cols</span><span class="o">=</span><span class="n">pct_cols</span><span class="p">,</span> <span class="n">years_to_standardize</span><span class="o">=</span><span class="p">[</span><span class="mi">2009</span><span class="p">,</span> <span class="mi">2010</span><span class="p">,</span> <span class="mi">2011</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="c1"># Fix duplicated SO2 control ID for plant 6016 in 2011</span>
    <span class="c1"># Every other year 2009-2012 &quot;01&quot; refers to 2009 operating FGD equipment, and &quot;1&quot;</span>
    <span class="c1"># refers to the 1976 operating FGD equipment. In 2011 the plant reports two &quot;1&quot;</span>
    <span class="c1"># plants, so we change the SO2 control ID to &quot;01&quot; for the 2009 unit to preserve</span>
    <span class="c1"># uniqueness.</span>
    <span class="n">fgd_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
        <span class="p">(</span><span class="n">fgd_df</span><span class="o">.</span><span class="n">plant_id_eia</span> <span class="o">==</span> <span class="mi">6016</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">fgd_df</span><span class="o">.</span><span class="n">report_date</span> <span class="o">==</span> <span class="s2">&quot;2011-01-01&quot;</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">fgd_df</span><span class="o">.</span><span class="n">fgd_operating_date</span> <span class="o">==</span> <span class="s2">&quot;2009-03-01&quot;</span><span class="p">),</span>
        <span class="s2">&quot;so2_control_id_eia&quot;</span><span class="p">,</span>
    <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;01&quot;</span>

    <span class="c1"># Add a manufacturer name from the code.</span>
    <span class="n">fgd_df</span><span class="p">[</span><span class="s2">&quot;fgd_manufacturer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fgd_df</span><span class="o">.</span><span class="n">fgd_manufacturer_code</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
        <span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">label_map</span><span class="p">(</span>
            <span class="n">CODE_METADATA</span><span class="p">[</span><span class="s2">&quot;core_eia__codes_environmental_equipment_manufacturers&quot;</span><span class="p">][</span>
                <span class="s2">&quot;df&quot;</span>
            <span class="p">],</span>
            <span class="n">from_col</span><span class="o">=</span><span class="s2">&quot;code&quot;</span><span class="p">,</span>
            <span class="n">to_col</span><span class="o">=</span><span class="s2">&quot;description&quot;</span><span class="p">,</span>
            <span class="n">null_value</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Check for uniqueness of index and handle special case duplicates.</span>
    <span class="n">pkey</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;plant_id_eia&quot;</span><span class="p">,</span> <span class="s2">&quot;so2_control_id_eia&quot;</span><span class="p">,</span> <span class="s2">&quot;report_date&quot;</span><span class="p">]</span>
    <span class="n">fgd_df</span> <span class="o">=</span> <span class="n">pudl</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">dedupe_and_drop_nas</span><span class="p">(</span><span class="n">fgd_df</span><span class="p">,</span> <span class="n">primary_key_cols</span><span class="o">=</span><span class="n">pkey</span><span class="p">)</span>

    <span class="c1"># After 2012, treated wastewater and water get lumped into what was previously</span>
    <span class="c1"># reported as just a water code. Let&#39;s rename this code to &quot;W&quot; to preserve detail in</span>
    <span class="c1"># earlier years.</span>
    <span class="k">for</span> <span class="n">sorbent_col</span> <span class="ow">in</span> <span class="p">(</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">fgd_df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="s2">&quot;sorbent_type&quot;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">):</span>
        <span class="n">fgd_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">fgd_df</span><span class="p">[</span><span class="n">sorbent_col</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;WT&quot;</span><span class="p">,</span> <span class="n">sorbent_col</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;W&quot;</span>

    <span class="c1"># Handle some non-numeric values in the pond landfill requirements column</span>
    <span class="n">fgd_df</span><span class="p">[</span><span class="s2">&quot;pond_landfill_requirements_acre_foot_per_year&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span>
        <span class="n">fgd_df</span><span class="o">.</span><span class="n">pond_landfill_requirements_acre_foot_per_year</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Encoding required because this isn&#39;t fed into harvesting yet.</span>
    <span class="k">return</span> <span class="n">PUDL_PACKAGE</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">fgd_df</span><span class="p">)</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">apply_pudl_dtypes</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>



<span class="nd">@asset_check</span><span class="p">(</span><span class="n">asset</span><span class="o">=</span><span class="n">_core_eia860__fgd_equipment</span><span class="p">,</span> <span class="n">blocking</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<div class="viewcode-block" id="fgd_equipment_continuity">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/eia860/index.html#pudl.transform.eia860.fgd_equipment_continuity">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">fgd_equipment_continuity</span><span class="p">(</span><span class="n">fgd</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check to see if columns vary as slowly as expected.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">pudl</span><span class="o">.</span><span class="n">validate</span><span class="o">.</span><span class="n">group_mean_continuity_check</span><span class="p">(</span>
        <span class="n">df</span><span class="o">=</span><span class="n">fgd</span><span class="p">,</span>
        <span class="n">thresholds</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;flue_gas_exit_rate_cubic_feet_per_minute&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
            <span class="s2">&quot;flue_gas_exit_temperature_fahrenheit&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
            <span class="s2">&quot;pond_landfill_requirements_acre_foot_per_year&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
            <span class="s2">&quot;so2_removal_efficiency_design&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
            <span class="s2">&quot;so2_emission_rate_lbs_per_hour&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
            <span class="s2">&quot;specifications_of_coal_ash&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
            <span class="s2">&quot;specifications_of_coal_sulfur&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>  <span class="c1"># TODO (2024-03-14): Investigate</span>
            <span class="s2">&quot;plant_summer_capacity_mw&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
            <span class="s2">&quot;total_fgd_equipment_cost&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="n">groupby_col</span><span class="o">=</span><span class="s2">&quot;report_date&quot;</span><span class="p">,</span>
        <span class="n">n_outliers_allowed</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span></div>

</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2016-2026, Catalyst Cooperative, CC-BY-4.0
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script src="../../../_static/documentation_options.js?v=11fc87b4"></script>
    <script src="../../../_static/doctools.js?v=fd6eb6e6"></script>
    <script src="../../../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script src="../../../_static/scripts/furo.js?v=46bd48cc"></script>
    </body>
</html>