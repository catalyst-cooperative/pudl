<!doctype html>
<html class="no-js" lang="en" data-content_root="../../../">
  <head><meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light dark">
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-EXWBBTVMWK"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-EXWBBTVMWK');
    </script>
    <link rel="index" title="Index" href="../../../genindex.html"><link rel="search" title="Search" href="../../../search.html">
        <link rel="prefetch" href="../../../_static/catalyst_logo-200x200.png" as="image">

    <!-- Generated with Sphinx 9.1.0 and Furo 2025.12.19 -->
        <title>pudl.transform.classes - PUDL 2026.2.1.dev10 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=d111a655" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo.css?v=7bdb33bb" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css?v=b1990d62" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo-extensions.css?v=8dab3a3b" />
    
    


<style>
  body {
    --color-code-background: #f2f2f2;
  --color-code-foreground: #1e1e1e;
  --color-announcement-background: yellow;
  --color-announcement-text: red;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-announcement-background: yellow;
  --color-announcement-text: red;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-announcement-background: yellow;
  --color-announcement-text: red;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle site navigation sidebar">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc" aria-label="Toggle table of contents sidebar">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>

<div class="announcement">
  <aside class="announcement-content">
     <b>Take our ~10 minute <a href="https://forms.gle/E9ou5fgMcR7YVRCRA">2026 Energy Data Ecosystem Survey!</b> 
  </aside>
</div>

<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <span class="icon"><svg><use href="#svg-menu"></use></svg></span>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../index.html"><div class="brand">PUDL 2026.2.1.dev10 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../index.html">
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../../../_static/catalyst_logo-200x200.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">PUDL 2026.2.1.dev10 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">About PUDL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../data_access.html">Data Access</a></li>
<li class="toctree-l1"><a class="reference external" href="https://data.catalyst.coop">PUDL Data Viewer</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../data_sources/index.html">Data Sources</a><input aria-label="Toggle navigation of Data Sources" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/censusdp1tract.html">Census DP1 – Profile of General Demographic Characteristics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/censuspep.html">Population Estimates Program's (PEP) Federal Information Processing Series (FIPS) Codes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/eiaapi.html">EIA Bulk API Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/eia176.html">EIA Form 176 – Annual Report of Natural and Supplemental Gas Supply and Disposition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/eia860.html">EIA Form 860 – Annual Electric Generator Report</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/eia861.html">EIA Form 861 – Annual Electric Power Industry Report</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/eia923.html">EIA Form 923 – Power Plant Operations Report</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/eia930.html">EIA Form 930 – Hourly and Daily Balancing Authority Operations Report</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/eiaaeo.html">EIA Annual Energy Outlook (AEO)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/epacamd_eia.html">EPA CAMD to EIA Power Sector Data Crosswalk</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/epacems.html">EPA Hourly Continuous Emission Monitoring System (CEMS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/ferc1.html">FERC Form 1 – Annual Report of Major Electric Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/ferc714.html">FERC Form 714 – Annual Electric Balancing Authority Area and Planning Area Report</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/ferceqr.html">FERC Form 920 – Electric Quarterly Report (EQR)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/gridpathratoolkit.html">GridPath Resource Adequacy Toolkit Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/nrelatb.html">NREL Annual Technology Baseline (ATB) for Electricity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/phmsagas.html">Pipelines and Hazardous Materials Safety Administration (PHMSA) Annual Natural Gas Report</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/rus12.html">USDA RUS Form 12 – Financial and Operating Report: Electric Power Supply</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/rus7.html">USDA RUS Form 7 – Financial and Operating Report: Electric Distribution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/sec10k.html">U.S. Securities and Exchange Commission (SEC) Form 10-K</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/vcerare.html">Vibrant Clean Energy Resource Adequacy Renewable Energy (RARE) Power Dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/other_data.html">Other Data in PUDL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_sources/future_data.html">High Priority Target Datasets</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../data_dictionaries/index.html">Data Dictionaries</a><input aria-label="Toggle navigation of Data Dictionaries" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../data_dictionaries/pudl_db.html">PUDL Data Dictionary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_dictionaries/ferc1_db.html">Raw FERC Form 1 Data Dictionary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_dictionaries/codes_and_labels.html">PUDL Code Metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../data_dictionaries/usage_warnings.html">PUDL Usage Warnings</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../methodology/index.html">Methodology</a><input aria-label="Toggle navigation of Methodology" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../methodology/timeseries_imputation.html">Timeseries Imputation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../methodology/sec10k_modeling.html">SEC 10-K Ownership Data Extraction Modeling</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../CONTRIBUTING.html">Contributing</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../dev/index.html">Development</a><input aria-label="Toggle navigation of Development" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/dev_setup.html">Development Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/run_the_etl.html">Running the ETL Pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/dev_dagster.html">Developing with Dagster</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/project_management.html">Project Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/testing.html">Testing PUDL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/data_validation_quickstart.html">Data validation quickstart</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/data_validation_reference.html">Data validation reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/metadata.html">Metadata editing guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/build_docs.html">Building the Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/datastore.html">Working with the Datastore</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/clone_ferc1.html">Converting raw FERC data to SQLite</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/existing_data_updates.html">Existing Data Updates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/run_a_release.html">Run a Versioned Release</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/pudl_id_mapping.html">PUDL ID Mapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/naming_conventions.html">Naming Conventions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/data_guidelines.html">Data and ETL Design Guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/nightly_data_builds.html">Nightly Data Builds</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/ferceqr_data_builds.html">FERC EQR Data Builds</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/infrastructure_as_code.html">Infrastructure as Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev/managing_external_contributions.html">Managing External Contributions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../LICENSE.html">Licensing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../code_of_conduct.html">Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release_notes.html">Release Notes</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../autoapi/index.html">API Reference</a><input aria-label="Toggle navigation of API Reference" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../autoapi/pudl/index.html">pudl</a><input aria-label="Toggle navigation of pudl" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/pudl/__main__/index.html">pudl.__main__</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/pudl/_version/index.html">pudl._version</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../autoapi/pudl/analysis/index.html">pudl.analysis</a><input aria-label="Toggle navigation of pudl.analysis" class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/analysis/allocate_gen_fuel/index.html">pudl.analysis.allocate_gen_fuel</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/analysis/fuel_by_plant/index.html">pudl.analysis.fuel_by_plant</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/analysis/mcoe/index.html">pudl.analysis.mcoe</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/analysis/ml_tools/index.html">pudl.analysis.ml_tools</a><input aria-label="Toggle navigation of pudl.analysis.ml_tools" class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/analysis/ml_tools/experiment_tracking/index.html">pudl.analysis.ml_tools.experiment_tracking</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/analysis/ml_tools/models/index.html">pudl.analysis.ml_tools.models</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/analysis/plant_parts_eia/index.html">pudl.analysis.plant_parts_eia</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/analysis/record_linkage/index.html">pudl.analysis.record_linkage</a><input aria-label="Toggle navigation of pudl.analysis.record_linkage" class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/analysis/record_linkage/classify_plants_ferc1/index.html">pudl.analysis.record_linkage.classify_plants_ferc1</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/analysis/record_linkage/eia_ferc1_inputs/index.html">pudl.analysis.record_linkage.eia_ferc1_inputs</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/analysis/record_linkage/eia_ferc1_model_config/index.html">pudl.analysis.record_linkage.eia_ferc1_model_config</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/analysis/record_linkage/eia_ferc1_record_linkage/index.html">pudl.analysis.record_linkage.eia_ferc1_record_linkage</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/analysis/record_linkage/eia_ferc1_train/index.html">pudl.analysis.record_linkage.eia_ferc1_train</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/analysis/record_linkage/embed_dataframe/index.html">pudl.analysis.record_linkage.embed_dataframe</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/analysis/record_linkage/link_cross_year/index.html">pudl.analysis.record_linkage.link_cross_year</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/analysis/record_linkage/name_cleaner/index.html">pudl.analysis.record_linkage.name_cleaner</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/analysis/service_territory/index.html">pudl.analysis.service_territory</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/analysis/spatial/index.html">pudl.analysis.spatial</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/analysis/state_demand/index.html">pudl.analysis.state_demand</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/analysis/timeseries_cleaning/index.html">pudl.analysis.timeseries_cleaning</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/analysis/timeseries_evaluation/index.html">pudl.analysis.timeseries_evaluation</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../autoapi/pudl/convert/index.html">pudl.convert</a><input aria-label="Toggle navigation of pudl.convert" class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/convert/censusdp1tract_to_sqlite/index.html">pudl.convert.censusdp1tract_to_sqlite</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/convert/metadata_to_rst/index.html">pudl.convert.metadata_to_rst</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/pudl/dbt_wrapper/index.html">pudl.dbt_wrapper</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../autoapi/pudl/etl/index.html">pudl.etl</a><input aria-label="Toggle navigation of pudl.etl" class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/etl/asset_checks/index.html">pudl.etl.asset_checks</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/etl/check_foreign_keys/index.html">pudl.etl.check_foreign_keys</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/etl/cli/index.html">pudl.etl.cli</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/etl/eia_bulk_elec_assets/index.html">pudl.etl.eia_bulk_elec_assets</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/etl/ferceqr_deployment/index.html">pudl.etl.ferceqr_deployment</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/etl/glue_assets/index.html">pudl.etl.glue_assets</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/etl/static_assets/index.html">pudl.etl.static_assets</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../autoapi/pudl/extract/index.html">pudl.extract</a><input aria-label="Toggle navigation of pudl.extract" class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/censuspep/index.html">pudl.extract.censuspep</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/csv/index.html">pudl.extract.csv</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/dbf/index.html">pudl.extract.dbf</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/eia176/index.html">pudl.extract.eia176</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/eia191/index.html">pudl.extract.eia191</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/eia757a/index.html">pudl.extract.eia757a</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/eia860/index.html">pudl.extract.eia860</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/eia860m/index.html">pudl.extract.eia860m</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/eia861/index.html">pudl.extract.eia861</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/eia923/index.html">pudl.extract.eia923</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/eia930/index.html">pudl.extract.eia930</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/eiaaeo/index.html">pudl.extract.eiaaeo</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/eiaapi/index.html">pudl.extract.eiaapi</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/epacems/index.html">pudl.extract.epacems</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/excel/index.html">pudl.extract.excel</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/extractor/index.html">pudl.extract.extractor</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/ferc/index.html">pudl.extract.ferc</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/ferc1/index.html">pudl.extract.ferc1</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/ferc2/index.html">pudl.extract.ferc2</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/ferc6/index.html">pudl.extract.ferc6</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/ferc60/index.html">pudl.extract.ferc60</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/ferc714/index.html">pudl.extract.ferc714</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/ferccid/index.html">pudl.extract.ferccid</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/ferceqr/index.html">pudl.extract.ferceqr</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/gridpathratoolkit/index.html">pudl.extract.gridpathratoolkit</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/nrelatb/index.html">pudl.extract.nrelatb</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/parquet/index.html">pudl.extract.parquet</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/phmsagas/index.html">pudl.extract.phmsagas</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/rus12/index.html">pudl.extract.rus12</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/rus7/index.html">pudl.extract.rus7</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/sec10k/index.html">pudl.extract.sec10k</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/vcerare/index.html">pudl.extract.vcerare</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/extract/xbrl/index.html">pudl.extract.xbrl</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../autoapi/pudl/ferc_to_sqlite/index.html">pudl.ferc_to_sqlite</a><input aria-label="Toggle navigation of pudl.ferc_to_sqlite" class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/ferc_to_sqlite/cli/index.html">pudl.ferc_to_sqlite.cli</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../autoapi/pudl/glue/index.html">pudl.glue</a><input aria-label="Toggle navigation of pudl.glue" class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/glue/ferc1_eia/index.html">pudl.glue.ferc1_eia</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/glue/ferc714/index.html">pudl.glue.ferc714</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/pudl/helpers/index.html">pudl.helpers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/pudl/io_managers/index.html">pudl.io_managers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/pudl/logging_helpers/index.html">pudl.logging_helpers</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../autoapi/pudl/metadata/index.html">pudl.metadata</a><input aria-label="Toggle navigation of pudl.metadata" class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/metadata/classes/index.html">pudl.metadata.classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/metadata/codes/index.html">pudl.metadata.codes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/metadata/constants/index.html">pudl.metadata.constants</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/metadata/descriptions/index.html">pudl.metadata.descriptions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/metadata/dfs/index.html">pudl.metadata.dfs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/metadata/enums/index.html">pudl.metadata.enums</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/metadata/fields/index.html">pudl.metadata.fields</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/metadata/helpers/index.html">pudl.metadata.helpers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/metadata/labels/index.html">pudl.metadata.labels</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/metadata/resource_helpers/index.html">pudl.metadata.resource_helpers</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/index.html">pudl.metadata.resources</a><input aria-label="Toggle navigation of pudl.metadata.resources" class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/allocate_gen_fuel/index.html">pudl.metadata.resources.allocate_gen_fuel</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/censusdp1tract/index.html">pudl.metadata.resources.censusdp1tract</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/eia/index.html">pudl.metadata.resources.eia</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/eia176/index.html">pudl.metadata.resources.eia176</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/eia860/index.html">pudl.metadata.resources.eia860</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/eia860m/index.html">pudl.metadata.resources.eia860m</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/eia861/index.html">pudl.metadata.resources.eia861</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/eia923/index.html">pudl.metadata.resources.eia923</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/eia930/index.html">pudl.metadata.resources.eia930</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/eiaaeo/index.html">pudl.metadata.resources.eiaaeo</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/eiaapi/index.html">pudl.metadata.resources.eiaapi</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/epacems/index.html">pudl.metadata.resources.epacems</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/ferc1/index.html">pudl.metadata.resources.ferc1</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/ferc1_eia_record_linkage/index.html">pudl.metadata.resources.ferc1_eia_record_linkage</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/ferc714/index.html">pudl.metadata.resources.ferc714</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/ferccid/index.html">pudl.metadata.resources.ferccid</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/ferceqr/index.html">pudl.metadata.resources.ferceqr</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/glue/index.html">pudl.metadata.resources.glue</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/gridpathratoolkit/index.html">pudl.metadata.resources.gridpathratoolkit</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/nrelatb/index.html">pudl.metadata.resources.nrelatb</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/phmsagas/index.html">pudl.metadata.resources.phmsagas</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/pudl/index.html">pudl.metadata.resources.pudl</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/rus12/index.html">pudl.metadata.resources.rus12</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/rus7/index.html">pudl.metadata.resources.rus7</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/sec10k/index.html">pudl.metadata.resources.sec10k</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/metadata/resources/vcerare/index.html">pudl.metadata.resources.vcerare</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/metadata/sources/index.html">pudl.metadata.sources</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/metadata/warnings/index.html">pudl.metadata.warnings</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../autoapi/pudl/output/index.html">pudl.output</a><input aria-label="Toggle navigation of pudl.output" class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/output/censusdp1tract/index.html">pudl.output.censusdp1tract</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/output/eia/index.html">pudl.output.eia</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/output/eia860/index.html">pudl.output.eia860</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/output/eia923/index.html">pudl.output.eia923</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/output/eia930/index.html">pudl.output.eia930</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/output/eiaapi/index.html">pudl.output.eiaapi</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/output/ferc1/index.html">pudl.output.ferc1</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/output/ferc714/index.html">pudl.output.ferc714</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/output/sec10k/index.html">pudl.output.sec10k</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/output/sql/index.html">pudl.output.sql</a><input aria-label="Toggle navigation of pudl.output.sql" class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/output/sql/helpers/index.html">pudl.output.sql.helpers</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../autoapi/pudl/package_data/index.html">pudl.package_data</a><input aria-label="Toggle navigation of pudl.package_data" class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/package_data/censuspep/index.html">pudl.package_data.censuspep</a><input aria-label="Toggle navigation of pudl.package_data.censuspep" class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/package_data/censuspep/column_maps/index.html">pudl.package_data.censuspep.column_maps</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/package_data/eia176/index.html">pudl.package_data.eia176</a><input aria-label="Toggle navigation of pudl.package_data.eia176" class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" role="switch" type="checkbox"/><label for="toctree-checkbox-21"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/package_data/eia176/column_maps/index.html">pudl.package_data.eia176.column_maps</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/package_data/eia191/index.html">pudl.package_data.eia191</a><input aria-label="Toggle navigation of pudl.package_data.eia191" class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" role="switch" type="checkbox"/><label for="toctree-checkbox-22"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/package_data/eia191/column_maps/index.html">pudl.package_data.eia191.column_maps</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/package_data/eia757a/index.html">pudl.package_data.eia757a</a><input aria-label="Toggle navigation of pudl.package_data.eia757a" class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" role="switch" type="checkbox"/><label for="toctree-checkbox-23"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/package_data/eia757a/column_maps/index.html">pudl.package_data.eia757a.column_maps</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/package_data/eia860/index.html">pudl.package_data.eia860</a><input aria-label="Toggle navigation of pudl.package_data.eia860" class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" role="switch" type="checkbox"/><label for="toctree-checkbox-24"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/package_data/eia860/column_maps/index.html">pudl.package_data.eia860.column_maps</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/package_data/eia860m/index.html">pudl.package_data.eia860m</a><input aria-label="Toggle navigation of pudl.package_data.eia860m" class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" role="switch" type="checkbox"/><label for="toctree-checkbox-25"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/package_data/eia860m/column_maps/index.html">pudl.package_data.eia860m.column_maps</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/package_data/eia861/index.html">pudl.package_data.eia861</a><input aria-label="Toggle navigation of pudl.package_data.eia861" class="toctree-checkbox" id="toctree-checkbox-26" name="toctree-checkbox-26" role="switch" type="checkbox"/><label for="toctree-checkbox-26"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/package_data/eia861/column_maps/index.html">pudl.package_data.eia861.column_maps</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/package_data/eia923/index.html">pudl.package_data.eia923</a><input aria-label="Toggle navigation of pudl.package_data.eia923" class="toctree-checkbox" id="toctree-checkbox-27" name="toctree-checkbox-27" role="switch" type="checkbox"/><label for="toctree-checkbox-27"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/package_data/eia923/column_maps/index.html">pudl.package_data.eia923.column_maps</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/package_data/eia930/index.html">pudl.package_data.eia930</a><input aria-label="Toggle navigation of pudl.package_data.eia930" class="toctree-checkbox" id="toctree-checkbox-28" name="toctree-checkbox-28" role="switch" type="checkbox"/><label for="toctree-checkbox-28"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/package_data/eia930/column_maps/index.html">pudl.package_data.eia930.column_maps</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/package_data/epacems/index.html">pudl.package_data.epacems</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/package_data/ferc1/index.html">pudl.package_data.ferc1</a><input aria-label="Toggle navigation of pudl.package_data.ferc1" class="toctree-checkbox" id="toctree-checkbox-29" name="toctree-checkbox-29" role="switch" type="checkbox"/><label for="toctree-checkbox-29"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/package_data/ferc1/row_maps/index.html">pudl.package_data.ferc1.row_maps</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/package_data/glue/index.html">pudl.package_data.glue</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/package_data/phmsagas/index.html">pudl.package_data.phmsagas</a><input aria-label="Toggle navigation of pudl.package_data.phmsagas" class="toctree-checkbox" id="toctree-checkbox-30" name="toctree-checkbox-30" role="switch" type="checkbox"/><label for="toctree-checkbox-30"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/package_data/phmsagas/column_maps/index.html">pudl.package_data.phmsagas.column_maps</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/package_data/rus12/index.html">pudl.package_data.rus12</a><input aria-label="Toggle navigation of pudl.package_data.rus12" class="toctree-checkbox" id="toctree-checkbox-31" name="toctree-checkbox-31" role="switch" type="checkbox"/><label for="toctree-checkbox-31"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/package_data/rus12/column_maps/index.html">pudl.package_data.rus12.column_maps</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/package_data/rus7/index.html">pudl.package_data.rus7</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/package_data/settings/index.html">pudl.package_data.settings</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/package_data/test/index.html">pudl.package_data.test</a><input aria-label="Toggle navigation of pudl.package_data.test" class="toctree-checkbox" id="toctree-checkbox-32" name="toctree-checkbox-32" role="switch" type="checkbox"/><label for="toctree-checkbox-32"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/package_data/test/column_maps/index.html">pudl.package_data.test.column_maps</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/package_data/vcerare/index.html">pudl.package_data.vcerare</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/pudl/resources/index.html">pudl.resources</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../autoapi/pudl/scripts/index.html">pudl.scripts</a><input aria-label="Toggle navigation of pudl.scripts" class="toctree-checkbox" id="toctree-checkbox-33" name="toctree-checkbox-33" role="switch" type="checkbox"/><label for="toctree-checkbox-33"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/scripts/auto_match_utilities/index.html">pudl.scripts.auto_match_utilities</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/scripts/dbt_helper/index.html">pudl.scripts.dbt_helper</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/scripts/generate_pudl_duckdb/index.html">pudl.scripts.generate_pudl_duckdb</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/scripts/pudl_null_cols/index.html">pudl.scripts.pudl_null_cols</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/scripts/resource_description/index.html">pudl.scripts.resource_description</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/scripts/zenodo_data_release/index.html">pudl.scripts.zenodo_data_release</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/pudl/settings/index.html">pudl.settings</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../autoapi/pudl/transform/index.html">pudl.transform</a><input aria-label="Toggle navigation of pudl.transform" class="toctree-checkbox" id="toctree-checkbox-34" name="toctree-checkbox-34" role="switch" type="checkbox"/><label for="toctree-checkbox-34"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/censuspep/index.html">pudl.transform.censuspep</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/classes/index.html">pudl.transform.classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/eia/index.html">pudl.transform.eia</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/eia176/index.html">pudl.transform.eia176</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/eia860/index.html">pudl.transform.eia860</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/eia860m/index.html">pudl.transform.eia860m</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/eia861/index.html">pudl.transform.eia861</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/eia923/index.html">pudl.transform.eia923</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/eia930/index.html">pudl.transform.eia930</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/eiaaeo/index.html">pudl.transform.eiaaeo</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/eiaapi/index.html">pudl.transform.eiaapi</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/epacems/index.html">pudl.transform.epacems</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/ferc/index.html">pudl.transform.ferc</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/ferc1/index.html">pudl.transform.ferc1</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/ferc714/index.html">pudl.transform.ferc714</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/ferccid/index.html">pudl.transform.ferccid</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/ferceqr/index.html">pudl.transform.ferceqr</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/gridpathratoolkit/index.html">pudl.transform.gridpathratoolkit</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/nrelatb/index.html">pudl.transform.nrelatb</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../autoapi/pudl/transform/params/index.html">pudl.transform.params</a><input aria-label="Toggle navigation of pudl.transform.params" class="toctree-checkbox" id="toctree-checkbox-35" name="toctree-checkbox-35" role="switch" type="checkbox"/><label for="toctree-checkbox-35"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../autoapi/pudl/transform/params/ferc1/index.html">pudl.transform.params.ferc1</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/phmsagas/index.html">pudl.transform.phmsagas</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/rus/index.html">pudl.transform.rus</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/rus12/index.html">pudl.transform.rus12</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/rus7/index.html">pudl.transform.rus7</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/sec10k/index.html">pudl.transform.sec10k</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/transform/vcerare/index.html">pudl.transform.vcerare</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/pudl/validate/index.html">pudl.validate</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../autoapi/pudl/workspace/index.html">pudl.workspace</a><input aria-label="Toggle navigation of pudl.workspace" class="toctree-checkbox" id="toctree-checkbox-36" name="toctree-checkbox-36" role="switch" type="checkbox"/><label for="toctree-checkbox-36"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/workspace/datastore/index.html">pudl.workspace.datastore</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/workspace/resource_cache/index.html">pudl.workspace.resource_cache</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/pudl/workspace/setup/index.html">pudl.workspace.setup</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../bibliography.html">Bibliography</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <h1>Source code for pudl.transform.classes</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Classes for defining &amp; coordinating the transformation of tabular data sources.</span>

<span class="sd">We define our data transformations in four separate components:</span>

<span class="sd">  * The data being transformed (:class:`pd.DataFrame` or :class:`pd.Series`).</span>
<span class="sd">  * The functions &amp; methods doing the transformations.</span>
<span class="sd">  * Non-data parameters that control the behavior of the transform functions &amp; methods.</span>
<span class="sd">  * Classes that organize the functions &amp; parameters that transform a given input table.</span>

<span class="sd">Separating out the transformation functions and the parameters that control them allows</span>
<span class="sd">us to re-use the same transforms in many different contexts without duplicating the</span>
<span class="sd">code.</span>

<span class="sd">Transform functions take data (either a Series or DataFrame) and a TransformParams</span>
<span class="sd">object as inputs, and return transformed data of the same type that they consumed</span>
<span class="sd">(Series or DataFrame). They operate on the data, and their particular behavior is</span>
<span class="sd">controlled by the TransformParams. Like the TableTransformer classes discussed below,</span>
<span class="sd">they are organized into 3 separate levels of abstraction:</span>

<span class="sd">  * general-purpose: always available from the abstract base class.</span>
<span class="sd">  * dataset-specific: used repeatedly by a dataset, from an intermediate abstract class.</span>
<span class="sd">  * table-specific: used only once for a particular table, defined in a concrete class.</span>

<span class="sd">These functions are not generally meant to be used independent of a ``TableTransformer``</span>
<span class="sd">class. They are wrapped by methods within the class definitions which handle logging</span>
<span class="sd">and intermediate dataframe caching.</span>

<span class="sd">  * Transform functions that operate on individual columns should implement the</span>
<span class="sd">    :class:`ColumnTransformFunc` :class:`Protocol`.</span>
<span class="sd">  * Transform functions that need to operate on whole tables should implement the</span>
<span class="sd">    :class:`TableTransformFunc` :class:`Protocol`.</span>
<span class="sd">  * To iteratively apply a :class:`ColumnTransformFunc` to several columns in a table,</span>
<span class="sd">    use :func:`multicol_transform_factory` to construct a</span>
<span class="sd">    :class:`MultiColumnTransformFunc`</span>

<span class="sd">Using a hierarchy of ``TableTransformer`` classes to organize the functions and</span>
<span class="sd">parameters allows us to apply a particular set of transformations uniformly across every</span>
<span class="sd">table that&#39;s part of a family of similar data. It also allows us to keep transform</span>
<span class="sd">functions that only apply to a particular collection of tables or an individual table</span>
<span class="sd">separated from other data that it should not be used with.</span>

<span class="sd">Currently there are 3 levels of abstraction in the TableTransformer classes:</span>

<span class="sd">  * The :class:`AbstractTableTransformer` abstract base class that defines methods</span>
<span class="sd">    useful across a wide range of data sources.</span>
<span class="sd">  * A dataset-specific abstract class that can define transforms which are consistently</span>
<span class="sd">    useful across many tables in the dataset (e.g. the</span>
<span class="sd">    :class:`pudl.transform.ferc1.Ferc1AbstractTableTransformer` class).</span>
<span class="sd">  * Table-specific concrete classes that inherit from both of the higher levels, and</span>
<span class="sd">    contain any bespoke transformations or parameters that only pertain to that table.</span>
<span class="sd">    (e.g. the :class:`pudl.transform.ferc1.SteamPlantsFerc1TableTransformer` class).</span>

<span class="sd">The :class:`TransformParams` classes are immutable :mod:`pydantic` models that store and</span>
<span class="sd">the parameters which are passed to the transform functions / methods described above.</span>
<span class="sd">These models are defined alongside the functions they&#39;re used with. General purpose</span>
<span class="sd">transforms have their parameter models defined in this module. Dataset-specific</span>
<span class="sd">transforms should have their parameters defined in the module that defines the</span>
<span class="sd">associated transform function. The :class:`MultiColumnTransformParams` models are</span>
<span class="sd">dictionaries keyed by column name, that must map to per-column parameters which are all</span>
<span class="sd">of the same type.</span>

<span class="sd">Specific :class:`TransformParams` classes are instantiated using dictionaries of values</span>
<span class="sd">defined in the per-dataset modules under :mod:`pudl.transform.params` e.g.</span>
<span class="sd">:mod:`pudl.transform.params.ferc1`.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">enum</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections.abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">Callable</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">wraps</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">combinations</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Annotated</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Protocol</span><span class="p">,</span> <span class="n">Self</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">yaml</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">BaseModel</span><span class="p">,</span>
    <span class="n">ConfigDict</span><span class="p">,</span>
    <span class="n">Field</span><span class="p">,</span>
    <span class="n">ValidationInfo</span><span class="p">,</span>
    <span class="n">field_validator</span><span class="p">,</span>
    <span class="n">model_validator</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pudl.logging_helpers</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pudl.transform.params.ferc1</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pudl.metadata</span><span class="w"> </span><span class="kn">import</span> <span class="n">PUDL_PACKAGE</span>

<div class="viewcode-block" id="logger">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.logger">[docs]</a>
<span class="n">logger</span> <span class="o">=</span> <span class="n">pudl</span><span class="o">.</span><span class="n">logging_helpers</span><span class="o">.</span><span class="n">get_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span></div>



<span class="c1">#####################################################################################</span>
<span class="c1"># Transform Parameter Models</span>
<span class="c1">#####################################################################################</span>
<div class="viewcode-block" id="TransformParams">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.TransformParams">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TransformParams</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An immutable base model for transformation parameters.</span>

<span class="sd">    ``TransformParams`` instances created without any arguments should have no effect</span>
<span class="sd">    when applied by their associated function.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TransformParams.model_config">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.TransformParams.model_config">[docs]</a>
    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="s2">&quot;forbid&quot;</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="MultiColumnTransformParams">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.MultiColumnTransformParams">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">MultiColumnTransformParams</span><span class="p">(</span><span class="n">TransformParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A dictionary of :class:`TransformParams` to apply to several columns in a table.</span>

<span class="sd">    These parameter dictionaries are dynamically generated for each multi-column</span>
<span class="sd">    transformation specified within a :class:`TableTransformParams` object, and passed</span>
<span class="sd">    in to the :class:`MultiColumnTransformFunc` callables which are constructed by</span>
<span class="sd">    :func:`multicol_transform_factory`</span>

<span class="sd">    The keys are column names, values must all be the same type of</span>
<span class="sd">    :class:`TransformParams` object. For examples, see e.g. the ``categorize_strings``</span>
<span class="sd">    or ``convert_units`` elements within</span>
<span class="sd">    :py:const:`pudl.transform.ferc1.TRANSFORM_PARAMS`.</span>

<span class="sd">    The dictionary structure is not explicitly stated in this class, because it&#39;s messy</span>
<span class="sd">    to use Pydantic for validation when the data to be validated isn&#39;t contained within</span>
<span class="sd">    a Pydantic model. When Pydantic v2 is available, it will be easy, and we&#39;ll do it:</span>
<span class="sd">    https://pydantic-docs.helpmanual.io/blog/pydantic-v2/#validation-without-a-model</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="MultiColumnTransformParams.single_param_type">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.MultiColumnTransformParams.single_param_type">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">single_param_type</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Self</span><span class="p">,</span> <span class="n">info</span><span class="p">:</span> <span class="n">ValidationInfo</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check that all TransformParams in the dictionary are of the same type.&quot;&quot;&quot;</span>
        <span class="n">param_types</span> <span class="o">=</span> <span class="p">{</span><span class="nb">type</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">])</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">info</span><span class="o">.</span><span class="n">data</span><span class="p">}</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_types</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Found multiple parameter types in multi-column transform params: &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">param_types</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>
</div>



<span class="c1">#####################################################################################</span>
<span class="c1"># Transform Protocol &amp; General Function Definitions</span>
<span class="c1"># Factory functions and callback protocols are a little complex. For more on how</span>
<span class="c1"># Protocols and type annotations can be used to define function call</span>
<span class="c1"># signatures and return types see:</span>
<span class="c1"># https://realpython.com/python-type-checking/#callables</span>
<span class="c1"># https://mypy.readthedocs.io/en/stable/protocols.html#callback-protocols</span>
<span class="c1">#####################################################################################</span>
<div class="viewcode-block" id="ColumnTransformFunc">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.ColumnTransformFunc">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ColumnTransformFunc</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Callback protocol defining a per-column transformation function.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="ColumnTransformFunc.__call__">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.ColumnTransformFunc.__call__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">TransformParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a callable.&quot;&quot;&quot;</span>
        <span class="o">...</span></div>
</div>



<div class="viewcode-block" id="TableTransformFunc">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.TableTransformFunc">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TableTransformFunc</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Callback protocol defining a per-table transformation function.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="TableTransformFunc.__call__">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.TableTransformFunc.__call__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">TransformParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a callable.&quot;&quot;&quot;</span>
        <span class="o">...</span></div>
</div>



<div class="viewcode-block" id="MultiColumnTransformFunc">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.MultiColumnTransformFunc">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">MultiColumnTransformFunc</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Callback protocol defining a per-table transformation function.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="MultiColumnTransformFunc.__call__">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.MultiColumnTransformFunc.__call__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">MultiColumnTransformParams</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a callable.&quot;&quot;&quot;</span>
        <span class="o">...</span></div>
</div>



<div class="viewcode-block" id="multicol_transform_factory">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.multicol_transform_factory">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">multicol_transform_factory</span><span class="p">(</span>
    <span class="n">col_func</span><span class="p">:</span> <span class="n">ColumnTransformFunc</span><span class="p">,</span>
    <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MultiColumnTransformFunc</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Construct :class:`MultiColumnTransformFunc` from a :class:`ColumnTransformFunc`.</span>

<span class="sd">    This factory function saves us from having to iterate over dataframes in many</span>
<span class="sd">    separate places, applying the same transform functions with different parameters to</span>
<span class="sd">    multiple columns. Instead, we define a function that transforms a column given</span>
<span class="sd">    some parameters, and then easily apply that function to many columns using a</span>
<span class="sd">    dictionary of parameters (a :class:`MultiColumnTransformParams`). Uniform logging</span>
<span class="sd">    output is also integrated into the constructed function.</span>

<span class="sd">    Args:</span>
<span class="sd">        col_func: A single column transform function.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A multi-column transform function.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; class AddInt(TransformParams):</span>
<span class="sd">        ...     val: int</span>
<span class="sd">        ...</span>
<span class="sd">        &gt;&gt;&gt; def add_int(col: pd.Series, params: AddInt):</span>
<span class="sd">        ...     return col + params.val</span>
<span class="sd">        ...</span>
<span class="sd">        &gt;&gt;&gt; add_int_multicol = multicol_transform_factory(add_int)</span>
<span class="sd">        ...</span>
<span class="sd">        &gt;&gt;&gt; df = pd.DataFrame(</span>
<span class="sd">        ...     {</span>
<span class="sd">        ...         &quot;col1&quot;: [1, 2, 3],</span>
<span class="sd">        ...         &quot;col2&quot;: [10, 20, 30],</span>
<span class="sd">        ...     }</span>
<span class="sd">        ... )</span>
<span class="sd">        ...</span>
<span class="sd">        &gt;&gt;&gt; actual = add_int_multicol(</span>
<span class="sd">        ...     df,</span>
<span class="sd">        ...     params={</span>
<span class="sd">        ...         &quot;col1&quot;: AddInt(val=1),</span>
<span class="sd">        ...         &quot;col2&quot;: AddInt(val=2),</span>
<span class="sd">        ...     }</span>
<span class="sd">        ... )</span>
<span class="sd">        ...</span>
<span class="sd">        &gt;&gt;&gt; expected = pd.DataFrame(</span>
<span class="sd">        ...     {</span>
<span class="sd">        ...         &quot;col1&quot;: [2, 3, 4],</span>
<span class="sd">        ...         &quot;col2&quot;: [12, 22, 32],</span>
<span class="sd">        ...     }</span>
<span class="sd">        ... )</span>
<span class="sd">        ...</span>
<span class="sd">        &gt;&gt;&gt; pd.testing.assert_frame_equal(actual, expected)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">InnerMultiColumnTransformFunc</span><span class="p">(</span>
        <span class="n">Callable</span><span class="p">[[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">MultiColumnTransformParams</span><span class="p">],</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span>
    <span class="p">):</span>
        <span class="vm">__name__</span> <span class="o">=</span> <span class="n">col_func</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s2">&quot;_multicol&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">MultiColumnTransformParams</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
            <span class="n">drop_col</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">drop</span>
            <span class="k">for</span> <span class="n">col_name</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">col_name</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Applying </span><span class="si">{</span><span class="n">col_func</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">col_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">new_col</span> <span class="o">=</span> <span class="n">col_func</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">col_name</span><span class="p">],</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="n">col_name</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">drop_col</span><span class="p">:</span>
                        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">col_name</span><span class="p">)</span>
                    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span> <span class="n">new_col</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;columns&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Expected column </span><span class="si">{</span><span class="n">col_name</span><span class="si">}</span><span class="s2"> not found in dataframe during &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;application of </span><span class="si">{</span><span class="n">col_func</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.&quot;</span>
                    <span class="p">)</span>
            <span class="k">return</span> <span class="n">df</span>

    <span class="k">return</span> <span class="n">InnerMultiColumnTransformFunc</span><span class="p">()</span></div>



<span class="c1">################################################################################</span>
<span class="c1"># Rename Columns</span>
<span class="c1">################################################################################</span>
<div class="viewcode-block" id="RenameColumns">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.RenameColumns">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">RenameColumns</span><span class="p">(</span><span class="n">TransformParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A dictionary for mapping old column names to new column names in a dataframe.</span>

<span class="sd">    This parameter model has no associated transform function since it is used with the</span>
<span class="sd">    :meth:`pd.DataFrame.rename` method. Because it renames all of the columns in a</span>
<span class="sd">    dataframe at once, it&#39;s a table transformation (though it could also have been</span>
<span class="sd">    implemented as a column transform).</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="RenameColumns.columns">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.RenameColumns.columns">[docs]</a>
    <span class="n">columns</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;A dictionary of columns to be renamed.&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="rename_columns">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.rename_columns">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">rename_columns</span><span class="p">(</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">RenameColumns</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Rename the whole collection of dataframe columns using input params.</span>

<span class="sd">    Raise an error if there&#39;s any mismatch between the columns in the dataframe, and</span>
<span class="sd">    the columns that have been defined in the mapping for renaming.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># If we are attempting to rename columns that do *not* appear in the dataframe,</span>
    <span class="c1"># raise an error.</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">missing_cols</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">missing_cols</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Attempting to rename columns which are not present in the dataframe.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Missing columns: </span><span class="si">{</span><span class="nb">sorted</span><span class="p">(</span><span class="n">missing_cols</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">Existing Columns: </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span></div>



<span class="c1">################################################################################</span>
<span class="c1"># Normalize Strings</span>
<span class="c1">################################################################################</span>
<div class="viewcode-block" id="StringNormalization">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.StringNormalization">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">StringNormalization</span><span class="p">(</span><span class="n">TransformParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Options to control string normalization.</span>

<span class="sd">    Most of what takes place in the string normalization is standardized and controlled</span>
<span class="sd">    by the :func:`normalize_strings` function since we need the normalizations of</span>
<span class="sd">    different columns to be comparable, but there are a couple of column-specific</span>
<span class="sd">    parameterizations that are useful, and they are encapsulated by this class.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="StringNormalization.remove_chars">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.StringNormalization.remove_chars">[docs]</a>
    <span class="n">remove_chars</span><span class="p">:</span> <span class="nb">str</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;A string of individual ASCII characters removed at the end of normalization.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="StringNormalization.nullable">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.StringNormalization.nullable">[docs]</a>
    <span class="n">nullable</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;Whether the normalized string should be cast to :class:`pd.StringDtype`.&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="normalize_strings">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.normalize_strings">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">normalize_strings</span><span class="p">(</span><span class="n">col</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">StringNormalization</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Derive a canonical, simplified version of the strings in the column.</span>

<span class="sd">    Transformations include:</span>

<span class="sd">    * Convert to :class:`pd.StringDtype`.</span>
<span class="sd">    * Decompose composite unicode characters.</span>
<span class="sd">    * Translate to ASCII character equivalents if they exist.</span>
<span class="sd">    * Translate to lower case.</span>
<span class="sd">    * Strip leading and trailing whitespace.</span>
<span class="sd">    * Consolidate multiple internal whitespace characters into a single space.</span>

<span class="sd">    Args:</span>
<span class="sd">        col: series of strings to normalize.</span>
<span class="sd">        params: settings enumerating any particular characters to remove, and whether</span>
<span class="sd">            the resulting series should be a nullable string.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">params</span><span class="p">:</span>
        <span class="n">col</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">col</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">StringDtype</span><span class="p">())</span>
            <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="s2">&quot;NFKD&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;ascii&quot;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;ascii&quot;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[&quot;</span> <span class="o">+</span> <span class="n">params</span><span class="o">.</span><span class="n">remove_chars</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;]+&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s+&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">params</span><span class="o">.</span><span class="n">nullable</span><span class="p">:</span>
            <span class="n">col</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">col</span></div>



<div class="viewcode-block" id="normalize_strings_multicol">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.normalize_strings_multicol">[docs]</a>
<span class="n">normalize_strings_multicol</span> <span class="o">=</span> <span class="n">multicol_transform_factory</span><span class="p">(</span><span class="n">normalize_strings</span><span class="p">)</span></div>

<span class="sd">&quot;&quot;&quot;A multi-column version of the :func:`normalize_strings` function.&quot;&quot;&quot;</span>


<span class="c1">################################################################################</span>
<span class="c1"># Enforce Snake Case</span>
<span class="c1">################################################################################</span>
<div class="viewcode-block" id="EnforceSnakeCase">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.EnforceSnakeCase">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">EnforceSnakeCase</span><span class="p">(</span><span class="n">TransformParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Boolean parameter for :func:`enforce_snake_case`.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="EnforceSnakeCase.enforce_snake_case">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.EnforceSnakeCase.enforce_snake_case">[docs]</a>
    <span class="n">enforce_snake_case</span><span class="p">:</span> <span class="nb">bool</span></div>
</div>



<div class="viewcode-block" id="enforce_snake_case">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.enforce_snake_case">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">enforce_snake_case</span><span class="p">(</span>
    <span class="n">col</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnforceSnakeCase</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Enforce snake_case for a column.</span>

<span class="sd">    Removes leading whitespaces, lower-cases, replaces spaces with underscore and</span>
<span class="sd">    removes remaining non alpha numeric snake case values.</span>

<span class="sd">    Args:</span>
<span class="sd">        col: a column of strings.</span>
<span class="sd">        params: an :class:`EnforceSnakeCase` parameter object. Default is None which</span>
<span class="sd">            will instantiate an instance of :class:`EnforceSnakeCase` where</span>
<span class="sd">            ``enforce_snake_case`` is ``True``, which will enforce snake case on the</span>
<span class="sd">            ``col``. If ``enforce_snake_case`` is ``False``, the column will be</span>
<span class="sd">            returned unaltered.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">EnforceSnakeCase</span><span class="p">(</span><span class="n">enforce_snake_case</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">enforce_snake_case</span><span class="p">:</span>
        <span class="n">col</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">col</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                <span class="n">to_replace</span><span class="o">=</span><span class="p">{</span>
                    <span class="sa">r</span><span class="s2">&quot;\s{1,}&quot;</span><span class="p">:</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span>
                    <span class="sa">r</span><span class="s2">&quot;[^a-z\d_]&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">col</span></div>



<div class="viewcode-block" id="enforce_snake_case_multicol">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.enforce_snake_case_multicol">[docs]</a>
<span class="n">enforce_snake_case_multicol</span> <span class="o">=</span> <span class="n">multicol_transform_factory</span><span class="p">(</span><span class="n">enforce_snake_case</span><span class="p">)</span></div>



<span class="c1">################################################################################</span>
<span class="c1"># Strip Non-Numeric Values</span>
<span class="c1">################################################################################</span>
<div class="viewcode-block" id="StripNonNumericValues">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.StripNonNumericValues">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">StripNonNumericValues</span><span class="p">(</span><span class="n">TransformParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Boolean parameter for :func:`strip_non_numeric_values`.</span>

<span class="sd">    Stores a named boolean variable that is employed in</span>
<span class="sd">    :func:`strip_non_numeric_values` to determine whether of not the transform</span>
<span class="sd">    treatment should be applied. Pydantic 2.0 will allow validation of these simple</span>
<span class="sd">    variables without needing to define a model.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="StripNonNumericValues.strip_non_numeric_values">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.StripNonNumericValues.strip_non_numeric_values">[docs]</a>
    <span class="n">strip_non_numeric_values</span><span class="p">:</span> <span class="nb">bool</span></div>
</div>



<div class="viewcode-block" id="strip_non_numeric_values">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.strip_non_numeric_values">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">strip_non_numeric_values</span><span class="p">(</span>
    <span class="n">col</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">StripNonNumericValues</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Strip a column of any non numeric values.</span>

<span class="sd">    Using the following options in :func:`pd.Series.extract` :</span>

<span class="sd">    * an optional ``+`` or ``-`` followed by at least one digit followed by an optional</span>
<span class="sd">      decimal place followed by any number of digits (including zero)</span>
<span class="sd">    * OR an optional ``+`` or ``-`` followed by a period followed by at least one digit</span>

<span class="sd">    Unless the found match is followed by a letter (this is done using a negative</span>
<span class="sd">    lookback).</span>

<span class="sd">    Note: This will not work with exponential values. If there are two possible matches</span>
<span class="sd">    of numeric values within a value, only the first match will be returned (ex:</span>
<span class="sd">    ``&quot;FERC1 Licenses 1234 &amp; 5678&quot;`` will return ``&quot;1234&quot;``).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">StripNonNumericValues</span><span class="p">(</span><span class="n">strip_non_numeric_values</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">strip_non_numeric_values</span><span class="p">:</span>
        <span class="n">col</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
            <span class="nb">str</span>
        <span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span>
            <span class="sa">rf</span><span class="s2">&quot;(?P&lt;</span><span class="si">{</span><span class="n">col</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&gt;(?&lt;![a-z-A-Z])[-+]?\d+\.?\d*|[-+]?\.\d+)&quot;</span><span class="p">,</span>  <span class="c1"># name the series</span>
            <span class="n">expand</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">col</span></div>



<div class="viewcode-block" id="strip_non_numeric_values_multicol">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.strip_non_numeric_values_multicol">[docs]</a>
<span class="n">strip_non_numeric_values_multicol</span> <span class="o">=</span> <span class="n">multicol_transform_factory</span><span class="p">(</span><span class="n">strip_non_numeric_values</span><span class="p">)</span></div>



<span class="c1">################################################################################</span>
<span class="c1"># Categorize Strings</span>
<span class="c1">################################################################################</span>
<div class="viewcode-block" id="StringCategories">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.StringCategories">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">StringCategories</span><span class="p">(</span><span class="n">TransformParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Mappings to categorize the values in freeform string columns.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="StringCategories.categories">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.StringCategories.categories">[docs]</a>
    <span class="n">categories</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;Mapping from a categorical string to the set of the values it should replace.</span>

<span class="sd">    When specifying StringCategories in dictionary format, you may store either</span>
<span class="sd">    a dict or a :class:`pathlib.Path` at this key. If a Path, it must point to a</span>
<span class="sd">    YAML file which encodes the dictionary like so::</span>

<span class="sd">        categories: dict[str, set[str]] = {...}</span>
<span class="sd">        with open(&quot;categoryfile.yml&quot;, &quot;w&quot;) as f:</span>
<span class="sd">            yaml.dump(</span>
<span class="sd">                {</span>
<span class="sd">                    cat: sorted(val)</span>
<span class="sd">                    for cat, val in categories.items()</span>
<span class="sd">                },</span>
<span class="sd">                f</span>
<span class="sd">            )</span>

<span class="sd">    We recommend putting any YAML files within a dataset directory in ``src/pudl/package_data``.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="StringCategories.na_category">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.StringCategories.na_category">[docs]</a>
    <span class="n">na_category</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;na_category&quot;</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;All strings mapped to this category will be set to NA at the end.</span>

<span class="sd">    The NA category is a special case because testing whether a value is NA is complex,</span>
<span class="sd">    given the many different values which can be used to represent NA. See</span>
<span class="sd">    :func:`categorize_strings` to see how it is used.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;categories&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;before&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="StringCategories.maybe_load_categories">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.StringCategories.maybe_load_categories">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">maybe_load_categories</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;If categories was specified as a Path, load it from disk.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">Path</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">v</span><span class="o">.</span><span class="n">open</span><span class="p">()</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">{</span><span class="n">cat</span><span class="p">:</span> <span class="nb">set</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="k">for</span> <span class="n">cat</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">return</span> <span class="n">v</span></div>


    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;categories&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="StringCategories.categories_are_disjoint">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.StringCategories.categories_are_disjoint">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">categories_are_disjoint</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Ensure that each string to be categorized only appears in one category.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">cat1</span><span class="p">,</span> <span class="n">cat2</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">intersection</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">cat1</span><span class="p">])</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">cat2</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">intersection</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;String categories are not disjoint. </span><span class="si">{</span><span class="n">cat1</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">cat2</span><span class="si">}</span><span class="s2"> both &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;contain these values: </span><span class="si">{</span><span class="n">intersection</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span></div>


    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;categories&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="StringCategories.categories_are_idempotent">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.StringCategories.categories_are_idempotent">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">categories_are_idempotent</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Ensure that every category contains the string it will map to.</span>

<span class="sd">        This ensures that if the categorization is applied more than once, it doesn&#39;t</span>
<span class="sd">        change the output.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cat</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="n">cat</span><span class="p">]:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;String category </span><span class="si">{</span><span class="n">cat</span><span class="si">}</span><span class="s2"> does not map to itself. Adding it.&quot;</span><span class="p">)</span>
                <span class="n">v</span><span class="p">[</span><span class="n">cat</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">cat</span><span class="p">]</span><span class="o">.</span><span class="n">union</span><span class="p">({</span><span class="n">cat</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">v</span></div>


    <span class="nd">@property</span>
<div class="viewcode-block" id="StringCategories.mapping">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.StringCategories.mapping">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">mapping</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A 1-to-1 mapping appropriate for use with :meth:`pd.Series.map`.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="n">string</span><span class="p">:</span> <span class="n">cat</span> <span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">categories</span> <span class="k">for</span> <span class="n">string</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">categories</span><span class="p">[</span><span class="n">cat</span><span class="p">]</span>
        <span class="p">}</span></div>
</div>



<div class="viewcode-block" id="categorize_strings">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.categorize_strings">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">categorize_strings</span><span class="p">(</span><span class="n">col</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">StringCategories</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Impose a controlled vocabulary on a freeform string column.</span>

<span class="sd">    Note that any value present in the data that is not mapped to one of the output</span>
<span class="sd">    categories will be set to NA.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">uncategorized_strings</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">mapping</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">uncategorized_strings</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">col</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">uncategorized_strings</span><span class="p">)</span><span class="si">}</span><span class="s2"> uncategorized values: &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">uncategorized_strings</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="n">col</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">mapping</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">StringDtype</span><span class="p">())</span>
    <span class="n">col</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">col</span> <span class="o">==</span> <span class="n">params</span><span class="o">.</span><span class="n">na_category</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NA</span>
    <span class="k">return</span> <span class="n">col</span></div>



<div class="viewcode-block" id="categorize_strings_multicol">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.categorize_strings_multicol">[docs]</a>
<span class="n">categorize_strings_multicol</span> <span class="o">=</span> <span class="n">multicol_transform_factory</span><span class="p">(</span><span class="n">categorize_strings</span><span class="p">)</span></div>

<span class="sd">&quot;&quot;&quot;A multi-column version of the :func:`categorize_strings` function.&quot;&quot;&quot;</span>


<span class="c1">################################################################################</span>
<span class="c1"># Convert Units</span>
<span class="c1">################################################################################</span>
<div class="viewcode-block" id="UnitConversion">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.UnitConversion">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">UnitConversion</span><span class="p">(</span><span class="n">TransformParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A column-wise unit conversion which can also rename the column.</span>

<span class="sd">    Allows simple linear conversions of the form y(x) = a*x + b. Note that the default</span>
<span class="sd">    values result in no alteration of the column.</span>

<span class="sd">    Args:</span>
<span class="sd">        multiplier: A multiplicative coefficient; &quot;a&quot; in the equation above. Set to 1.0</span>
<span class="sd">            by default.</span>
<span class="sd">        adder: An additive constant; &quot;b&quot; in the equation above. Set to 0.0 by default.</span>
<span class="sd">        from_unit: A string that will be replaced in the input series name. If None or</span>
<span class="sd">            the empty string, the series is not renamed.</span>
<span class="sd">        to_unit: The string from_unit is replaced with. If None or the empty string,</span>
<span class="sd">            the series is not renamed. Note that either both or neither of ``from_unit``</span>
<span class="sd">            and ``to_unit`` can be left unset, but not just one of them.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="UnitConversion.multiplier">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.UnitConversion.multiplier">[docs]</a>
    <span class="n">multiplier</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># By default, multiply by 1 (no change)</span></div>

<div class="viewcode-block" id="UnitConversion.adder">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.UnitConversion.adder">[docs]</a>
    <span class="n">adder</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># By default, add 0 (no change)</span></div>

<div class="viewcode-block" id="UnitConversion.from_unit">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.UnitConversion.from_unit">[docs]</a>
    <span class="n">from_unit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>  <span class="c1"># If it&#39;s the empty string, no renaming will happen.</span></div>

<div class="viewcode-block" id="UnitConversion.to_unit">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.UnitConversion.to_unit">[docs]</a>
    <span class="n">to_unit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>  <span class="c1"># If it&#39;s the empty string, no renaming will happen.</span></div>


    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="UnitConversion.both_or_neither_units_are_none">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.UnitConversion.both_or_neither_units_are_none">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">both_or_neither_units_are_none</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Ensure that either both or neither of the units strings are None.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">from_unit</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_unit</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">from_unit</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_unit</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Either both or neither of from_unit and to_unit must be non-empty. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Got </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">from_unit</span><span class="si">=}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">to_unit</span><span class="si">=}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="UnitConversion.inverse">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.UnitConversion.inverse">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">inverse</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;UnitConversion&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct a :class:`UnitConversion` that is the inverse of self.</span>

<span class="sd">        Allows a unit conversion to be undone. This is currently used in the context of</span>
<span class="sd">        validating the combination of :class:`UnitConversions` that are used in the</span>
<span class="sd">        :class:`UnitCorrections` parameter model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">UnitConversion</span><span class="p">(</span>
            <span class="n">multiplier</span><span class="o">=</span><span class="mf">1.0</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiplier</span><span class="p">,</span>
            <span class="n">adder</span><span class="o">=-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adder</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiplier</span><span class="p">),</span>
            <span class="n">from_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">to_unit</span><span class="p">,</span>
            <span class="n">to_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">from_unit</span><span class="p">,</span>
        <span class="p">)</span></div>


    <span class="nd">@property</span>
<div class="viewcode-block" id="UnitConversion.pattern">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.UnitConversion.pattern">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Regular expression based on from_unit for use with :func:`re.sub`.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">r</span><span class="s2">&quot;^(.*)&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_unit</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;(.*)$&quot;</span></div>


    <span class="nd">@property</span>
<div class="viewcode-block" id="UnitConversion.repl">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.UnitConversion.repl">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">repl</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Regex backreference to parentheticals, for use with :func:`re.sub`.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">r</span><span class="s2">&quot;\1&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_unit</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;\2&quot;</span></div>
</div>



<div class="viewcode-block" id="convert_units">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.convert_units">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">convert_units</span><span class="p">(</span><span class="n">col</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">UnitConversion</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert column units and rename the column to reflect the change.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">from_unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">new_name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">pattern</span><span class="p">,</span> <span class="n">repl</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">repl</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="n">col</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="c1"># only apply the unit conversion if the column name matched the pattern</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">pattern</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="n">col</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">col</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> did not match the unit rename pattern. Check for typos &quot;</span>
                <span class="s2">&quot;and make sure you&#39;re applying the conversion to an appropriate column.&quot;</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">new_name</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">name</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">new_name</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">from_unit</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">to_unit</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Old and new column names are identical: </span><span class="si">{</span><span class="n">col</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
    <span class="n">col</span> <span class="o">=</span> <span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">multiplier</span> <span class="o">*</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">col</span><span class="p">))</span> <span class="o">+</span> <span class="n">params</span><span class="o">.</span><span class="n">adder</span>
    <span class="n">col</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">new_name</span>
    <span class="k">return</span> <span class="n">col</span></div>



<div class="viewcode-block" id="convert_units_multicol">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.convert_units_multicol">[docs]</a>
<span class="n">convert_units_multicol</span> <span class="o">=</span> <span class="n">multicol_transform_factory</span><span class="p">(</span><span class="n">convert_units</span><span class="p">)</span></div>

<span class="sd">&quot;&quot;&quot;A multi-column version of the :func:`convert_units` function.&quot;&quot;&quot;</span>


<span class="c1">################################################################################</span>
<span class="c1"># Nullify outlying values not within the valid range</span>
<span class="c1">################################################################################</span>
<div class="viewcode-block" id="ValidRange">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.ValidRange">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ValidRange</span><span class="p">(</span><span class="n">TransformParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Column level specification of min and/or max values.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="ValidRange.lower_bound">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.ValidRange.lower_bound">[docs]</a>
    <span class="n">lower_bound</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span></div>

<div class="viewcode-block" id="ValidRange.upper_bound">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.ValidRange.upper_bound">[docs]</a>
    <span class="n">upper_bound</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span></div>


    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;upper_bound&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="ValidRange.upper_bound_gte_lower_bound">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.ValidRange.upper_bound_gte_lower_bound">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">upper_bound_gte_lower_bound</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">upper_bound</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">info</span><span class="p">:</span> <span class="n">ValidationInfo</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Require upper bound to be greater than or equal to lower bound.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">info</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;lower_bound&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">upper_bound</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;upper_bound must be greater than or equal to lower_bound&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">upper_bound</span></div>
</div>



<div class="viewcode-block" id="nullify_outliers">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.nullify_outliers">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">nullify_outliers</span><span class="p">(</span><span class="n">col</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">ValidRange</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set any values outside the valid range to NA.</span>

<span class="sd">    The column is coerced to be numeric.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Surprisingly, pd.to_numeric() did *not* return a copy of the series!</span>
    <span class="n">col</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">col</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span>
    <span class="n">col</span><span class="p">[</span><span class="o">~</span><span class="n">col</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">lower_bound</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">upper_bound</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">return</span> <span class="n">col</span></div>



<div class="viewcode-block" id="nullify_outliers_multicol">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.nullify_outliers_multicol">[docs]</a>
<span class="n">nullify_outliers_multicol</span> <span class="o">=</span> <span class="n">multicol_transform_factory</span><span class="p">(</span><span class="n">nullify_outliers</span><span class="p">)</span></div>

<span class="sd">&quot;&quot;&quot;A multi-column version of the :func:`nullify_outliers` function.&quot;&quot;&quot;</span>


<span class="c1">################################################################################</span>
<span class="c1"># Correct units based on inferred data entry errors or implicit units.</span>
<span class="c1">################################################################################</span>
<div class="viewcode-block" id="UnitCorrections">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.UnitCorrections">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">UnitCorrections</span><span class="p">(</span><span class="n">TransformParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fix outlying values resulting from apparent unit errors.</span>

<span class="sd">    Note that since the unit correction depends on other columns in the dataframe to</span>
<span class="sd">    select a relevant subset of records, it is a table transform not a column transform,</span>
<span class="sd">    and so needs to know what column it applies to internally.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="UnitCorrections.data_col">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.UnitCorrections.data_col">[docs]</a>
    <span class="n">data_col</span><span class="p">:</span> <span class="nb">str</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;The label of the column to be modified.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="UnitCorrections.cat_col">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.UnitCorrections.cat_col">[docs]</a>
    <span class="n">cat_col</span><span class="p">:</span> <span class="nb">str</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;Label of a categorical column which will be used to select records to correct.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="UnitCorrections.cat_val">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.UnitCorrections.cat_val">[docs]</a>
    <span class="n">cat_val</span><span class="p">:</span> <span class="nb">str</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;Categorical value to use to select records for correction.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="UnitCorrections.valid_range">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.UnitCorrections.valid_range">[docs]</a>
    <span class="n">valid_range</span><span class="p">:</span> <span class="n">ValidRange</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;The range of values expected to be found in ``data_col``.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="UnitCorrections.unit_conversions">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.UnitCorrections.unit_conversions">[docs]</a>
    <span class="n">unit_conversions</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">UnitConversion</span><span class="p">]</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;A list of unit conversions to use to identify errors and correct them.&quot;&quot;&quot;</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;unit_conversions&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="UnitCorrections.no_column_rename">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.UnitCorrections.no_column_rename">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">no_column_rename</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">UnitConversion</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">UnitConversion</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Ensure that the unit conversions used in corrections don&#39;t rename the column.</span>

<span class="sd">        This constraint is imposed so that the same unit conversion definitions can be</span>
<span class="sd">        re-used both for unit corrections and normal columnwise unit conversions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_conversions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">uc</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="n">new_conversions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">UnitConversion</span><span class="p">(</span><span class="n">multiplier</span><span class="o">=</span><span class="n">uc</span><span class="o">.</span><span class="n">multiplier</span><span class="p">,</span> <span class="n">adder</span><span class="o">=</span><span class="n">uc</span><span class="o">.</span><span class="n">adder</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">new_conversions</span></div>


    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="UnitCorrections.distinct_domains">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.UnitCorrections.distinct_domains">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">distinct_domains</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Verify that all unit conversions map distinct domains to the valid range.</span>

<span class="sd">        If the domains being mapped to the valid range overlap, then it is ambiguous</span>
<span class="sd">        which unit conversion should be applied to the original value.</span>

<span class="sd">        * For all unit conversions calculate the range of original values that result</span>
<span class="sd">          from the inverse of the specified unit conversion applied to the valid</span>
<span class="sd">          ranges of values.</span>
<span class="sd">        * For all pairs of unit conversions verify that their original data ranges do</span>
<span class="sd">          not overlap with each other. We must also ensure that the original and</span>
<span class="sd">          converted ranges of each individual correction do not overlap. For example, if</span>
<span class="sd">          the valid range is from 1 to 10, and the unit conversion multiplies by 3, we&#39;d</span>
<span class="sd">          be unable to distinguish a valid value of 6 from a value that should be</span>
<span class="sd">          corrected to be 2.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">input_vals</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">valid_range</span><span class="o">.</span><span class="n">lower_bound</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_range</span><span class="o">.</span><span class="n">upper_bound</span><span class="p">],</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;dude&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># We need to make sure that the unit conversion doesn&#39;t map the valid range</span>
        <span class="c1"># onto itself either, so add an additional conversion that does nothing:</span>
        <span class="n">uc_combos</span> <span class="o">=</span> <span class="n">combinations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unit_conversions</span> <span class="o">+</span> <span class="p">[</span><span class="n">UnitConversion</span><span class="p">()],</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">uc1</span><span class="p">,</span> <span class="n">uc2</span> <span class="ow">in</span> <span class="n">uc_combos</span><span class="p">:</span>
            <span class="n">out1</span> <span class="o">=</span> <span class="n">convert_units</span><span class="p">(</span><span class="n">input_vals</span><span class="p">,</span> <span class="n">uc1</span><span class="o">.</span><span class="n">inverse</span><span class="p">())</span>
            <span class="n">out2</span> <span class="o">=</span> <span class="n">convert_units</span><span class="p">(</span><span class="n">input_vals</span><span class="p">,</span> <span class="n">uc2</span><span class="o">.</span><span class="n">inverse</span><span class="p">())</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">((</span><span class="nb">min</span><span class="p">(</span><span class="n">out1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">(</span><span class="n">out2</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">out1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">min</span><span class="p">(</span><span class="n">out2</span><span class="p">))):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;The following pair of unit corrections are incompatible due to &quot;</span>
                    <span class="s2">&quot;overlapping domains.</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">valid_range</span><span class="si">=}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">uc1</span><span class="si">=}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">uc2</span><span class="si">=}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>
</div>



<div class="viewcode-block" id="correct_units">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.correct_units">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">correct_units</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">UnitCorrections</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Correct outlying values based on inferred discrepancies in reported units.</span>

<span class="sd">    In many cases we know that a particular column in the database should have a value</span>
<span class="sd">    within a particular range (e.g. the heat content of a ton of coal is a well defined</span>
<span class="sd">    physical quantity -- it can be 15 mmBTU/ton or 22 mmBTU/ton, but it can&#39;t be 1</span>
<span class="sd">    mmBTU/ton or 100 mmBTU/ton).</span>

<span class="sd">    Sometimes these fields are reported in the wrong units (e.g. kWh of electricity</span>
<span class="sd">    generated rather than MWh) resulting in several recognizable populations of reported</span>
<span class="sd">    values showing up at different ranges of value within the data. In cases where the</span>
<span class="sd">    unit conversion and range of valid values are such that these populations do not</span>
<span class="sd">    overlap, it&#39;s possible to convert them to the canonical units fairly unambiguously.</span>

<span class="sd">    This issue is especially common in the context of fuel attributes, because fuels are</span>
<span class="sd">    reported in terms of many different units. Because fuels with different units are</span>
<span class="sd">    often reported in the same column, and different fuels have different valid ranges</span>
<span class="sd">    of values, it&#39;s also necessary to be able to select only a subset of the data that</span>
<span class="sd">    pertains to a particular fuel. This means filtering based on another column, so the</span>
<span class="sd">    function needs to have access to the whole dataframe.</span>

<span class="sd">    Data values which are not found in one of the expected ranges are set to NA.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Correcting units of </span><span class="si">{</span><span class="n">params</span><span class="o">.</span><span class="n">data_col</span><span class="si">}</span><span class="s2"> &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;where </span><span class="si">{</span><span class="n">params</span><span class="o">.</span><span class="n">cat_col</span><span class="si">}</span><span class="s2">==</span><span class="si">{</span><span class="n">params</span><span class="o">.</span><span class="n">cat_val</span><span class="si">}</span><span class="s2">.&quot;</span>
    <span class="p">)</span>
    <span class="c1"># Select a subset of the input dataframe to work on. E.g. only the heat content</span>
    <span class="c1"># column for coal records:</span>
    <span class="n">selected</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">params</span><span class="o">.</span><span class="n">cat_col</span><span class="p">]</span> <span class="o">==</span> <span class="n">params</span><span class="o">.</span><span class="n">cat_val</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">data_col</span><span class="p">]</span>
    <span class="n">not_selected</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">params</span><span class="o">.</span><span class="n">data_col</span><span class="p">]</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">selected</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

    <span class="c1"># Now, we only want to alter the subset of these values which, when transformed by</span>
    <span class="c1"># the unit conversion, lie in the range of valid values.</span>
    <span class="k">for</span> <span class="n">uc</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">unit_conversions</span><span class="p">:</span>
        <span class="n">converted</span> <span class="o">=</span> <span class="n">convert_units</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="n">selected</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">uc</span><span class="p">)</span>
        <span class="n">converted</span> <span class="o">=</span> <span class="n">nullify_outliers</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="n">converted</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">valid_range</span><span class="p">)</span>
        <span class="n">selected</span> <span class="o">=</span> <span class="n">selected</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">converted</span><span class="o">.</span><span class="n">isna</span><span class="p">(),</span> <span class="n">converted</span><span class="p">)</span>

    <span class="c1"># Nullify outliers that remain after the corrections have been applied.</span>
    <span class="n">na_before</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">selected</span><span class="o">.</span><span class="n">isna</span><span class="p">())</span>
    <span class="n">selected</span> <span class="o">=</span> <span class="n">nullify_outliers</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="n">selected</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">valid_range</span><span class="p">)</span>
    <span class="n">na_after</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">selected</span><span class="o">.</span><span class="n">isna</span><span class="p">())</span>
    <span class="n">total_nullified</span> <span class="o">=</span> <span class="n">na_after</span> <span class="o">-</span> <span class="n">na_before</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">total_nullified</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">selected</span><span class="p">)</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">total_nullified</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">selected</span><span class="p">)</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2">) &quot;</span>
        <span class="s2">&quot;of records could not be corrected and were set to NA.&quot;</span>
    <span class="p">)</span>
    <span class="c1"># Combine our cleaned up values with the other values we didn&#39;t select.</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">df</span><span class="p">[</span><span class="n">params</span><span class="o">.</span><span class="n">data_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">selected</span><span class="p">,</span> <span class="n">not_selected</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">df</span></div>



<span class="c1">################################################################################</span>
<span class="c1"># Drop invalid rows</span>
<span class="c1">################################################################################</span>
<div class="viewcode-block" id="InvalidRows">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.InvalidRows">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">InvalidRows</span><span class="p">(</span><span class="n">TransformParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pameters that identify invalid rows to drop.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="InvalidRows.invalid_values">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.InvalidRows.invalid_values">[docs]</a>
    <span class="n">invalid_values</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">set</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;A list of values that should be considered invalid in the selected columns.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="InvalidRows.required_valid_cols">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.InvalidRows.required_valid_cols">[docs]</a>
    <span class="n">required_valid_cols</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;List of columns passed into :meth:`pd.filter` as the ``items`` argument.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="InvalidRows.allowed_invalid_cols">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.InvalidRows.allowed_invalid_cols">[docs]</a>
    <span class="n">allowed_invalid_cols</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;List of columns *not* to search for valid values to preserve.</span>

<span class="sd">    Used to construct an ``items`` argument for :meth:`pd.filter`. This option is useful</span>
<span class="sd">    when a table is wide, and specifying all ``required_valid_cols`` would be tedious.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="InvalidRows.like">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.InvalidRows.like">[docs]</a>
    <span class="n">like</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;A string to use as the ``like`` argument to :meth:`pd.filter`&quot;&quot;&quot;</span>

<div class="viewcode-block" id="InvalidRows.regex">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.InvalidRows.regex">[docs]</a>
    <span class="n">regex</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;A regular expression to use as the ``regex`` argument to :meth:`pd.filter`.&quot;&quot;&quot;</span>

    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="InvalidRows.one_filter_argument">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.InvalidRows.one_filter_argument">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">one_filter_argument</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate that only one argument is specified for :meth:`pd.filter`.&quot;&quot;&quot;</span>
        <span class="n">num_args</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
            <span class="nb">int</span><span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">required_valid_cols</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">allowed_invalid_cols</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">like</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">regex</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">num_args</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span>
                <span class="s2">&quot;You must specify at most one argument to :meth:`pd.filter` and &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">num_args</span><span class="si">}</span><span class="s2"> were found.&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span></div>
</div>



<div class="viewcode-block" id="drop_invalid_rows">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.drop_invalid_rows">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">drop_invalid_rows</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">InvalidRows</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Drop rows with only invalid values in all specified columns.</span>

<span class="sd">    This method finds all rows in a dataframe that contain ONLY invalid data in ALL of</span>
<span class="sd">    the columns that we are checking, and drops those rows, logging the % of all rows</span>
<span class="sd">    that were dropped.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># The default InvalidRows() instance has no effect:</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="n">params</span><span class="o">.</span><span class="n">required_valid_cols</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="ow">and</span> <span class="n">params</span><span class="o">.</span><span class="n">allowed_invalid_cols</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="ow">and</span> <span class="n">params</span><span class="o">.</span><span class="n">like</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="ow">and</span> <span class="n">params</span><span class="o">.</span><span class="n">regex</span> <span class="ow">is</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="ow">or</span> <span class="n">params</span><span class="o">.</span><span class="n">invalid_values</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="n">pre_drop_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">required_valid_cols</span> <span class="ow">or</span> <span class="n">params</span><span class="o">.</span><span class="n">allowed_invalid_cols</span><span class="p">:</span>
        <span class="c1"># check if the columns enumerated are actually in the df</span>
        <span class="n">possible_cols</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">params</span><span class="o">.</span><span class="n">required_valid_cols</span> <span class="ow">or</span> <span class="p">[]</span> <span class="o">+</span> <span class="n">params</span><span class="o">.</span><span class="n">allowed_invalid_cols</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="p">)</span>
        <span class="n">missing_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">possible_cols</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">missing_cols</span> <span class="ow">and</span> <span class="n">params</span><span class="o">.</span><span class="n">allowed_invalid_cols</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Columns used as drop_invalid_rows parameters do not appear in &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;dataframe: </span><span class="si">{</span><span class="n">missing_cols</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">missing_cols</span> <span class="ow">and</span> <span class="n">params</span><span class="o">.</span><span class="n">required_valid_cols</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Some required valid columns in drop_invalid_rows are missing from &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;dataframe: </span><span class="si">{</span><span class="n">missing_cols</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="c1"># set filter items using either required_valid_cols or allowed_invalid_cols</span>
        <span class="n">items</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">required_valid_cols</span> <span class="ow">or</span> <span class="p">[</span>
            <span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">allowed_invalid_cols</span>
        <span class="p">]</span>

    <span class="c1"># Filter to select the subset of COLUMNS we want to check for valid values:</span>
    <span class="n">cols_to_check</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
        <span class="n">items</span><span class="o">=</span><span class="n">items</span><span class="p">,</span> <span class="n">like</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">like</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">regex</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;columns&quot;</span>
    <span class="p">)</span>
    <span class="c1"># Create a boolean mask selecting the ROWS where NOT ALL of the columns we</span>
    <span class="c1"># care about are invalid (i.e. where ANY of the columns we care about contain a</span>
    <span class="c1"># valid value):</span>

    <span class="c1"># For some reason, a simple cols_to_check.isin(params.invalid_values) fails</span>
    <span class="c1"># on some dfs with NA values. this cols_to_check.transform() is intended as</span>
    <span class="c1"># a drop-in replacement for cols_to_check.isin(params.invalid_values)</span>
    <span class="n">invalids</span> <span class="o">=</span> <span class="n">cols_to_check</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">invalid_values</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="o">~</span><span class="p">(</span><span class="n">invalids</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;columns&quot;</span><span class="p">))</span>
    <span class="c1"># Mask the input dataframe and make a copy to avoid returning a slice.</span>
    <span class="n">df_out</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_out</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">pre_drop_len</span><span class="p">)</span><span class="si">:</span><span class="s2">.1%</span><span class="si">}</span><span class="s2"> of records (</span><span class="si">{</span><span class="n">pre_drop_len</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">df_out</span><span class="p">)</span><span class="si">}</span><span class="s2"> &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;rows) contain only </span><span class="si">{</span><span class="n">params</span><span class="o">.</span><span class="n">invalid_values</span><span class="si">}</span><span class="s2"> values in required columns. &quot;</span>
        <span class="s2">&quot;Dropped these 💩💩💩 records.&quot;</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">df_out</span></div>



<span class="c1">################################################################################</span>
<span class="c1"># Replace values with NA</span>
<span class="c1">################################################################################</span>
<div class="viewcode-block" id="ReplaceWithNa">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.ReplaceWithNa">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ReplaceWithNa</span><span class="p">(</span><span class="n">TransformParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pameters that replace certain values with NA.</span>

<span class="sd">    The categorize strings function replaces bad values, but it requires all the values</span>
<span class="sd">    in the column to fall under a certain category. This function allows you to replace</span>
<span class="sd">    certain specific values with NA without having to categorize the rest of the column.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ReplaceWithNa.replace_with_na">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.ReplaceWithNa.replace_with_na">[docs]</a>
    <span class="n">replace_with_na</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;A list of values that should be replaced with NA.&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="replace_with_na">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.replace_with_na">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">replace_with_na</span><span class="p">(</span><span class="n">col</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">ReplaceWithNa</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Replace specified values with NA.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">col</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">replace_with_na</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">)</span></div>



<div class="viewcode-block" id="replace_with_na_multicol">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.replace_with_na_multicol">[docs]</a>
<span class="n">replace_with_na_multicol</span> <span class="o">=</span> <span class="n">multicol_transform_factory</span><span class="p">(</span><span class="n">replace_with_na</span><span class="p">)</span></div>

<span class="sd">&quot;&quot;&quot;A multi-column version of the :func:`nullify_outliers` function.&quot;&quot;&quot;</span>

<span class="c1">################################################################################</span>
<span class="c1"># Spot fix missing values</span>
<span class="c1">################################################################################</span>


<div class="viewcode-block" id="SpotFixes">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.SpotFixes">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">SpotFixes</span><span class="p">(</span><span class="n">TransformParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parameters that replace certain values with a manually corrected value.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="SpotFixes.idx_cols">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.SpotFixes.idx_cols">[docs]</a>
    <span class="n">idx_cols</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;The column(s) used to identify a record.&quot;&quot;&quot;</span>
<div class="viewcode-block" id="SpotFixes.fix_cols">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.SpotFixes.fix_cols">[docs]</a>
    <span class="n">fix_cols</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;The column(s) to be fixed.&quot;&quot;&quot;</span>
<div class="viewcode-block" id="SpotFixes.expect_unique">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.SpotFixes.expect_unique">[docs]</a>
    <span class="n">expect_unique</span><span class="p">:</span> <span class="nb">bool</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set to True if each fix should correspond to only one row.&quot;&quot;&quot;</span>
<div class="viewcode-block" id="SpotFixes.spot_fixes">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.SpotFixes.spot_fixes">[docs]</a>
    <span class="n">spot_fixes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">bool</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;A tuple containing the values of the idx_cols and fix_cols for each fix.&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="spot_fix_values">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.spot_fix_values">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">spot_fix_values</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">SpotFixes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Manually fix one-off singular missing values and typos across a DataFrame.</span>

<span class="sd">    Use this function to correct typos, missing values that are easily manually</span>
<span class="sd">    identified through manual investigation of records, consistent issues for a small</span>
<span class="sd">    number of records (e.g. incorrectly entered capacity data for 2-3 plants).</span>

<span class="sd">    From an instance of :class:`SpotFixes`, this function takes a list of sets of</span>
<span class="sd">    manual fixes and applies them to the specified records in a given dataframe. Each</span>
<span class="sd">    set of fixes contains a list of identifying columns, a list of columns to be fixed,</span>
<span class="sd">    and the values to be updated. A ValueError will be returned if spot-fixed datatypes</span>
<span class="sd">    do not match those of the inputted dataframe. For each set of fixes, the</span>
<span class="sd">    expect_unique parameter allows users to specify whether each fix should be applied</span>
<span class="sd">    only to one row.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The same input DataFrame but with some spot fixes corrected.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">spot_fixes_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="n">params</span><span class="o">.</span><span class="n">spot_fixes</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">idx_cols</span> <span class="o">+</span> <span class="n">params</span><span class="o">.</span><span class="n">fix_cols</span>
    <span class="p">)</span>

    <span class="c1"># Convert input datatypes to match corresponding df columns.</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">spot_fixes_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">spot_fixes_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">spot_fixes_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dtypes</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="n">spot_fixes_df</span> <span class="o">=</span> <span class="n">spot_fixes_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">idx_cols</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">idx_cols</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">expect_unique</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">is_unique</span><span class="p">:</span>
        <span class="n">cols_list</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">idx_cols</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;This spot fix expects a unique set of idx_col, but the idx_cols provided &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;are not uniquely identifying: </span><span class="si">{</span><span class="n">cols_list</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Only keep spot fix values found in the dataframe index.</span>
    <span class="n">spot_fixes_df</span> <span class="o">=</span> <span class="n">spot_fixes_df</span><span class="p">[</span><span class="n">spot_fixes_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">spot_fixes_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spot_fixes_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">fix_cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">spot_fixes_df</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">df</span></div>



<span class="c1">################################################################################</span>
<span class="c1"># A parameter model collecting all the valid generic transform params:</span>
<span class="c1">################################################################################</span>
<div class="viewcode-block" id="TableTransformParams">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.TableTransformParams">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TableTransformParams</span><span class="p">(</span><span class="n">TransformParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A collection of all the generic transformation parameters for a table.</span>

<span class="sd">    This class is used to instantiate and contain all of the individual</span>
<span class="sd">    :class:`TransformParams` objects that are associated with transforming a given</span>
<span class="sd">    table. It can be instantiated using one of the table-level dictionaries of</span>
<span class="sd">    parameters defined in the dataset-specific modules in :mod:`pudl.transform.params`</span>

<span class="sd">    Data source-specific :class:`TableTransformParams` classes should be defined in</span>
<span class="sd">    the data source-specific transform modules and inherit from this class. See e.g.</span>
<span class="sd">    :class:`pudl.transform.ferc1.Ferc1TableTransformParams`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># MultiColumnTransformParams can be initialized to empty dictionaries, since they</span>
    <span class="c1"># all iterate over the columns they apply to. Empty means... do nothing.</span>
<div class="viewcode-block" id="TableTransformParams.convert_units">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.TableTransformParams.convert_units">[docs]</a>
    <span class="n">convert_units</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">UnitConversion</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="TableTransformParams.categorize_strings">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.TableTransformParams.categorize_strings">[docs]</a>
    <span class="n">categorize_strings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">StringCategories</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="TableTransformParams.nullify_outliers">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.TableTransformParams.nullify_outliers">[docs]</a>
    <span class="n">nullify_outliers</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ValidRange</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="TableTransformParams.normalize_strings">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.TableTransformParams.normalize_strings">[docs]</a>
    <span class="n">normalize_strings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">StringNormalization</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="TableTransformParams.strip_non_numeric_values">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.TableTransformParams.strip_non_numeric_values">[docs]</a>
    <span class="n">strip_non_numeric_values</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">StripNonNumericValues</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="TableTransformParams.replace_with_na">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.TableTransformParams.replace_with_na">[docs]</a>
    <span class="n">replace_with_na</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ReplaceWithNa</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span></div>


    <span class="c1"># Transformations that apply to whole dataframes have to be treated individually,</span>
    <span class="c1"># with default initializations that result in no transformation taking place.</span>

    <span class="c1"># correct_units iterates over a list... so does nothing with an empty list.</span>
<div class="viewcode-block" id="TableTransformParams.correct_units">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.TableTransformParams.correct_units">[docs]</a>
    <span class="n">correct_units</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">UnitCorrections</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span></div>

    <span class="c1"># This instantiates an empty dictionary of column renames:</span>
<div class="viewcode-block" id="TableTransformParams.rename_columns">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.TableTransformParams.rename_columns">[docs]</a>
    <span class="n">rename_columns</span><span class="p">:</span> <span class="n">RenameColumns</span> <span class="o">=</span> <span class="n">RenameColumns</span><span class="p">()</span></div>

    <span class="c1"># InvalidRows has a special case of all None parameters, where it does nothing:</span>
<div class="viewcode-block" id="TableTransformParams.drop_invalid_rows">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.TableTransformParams.drop_invalid_rows">[docs]</a>
    <span class="n">drop_invalid_rows</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">InvalidRows</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span></div>

    <span class="c1"># This instantiates an empty list. The function iterates over a list,</span>
    <span class="c1"># so does nothing.</span>
<div class="viewcode-block" id="TableTransformParams.spot_fix_values">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.TableTransformParams.spot_fix_values">[docs]</a>
    <span class="n">spot_fix_values</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SpotFixes</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span></div>


    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="TableTransformParams.from_dict">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.TableTransformParams.from_dict">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;TableTransformParams&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct ``TableTransformParams`` from a dictionary of keyword arguments.</span>

<span class="sd">        Typically these will be the table-level dictionaries defined in the dataset-</span>
<span class="sd">        specific modules in the :mod:`pudl.transform.params` subpackage. See also the</span>
<span class="sd">        :meth:`TableTransformParams.from_id` method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span></div>


    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="TableTransformParams.from_id">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.TableTransformParams.from_id">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_id</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">table_id</span><span class="p">:</span> <span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;TableTransformParams&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A factory method that looks up transform parameters based on table_id.</span>

<span class="sd">        This is a shortcut, which allows us to constitute the parameter models based on</span>
<span class="sd">        the table they are associated with without having to pass in a potentially large</span>
<span class="sd">        nested data structure, which gets messy in Dagster.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">transform_params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="o">**</span><span class="n">pudl</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">ferc1</span><span class="o">.</span><span class="n">TRANSFORM_PARAMS</span><span class="p">,</span>
            <span class="c1"># **pudl.transform.params.eia860.TRANSFORM_PARAMS,</span>
            <span class="c1"># **pudl.transform.params.eia923.TRANSFORM_PARAMS,</span>
            <span class="c1"># etc... as appropriate</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">transform_params</span><span class="p">[</span><span class="n">table_id</span><span class="o">.</span><span class="n">value</span><span class="p">])</span></div>
</div>



<span class="c1">#####################################################################################</span>
<span class="c1"># Abstract Table Transformer classes</span>
<span class="c1">#####################################################################################</span>
<div class="viewcode-block" id="cache_df">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.cache_df">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">cache_df</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;main&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A decorator for caching dataframes within an :class:`AbstractTableTransformer`.</span>

<span class="sd">    It&#39;s often useful during development or debugging to be able to track the evolution</span>
<span class="sd">    of data as it passes through several transformation steps. Especially when some of</span>
<span class="sd">    the steps are time consuming, it&#39;s nice to still get a copy of the last known state</span>
<span class="sd">    of the data when a transform raises an exception and fails.</span>

<span class="sd">    This decorator lets you easily save a copy of the dataframe being returned by a</span>
<span class="sd">    class method for later reference, before moving on to the next step. Each unique key</span>
<span class="sd">    used within a given :class:`AbstractTableTransformer` instance results in a new</span>
<span class="sd">    dataframe being cached. Re-using the same key will overwrite previously cached</span>
<span class="sd">    dataframes that were stored with that key.</span>

<span class="sd">    Saving many intermediate steps can provide lots of detailed information, but will</span>
<span class="sd">    use more memory. Updating the same cached dataframe as it successfully passes</span>
<span class="sd">    through each step lets you access the last known state it had before an error</span>
<span class="sd">    occurred.</span>

<span class="sd">    This decorator requires that the decorated function return a single</span>
<span class="sd">    :class:`pd.DataFrame`, but it can take any type of inputs.</span>

<span class="sd">    There&#39;s a lot of nested functions in here. For a more thorough explanation, see:</span>
<span class="sd">    https://realpython.com/primer-on-python-decorators/#fancy-decorators</span>

<span class="sd">    Args:</span>
<span class="sd">        key: The key that will be used to store and look up the cached dataframe in the</span>
<span class="sd">            internal ``self._cached_dfs`` dictionary.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The decorated class method.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_decorator</span><span class="p">(</span><span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
        <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">AbstractTableTransformer</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">table_id</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">: The cache_df decorator only works on &quot;</span>
                    <span class="s2">&quot;methods that return a pandas dataframe. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;The method </span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> returned a </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_dfs</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">table_id</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">: Caching df to </span><span class="si">{</span><span class="n">key</span><span class="si">=}</span><span class="s2"> in </span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">()&quot;</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cached_dfs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">df</span>

        <span class="k">return</span> <span class="n">_wrapper</span>

    <span class="k">return</span> <span class="n">_decorator</span></div>



<div class="viewcode-block" id="AbstractTableTransformer">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.AbstractTableTransformer">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">AbstractTableTransformer</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An abstract base table transformer class.</span>

<span class="sd">    This class provides methods for applying the general purpose transform functions to</span>
<span class="sd">    dataframes. These methods should each log that they are running, and the</span>
<span class="sd">    ``table_id`` of the table they&#39;re beiing applied to. By default they should obtain</span>
<span class="sd">    their parameters from the ``params`` which are stored in the class, but should allow</span>
<span class="sd">    other parameters to be passed in.</span>

<span class="sd">    The class also provides a template for coordinating the high level flow of data</span>
<span class="sd">    through the transformations. The main coordinating function that&#39;s used to run the</span>
<span class="sd">    full transformation is :meth:`AbstractTableTransformer.transform`, and the transform</span>
<span class="sd">    is broken down into 3 distinct steps: start, main, and end. Those individual steps</span>
<span class="sd">    need to be defined by child classes. Usually the start and end methods will handle</span>
<span class="sd">    transformations that need to be applied uniformily across all the tables in a given</span>
<span class="sd">    dataset, with the main step containing transformations that are specific to a</span>
<span class="sd">    particular table.</span>

<span class="sd">    In development it&#39;s often useful to be able to review the state of the data at</span>
<span class="sd">    various stages as it progresses through the transformation. The :func:`cache_df`</span>
<span class="sd">    decorator defined above can be applied to individual transform methods or the</span>
<span class="sd">    start, main, and end methods defined in the child classes, to allow intermediate</span>
<span class="sd">    dataframes to be reviewed after the fact. Whether to cache dataframes and whether to</span>
<span class="sd">    delete them upon successful completion of the transform is controlled by flags set</span>
<span class="sd">    when the ``TableTransformer`` class is created.</span>

<span class="sd">    Table-specific transform parameters need to be associated with the class. They can</span>
<span class="sd">    either be passed in explicitly when the class is instantiated, or looked up based on</span>
<span class="sd">    the ``table_id`` associated with the class. See :meth:`TableTransformParams.from_id`</span>

<span class="sd">    The call signature of the :meth:`AbstractTableTransformer.transform_start` method</span>
<span class="sd">    accepts any type of inputs by default, and returns a single :class:`pd.DataFrame`.</span>
<span class="sd">    Later transform steps are assumed to take a single dataframe as input, and return a</span>
<span class="sd">    single dataframe. Since Python is lazy about enforcing types and interfaces you can</span>
<span class="sd">    get away with other kinds of arguments when they&#39;re sometimes necessary, but this</span>
<span class="sd">    isn&#39;t a good arrangement and we should figure out how to do it right. See the</span>
<span class="sd">    :class:`pudl.transform.ferc1.SteamPlantsTableTransformer` class for an example.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="AbstractTableTransformer.table_id">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.AbstractTableTransformer.table_id">[docs]</a>
    <span class="n">table_id</span><span class="p">:</span> <span class="n">enum</span><span class="o">.</span><span class="n">Enum</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;Name of the PUDL database table that this table transformer produces.</span>

<span class="sd">    Must be defined in the database schema / metadata. This ID is used to instantiate</span>
<span class="sd">    the appropriate :class:`TableTransformParams` object.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="AbstractTableTransformer.cache_dfs">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.AbstractTableTransformer.cache_dfs">[docs]</a>
    <span class="n">cache_dfs</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;Whether to cache copies of intermediate dataframes until transformation is done.</span>

<span class="sd">    When True, the TableTransformer will save dataframes internally at each step of the</span>
<span class="sd">    transform, so that they can be inspected easily if the transformation fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="AbstractTableTransformer.clear_cached_dfs">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.AbstractTableTransformer.clear_cached_dfs">[docs]</a>
    <span class="n">clear_cached_dfs</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;Determines whether cached dataframes are deleted at the end of the transform.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="AbstractTableTransformer._cached_dfs">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.AbstractTableTransformer._cached_dfs">[docs]</a>
    <span class="n">_cached_dfs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;Cached intermediate dataframes for use in development and debugging.</span>

<span class="sd">    The dictionary keys are the strings passed to the :func:`cache_df` method decorator.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="AbstractTableTransformer.parameter_model">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.AbstractTableTransformer.parameter_model">[docs]</a>
    <span class="n">parameter_model</span> <span class="o">=</span> <span class="n">TableTransformParams</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;The :mod:`pydantic` model that is used to contain &amp; instantiate parameters.</span>

<span class="sd">    In child classes this should be replaced with the data source-specific</span>
<span class="sd">    :class:`TableTransformParams` class, if it has been defined.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="AbstractTableTransformer.params">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.AbstractTableTransformer.params">[docs]</a>
    <span class="n">params</span><span class="p">:</span> <span class="n">parameter_model</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;The parameters that will be used to control the transformation functions.</span>

<span class="sd">    This attribute is of type ``parameter_model`` which is defined above. This type</span>
<span class="sd">    varies across datasets and is used to construct and validate the parameters based,</span>
<span class="sd">    so it needs to be set separately in child classes. See</span>
<span class="sd">    :class:`pudl.transform.ferc1.Ferc1AbstractTableTransformer` for an example.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">params</span><span class="p">:</span> <span class="n">TableTransformParams</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cache_dfs</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">clear_cached_dfs</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the table transformer, setting caching flags.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># Allowing params to be passed in or looked up makes testing easier, since it</span>
        <span class="c1"># means the same transformer can be run with a variety of parameters and inputs.</span>
        <span class="k">if</span> <span class="n">params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_model</span><span class="o">.</span><span class="n">from_id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_id</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache_dfs</span> <span class="o">=</span> <span class="n">cache_dfs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_cached_dfs</span> <span class="o">=</span> <span class="n">clear_cached_dfs</span>

    <span class="c1">################################################################################</span>
    <span class="c1"># Abstract methods that must be defined by subclasses</span>
    <span class="nd">@abstractmethod</span>
<div class="viewcode-block" id="AbstractTableTransformer.transform_start">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.AbstractTableTransformer.transform_start">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">transform_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Transformations applied to many tables within a dataset at the beginning.</span>

<span class="sd">        This method should be implemented by the dataset-level abstract table</span>
<span class="sd">        transformer class. It does not specify its inputs because different data sources</span>
<span class="sd">        need different inputs. E.g. the FERC 1 transform needs 2 XBRL derived</span>
<span class="sd">        dataframes, and one DBF derived dataframe, while (most) EIA tables just receive</span>
<span class="sd">        and return a single dataframe.</span>

<span class="sd">        This step is often used to organize initial transformations that are applied</span>
<span class="sd">        uniformly across all the tables in a dataset.</span>

<span class="sd">        At the end of this step, all the inputs should have been consolidated into a</span>
<span class="sd">        single dataframe to return.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="o">...</span></div>


    <span class="nd">@abstractmethod</span>
<div class="viewcode-block" id="AbstractTableTransformer.transform_main">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.AbstractTableTransformer.transform_main">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">transform_main</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The method used to do most of the table-specific transformations.</span>

<span class="sd">        Typically the transformations grouped together into this method will be unique</span>
<span class="sd">        to the table that is being transformed. Generally this method will take and</span>
<span class="sd">        return a single dataframe, and that pattern is implemented in the</span>
<span class="sd">        :meth:`AbstractTableTransformer.transform` method. In cases where transforms</span>
<span class="sd">        take or return more than one dataframe, you will need to define a new transform</span>
<span class="sd">        method within the child class. See :class:`SteamPlantsTableTransformer`</span>
<span class="sd">        as an example.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="o">...</span></div>


    <span class="nd">@abstractmethod</span>
<div class="viewcode-block" id="AbstractTableTransformer.transform_end">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.AbstractTableTransformer.transform_end">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">transform_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Transformations applied to many tables within a dataset at the end.</span>

<span class="sd">        This method should be implemented by the dataset-level abstract table</span>
<span class="sd">        transformer class. It should do any standard cleanup that&#39;s required after the</span>
<span class="sd">        table-specific transformations have been applied. E.g. enforcing the table&#39;s</span>
<span class="sd">        database schema and dropping invalid records based on parameterized criteria.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="o">...</span></div>


    <span class="c1">################################################################################</span>
    <span class="c1"># Default method implementations which can be used or overridden by subclasses</span>
<div class="viewcode-block" id="AbstractTableTransformer.transform">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.AbstractTableTransformer.transform">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply all specified transformations to the appropriate input dataframes.&quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transform_start</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transform_main</span><span class="p">)</span>
            <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transform_end</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clear_cached_dfs</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">table_id</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">: Clearing cached dfs: &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cached_dfs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cached_dfs</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">df</span></div>


<div class="viewcode-block" id="AbstractTableTransformer.rename_columns">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.AbstractTableTransformer.rename_columns">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">rename_columns</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">RenameColumns</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Rename the whole collection of dataframe columns using input params.</span>

<span class="sd">        Raise an error if there&#39;s any mismatch between the columns in the dataframe, and</span>
<span class="sd">        the columns that have been defined in the mapping for renaming.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">rename_columns</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">table_id</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">: Attempting to rename </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2"> &quot;</span>
            <span class="s2">&quot;columns.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">rename_columns</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></div>


<div class="viewcode-block" id="AbstractTableTransformer.normalize_strings">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.AbstractTableTransformer.normalize_strings">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">normalize_strings</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method wrapper for string normalization.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">normalize_strings</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">table_id</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">: Normalizing freeform string columns.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">normalize_strings_multicol</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></div>


<div class="viewcode-block" id="AbstractTableTransformer.strip_non_numeric_values">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.AbstractTableTransformer.strip_non_numeric_values">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">strip_non_numeric_values</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method wrapper for stripping non-numeric values.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">strip_non_numeric_values</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">table_id</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">: Stripping non-numeric values from </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">strip_non_numeric_values_multicol</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></div>


<div class="viewcode-block" id="AbstractTableTransformer.categorize_strings">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.AbstractTableTransformer.categorize_strings">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">categorize_strings</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">StringCategories</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method wrapper for string categorization.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">categorize_strings</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">table_id</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">: Categorizing string columns using a controlled &quot;</span>
            <span class="s2">&quot;vocabulary.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">categorize_strings_multicol</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></div>


<div class="viewcode-block" id="AbstractTableTransformer.nullify_outliers">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.AbstractTableTransformer.nullify_outliers">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">nullify_outliers</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ValidRange</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method wrapper for nullifying outlying values.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">nullify_outliers</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">table_id</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">: Nullifying outlying values.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nullify_outliers_multicol</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></div>


<div class="viewcode-block" id="AbstractTableTransformer.convert_units">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.AbstractTableTransformer.convert_units">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">convert_units</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">UnitConversion</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method wrapper for columnwise unit conversions.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">convert_units</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">table_id</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">: Converting units and renaming columns accordingly.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">convert_units_multicol</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></div>


<div class="viewcode-block" id="AbstractTableTransformer.correct_units">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.AbstractTableTransformer.correct_units">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">correct_units</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">params</span><span class="p">:</span> <span class="n">UnitCorrections</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply all specified unit corrections to the table in order.</span>

<span class="sd">        Note: this is a table transform, not a multi-column transform.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">correct_units</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">table_id</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">: Correcting inferred non-standard column units.&quot;</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">correction</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">correct_units</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">correction</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span></div>


<div class="viewcode-block" id="AbstractTableTransformer.drop_invalid_rows">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.AbstractTableTransformer.drop_invalid_rows">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">drop_invalid_rows</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">InvalidRows</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Drop rows with only invalid values in all specified columns.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">drop_invalid_rows</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">table_id</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">: Dropping remaining invalid rows.&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">drop_invalid_rows</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span></div>


<div class="viewcode-block" id="AbstractTableTransformer.replace_with_na">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.AbstractTableTransformer.replace_with_na">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">replace_with_na</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ReplaceWithNa</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Replace specified values with NA.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">replace_with_na</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">table_id</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">: Replacing specified values with NA.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">replace_with_na_multicol</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></div>


<div class="viewcode-block" id="AbstractTableTransformer.spot_fix_values">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.AbstractTableTransformer.spot_fix_values">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">spot_fix_values</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">params</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SpotFixes</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Replace specified values with specified values.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">spot_fix_values</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">table_id</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">: Spot fixing missing values.&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">spot_fix_values</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span></div>


<div class="viewcode-block" id="AbstractTableTransformer.enforce_schema">
<a class="viewcode-back" href="../../../autoapi/pudl/transform/classes/index.html#pudl.transform.classes.AbstractTableTransformer.enforce_schema">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">enforce_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Drop columns not in the DB schema and enforce specified types.&quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">table_id</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">: Enforcing database schema on dataframe.&quot;</span><span class="p">)</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="n">PUDL_PACKAGE</span><span class="o">.</span><span class="n">get_resource</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_id</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">resource</span><span class="o">.</span><span class="n">enforce_schema</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span></div>
</div>

</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2016-2026, Catalyst Cooperative, CC-BY-4.0
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script src="../../../_static/documentation_options.js?v=11fc87b4"></script>
    <script src="../../../_static/doctools.js?v=fd6eb6e6"></script>
    <script src="../../../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script src="../../../_static/scripts/furo.js?v=46bd48cc"></script>
    </body>
</html>