version: 2

sources:
  - name: pudl
    meta:
      external_location: |
        {%- if target.name == "nightly" -%} 'https://s3.us-west-2.amazonaws.com/pudl.catalyst.coop/nightly/{name}.parquet'
        {%- else -%} '{{ env_var('PUDL_OUTPUT') }}/parquet/{name}.parquet'
        {%- endif -%}
    tables:
      - name: out_eia923__boiler_fuel
      - name: out_eia923__monthly_boiler_fuel
      - name: out_ferc1__yearly_steam_plants_fuel_by_plant_sched402
      - name: out_vcerare__hourly_available_capacity_factor
        data_tests:
          - dbt_expectations.expect_table_row_count_to_equal:
              value: |
                {%- if target.name == "etl-fast" -%} 27287400
                {%- else -%} 136437000
                {%- endif -%}
          - dbt_expectations.expect_compound_columns_to_be_unique:
              column_list: ["county_id_fips", "datetime_utc"]
              row_condition: "county_id_fips is not null"
        columns:
          - name: capacity_factor_solar_pv
            data_tests:
              - not_null
              - dbt_expectations.expect_column_max_to_be_between:
                  max_value: 1.02
              - dbt_expectations.expect_column_min_to_be_between:
                  min_value: 0.00
          - name: capacity_factor_offshore_wind
            data_tests:
              - not_null
              - dbt_expectations.expect_column_max_to_be_between:
                  max_value: 1.00
              - dbt_expectations.expect_column_min_to_be_between:
                  min_value: 0.00
          - name: hour_of_year
            data_tests:
              - not_null
              - dbt_expectations.expect_column_max_to_be_between:
                  min_value: 8759
                  max_value: 8761
          - name: datetime_utc
            data_tests:
              - not_null
              - dbt_expectations.expect_column_values_to_not_be_in_set:
                  value_set: ["{{ dbt_date.date(2020, 12, 31) }}"]
          - name: county_or_lake_name
            data_tests:
              - not_null
              - dbt_expectations.expect_column_values_to_not_be_in_set:
                  value_set: ["bedford_city", "clifton_forge_city"]
models:
  - name: ferc1_fbp_cost_per_mmbtu
    columns:
      - name: gas_cost_per_mmbtu
        data_tests:
          - dbt_expectations.expect_column_quantile_values_to_be_between:
              quantile: 0.05
              min_value: 1.5
          - dbt_expectations.expect_column_quantile_values_to_be_between:
              quantile: 0.90
              max_value: 15.0
          - dbt_expectations.expect_column_median_to_be_between:
              min_value: 2.0
              max_value: 10.0
      - name: oil_cost_per_mmbtu
        data_tests:
          - dbt_expectations.expect_column_quantile_values_to_be_between:
              quantile: 0.10
              min_value: 3.5
          - dbt_expectations.expect_column_quantile_values_to_be_between:
              quantile: 0.90
              max_value: 25.0
          - dbt_expectations.expect_column_median_to_be_between:
              min_value: 6.5
              max_value: 17.0
      - name: coal_cost_per_mmbtu
        data_tests:
          - dbt_expectations.expect_column_quantile_values_to_be_between:
              quantile: 0.10
              min_value: 0.75
          - dbt_expectations.expect_column_quantile_values_to_be_between:
              quantile: 0.90
              max_value: 4.0
          - dbt_expectations.expect_column_median_to_be_between:
              min_value: 1.0
              max_value: 2.5
