<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-EXWBBTVMWK"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-EXWBBTVMWK');
    </script>
    <link rel="index" title="Index" href="../genindex.html"><link rel="search" title="Search" href="../search.html"><link rel="next" title="Metadata editing guide" href="metadata.html"><link rel="prev" title="Data validation quickstart" href="data_validation_quickstart.html">
        <link rel="prefetch" href="../_static/catalyst_logo-200x200.png" as="image">

    <!-- Generated with Sphinx 9.1.0 and Furo 2025.12.19 -->
        <title>Data validation reference - PUDL 2026.2.1.dev10 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=d111a655" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=7bdb33bb" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=b1990d62" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=8dab3a3b" />
    
    


<style>
  body {
    --color-code-background: #f2f2f2;
  --color-code-foreground: #1e1e1e;
  --color-announcement-background: yellow;
  --color-announcement-text: red;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-announcement-background: yellow;
  --color-announcement-text: red;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-announcement-background: yellow;
  --color-announcement-text: red;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle site navigation sidebar">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc" aria-label="Toggle table of contents sidebar">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>

<div class="announcement">
  <aside class="announcement-content">
     <b>Take our ~10 minute <a href="https://forms.gle/E9ou5fgMcR7YVRCRA">2026 Energy Data Ecosystem Survey!</b> 
  </aside>
</div>

<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <span class="icon"><svg><use href="#svg-menu"></use></svg></span>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">PUDL 2026.2.1.dev10 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/catalyst_logo-200x200.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">PUDL 2026.2.1.dev10 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">About PUDL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data_access.html">Data Access</a></li>
<li class="toctree-l1"><a class="reference external" href="https://data.catalyst.coop">PUDL Data Viewer</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../data_sources/index.html">Data Sources</a><input aria-label="Toggle navigation of Data Sources" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../data_sources/censusdp1tract.html">Census DP1 – Profile of General Demographic Characteristics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_sources/censuspep.html">Population Estimates Program's (PEP) Federal Information Processing Series (FIPS) Codes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_sources/eiaapi.html">EIA Bulk API Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_sources/eia176.html">EIA Form 176 – Annual Report of Natural and Supplemental Gas Supply and Disposition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_sources/eia860.html">EIA Form 860 – Annual Electric Generator Report</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_sources/eia861.html">EIA Form 861 – Annual Electric Power Industry Report</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_sources/eia923.html">EIA Form 923 – Power Plant Operations Report</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_sources/eia930.html">EIA Form 930 – Hourly and Daily Balancing Authority Operations Report</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_sources/eiaaeo.html">EIA Annual Energy Outlook (AEO)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_sources/epacamd_eia.html">EPA CAMD to EIA Power Sector Data Crosswalk</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_sources/epacems.html">EPA Hourly Continuous Emission Monitoring System (CEMS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_sources/ferc1.html">FERC Form 1 – Annual Report of Major Electric Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_sources/ferc714.html">FERC Form 714 – Annual Electric Balancing Authority Area and Planning Area Report</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_sources/ferceqr.html">FERC Form 920 – Electric Quarterly Report (EQR)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_sources/gridpathratoolkit.html">GridPath Resource Adequacy Toolkit Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_sources/nrelatb.html">NREL Annual Technology Baseline (ATB) for Electricity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_sources/phmsagas.html">Pipelines and Hazardous Materials Safety Administration (PHMSA) Annual Natural Gas Report</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_sources/rus12.html">USDA RUS Form 12 – Financial and Operating Report: Electric Power Supply</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_sources/rus7.html">USDA RUS Form 7 – Financial and Operating Report: Electric Distribution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_sources/sec10k.html">U.S. Securities and Exchange Commission (SEC) Form 10-K</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_sources/vcerare.html">Vibrant Clean Energy Resource Adequacy Renewable Energy (RARE) Power Dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_sources/other_data.html">Other Data in PUDL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_sources/future_data.html">High Priority Target Datasets</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../data_dictionaries/index.html">Data Dictionaries</a><input aria-label="Toggle navigation of Data Dictionaries" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../data_dictionaries/pudl_db.html">PUDL Data Dictionary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_dictionaries/ferc1_db.html">Raw FERC Form 1 Data Dictionary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_dictionaries/codes_and_labels.html">PUDL Code Metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_dictionaries/usage_warnings.html">PUDL Usage Warnings</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../methodology/index.html">Methodology</a><input aria-label="Toggle navigation of Methodology" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../methodology/timeseries_imputation.html">Timeseries Imputation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../methodology/sec10k_modeling.html">SEC 10-K Ownership Data Extraction Modeling</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING.html">Contributing</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Development</a><input aria-label="Toggle navigation of Development" checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="dev_setup.html">Development Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="run_the_etl.html">Running the ETL Pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_dagster.html">Developing with Dagster</a></li>
<li class="toctree-l2"><a class="reference internal" href="project_management.html">Project Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="testing.html">Testing PUDL</a></li>
<li class="toctree-l2"><a class="reference internal" href="data_validation_quickstart.html">Data validation quickstart</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Data validation reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="metadata.html">Metadata editing guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="build_docs.html">Building the Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="datastore.html">Working with the Datastore</a></li>
<li class="toctree-l2"><a class="reference internal" href="clone_ferc1.html">Converting raw FERC data to SQLite</a></li>
<li class="toctree-l2"><a class="reference internal" href="existing_data_updates.html">Existing Data Updates</a></li>
<li class="toctree-l2"><a class="reference internal" href="run_a_release.html">Run a Versioned Release</a></li>
<li class="toctree-l2"><a class="reference internal" href="pudl_id_mapping.html">PUDL ID Mapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="naming_conventions.html">Naming Conventions</a></li>
<li class="toctree-l2"><a class="reference internal" href="data_guidelines.html">Data and ETL Design Guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="nightly_data_builds.html">Nightly Data Builds</a></li>
<li class="toctree-l2"><a class="reference internal" href="ferceqr_data_builds.html">FERC EQR Data Builds</a></li>
<li class="toctree-l2"><a class="reference internal" href="infrastructure_as_code.html">Infrastructure as Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="managing_external_contributions.html">Managing External Contributions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../LICENSE.html">Licensing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../code_of_conduct.html">Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release_notes.html">Release Notes</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../autoapi/index.html">API Reference</a><input aria-label="Toggle navigation of API Reference" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../autoapi/pudl/index.html">pudl</a><input aria-label="Toggle navigation of pudl" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../autoapi/pudl/__main__/index.html">pudl.__main__</a></li>
<li class="toctree-l3"><a class="reference internal" href="../autoapi/pudl/_version/index.html">pudl._version</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../autoapi/pudl/analysis/index.html">pudl.analysis</a><input aria-label="Toggle navigation of pudl.analysis" class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/analysis/allocate_gen_fuel/index.html">pudl.analysis.allocate_gen_fuel</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/analysis/fuel_by_plant/index.html">pudl.analysis.fuel_by_plant</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/analysis/mcoe/index.html">pudl.analysis.mcoe</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../autoapi/pudl/analysis/ml_tools/index.html">pudl.analysis.ml_tools</a><input aria-label="Toggle navigation of pudl.analysis.ml_tools" class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/analysis/ml_tools/experiment_tracking/index.html">pudl.analysis.ml_tools.experiment_tracking</a></li>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/analysis/ml_tools/models/index.html">pudl.analysis.ml_tools.models</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/analysis/plant_parts_eia/index.html">pudl.analysis.plant_parts_eia</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../autoapi/pudl/analysis/record_linkage/index.html">pudl.analysis.record_linkage</a><input aria-label="Toggle navigation of pudl.analysis.record_linkage" class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/analysis/record_linkage/classify_plants_ferc1/index.html">pudl.analysis.record_linkage.classify_plants_ferc1</a></li>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/analysis/record_linkage/eia_ferc1_inputs/index.html">pudl.analysis.record_linkage.eia_ferc1_inputs</a></li>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/analysis/record_linkage/eia_ferc1_model_config/index.html">pudl.analysis.record_linkage.eia_ferc1_model_config</a></li>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/analysis/record_linkage/eia_ferc1_record_linkage/index.html">pudl.analysis.record_linkage.eia_ferc1_record_linkage</a></li>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/analysis/record_linkage/eia_ferc1_train/index.html">pudl.analysis.record_linkage.eia_ferc1_train</a></li>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/analysis/record_linkage/embed_dataframe/index.html">pudl.analysis.record_linkage.embed_dataframe</a></li>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/analysis/record_linkage/link_cross_year/index.html">pudl.analysis.record_linkage.link_cross_year</a></li>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/analysis/record_linkage/name_cleaner/index.html">pudl.analysis.record_linkage.name_cleaner</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/analysis/service_territory/index.html">pudl.analysis.service_territory</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/analysis/spatial/index.html">pudl.analysis.spatial</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/analysis/state_demand/index.html">pudl.analysis.state_demand</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/analysis/timeseries_cleaning/index.html">pudl.analysis.timeseries_cleaning</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/analysis/timeseries_evaluation/index.html">pudl.analysis.timeseries_evaluation</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../autoapi/pudl/convert/index.html">pudl.convert</a><input aria-label="Toggle navigation of pudl.convert" class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/convert/censusdp1tract_to_sqlite/index.html">pudl.convert.censusdp1tract_to_sqlite</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/convert/metadata_to_rst/index.html">pudl.convert.metadata_to_rst</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../autoapi/pudl/dbt_wrapper/index.html">pudl.dbt_wrapper</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../autoapi/pudl/etl/index.html">pudl.etl</a><input aria-label="Toggle navigation of pudl.etl" class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/etl/asset_checks/index.html">pudl.etl.asset_checks</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/etl/check_foreign_keys/index.html">pudl.etl.check_foreign_keys</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/etl/cli/index.html">pudl.etl.cli</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/etl/eia_bulk_elec_assets/index.html">pudl.etl.eia_bulk_elec_assets</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/etl/ferceqr_deployment/index.html">pudl.etl.ferceqr_deployment</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/etl/glue_assets/index.html">pudl.etl.glue_assets</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/etl/static_assets/index.html">pudl.etl.static_assets</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../autoapi/pudl/extract/index.html">pudl.extract</a><input aria-label="Toggle navigation of pudl.extract" class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/extract/censuspep/index.html">pudl.extract.censuspep</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/extract/csv/index.html">pudl.extract.csv</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/extract/dbf/index.html">pudl.extract.dbf</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/extract/eia176/index.html">pudl.extract.eia176</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/extract/eia191/index.html">pudl.extract.eia191</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/extract/eia757a/index.html">pudl.extract.eia757a</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/extract/eia860/index.html">pudl.extract.eia860</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/extract/eia860m/index.html">pudl.extract.eia860m</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/extract/eia861/index.html">pudl.extract.eia861</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/extract/eia923/index.html">pudl.extract.eia923</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/extract/eia930/index.html">pudl.extract.eia930</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/extract/eiaaeo/index.html">pudl.extract.eiaaeo</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/extract/eiaapi/index.html">pudl.extract.eiaapi</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/extract/epacems/index.html">pudl.extract.epacems</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/extract/excel/index.html">pudl.extract.excel</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/extract/extractor/index.html">pudl.extract.extractor</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/extract/ferc/index.html">pudl.extract.ferc</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/extract/ferc1/index.html">pudl.extract.ferc1</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/extract/ferc2/index.html">pudl.extract.ferc2</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/extract/ferc6/index.html">pudl.extract.ferc6</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/extract/ferc60/index.html">pudl.extract.ferc60</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/extract/ferc714/index.html">pudl.extract.ferc714</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/extract/ferccid/index.html">pudl.extract.ferccid</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/extract/ferceqr/index.html">pudl.extract.ferceqr</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/extract/gridpathratoolkit/index.html">pudl.extract.gridpathratoolkit</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/extract/nrelatb/index.html">pudl.extract.nrelatb</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/extract/parquet/index.html">pudl.extract.parquet</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/extract/phmsagas/index.html">pudl.extract.phmsagas</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/extract/rus12/index.html">pudl.extract.rus12</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/extract/rus7/index.html">pudl.extract.rus7</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/extract/sec10k/index.html">pudl.extract.sec10k</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/extract/vcerare/index.html">pudl.extract.vcerare</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/extract/xbrl/index.html">pudl.extract.xbrl</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../autoapi/pudl/ferc_to_sqlite/index.html">pudl.ferc_to_sqlite</a><input aria-label="Toggle navigation of pudl.ferc_to_sqlite" class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/ferc_to_sqlite/cli/index.html">pudl.ferc_to_sqlite.cli</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../autoapi/pudl/glue/index.html">pudl.glue</a><input aria-label="Toggle navigation of pudl.glue" class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/glue/ferc1_eia/index.html">pudl.glue.ferc1_eia</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/glue/ferc714/index.html">pudl.glue.ferc714</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../autoapi/pudl/helpers/index.html">pudl.helpers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../autoapi/pudl/io_managers/index.html">pudl.io_managers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../autoapi/pudl/logging_helpers/index.html">pudl.logging_helpers</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../autoapi/pudl/metadata/index.html">pudl.metadata</a><input aria-label="Toggle navigation of pudl.metadata" class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/metadata/classes/index.html">pudl.metadata.classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/metadata/codes/index.html">pudl.metadata.codes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/metadata/constants/index.html">pudl.metadata.constants</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/metadata/descriptions/index.html">pudl.metadata.descriptions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/metadata/dfs/index.html">pudl.metadata.dfs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/metadata/enums/index.html">pudl.metadata.enums</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/metadata/fields/index.html">pudl.metadata.fields</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/metadata/helpers/index.html">pudl.metadata.helpers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/metadata/labels/index.html">pudl.metadata.labels</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/metadata/resource_helpers/index.html">pudl.metadata.resource_helpers</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../autoapi/pudl/metadata/resources/index.html">pudl.metadata.resources</a><input aria-label="Toggle navigation of pudl.metadata.resources" class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/metadata/resources/allocate_gen_fuel/index.html">pudl.metadata.resources.allocate_gen_fuel</a></li>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/metadata/resources/censusdp1tract/index.html">pudl.metadata.resources.censusdp1tract</a></li>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/metadata/resources/eia/index.html">pudl.metadata.resources.eia</a></li>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/metadata/resources/eia176/index.html">pudl.metadata.resources.eia176</a></li>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/metadata/resources/eia860/index.html">pudl.metadata.resources.eia860</a></li>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/metadata/resources/eia860m/index.html">pudl.metadata.resources.eia860m</a></li>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/metadata/resources/eia861/index.html">pudl.metadata.resources.eia861</a></li>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/metadata/resources/eia923/index.html">pudl.metadata.resources.eia923</a></li>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/metadata/resources/eia930/index.html">pudl.metadata.resources.eia930</a></li>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/metadata/resources/eiaaeo/index.html">pudl.metadata.resources.eiaaeo</a></li>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/metadata/resources/eiaapi/index.html">pudl.metadata.resources.eiaapi</a></li>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/metadata/resources/epacems/index.html">pudl.metadata.resources.epacems</a></li>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/metadata/resources/ferc1/index.html">pudl.metadata.resources.ferc1</a></li>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/metadata/resources/ferc1_eia_record_linkage/index.html">pudl.metadata.resources.ferc1_eia_record_linkage</a></li>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/metadata/resources/ferc714/index.html">pudl.metadata.resources.ferc714</a></li>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/metadata/resources/ferccid/index.html">pudl.metadata.resources.ferccid</a></li>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/metadata/resources/ferceqr/index.html">pudl.metadata.resources.ferceqr</a></li>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/metadata/resources/glue/index.html">pudl.metadata.resources.glue</a></li>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/metadata/resources/gridpathratoolkit/index.html">pudl.metadata.resources.gridpathratoolkit</a></li>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/metadata/resources/nrelatb/index.html">pudl.metadata.resources.nrelatb</a></li>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/metadata/resources/phmsagas/index.html">pudl.metadata.resources.phmsagas</a></li>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/metadata/resources/pudl/index.html">pudl.metadata.resources.pudl</a></li>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/metadata/resources/rus12/index.html">pudl.metadata.resources.rus12</a></li>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/metadata/resources/rus7/index.html">pudl.metadata.resources.rus7</a></li>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/metadata/resources/sec10k/index.html">pudl.metadata.resources.sec10k</a></li>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/metadata/resources/vcerare/index.html">pudl.metadata.resources.vcerare</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/metadata/sources/index.html">pudl.metadata.sources</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/metadata/warnings/index.html">pudl.metadata.warnings</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../autoapi/pudl/output/index.html">pudl.output</a><input aria-label="Toggle navigation of pudl.output" class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/output/censusdp1tract/index.html">pudl.output.censusdp1tract</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/output/eia/index.html">pudl.output.eia</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/output/eia860/index.html">pudl.output.eia860</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/output/eia923/index.html">pudl.output.eia923</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/output/eia930/index.html">pudl.output.eia930</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/output/eiaapi/index.html">pudl.output.eiaapi</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/output/ferc1/index.html">pudl.output.ferc1</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/output/ferc714/index.html">pudl.output.ferc714</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/output/sec10k/index.html">pudl.output.sec10k</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../autoapi/pudl/output/sql/index.html">pudl.output.sql</a><input aria-label="Toggle navigation of pudl.output.sql" class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/output/sql/helpers/index.html">pudl.output.sql.helpers</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../autoapi/pudl/package_data/index.html">pudl.package_data</a><input aria-label="Toggle navigation of pudl.package_data" class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4 has-children"><a class="reference internal" href="../autoapi/pudl/package_data/censuspep/index.html">pudl.package_data.censuspep</a><input aria-label="Toggle navigation of pudl.package_data.censuspep" class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/package_data/censuspep/column_maps/index.html">pudl.package_data.censuspep.column_maps</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../autoapi/pudl/package_data/eia176/index.html">pudl.package_data.eia176</a><input aria-label="Toggle navigation of pudl.package_data.eia176" class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" role="switch" type="checkbox"/><label for="toctree-checkbox-21"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/package_data/eia176/column_maps/index.html">pudl.package_data.eia176.column_maps</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../autoapi/pudl/package_data/eia191/index.html">pudl.package_data.eia191</a><input aria-label="Toggle navigation of pudl.package_data.eia191" class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" role="switch" type="checkbox"/><label for="toctree-checkbox-22"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/package_data/eia191/column_maps/index.html">pudl.package_data.eia191.column_maps</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../autoapi/pudl/package_data/eia757a/index.html">pudl.package_data.eia757a</a><input aria-label="Toggle navigation of pudl.package_data.eia757a" class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" role="switch" type="checkbox"/><label for="toctree-checkbox-23"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/package_data/eia757a/column_maps/index.html">pudl.package_data.eia757a.column_maps</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../autoapi/pudl/package_data/eia860/index.html">pudl.package_data.eia860</a><input aria-label="Toggle navigation of pudl.package_data.eia860" class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" role="switch" type="checkbox"/><label for="toctree-checkbox-24"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/package_data/eia860/column_maps/index.html">pudl.package_data.eia860.column_maps</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../autoapi/pudl/package_data/eia860m/index.html">pudl.package_data.eia860m</a><input aria-label="Toggle navigation of pudl.package_data.eia860m" class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" role="switch" type="checkbox"/><label for="toctree-checkbox-25"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/package_data/eia860m/column_maps/index.html">pudl.package_data.eia860m.column_maps</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../autoapi/pudl/package_data/eia861/index.html">pudl.package_data.eia861</a><input aria-label="Toggle navigation of pudl.package_data.eia861" class="toctree-checkbox" id="toctree-checkbox-26" name="toctree-checkbox-26" role="switch" type="checkbox"/><label for="toctree-checkbox-26"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/package_data/eia861/column_maps/index.html">pudl.package_data.eia861.column_maps</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../autoapi/pudl/package_data/eia923/index.html">pudl.package_data.eia923</a><input aria-label="Toggle navigation of pudl.package_data.eia923" class="toctree-checkbox" id="toctree-checkbox-27" name="toctree-checkbox-27" role="switch" type="checkbox"/><label for="toctree-checkbox-27"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/package_data/eia923/column_maps/index.html">pudl.package_data.eia923.column_maps</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../autoapi/pudl/package_data/eia930/index.html">pudl.package_data.eia930</a><input aria-label="Toggle navigation of pudl.package_data.eia930" class="toctree-checkbox" id="toctree-checkbox-28" name="toctree-checkbox-28" role="switch" type="checkbox"/><label for="toctree-checkbox-28"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/package_data/eia930/column_maps/index.html">pudl.package_data.eia930.column_maps</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/package_data/epacems/index.html">pudl.package_data.epacems</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../autoapi/pudl/package_data/ferc1/index.html">pudl.package_data.ferc1</a><input aria-label="Toggle navigation of pudl.package_data.ferc1" class="toctree-checkbox" id="toctree-checkbox-29" name="toctree-checkbox-29" role="switch" type="checkbox"/><label for="toctree-checkbox-29"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/package_data/ferc1/row_maps/index.html">pudl.package_data.ferc1.row_maps</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/package_data/glue/index.html">pudl.package_data.glue</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../autoapi/pudl/package_data/phmsagas/index.html">pudl.package_data.phmsagas</a><input aria-label="Toggle navigation of pudl.package_data.phmsagas" class="toctree-checkbox" id="toctree-checkbox-30" name="toctree-checkbox-30" role="switch" type="checkbox"/><label for="toctree-checkbox-30"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/package_data/phmsagas/column_maps/index.html">pudl.package_data.phmsagas.column_maps</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../autoapi/pudl/package_data/rus12/index.html">pudl.package_data.rus12</a><input aria-label="Toggle navigation of pudl.package_data.rus12" class="toctree-checkbox" id="toctree-checkbox-31" name="toctree-checkbox-31" role="switch" type="checkbox"/><label for="toctree-checkbox-31"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/package_data/rus12/column_maps/index.html">pudl.package_data.rus12.column_maps</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/package_data/rus7/index.html">pudl.package_data.rus7</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/package_data/settings/index.html">pudl.package_data.settings</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../autoapi/pudl/package_data/test/index.html">pudl.package_data.test</a><input aria-label="Toggle navigation of pudl.package_data.test" class="toctree-checkbox" id="toctree-checkbox-32" name="toctree-checkbox-32" role="switch" type="checkbox"/><label for="toctree-checkbox-32"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/package_data/test/column_maps/index.html">pudl.package_data.test.column_maps</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/package_data/vcerare/index.html">pudl.package_data.vcerare</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../autoapi/pudl/resources/index.html">pudl.resources</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../autoapi/pudl/scripts/index.html">pudl.scripts</a><input aria-label="Toggle navigation of pudl.scripts" class="toctree-checkbox" id="toctree-checkbox-33" name="toctree-checkbox-33" role="switch" type="checkbox"/><label for="toctree-checkbox-33"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/scripts/auto_match_utilities/index.html">pudl.scripts.auto_match_utilities</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/scripts/dbt_helper/index.html">pudl.scripts.dbt_helper</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/scripts/generate_pudl_duckdb/index.html">pudl.scripts.generate_pudl_duckdb</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/scripts/pudl_null_cols/index.html">pudl.scripts.pudl_null_cols</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/scripts/resource_description/index.html">pudl.scripts.resource_description</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/scripts/zenodo_data_release/index.html">pudl.scripts.zenodo_data_release</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../autoapi/pudl/settings/index.html">pudl.settings</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../autoapi/pudl/transform/index.html">pudl.transform</a><input aria-label="Toggle navigation of pudl.transform" class="toctree-checkbox" id="toctree-checkbox-34" name="toctree-checkbox-34" role="switch" type="checkbox"/><label for="toctree-checkbox-34"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/transform/censuspep/index.html">pudl.transform.censuspep</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/transform/classes/index.html">pudl.transform.classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/transform/eia/index.html">pudl.transform.eia</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/transform/eia176/index.html">pudl.transform.eia176</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/transform/eia860/index.html">pudl.transform.eia860</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/transform/eia860m/index.html">pudl.transform.eia860m</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/transform/eia861/index.html">pudl.transform.eia861</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/transform/eia923/index.html">pudl.transform.eia923</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/transform/eia930/index.html">pudl.transform.eia930</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/transform/eiaaeo/index.html">pudl.transform.eiaaeo</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/transform/eiaapi/index.html">pudl.transform.eiaapi</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/transform/epacems/index.html">pudl.transform.epacems</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/transform/ferc/index.html">pudl.transform.ferc</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/transform/ferc1/index.html">pudl.transform.ferc1</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/transform/ferc714/index.html">pudl.transform.ferc714</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/transform/ferccid/index.html">pudl.transform.ferccid</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/transform/ferceqr/index.html">pudl.transform.ferceqr</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/transform/gridpathratoolkit/index.html">pudl.transform.gridpathratoolkit</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/transform/nrelatb/index.html">pudl.transform.nrelatb</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../autoapi/pudl/transform/params/index.html">pudl.transform.params</a><input aria-label="Toggle navigation of pudl.transform.params" class="toctree-checkbox" id="toctree-checkbox-35" name="toctree-checkbox-35" role="switch" type="checkbox"/><label for="toctree-checkbox-35"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../autoapi/pudl/transform/params/ferc1/index.html">pudl.transform.params.ferc1</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/transform/phmsagas/index.html">pudl.transform.phmsagas</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/transform/rus/index.html">pudl.transform.rus</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/transform/rus12/index.html">pudl.transform.rus12</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/transform/rus7/index.html">pudl.transform.rus7</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/transform/sec10k/index.html">pudl.transform.sec10k</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/transform/vcerare/index.html">pudl.transform.vcerare</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../autoapi/pudl/validate/index.html">pudl.validate</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../autoapi/pudl/workspace/index.html">pudl.workspace</a><input aria-label="Toggle navigation of pudl.workspace" class="toctree-checkbox" id="toctree-checkbox-36" name="toctree-checkbox-36" role="switch" type="checkbox"/><label for="toctree-checkbox-36"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/workspace/datastore/index.html">pudl.workspace.datastore</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/workspace/resource_cache/index.html">pudl.workspace.resource_cache</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/pudl/workspace/setup/index.html">pudl.workspace.setup</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../bibliography.html">Bibliography</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/dev/data_validation_reference.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="data-validation-reference">
<h1>Data validation reference<a class="headerlink" href="#data-validation-reference" title="Link to this heading">¶</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>In dbt, every data validation test is a SQL query meant to select rows that fail the
test. A successful test will return no results. The query can be parametrized so it can
be reused across multiple tables. dbt includes a few <a class="reference external" href="https://docs.getdbt.com/docs/build/data-tests">built-in data test definitions</a>, and the <a class="reference external" href="https://github.com/metaplane/dbt-expectations">dbt_expectations</a> package provides many more. We also
define our own <a class="reference external" href="https://docs.getdbt.com/best-practices/writing-custom-generic-tests">custom data tests</a>.</p>
<div class="admonition-todo admonition" id="id1">
<p class="admonition-title">Todo</p>
<p>We should chat about the minimum level of data validation that we expect for a table.</p>
<ul class="simple">
<li><p>All dbt tests should pass meaningfully on both the Full ETL and Fast ETL outputs,
so that we have a chance of catching data issues in CI before the nightly builds.
The one exception to this is the row count checks – they only apply to the Full
ETL outputs.</p></li>
<li><p>All tables should have row count checks, unless they have a non-deterministic
number of rows. Tables with non-deterministic row counts should have their length
checked with <a class="reference external" href="https://github.com/metaplane/dbt-expectations?tab=readme-ov-file#expect_table_row_count_to_be_between">expect_table_row_count_to_be_between</a></p></li>
<li><p>There should be no entirely null columns in the Full ETL outputs. For tables that
contain deprecated columns with no data in the recent years processed by the Fast
ETL, per-year nullness expectations should be added. See the
<a class="reference internal" href="../autoapi/pudl/scripts/pudl_null_cols/index.html#module-pudl.scripts.pudl_null_cols" title="pudl.scripts.pudl_null_cols"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pudl.scripts.pudl_null_cols</span></code></a> script.</p></li>
<li><p>What else?</p></li>
</ul>
</div>
</section>
<section id="common-workflows">
<h2>Common workflows<a class="headerlink" href="#common-workflows" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Typical workflow: tweaking an asset, remateralize it in Dagster, re-run the data
validations that pertain to just that table.</p></li>
<li><p>Often also useful to rematerialize the changed table and all of its downstream
dependencies, and then run the data validations on all of those downstream
dependencies to see if there were any unforeseen consequences.</p></li>
</ul>
</section>
<section id="pudl-specific-design-choices">
<span id="pudl-dbt-quirks"></span><h2>PUDL Specific Design Choices<a class="headerlink" href="#pudl-specific-design-choices" title="Link to this heading">¶</a></h2>
<p>Our usage of dbt is slightly unusual, since we rely on Dagster to coordinate our data
pipeline, and are only using dbt for data validation. Some quirks of our setup to be
aware of:</p>
<ul class="simple">
<li><p>From dbt’s point of view, the PUDL tables are all
<a class="reference external" href="https://docs.getdbt.com/docs/build/sources">sources</a> – external tables about
which it knows very little other than the table and column names. It assumes the
tables will be available, rather than trying to create them. In a typical dbt project,
most tables would be defined as <a class="reference external" href="https://docs.getdbt.com/docs/build/models">models</a>
which are somewhat analogous to <a class="reference external" href="https://docs.dagster.io/guides/build/assets/defining-assets">Dagster assets</a>.</p></li>
<li><p>As a SQL-based tool, dbt generally expects to be querying a database. However, in our
case the tables are stored as Apache Parquet files, which we query with SQL via
DuckDB. This means some of dbt’s functionality is not available. For example, we can’t
use <a class="reference external" href="https://docs.getdbt.com/reference/dbt-jinja-functions/adapter">the dbt adapter object</a> in our test
definitions because it relies on being able to access the underlying database schema.</p></li>
<li><p>One place we use true dbt models instead of sources is when
we define intermediate tables to simplify test definitions.
See <a class="reference internal" href="#intermediate-tables"><span class="std std-ref">Creating intermediate tables for a test</span></a>.
These intermediate tables are created as materialized views in a DuckDB database
at <code class="docutils literal notranslate"><span class="pre">$PUDL_OUTPUT/pudl_dbt_tests.duckdb</span></code>.
In this case, the underlying database schema <em>will</em> be accessible to dbt.
Additionally, any time you need to refer to those tables while debugging,
you’ll need to be connected to that database.</p></li>
</ul>
</section>
<section id="branch-builds">
<span id="id2"></span><h2>Branch builds<a class="headerlink" href="#branch-builds" title="Link to this heading">¶</a></h2>
<p>Depending on your computer, running the full ETL locally can be extremely time consuming
and may run into memory limits. It’s also easy to accidentally end up with local outputs
that are the result of code from multiple different branches, and so may not be
consistent with each other. If you’re only altering a few tables, rematerializing them
in Dagster and then running the specific dbt tests that apply to them and any tables
downstream of them should work fine.</p>
<section id="kicking-off-a-branch-build">
<h3>Kicking off a branch build<a class="headerlink" href="#kicking-off-a-branch-build" title="Link to this heading">¶</a></h3>
<p>When we’re doing big quarterly or annual updates, and dozens or hundreds of tables are
changing simultaneously, it is helpful to be able to run the full ETL from scratch, run
all of the data validation tests against the outputs, and use the results to update the
test parameters (especially expected row counts) appropriately. This can be done by
manually kicking off a PUDL deployment on your branch.</p>
<p>To initiate a branch build, in the PUDL repo on GitHub go to <a class="reference external" href="https://github.com/catalyst-cooperative/pudl/actions">Actions</a> and select <a class="reference external" href="https://github.com/catalyst-cooperative/pudl/actions/workflows/build-deploy-pudl.yml">build-deploy-pudl</a>.
On the right hand side select Run Workflow and then select your branch in the dropdown
and click the Run Workflow button. Shortly thereafter you should see a notification in
the <code class="docutils literal notranslate"><span class="pre">pudl-deployments</span></code> channel in our Slack saying that the build has kicked off. It
should take about 3 hours to complete. You can track its progress and watch the logs in
the <a class="reference external" href="https://console.cloud.google.com/monitoring/dashboards/builder/992bbe3f-17e6-49c4-a9e8-8f1925d4ec24">Google Cloud Console</a>.</p>
</section>
<section id="getting-fresh-row-counts-from-a-branch-build">
<h3>Getting fresh row counts from a branch build<a class="headerlink" href="#getting-fresh-row-counts-from-a-branch-build" title="Link to this heading">¶</a></h3>
<p>To catch unexpected changes to the data, we keep track of the expected number of rows in
each data table we distribute. These expectations are stored in
<code class="docutils literal notranslate"><span class="pre">dbt/seeds/etl_full_row_counts.csv</span></code> and they can be updated using the <code class="docutils literal notranslate"><span class="pre">dbt_helper</span></code>
script based on the observed row counts in your local PUDL Parquet outputs. If you can’t
run the full ETL locally, the nightly builds / branch build also generate updated row
count expectations. After a branch build completes, you can download the updated
<code class="docutils literal notranslate"><span class="pre">etl_full_row_counts.csv</span></code> file from the build outputs that are uploaded to
<code class="docutils literal notranslate"><span class="pre">gs://builds.catalyst.coop/&lt;build-id&gt;/etl_full_row_counts.csv</span></code> See the
<a class="reference internal" href="nightly_data_builds.html"><span class="doc">Nightly Data Builds</span></a> documentation for more details on accessing the nightly build
outputs. Replace the <code class="docutils literal notranslate"><span class="pre">etl_full_row_counts.csv</span></code> in your local PUDL git repo with the
one you’ve downloaded and use <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">diff</span></code> to see what has changed. Make sure to review
the row count changes closely to see if there’s anything unexpected.</p>
</section>
</section>
<section id="running-dbt-directly">
<span id="dbt-build"></span><h2>Running dbt directly<a class="headerlink" href="#running-dbt-directly" title="Link to this heading">¶</a></h2>
<p>dbt has its own much more <a class="reference external" href="https://docs.getdbt.com/">extensive documentation</a>.
PUDL uses only a small subset of its features.</p>
<p>To run all of the data validation tests, from within the <code class="docutils literal notranslate"><span class="pre">dbt/</span></code> directory run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>dbt<span class="w"> </span>build
</pre></div>
</div>
<p>For more fine-grained control, you can use the <code class="docutils literal notranslate"><span class="pre">--select</span></code> option to run only the tests
defined for a particular table, or all instances of a particular test no matter what
table it’s associated with. Or you can combine the two to run just a particular test
on a particular table. Some examples:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run all tests defined for the out_eia__monthly_generators table</span>
dbt<span class="w"> </span>build<span class="w"> </span>--select<span class="w"> </span><span class="s2">&quot;source:pudl.out_eia__monthly_generators&quot;</span>
<span class="c1"># Run all instances of the expect_columns_not_all_null test</span>
dbt<span class="w"> </span>build<span class="w"> </span>--select<span class="w"> </span><span class="s2">&quot;test_name:expect_columns_not_all_null&quot;</span>
<span class="c1"># Run expect_columns_not_all_null test on the out_eia__monthly_generators table only</span>
dbt<span class="w"> </span>build<span class="w"> </span>--select<span class="w"> </span><span class="s2">&quot;test_name:expect_columns_not_all_null,source:pudl.out_eia__monthly_generators&quot;</span>
<span class="c1"># Use a wildcard &quot;*&quot; to run all tests on tables whose names start with out_eia923__</span>
dbt<span class="w"> </span>build<span class="w"> </span>--select<span class="w"> </span><span class="s2">&quot;source:pudl.out_eia923__*&quot;</span>
</pre></div>
</div>
<p>Similarly, you can exclude individual tables or tests using <code class="docutils literal notranslate"><span class="pre">--exclude</span></code>. One case
where this is useful is running the data validation tests against the outputs of the
fast ETL. We do not store expected row-counts for the fast ETL outputs, and so generally
expect the row-count checks to fail. To run all of the data validation tests except for
the row counts and avoid seeing all those spurious failures you could run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>dbt<span class="w"> </span>build<span class="w"> </span>--exclude<span class="w"> </span><span class="s2">&quot;test_name:check_row_counts_per_partition&quot;</span>
</pre></div>
</div>
<p>For more options, see the <a class="reference external" href="https://docs.getdbt.com/reference/node-selection/syntax">dbt selection syntax documentation</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The dbt tests can be run in parallel to speed them up with the <code class="docutils literal notranslate"><span class="pre">--threads</span></code> argument
but this sometimes results in spurious errors like “too many files open” which are
not related to the data being tested.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There are a handful of data validation tests that have been implemented using
<a class="reference external" href="https://docs.dagster.io/guides/test/asset-checks">Dagster’s asset checks</a>.
Typically these tests weren’t well suited to SQL, weren’t performance bottlenecks,
and had already been implemented in Python. E.g. <a class="reference internal" href="../autoapi/pudl/validate/index.html#pudl.validate.no_null_rows" title="pudl.validate.no_null_rows"><code class="xref py py-func docutils literal notranslate"><span class="pre">pudl.validate.no_null_rows()</span></code></a>.</p>
</div>
</section>
<section id="data-validation-in-our-integration-tests">
<h2>Data validation in our integration tests<a class="headerlink" href="#data-validation-in-our-integration-tests" title="Link to this heading">¶</a></h2>
<p>The dbt data tests are invoked by <code class="docutils literal notranslate"><span class="pre">pytest</span></code> as part of our integration tests. This
means they run as part of our continuous integration (CI) checks before a PR can be
merged into <code class="docutils literal notranslate"><span class="pre">main</span></code>. However, the CI only processes 1-2 years of data, so when the
tests run in CI, they’re only checking a small subset of the data we publish. We also
don’t run the row count checks in CI, since the fast ETL outputs are more changeable
and less informative than those in the nightly builds.</p>
<p>This means that when you’re developing a new table or updating an existing table, it’s
important to manually run the dbt tests on the new data in its entirety before the
changes are merged into <code class="docutils literal notranslate"><span class="pre">main</span></code>.</p>
<p>If the data validations fail in the <code class="docutils literal notranslate"><span class="pre">pytest</span></code> integration tests, they should produce
helpful output indicating what failed and why, in the same way as <code class="docutils literal notranslate"><span class="pre">dbt_helper</span>
<span class="pre">validate</span></code></p>
</section>
<section id="debugging-data-validation-failures">
<h2>Debugging data validation failures<a class="headerlink" href="#debugging-data-validation-failures" title="Link to this heading">¶</a></h2>
<p>So, you’ve run the data validations, but one or more of them has failed. Now what?</p>
<p>We’ll go over some general strategies first, then look at the two most common
failures: row counts and quantiles.</p>
<section id="general-strategies-and-tools">
<h3>General strategies and tools<a class="headerlink" href="#general-strategies-and-tools" title="Link to this heading">¶</a></h3>
<section id="use-dbt-helper-validate">
<h4>Use <code class="docutils literal notranslate"><span class="pre">dbt_helper</span> <span class="pre">validate</span></code><a class="headerlink" href="#use-dbt-helper-validate" title="Link to this heading">¶</a></h4>
<p>If you habitually use <code class="docutils literal notranslate"><span class="pre">dbt</span></code>, try using <code class="docutils literal notranslate"><span class="pre">dbt_helper</span> <span class="pre">validate</span></code> instead – it
will print out additional context information to help with debugging failures.</p>
<p><strong>Example: validation ``expect_columns_not_all_null`` on table
``out_eia__yearly_generators``</strong></p>
<p>If you run this validation in <code class="docutils literal notranslate"><span class="pre">dbt</span></code>, it tells you:</p>
<ul class="simple">
<li><p>the test failed</p></li>
<li><p>there was 1 failure row</p></li>
<li><p>the compiled SQL query for the test is at
<code class="docutils literal notranslate"><span class="pre">target/compiled/pudl_dbt/models/eia/out_eia__yearly_generators/schema.yml/source_expect_columns_not_all__790ceaac9ad08187ce2e9323e6b58961.sql</span></code></p></li>
</ul>
<p>&amp; that’s it:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>dbt<span class="w"> </span>build<span class="w"> </span>--select<span class="w"> </span>source:pudl.out_eia__yearly_generators,test_name:expect_columns_not_all_null
<span class="go">20:38:56  Running with dbt=1.10.6</span>
<span class="go">20:38:57  Registered adapter: duckdb=1.9.4</span>
<span class="go">20:38:57  Unable to do partial parsing because config vars, config profile, or config target have changed</span>
<span class="go">20:39:00  Found 2 models, 700 data tests, 1 seed, 240 sources, 850 macros</span>
<span class="go">20:39:00</span>
<span class="go">20:39:00  Concurrency: 1 threads (target=&#39;etl-full&#39;)</span>
<span class="go">20:39:00</span>
<span class="go">20:39:00  1 of 1 START test source_expect_columns_not_all_null_pudl_out_eia__yearly_generators_False__EXTRACT_year_FROM_report_date_2008__[...]EXTRACT_year_FROM_report_date_2009  [RUN]</span>
<span class="go">20:39:01  1 of 1 FAIL 1 source_expect_columns_not_all_null_pudl_out_eia__yearly_generators_False__EXTRACT_year_FROM_report_date_2008__[...]EXTRACT_year_FROM_report_date_2009  [FAIL 1 in 0.15s]</span>
<span class="go">20:39:01</span>
<span class="go">20:39:01  Finished running 1 test in 0 hours 0 minutes and 0.21 seconds (0.21s).</span>
<span class="go">20:39:01</span>
<span class="go">20:39:01  Completed with 1 error, 0 partial successes, and 0 warnings:</span>
<span class="go">20:39:01</span>
<span class="go">20:39:01  Failure in test source_expect_columns_not_all_null_pudl_out_eia__yearly_generators_False__EXTRACT_year_FROM_report_date_2008__[...]EXTRACT_year_FROM_report_date_2009 (models/eia/out_eia__yearly_generators/schema.yml)</span>
<span class="go">20:39:01    Got 1 result, configured to fail if != 0</span>
<span class="go">20:39:01</span>
<span class="go">20:39:01    compiled code at target/compiled/pudl_dbt/models/eia/out_eia__yearly_generators/schema.yml/source_expect_columns_not_all__790ceaac9ad08187ce2e9323e6b58961.sql</span>
<span class="go">20:39:01</span>
<span class="go">20:39:01  Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1</span>
</pre></div>
</div>
<p>It doesn’t tell you what the failure row was; you’d have to run the compiled
query yourself to figure that out (see below for details on what that means and
how to do it).</p>
<p>If you run this validation in <code class="docutils literal notranslate"><span class="pre">dbt_helper</span></code>, it shows you the dbt output, but
it <strong>also</strong> runs the compiled SQL query and gives you the results:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>dbt_helper<span class="w"> </span>validate<span class="w"> </span>--select<span class="w"> </span>source:pudl.out_eia__yearly_generators,test_name:expect_columns_not_all_null
<span class="go">[...]</span>
<span class="go">20:37:49  Finished running 1 test in 0 hours 0 minutes and 0.17 seconds (0.17s).</span>
<span class="go">20:37:49</span>
<span class="go">20:37:49  Completed with 1 error, 0 partial successes, and 0 warnings:</span>
<span class="go">20:37:49</span>
<span class="go">20:37:49  Failure in test source_expect_columns_not_all_null_pudl_out_eia__yearly_generators_False__EXTRACT_year_FROM_report_date_2008__[...]EXTRACT_year_FROM_report_date_2009 (models/eia/out_eia__yearly_generators/schema.yml)</span>
<span class="go">20:37:49    Got 1 result, configured to fail if != 0</span>
<span class="go">20:37:49</span>
<span class="go">20:37:49    compiled code at target/compiled/pudl_dbt/models/eia/out_eia__yearly_generators/schema.yml/source_expect_columns_not_all__790ceaac9ad08187ce2e9323e6b58961.sql</span>
<span class="go">20:37:49</span>
<span class="go">20:37:49  Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1</span>
<span class="go">Traceback (most recent call last):</span>
<span class="go">[...]</span>
<span class="go">AssertionError: failure contexts:</span>
<span class="go">source_expect_columns_not_all_null_pudl_out_eia__yearly_generators_False__EXTRACT_year_FROM_report_date_2008__[...]EXTRACT_year_FROM_report_date_2009:</span>

<span class="go">| table_name                 | failing_column   | failure_reason                         | row_condition                         |   total_rows_matching_condition |   non_null_count |</span>
<span class="go">|:---------------------------|:-----------------|:---------------------------------------|:--------------------------------------|--------------------------------:|-----------------:|</span>
<span class="go">| out_eia__yearly_generators | unit_id_pudl     | Conditional check failed: EXTRACT(year | EXTRACT(year FROM report_date) &lt; 2008 |                          136918 |                0 |</span>
<span class="go">|                            |                  | FROM report_date) &lt; 2008               |                                       |                                 |                  |</span>
</pre></div>
</div>
<p>This saves you a step. Most times, this is enough to figure out what has gone
wrong, and you never need to look at the compiled SQL query at all.</p>
</section>
<section id="inspect-the-sql-query-for-the-test-and-run-it-yourself">
<h4>Inspect the SQL query for the test and run it yourself<a class="headerlink" href="#inspect-the-sql-query-for-the-test-and-run-it-yourself" title="Link to this heading">¶</a></h4>
<p>Some tests have very long failure row output that <code class="docutils literal notranslate"><span class="pre">dbt_helper</span></code>
doesn’t handle very well. To debug those failures, you will need to
run the SQL yourself, and explore duckdb’s <a class="reference external" href="https://duckdb.org/docs/stable/clients/cli/output_formats.html">output formatting options</a> to display
the results legibly.</p>
<p>Some tests have terrible failure row output that doesn’t tell you anything
useful. To debug those failures, you will need to bust into the SQL to pull out
enough information to figure out what went wrong.</p>
<p>Both of these cases require you to touch the compiled SQL query for the test directly.</p>
<p>dbt gives you a path for the “compiled code” for the failing test, in a line
that looks like this:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">20:37:49    compiled code at target/compiled/pudl_dbt/models/eia/out_eia__yearly_generators/schema.yml/source_expect_columns_not_all__790ceaac9ad08187ce2e9323e6b58961.sql</span>
</pre></div>
</div>
<p>“Compiled” is important here because the source code for each test is merely
a template. The template cannot directly be used to query the database. Each
instance of a test is configured in the schema.yml for the table being tested.
dbt compiles the SQL query for that test by filling in the template values using
information from the test config. It saves the resulting SQL query to a new file
in the <code class="docutils literal notranslate"><span class="pre">target/compiled</span></code> directory. This is the compiled query.</p>
<p>Running this query in duckdb will generate the failure row output. There are two
ways to run the query.</p>
<section id="run-once-using-the-shell">
<h5>Run once using the shell<a class="headerlink" href="#run-once-using-the-shell" title="Link to this heading">¶</a></h5>
<p>You can run duckdb against the test database, and input the compiled code path
using <code class="docutils literal notranslate"><span class="pre">&lt;</span></code>.</p>
<p>If you are in the <code class="docutils literal notranslate"><span class="pre">pudl</span></code> working directory, you may need to add <code class="docutils literal notranslate"><span class="pre">dbt/</span></code> to
the front of the compiled code path. Like this:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>duckdb<span class="w"> </span><span class="nv">$PUDL_OUTPUT</span>/pudl_dbt_tests.duckdb<span class="w"> </span>&lt;dbt/target/compiled/pudl_dbt/models/eia/out_eia__yearly_generators/schema.yml/source_expect_columns_not_all__790ceaac9ad08187ce2e9323e6b58961.sql
<span class="go">┌────────────────────────────┬────────────────┬─────────────────────────────────────────────────────────────────┬───────────────────────────────────────┬───────────────────────────────┬────────────────┐</span>
<span class="go">│         table_name         │ failing_column │                         failure_reason                          │             row_condition             │ total_rows_matching_condition │ non_null_count │</span>
<span class="go">│          varchar           │    varchar     │                             varchar                             │                varchar                │             int64             │     int64      │</span>
<span class="go">├────────────────────────────┼────────────────┼─────────────────────────────────────────────────────────────────┼───────────────────────────────────────┼───────────────────────────────┼────────────────┤</span>
<span class="go">│ out_eia__yearly_generators │ unit_id_pudl   │ Conditional check failed: EXTRACT(year FROM report_date) &lt; 2008 │ EXTRACT(year FROM report_date) &lt; 2008 │            136918             │       0        │</span>
<span class="go">└────────────────────────────┴────────────────┴─────────────────────────────────────────────────────────────────┴───────────────────────────────────────┴───────────────────────────────┴────────────────┘</span>
</pre></div>
</div>
<p>The advantage of this approach is that it is very quick, and it immediately
returns you to a shell.</p>
<p><strong>Variation: change output modes</strong></p>
<p>To transpose very wide output, consider setting <code class="docutils literal notranslate"><span class="pre">.mode</span></code>. Using the <code class="docutils literal notranslate"><span class="pre">-cmd</span></code>
argument to duckdb will execute a command before processing input provided using
<code class="docutils literal notranslate"><span class="pre">&lt;</span></code>. Like this:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>duckdb<span class="w"> </span>-cmd<span class="w"> </span><span class="s1">&#39;.mode line&#39;</span><span class="w"> </span><span class="nv">$PUDL_OUTPUT</span>/pudl_dbt_tests.duckdb<span class="w"> </span>&lt;dbt/target/compiled/pudl_dbt/models/eia/out_eia__yearly_generators/schema.yml/source_expect_columns_not_all__790ceaac9ad08187ce2e9323e6b58961.sql
<span class="go">                   table_name = out_eia__yearly_generators</span>
<span class="go">               failing_column = unit_id_pudl</span>
<span class="go">               failure_reason = Conditional check failed: EXTRACT(year FROM report_date) &lt; 2008</span>
<span class="go">                row_condition = EXTRACT(year FROM report_date) &lt; 2008</span>
<span class="go">total_rows_matching_condition = 136918</span>
<span class="go">               non_null_count = 0</span>
</pre></div>
</div>
<p>There are lots of <a class="reference external" href="https://duckdb.org/docs/stable/clients/cli/output_formats.html">output format modes available</a>; hopefully one of them will be legible for your failure row output!</p>
</section>
<section id="run-inside-a-duckdb-session">
<h5>Run inside a duckdb session<a class="headerlink" href="#run-inside-a-duckdb-session" title="Link to this heading">¶</a></h5>
<p>You can open a duckdb session against the test database, and input the compiled
code path using the duckdb <code class="docutils literal notranslate"><span class="pre">.read</span></code> command. Like this:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>duckdb<span class="w"> </span><span class="nv">$PUDL_OUTPUT</span>/pudl_dbt_tests.duckdb
<span class="go">v1.2.0 5f5512b827</span>
<span class="go">Enter &quot;.help&quot; for usage hints.</span>
<span class="go">D .read dbt/target/compiled/pudl_dbt/models/eia/out_eia__yearly_generators/schema.yml/source_expect_columns_not_all__790ceaac9ad08187ce2e9323e6b58961.sql</span>
<span class="go">┌────────────────────────────┬────────────────┬─────────────────────────────────────────────────────────────────┬───────────────────────────────────────┬───────────────────────────────┬────────────────┐</span>
<span class="go">│         table_name         │ failing_column │                         failure_reason                          │             row_condition             │ total_rows_matching_condition │ non_null_count │</span>
<span class="go">│          varchar           │    varchar     │                             varchar                             │                varchar                │             int64             │     int64      │</span>
<span class="go">├────────────────────────────┼────────────────┼─────────────────────────────────────────────────────────────────┼───────────────────────────────────────┼───────────────────────────────┼────────────────┤</span>
<span class="go">│ out_eia__yearly_generators │ unit_id_pudl   │ Conditional check failed: EXTRACT(year FROM report_date) &lt; 2008 │ EXTRACT(year FROM report_date) &lt; 2008 │            136918             │       0        │</span>
<span class="go">└────────────────────────────┴────────────────┴─────────────────────────────────────────────────────────────────┴───────────────────────────────────────┴───────────────────────────────┴────────────────┘</span>
</pre></div>
</div>
<p>You can type other SQL queries and duckdb commands at the duckdb prompt as well.</p>
<p>The advantage of this approach is that you are at a database prompt, and can
immediately run other queries to narrow down what has gone wrong.</p>
<p>The disadvantage of this approach is that you have to remember to quit (CTRL-D
or <code class="docutils literal notranslate"><span class="pre">.quit</span></code>) before you can run more dbt commands. duckdb does not like having
multiple programs accessing the database simultaneously.</p>
</section>
<section id="dealing-with-terrible-failure-row-output">
<h5>Dealing with terrible failure row output<a class="headerlink" href="#dealing-with-terrible-failure-row-output" title="Link to this heading">¶</a></h5>
<p>If the failure row output for a test says something useless like “false” with
no other identifying information, you’ll need to actually read the SQL query and
adapt some portion of it to give you the context you need.</p>
<p>Such as:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>duckdb<span class="w"> </span><span class="nv">$PUDL_OUTPUT</span>/pudl_dbt_tests.duckdb<span class="w"> </span>&lt;target/compiled/pudl_dbt/models/eia/out_eia__yearly_generators/schema.yml/dbt_expectations_source_expect_33dc33ad0a260e896f11f41b4422dda8.sql
<span class="go">┌─────────────┐</span>
<span class="go">│ expression  │</span>
<span class="go">│   boolean   │</span>
<span class="go">├─────────────┤</span>
<span class="go">│ false       │</span>
<span class="go">│ false       │</span>
<span class="go">│ false       │</span>
<span class="go">│ false       │</span>
<span class="go">│ false       │</span>
<span class="go">│ false       │</span>
<span class="go">│ false       │</span>
<span class="go">│ false       │</span>
<span class="go">│ false       │</span>
<span class="go">│ false       │</span>
<span class="go">│   ·         │</span>
<span class="go">│   ·         │</span>
<span class="go">│   ·         │</span>
<span class="go">│ false       │</span>
<span class="go">│ false       │</span>
<span class="go">│ false       │</span>
<span class="go">│ false       │</span>
<span class="go">│ false       │</span>
<span class="go">│ false       │</span>
<span class="go">│ false       │</span>
<span class="go">│ false       │</span>
<span class="go">│ false       │</span>
<span class="go">│ false       │</span>
<span class="go">├─────────────┤</span>
<span class="go">│ 570499 rows │</span>
<span class="go">│ (20 shown)  │</span>
<span class="go">└─────────────┘</span>
</pre></div>
</div>
<p>The only thing this tells us is that there are 570,499 rows that failed the test.
We need to know which rows they are in order to debug further.</p>
<p>Opening <code class="docutils literal notranslate"><span class="pre">dbt_expectations_source_expect_33dc33ad0a260e896f11f41b4422dda8.sql</span></code>
in a pager or text editor yields the following:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="k">with</span><span class="w"> </span><span class="n">grouped_expression</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">select</span>



<span class="w">  </span><span class="n">unit_id_pudl</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">expression</span>


<span class="w">    </span><span class="k">from</span><span class="w"> </span><span class="s1">&#39;/Users/catalyst/pudl_output/parquet/out_eia__yearly_generators.parquet&#39;</span>


<span class="p">),</span>
<span class="n">validation_errors</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span>

<span class="w">    </span><span class="k">select</span>
<span class="w">        </span><span class="o">*</span>
<span class="w">    </span><span class="k">from</span>
<span class="w">        </span><span class="n">grouped_expression</span>
<span class="w">    </span><span class="k">where</span>
<span class="w">        </span><span class="k">not</span><span class="p">(</span><span class="n">expression</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">)</span>

<span class="p">)</span>

<span class="k">select</span><span class="w"> </span><span class="o">*</span>
<span class="k">from</span><span class="w"> </span><span class="n">validation_errors</span>
</pre></div>
</div>
<p>Here we’d have several options:</p>
<ul class="simple">
<li><p>Add a few primary key columns to the <code class="docutils literal notranslate"><span class="pre">grouped_expression</span></code> table, so that
they pop out in the final <code class="docutils literal notranslate"><span class="pre">select</span></code></p></li>
<li><p>Adapt the inner <code class="docutils literal notranslate"><span class="pre">select</span></code> from <code class="docutils literal notranslate"><span class="pre">grouped_expression</span></code> to work on its own</p></li>
<li><p>Grab only the parquet path and put it in a custom query like <code class="docutils literal notranslate"><span class="pre">select</span>
<span class="pre">plant_id_eia,</span> <span class="pre">generator_id,</span> <span class="pre">report_date</span> <span class="pre">from</span> <span class="pre">{parquet</span> <span class="pre">path}</span> <span class="pre">where</span> <span class="pre">unit_id_pudl</span>
<span class="pre">is</span> <span class="pre">null</span></code></p></li>
</ul>
<p>The query you build using any of the above could be copied and pasted into a
duckdb session, and the results interrogated further from there.</p>
</section>
</section>
<section id="debugging-and-fixing-row-count-failures">
<span id="row-countfailures"></span><h4>Debugging and fixing row count failures<a class="headerlink" href="#debugging-and-fixing-row-count-failures" title="Link to this heading">¶</a></h4>
<p>Row count checks fail when
the local data has a different number of rows in it than dbt expected.</p>
<p>There are two cases to consider:</p>
<ul class="simple">
<li><p>you expect the local data to have a new number of rows</p></li>
<li><p>you expect the local data to have the same number of rows as before</p></li>
</ul>
<p>If you expect the local data to have a new number of rows -
you’re adding a new year of data,
you’re changing how the data is filtered or dropped,
etc.
Then it’s a good thing if the row count check fails at first.
That means you have some new rows!
First, we can use <code class="docutils literal notranslate"><span class="pre">dbt_helper</span></code> to count up the new row counts,
and see how they differ from the old ones.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>dbt_helper<span class="w"> </span>update-tables<span class="w"> </span>&lt;TABLE_NAME&gt;<span class="w"> </span>--row-counts<span class="w"> </span>--clobber<span class="w"> </span><span class="c1"># we use --clobber so the changes are actually written to disk</span>
<span class="gp">$ </span>git<span class="w"> </span>diff<span class="w"> </span><span class="c1"># to see the difference</span>
</pre></div>
</div>
<p>You may see that a row count for a partition has been added:</p>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="gh">diff --git a/dbt/seeds/etl_full_row_counts.csv b/dbt/seeds/etl_full_row_counts.csv</span>
<span class="gh">index d9a5f0ec7..2b40f3ad7 100644</span>
<span class="gd">--- a/dbt/seeds/etl_full_row_counts.csv</span>
<span class="gi">+++ b/dbt/seeds/etl_full_row_counts.csv</span>
<span class="gu">@@ -3318,7 +3318,7 @@ out_ferc1__yearly_steam_plants_fuel_sched402,2020,1250</span>
<span class="w"> </span>out_ferc1__yearly_steam_plants_fuel_sched402,2021,1152
<span class="w"> </span>out_ferc1__yearly_steam_plants_fuel_sched402,2022,1196
<span class="w"> </span>out_ferc1__yearly_steam_plants_fuel_sched402,2023,1210
<span class="gi">+out_ferc1__yearly_steam_plants_fuel_sched402,2024,1221</span>
<span class="w"> </span>out_ferc1__yearly_steam_plants_sched402,1994,1411
<span class="w"> </span>out_ferc1__yearly_steam_plants_sched402,1995,1448
<span class="w"> </span>out_ferc1__yearly_steam_plants_sched402,1996,1395
</pre></div>
</div>
<p>This is what you’d expect if you were adding a new year of data.
In this case,
we want to double-check if that is a reasonable number of rows for a new partition.
This will be different for each table,
but consider these heuristic questions:</p>
<ul class="simple">
<li><p>How does this compare to previous years?
Do I expect there to be more rows, fewer rows, or about the same number?</p></li>
<li><p>Have I made changes to how the data is filtered or merged with other data?</p></li>
<li><p>Did other partitions change, too, or did I just see a new partition?</p></li>
</ul>
<p>If any of those questions raise alarm bells,
you should probably look at the actual output data in a notebook.
If, after investigation, you’re sure the row counts are correct,
commit the changes to the expected row counts.</p>
<p>You might also get a row count test failure when you don’t expect it.
That will probably look like a change in row count for one or more partitions:</p>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="gh">diff --git a/dbt/seeds/etl_full_row_counts.csv b/dbt/seeds/etl_full_row_counts.csv</span>
<span class="gh">index d9a5f0ec7..2b40f3ad7 100644</span>
<span class="gd">--- a/dbt/seeds/etl_full_row_counts.csv</span>
<span class="gi">+++ b/dbt/seeds/etl_full_row_counts.csv</span>
<span class="gu">@@ -3318,7 +3318,7 @@ out_ferc1__yearly_steam_plants_fuel_sched402,2020,1250</span>
<span class="w"> </span>out_ferc1__yearly_steam_plants_fuel_sched402,2021,1152
<span class="w"> </span>out_ferc1__yearly_steam_plants_fuel_sched402,2022,1196
<span class="gd">-out_ferc1__yearly_steam_plants_fuel_sched402,2023,1210</span>
<span class="gi">+out_ferc1__yearly_steam_plants_fuel_sched402,2023,1215</span>
<span class="gd">-out_ferc1__yearly_steam_plants_fuel_sched402,2024,1224</span>
<span class="gi">+out_ferc1__yearly_steam_plants_fuel_sched402,2024,1221</span>
<span class="w"> </span>out_ferc1__yearly_steam_plants_sched402,1994,1411
<span class="w"> </span>out_ferc1__yearly_steam_plants_sched402,1995,1448
<span class="w"> </span>out_ferc1__yearly_steam_plants_sched402,1996,1395
</pre></div>
</div>
<p>If you don’t expect your code to have caused these row-count changes,
it’s time to investigate.
There’s likely a bug somewhere.
Investigation will be different for each table,
but here are some ideas to get you started:</p>
<ul class="simple">
<li><p>Check that everything is up to date -
do you have the latest changes from <code class="docutils literal notranslate"><span class="pre">main</span></code> in your branch?
Did you re-materialize your asset using fresh upstream data?</p></li>
<li><p>Compare your local data to the data in the last nightly build:
Using the primary key,
merge the two tables and see what rows are in both,
what rows are only in the nightly build,
and what rows are only in your local build.</p></li>
</ul>
<p>Once you understand why the row counts are different,
either fix the bug or commit the new expected row counts.</p>
</section>
</section>
<section id="debugging-quantile-checks">
<h3>Debugging quantile checks<a class="headerlink" href="#debugging-quantile-checks" title="Link to this heading">¶</a></h3>
<p>Run the quantile check by selecting the table you want to check.
If you want to check all the tables, you can instead select all the quantile checks.
Note that we’re using <code class="docutils literal notranslate"><span class="pre">--select</span></code> to use <strong>dbt</strong> selection syntax,
not <code class="docutils literal notranslate"><span class="pre">--asset-select</span></code> for <strong>Dagster</strong> selection syntax.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>dbt_helper<span class="w"> </span>validate<span class="w"> </span>--select<span class="w"> </span><span class="s2">&quot;test_name:expect_quantile_constraints&quot;</span>
</pre></div>
</div>
<p>In this example, we’re running quantile checks for <code class="docutils literal notranslate"><span class="pre">out_eia__yearly_generators</span></code>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>dbt_helper<span class="w"> </span>validate<span class="w"> </span>--select<span class="w"> </span><span class="s2">&quot;source:pudl_dbt.pudl.out_eia__yearly_generators&quot;</span>
<span class="go">[...]</span>
<span class="go">18:39:46  Finished running 24 data tests in 0 hours 0 minutes and 1.01 seconds (1.01s).</span>
<span class="go">18:39:46</span>
<span class="go">18:39:46  Completed with 1 error, 0 partial successes, and 0 warnings:</span>
<span class="go">18:39:46</span>
<span class="go">18:39:46  Failure in test source_expect_quantile_constraints_pudl_out_eia__yearly_generators_capacity_factor___quantile_0_65_min_value_0_5_max_value_0_6____quantile_0_15_min_value_0_005____quantile_0_95_max_value_0_95___fuel_type_code_pudl_gas_and_report_date_CAST_2015_01_01_AS_DATE_and_capacity_factor_0_0__capacity_mw (models/eia/out_eia__yearly_generators/schema.yml)</span>
<span class="go">18:39:46    Got 1 result, configured to fail if != 0</span>
<span class="go">18:39:46</span>
<span class="go">18:39:46    compiled code at target/compiled/pudl_dbt/models/eia/out_eia__yearly_generators/schema.yml/source_expect_quantile_constra_392a2df5d1590fb6bc46821e0b879c86.sql</span>
<span class="go">18:39:46</span>
<span class="go">18:39:46  Done. PASS=23 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=24</span>
<span class="go">Traceback (most recent call last):</span>
<span class="go">  File &quot;/Users/catalyst/bin/miniforge3/envs/pudl-dev/bin/dbt_helper&quot;, line 7, in &lt;module&gt;</span>
<span class="go">    sys.exit(dbt_helper())</span>
<span class="go">             ~~~~~~~~~~^^</span>
<span class="go">  File &quot;/Users/catalyst/bin/miniforge3/envs/pudl-dev/lib/python3.13/site-packages/click/core.py&quot;, line 1161, in __call__</span>
<span class="go">    return self.main(*args, **kwargs)</span>
<span class="go">           ~~~~~~~~~^^^^^^^^^^^^^^^^^</span>
<span class="go">  File &quot;/Users/catalyst/bin/miniforge3/envs/pudl-dev/lib/python3.13/site-packages/click/core.py&quot;, line 1082, in main</span>
<span class="go">    rv = self.invoke(ctx)</span>
<span class="go">  File &quot;/Users/catalyst/bin/miniforge3/envs/pudl-dev/lib/python3.13/site-packages/click/core.py&quot;, line 1697, in invoke</span>
<span class="go">    return _process_result(sub_ctx.command.invoke(sub_ctx))</span>
<span class="go">                           ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^</span>
<span class="go">  File &quot;/Users/catalyst/bin/miniforge3/envs/pudl-dev/lib/python3.13/site-packages/click/core.py&quot;, line 1443, in invoke</span>
<span class="go">    return ctx.invoke(self.callback, **ctx.params)</span>
<span class="go">           ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
<span class="go">  File &quot;/Users/catalyst/bin/miniforge3/envs/pudl-dev/lib/python3.13/site-packages/click/core.py&quot;, line 788, in invoke</span>
<span class="go">    return __callback(*args, **kwargs)</span>
<span class="go">  File &quot;/Users/catalyst/Documents/work/catalyst/pudl/src/pudl/scripts/dbt_helper.py&quot;, line 673, in validate</span>
<span class="go">    raise AssertionError(</span>
<span class="go">        f&quot;failure contexts:\n{test_result.format_failure_contexts()}&quot;</span>
<span class="go">    )</span>
<span class="go">AssertionError: failure contexts:</span>
<span class="go">source_expect_quantile_constraints_pudl_out_eia__yearly_generators_capacity_factor___quantile_0_65_min_value_0_5_max_value_0_6____quantile_0_15_min_value_0_005____quantile_0_95_max_value_0_95___fuel_type_code_pudl_gas_and_report_date_CAST_2015_01_01_AS_DATE_and_capacity_factor_0_0__capacity_mw:</span>

<span class="go"> table: source.pudl_dbt.pudl.out_eia__yearly_generators</span>
<span class="go"> test: expect_quantile_constraints</span>
<span class="go"> column: capacity_factor</span>
<span class="go"> row_condition: fuel_type_code_pudl=&#39;gas&#39; and report_date&gt;=CAST(&#39;2015-01-01&#39; AS DATE) and capacity_factor&lt;&gt;0.0</span>
<span class="go"> weight column: capacity_mw</span>
<span class="go"> description: Historical note, EIA natural gas reporting really only becomes usable in 2015.</span>
<span class="go">  quantile |     value |       min |       max</span>
<span class="go">      0.65 | 0.4638245 |     0.500 |      0.60</span>
<span class="go">      0.15 | 0.0246494 |     0.005 |      None</span>
<span class="go">      0.95 | 0.7754576 |      None |      0.95</span>
</pre></div>
</div>
<p>In this example, quantile 0.65 was expected to be between 0.5 and 0.6,
but was instead 0.46, outside of the expected range.</p>
<p>Locate the quantile check in the table’s <code class="docutils literal notranslate"><span class="pre">schema.yml</span></code> file.
This will be at <code class="docutils literal notranslate"><span class="pre">dbt/models/&lt;data_source&gt;/&lt;table_name&gt;/schema.yml</span></code>.</p>
<p>Find the column name and the row condition in the failure output.
In this example, the check we want is for column <code class="docutils literal notranslate"><span class="pre">capacity_factor</span></code>,
and it’s the entry with the row condition
<code class="docutils literal notranslate"><span class="pre">fuel_type_code_pudl='gas'</span>
<span class="pre">and</span> <span class="pre">report_date&gt;=CAST('2015-01-01'</span> <span class="pre">AS</span> <span class="pre">DATE)</span>
<span class="pre">and</span> <span class="pre">capacity_factor&lt;&gt;0.0</span></code>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">[pudl/dbt] $ </span><span class="nv">$EDITOR</span><span class="w"> </span>models/eia/out_eia__monthly_generators/schema.yml
</pre></div>
</div>
<p>Depending on the situation, from here you can:</p>
<ul class="simple">
<li><p>investigate further in a Python notebook -
how has this data changed from the version in the nightly builds which passed
this check?</p></li>
<li><p>ask folks if we expect these quantiles to have shifted</p></li>
<li><p>fix a bug, re-run the pipeline, and repeat the check</p></li>
<li><p>adjust the quantile constraints (&amp; consider leaving a dated note for followup in
case it gets worse)</p></li>
</ul>
</section>
</section>
<section id="applying-pre-defined-validations-to-existing-data">
<h2>Applying pre-defined validations to existing data<a class="headerlink" href="#applying-pre-defined-validations-to-existing-data" title="Link to this heading">¶</a></h2>
<p>Applying an existing generic test to an existing table should be as easy as editing
the <code class="docutils literal notranslate"><span class="pre">schema.yml</span></code> file associated with that table, and adding a new test specification
to the <code class="docutils literal notranslate"><span class="pre">data_tests</span></code> section of either the table as a whole or an individual column.
The <code class="docutils literal notranslate"><span class="pre">schema.yml</span></code> for <code class="docutils literal notranslate"><span class="pre">table_name</span></code> can be found at
<code class="docutils literal notranslate"><span class="pre">dbt/models/{data_source}/{table_name}/schema.yml</span></code>.</p>
<p>In general, table-level tests depend on multiple columns or test some property of the
table as a whole, while column-level tests typically depend only on values with the
column they are applied to.</p>
<section id="pre-defined-tests">
<h3>Pre-defined tests<a class="headerlink" href="#pre-defined-tests" title="Link to this heading">¶</a></h3>
<p>Our dbt project includes <a class="reference external" href="https://github.com/dbt-labs/dbt-utils">dbt-utils</a> and
<a class="reference external" href="https://github.com/metaplane/dbt-expectations">dbt-expectations</a> as dependencies.
These packages include a bunch of useful tests that can be applied to any table.
There are several examples of applying tests from <code class="docutils literal notranslate"><span class="pre">dbt-expectations</span></code> in
<code class="docutils literal notranslate"><span class="pre">dbt/models/vcerare/out_vcerare__hourly_available_capacity_factor/schema.yml</span></code>
and in general they will look like the below. Each item in a <code class="docutils literal notranslate"><span class="pre">data_tests</span></code> section
defines a single test, and may provide named parameters for the test. The tests whose
names have the <code class="docutils literal notranslate"><span class="pre">dbt_expectations</span></code> prefix come from that package.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="nt">sources</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pudl</span>
<span class="w">    </span><span class="nt">tables</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">out_vcerare__hourly_available_capacity_factor</span>
<span class="w">        </span><span class="nt">data_tests</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">expect_columns_not_all_null</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">check_row_counts_per_partition</span><span class="p">:</span>
<span class="w">              </span><span class="nt">arguments</span><span class="p">:</span>
<span class="w">                </span><span class="nt">table_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">out_vcerare__hourly_available_capacity_factor</span>
<span class="w">                </span><span class="nt">partition_expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">report_year</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">expect_valid_hour_of_year</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect_unique_column_combination</span><span class="p">:</span>
<span class="w">              </span><span class="nt">arguments</span><span class="p">:</span>
<span class="w">                </span><span class="nt">columns</span><span class="p">:</span>
<span class="w">                  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">county_id_fips</span>
<span class="w">                  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">datetime_utc</span>
<span class="w">        </span><span class="nt">columns</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">state</span>
<span class="w">            </span><span class="nt">data_tests</span><span class="p">:</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">not_null</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">place_name</span>
<span class="w">            </span><span class="nt">data_tests</span><span class="p">:</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">not_null</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">dbt_expectations.expect_column_values_to_not_be_in_set</span><span class="p">:</span>
<span class="w">                  </span><span class="nt">arguments</span><span class="p">:</span>
<span class="w">                    </span><span class="nt">value_set</span><span class="p">:</span>
<span class="w">                      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bedford_city</span>
<span class="w">                      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">clifton_forge_city</span>
<span class="w">                      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lake_hurron</span>
<span class="w">                      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lake_st_clair</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">dbt_expectations.expect_column_values_to_be_in_set</span><span class="p">:</span>
<span class="w">                  </span><span class="nt">arguments</span><span class="p">:</span>
<span class="w">                    </span><span class="nt">value_set</span><span class="p">:</span>
<span class="w">                      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">oglala lakota</span>
<span class="w">                    </span><span class="nt">row_condition</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;county_id_fips</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">&#39;46012&#39;&quot;</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">datetime_utc</span>
<span class="w">            </span><span class="nt">data_tests</span><span class="p">:</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">not_null</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">dbt_expectations.expect_column_values_to_not_be_in_set</span><span class="p">:</span>
<span class="w">                  </span><span class="nt">arguments</span><span class="p">:</span>
<span class="w">                    </span><span class="nt">value_set</span><span class="p">:</span>
<span class="w">                      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">dbt_date.date(2020,</span><span class="nv"> </span><span class="s">12,</span><span class="nv"> </span><span class="s">31)</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">report_year</span>
<span class="w">            </span><span class="nt">data_tests</span><span class="p">:</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">not_null</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hour_of_year</span>
<span class="w">            </span><span class="nt">data_tests</span><span class="p">:</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">not_null</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">dbt_expectations.expect_column_max_to_be_between</span><span class="p">:</span>
<span class="w">                  </span><span class="nt">arguments</span><span class="p">:</span>
<span class="w">                    </span><span class="nt">min_value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8760</span>
<span class="w">                    </span><span class="nt">max_value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8760</span>
</pre></div>
</div>
</section>
<section id="tests-defined-within-pudl">
<h3>Tests defined within PUDL<a class="headerlink" href="#tests-defined-within-pudl" title="Link to this heading">¶</a></h3>
<p>Some of the tests in the example above like <code class="docutils literal notranslate"><span class="pre">expect_columns_not_all_null</span></code> or
<code class="docutils literal notranslate"><span class="pre">check_row_counts_per_partition</span></code> are defined by us, and can be found in the SQL
files with the same name under <code class="docutils literal notranslate"><span class="pre">dbt/tests/data_tests/generic_tests/</span></code></p>
<p>Documentation for the tests that we define is in
<code class="docutils literal notranslate"><span class="pre">dbt/tests/data_tests/generic_tests/schema.yml</span></code></p>
<div class="admonition-todo admonition" id="id3">
<p class="admonition-title">Todo</p>
<ul class="simple">
<li><p>Integrate documentation of our existing generic tests into the docs build.</p></li>
</ul>
</div>
</section>
</section>
<section id="adding-new-tables">
<h2>Adding new tables<a class="headerlink" href="#adding-new-tables" title="Link to this heading">¶</a></h2>
<p>The tables that exist within PUDL are defined by the data structures within
<a class="reference internal" href="../autoapi/pudl/metadata/resources/index.html#module-pudl.metadata.resources" title="pudl.metadata.resources"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pudl.metadata.resources</span></code></a>. Any Dagster asset that’s being written out to Parquet
or the PUDL SQLite database needs to be defined there. The <code class="docutils literal notranslate"><span class="pre">schema.yml</span></code> files within
our dbt project are derived from that same PUDL metadata. Our unit tests check to make
sure that the dbt schemas haven’t drifted away from the canonical PUDL metadata. To make
sure that the two sets of database table descriptions stay in sync, we try to create and
update the dbt schemas programmatically when possible.</p>
<section id="using-dbt-helper-update-tables">
<h3>Using <code class="docutils literal notranslate"><span class="pre">dbt_helper</span> <span class="pre">update-tables</span></code><a class="headerlink" href="#using-dbt-helper-update-tables" title="Link to this heading">¶</a></h3>
<p>To add a new PUDL table to the dbt project, you must add it as a <a class="reference external" href="https://docs.getdbt.com/docs/build/sources">dbt
source</a>. The <code class="docutils literal notranslate"><span class="pre">dbt_helper</span></code> script
automates the initial setup with the <code class="docutils literal notranslate"><span class="pre">update-tables</span></code> subcommand.</p>
<p>Before adding a table as a dbt source, you need to:</p>
<ul class="simple">
<li><p>define that table as a resource in <a class="reference internal" href="../autoapi/pudl/metadata/resources/index.html#module-pudl.metadata.resources" title="pudl.metadata.resources"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pudl.metadata.resources</span></code></a></p></li>
<li><p>make sure that table is written out to Parquet</p></li>
</ul>
<p>Then you can use the <code class="docutils literal notranslate"><span class="pre">dbt_helper</span> <span class="pre">update-tables</span></code> command to initialize the file.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>dbt_helper<span class="w"> </span>update-tables<span class="w"> </span>--schema<span class="w"> </span>new_table_name
</pre></div>
</div>
<p>This will add a file called <code class="docutils literal notranslate"><span class="pre">dbt/models/{data_source}/new_table_name/schema.yml</span></code>. You
can also give it a list of tables and they will all be created at once.  This yaml file
tells <code class="docutils literal notranslate"><span class="pre">dbt</span></code> about the table and its schema, but initially it will not have any data
validations defined. Tests need to be added by hand.</p>
</section>
<section id="initial-data-tests">
<h3>Initial data tests<a class="headerlink" href="#initial-data-tests" title="Link to this heading">¶</a></h3>
<p>There are a few tests that we apply to every table,
which should be defined as soon as you’ve added a new table.
These include <code class="docutils literal notranslate"><span class="pre">check_row_counts_by_partition</span></code> and <code class="docutils literal notranslate"><span class="pre">expect_columns_not_all_null</span></code>.
We talk about <code class="docutils literal notranslate"><span class="pre">check_row_counts_by_partition</span></code> in <a class="reference internal" href="data_validation_quickstart.html#row-counts"><span class="std std-ref">Updating row counts</span></a>.</p>
</section>
<section id="checking-for-entirely-null-columns">
<h3>Checking for entirely null columns<a class="headerlink" href="#checking-for-entirely-null-columns" title="Link to this heading">¶</a></h3>
<p>A test we apply to basically all tables is <code class="docutils literal notranslate"><span class="pre">expect_columns_not_all_null</span></code>. In
its most basic form it verifies that there are no columns in the table which are
completely null, since that is typically indicative of a bad <code class="docutils literal notranslate"><span class="pre">ENUM</span></code> constraint, a
column naming error, or a bad merge, and should be investigated. To add this basic
default, you add the test to the table level <code class="docutils literal notranslate"><span class="pre">data_tests</span></code> with no parameters:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="nt">sources</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pudl</span>
<span class="w">    </span><span class="nt">tables</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">new_table_name</span>
<span class="w">        </span><span class="nt">data_tests</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">expect_columns_not_all_null</span>
</pre></div>
</div>
</section>
</section>
<section id="defining-new-data-validation-tests">
<h2>Defining new data validation tests<a class="headerlink" href="#defining-new-data-validation-tests" title="Link to this heading">¶</a></h2>
<p>Sometimes you will want to test a property that can’t be expressed
using the existing dbt tests like <code class="docutils literal notranslate"><span class="pre">check_row_counts_per_partition</span></code> (in
<code class="docutils literal notranslate"><span class="pre">dbt/tests/data_tests/generic_tests</span></code>) or the tests in <a class="reference external" href="https://hub.getdbt.com/metaplane/dbt_expectations/latest/">dbt_expectations</a> or <a class="reference external" href="https://hub.getdbt.com/dbt-labs/dbt_utils/latest/">dbt_utils</a>.</p>
<p>In those cases you’ll need to define a new <em>type</em> of data validation test using
dbt!</p>
<p>Writing tests in dbt means they’ll be located next to all the other data
validation we’re defining in the dbt schemas, which is nice. They also tend to
be quite performant.</p>
<p>In a few rare cases you may need to write the check with access to all of
the tools within Python. In those cases, you can use <a class="reference external" href="https://docs.dagster.io/guides/test/asset-checks">Dagster’s asset checks</a>, but in general we prefer
using dbt tests.</p>
<section id="how-do-i-write-a-new-dbt-test">
<h3>How do I write a new dbt test?<a class="headerlink" href="#how-do-i-write-a-new-dbt-test" title="Link to this heading">¶</a></h3>
<p>A dbt test is a templated SQL query that runs on your output data to look for
problems in the data. The query should be designed to return no rows if there
are no problems with the data. If the query returns any rows at all, then the
test will fail.</p>
<p>The test will need to live as a templated piece of SQL within
<code class="docutils literal notranslate"><span class="pre">pudl/dbt/tests/data_tests/generic_tests</span></code>. dbt has <a class="reference external" href="https://docs.getdbt.com/best-practices/writing-custom-generic-tests">official docs</a> for
doing this, but the core steps are:</p>
<ol class="arabic simple">
<li><p>Check to see whether the test you need is already provided by <a class="reference external" href="https://hub.getdbt.com/dbt-labs/dbt_utils/latest/">dbt-utils</a> or <a class="reference external" href="https://github.com/metaplane/dbt-expectations">dbt-expectations</a>.</p></li>
<li><p>Make a file called <code class="docutils literal notranslate"><span class="pre">pudl/dbt/tests/data_tests/generic_tests/your_test.sql</span></code>.</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">test</span> <span class="pre">your_test(some_test_params...)</span> <span class="pre">%}</span></code> to the top of the file
and <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">endtest</span> <span class="pre">%}</span></code> to the end. By default, if a test is defined at the
<strong>table</strong> level, it will receive the <code class="docutils literal notranslate"><span class="pre">model</span></code> parameter; if it’s defined
at the <strong>column</strong> level, it will receive both <code class="docutils literal notranslate"><span class="pre">model</span></code> and <code class="docutils literal notranslate"><span class="pre">column</span></code>
parameters; and you can add more custom parameters in the test signature
which will be read out of the schema YAML.</p></li>
<li><p>Write a SQL <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> statement that returns any data that would fail your
test, as well as useful debugging information. See our existing tests in
<code class="docutils literal notranslate"><span class="pre">dbt/tests/data_tests/generic_tests</span></code> to see some common patterns.
<code class="docutils literal notranslate"><span class="pre">dbt/tests/data_tests/generic_tests/expect_consistent_years.sql</span></code> may be
of particular use as a simple example that returns useful debugging context
along with the failing rows.</p></li>
</ol>
<p>If you’re not already familiar with SQL, here are some useful resources:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://mode.com/sql-tutorial">Interactive Mode SQL Tutorial</a></p></li>
<li><p><a class="reference external" href="https://third-bit.com/sql/">Greg Wilson’s Querynomicon</a></p></li>
<li><p><a class="reference external" href="https://motherduckdb.github.io/sql-tutorial/">Interactive DuckDB SQL Tutorial</a></p></li>
<li><p><a class="reference external" href="https://duckdb.org/docs/stable/sql/introduction.html">DuckDB SQL Introduction</a></p></li>
<li><p><a class="reference external" href="https://www.oreilly.com/library/view/sql-for-data/9781119669364/">SQL for Data Scientists</a> (book)</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Refer to <a class="reference internal" href="#pudl-dbt-quirks"><span class="std std-ref">PUDL Specific Design Choices</span></a> above for an explanation of some details of our dbt
setup that may affect what functionality is available when writing new tests.</p>
</div>
</section>
<section id="testing-your-new-test">
<h3>Testing your new test<a class="headerlink" href="#testing-your-new-test" title="Link to this heading">¶</a></h3>
<p>OK, now you have a new test, which <em>seems</em> to be working.
How can we check to make sure it’s doing what we want?</p>
<p>dbt has robust macro testing tools, and tests are basically macros,
but unfortunately you still have to jump through a couple hoops:</p>
<ol class="arabic simple">
<li><p>Pull the test logic out into a macro</p></li>
<li><p>Use the test as a <em>very</em> thin wrapper around the logic macro</p></li>
<li><p>Test the logic macro</p></li>
</ol>
<p>First, we pull the test logic out into a macro (let’s call it <code class="docutils literal notranslate"><span class="pre">your_macro()</span></code>):</p>
<ol class="arabic simple">
<li><p>Move the test file from above to <code class="docutils literal notranslate"><span class="pre">pudl/dbt/macros/your_macro.sql</span></code></p></li>
<li><p>Replace <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">test</span> <span class="pre">your_macro(...)</span> <span class="pre">%}</span></code> with <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">macro</span> <span class="pre">your_macro(...)</span> <span class="pre">%}</span></code></p></li>
<li><p>Replace <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">endtest</span> <span class="pre">%}</span></code> with <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">endmacro</span> <span class="pre">%}</span></code></p></li>
</ol>
<p>The logic macro is now available to use in tests. Next, use the test as a
wrapper around the logic macro you just wrote. Make the test file read
like this:</p>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">test</span> <span class="nv">your_test</span><span class="o">(</span><span class="nv">model</span><span class="o">,</span> <span class="nv">custom_param</span><span class="o">)</span> <span class="cp">%}</span>

<span class="cp">{{</span> <span class="nv">your_macro</span><span class="o">(</span><span class="nv">model</span><span class="o">,</span> <span class="nv">custom_param</span><span class="o">)</span> <span class="cp">}}</span>

<span class="cp">{%</span> <span class="k">endtest</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>This makes it a very simple wrapper that allows the test logic to be accessed
from a <code class="docutils literal notranslate"><span class="pre">data_tests</span></code> block within the schema.</p>
<p>Finally, write a test in <code class="docutils literal notranslate"><span class="pre">pudl/dbt/tests/unit_tests/test_your_macro.sql</span></code>. This
SQL file doesn’t need any special <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">...</span> <span class="pre">%}</span></code> stuff in it.</p>
<p>The structure is easiest to explain with an example. Let’s walk through a test
that checks if the row-counts macro is working as expected:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">WITH</span><span class="w"> </span><span class="n">test_row_counts</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="k">VALUES</span>
<span class="w">        </span><span class="p">(</span><span class="s1">&#39;test_table&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">2022</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span>
<span class="w">        </span><span class="p">(</span><span class="s1">&#39;test_table&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">2023</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">t</span><span class="p">(</span><span class="k">table_name</span><span class="p">,</span><span class="w"> </span><span class="n">partition</span><span class="p">,</span><span class="w"> </span><span class="k">row_count</span><span class="p">)</span>
<span class="p">),</span>
</pre></div>
</div>
<p>Here, <code class="docutils literal notranslate"><span class="pre">test_row_counts</span></code> is setting up the expected row counts per partition.
We use that <code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">*</span> <span class="pre">FROM</span> <span class="pre">(VALUES</span></code> construction to make a temporary SQL table
with that literal data - 2 rows saying that “<code class="docutils literal notranslate"><span class="pre">test_table</span></code> should have 1 row in
2022 and 1 in 2023”. Continuing on:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">test_table</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="k">VALUES</span>
<span class="w">        </span><span class="p">(</span><span class="mi">2022</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;x&#39;</span><span class="p">),</span>
<span class="w">        </span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;x&#39;</span><span class="p">),</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">t</span><span class="p">(</span><span class="n">report_year</span><span class="p">,</span><span class="w"> </span><span class="n">dummy_col</span><span class="p">)</span>
<span class="p">),</span>
</pre></div>
</div>
<p>Here, we define <code class="docutils literal notranslate"><span class="pre">test_table</span></code>, the actual table we’re counting rows for. You
can see we’ve added one row for 2022 and one for 2023 - so we expect the test
to pass! Next:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">expected_mismatch_counts</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="k">VALUES</span>
<span class="w">        </span><span class="p">(</span><span class="s1">&#39;test_table&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">t</span><span class="p">(</span><span class="k">table_name</span><span class="p">,</span><span class="w"> </span><span class="n">num_mismatches</span><span class="p">)</span>
<span class="p">),</span>
</pre></div>
</div>
<p>We’re saying here that <code class="docutils literal notranslate"><span class="pre">expected_mismatch_counts</span></code> is 0 - there are <em>no</em>
partitions where we expect there to be a mismatch. Next, we call the macro:</p>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="x">result_comparison AS (</span>
<span class="x">    SELECT (SELECT COUNT(*)</span>
<span class="x">    FROM (</span><span class="cp">{{</span>
        <span class="nv">row_counts_per_partition</span><span class="o">(</span><span class="s1">&#39;test_table&#39;</span><span class="o">,</span> <span class="s1">&#39;test_table&#39;</span><span class="o">,</span> <span class="s1">&#39;report_year&#39;</span><span class="o">,</span> <span class="nv">force_row_counts_table</span><span class="o">=</span><span class="s1">&#39;test_row_counts&#39;</span><span class="o">)</span>
    <span class="cp">}}</span><span class="x">)) as observed_mismatch_count,</span>
<span class="x">    num_mismatches AS expected_mismatch_count,</span>
<span class="x">    FROM expected_mismatch_counts</span>
<span class="x">)</span>
</pre></div>
</div>
<p>This one is a bit more complicated.</p>
<p>Let’s start from the macro call <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">row_counts_per_partition(...)</span> <span class="pre">}}</span></code>. This
gets us one row per partition that has a mismatched number of rows between
the expected row counts (<code class="docutils literal notranslate"><span class="pre">test_row_counts</span></code>) and the observed row counts in
<code class="docutils literal notranslate"><span class="pre">test_table</span></code>.</p>
<p>Then we wrap that in <code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">COUNT(*)</span></code> which tells us how many rows that macro
call returned (in this case, 0).</p>
<p>Finally, we wrap that in <code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">(SELECT</span> <span class="pre">COUNT(*)</span> <span class="pre">FROM</span> <span class="pre">...)</span> <span class="pre">as</span>
<span class="pre">observed_mismatch_count</span> <span class="pre">...</span></code>. That makes a table where the columns are the
observed mismatch count (0, as counted by the macro) and the expected mismatch
count (directly pulled from the <code class="docutils literal notranslate"><span class="pre">expected_mismatch_counts</span></code> table we set up
earlier). Finally we are ready to actually run the top-level <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> - much
like other tests, we are looking for problem rows - if the <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> returns 0
rows that means a passing test:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">result_comparison</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">observed_mismatch_count</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">expected_mismatch_count</span>
</pre></div>
</div>
<p>So if we observe a different number of mismatched partitions than what we
expect, this test will fail. We can repeat this structure with different input
data to cover many different use cases of the macro.</p>
<p>If the test is particularly weird and hard to get good debug
info for, you can add custom debug handlers for your test type in
<a class="reference internal" href="../autoapi/pudl/dbt_wrapper/index.html#pudl.dbt_wrapper.build_with_context" title="pudl.dbt_wrapper.build_with_context"><code class="xref py py-func docutils literal notranslate"><span class="pre">pudl.dbt_wrapper.build_with_context()</span></code></a>, which gives you access to the full
power of Python.</p>
</section>
<section id="creating-intermediate-tables-for-a-test">
<span id="intermediate-tables"></span><h3>Creating intermediate tables for a test<a class="headerlink" href="#creating-intermediate-tables-for-a-test" title="Link to this heading">¶</a></h3>
<p>Sometimes you’ll need to do a test in two steps. For example, if you want to
use a column test (such as <code class="docutils literal notranslate"><span class="pre">expect_quantile_constraints</span></code>) on the ratio of two
columns, you will need to calculate that ratio as a separate column.</p>
<p>This can be done by creating a new <a class="reference external" href="https://docs.getdbt.com/docs/build/models">dbt model</a> that materializes an
intermediate table you want to execute tests on. Add a SQL file to
<code class="docutils literal notranslate"><span class="pre">dbt/models/{data_source}/{source_table_name}/{intermediate_table_name}.sql</span></code>
containing a <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> statement that builds your new table. For
example, if you need to divide the <code class="docutils literal notranslate"><span class="pre">source_table_name.a</span></code> column by
<code class="docutils literal notranslate"><span class="pre">source_table_name.b</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span>
<span class="n">a</span> <span class="o">/</span> <span class="n">b</span> <span class="k">as</span> <span class="n">my_ratio</span>
<span class="kn">from</span><span class="w"> </span><span class="p">{{</span> <span class="n">source</span><span class="p">(</span><span class="s1">&#39;pudl&#39;</span><span class="p">,</span> <span class="s1">&#39;source_table_name&#39;</span><span class="p">)</span> <span class="p">}}</span>
</pre></div>
</div>
<p>Then add the model to the <code class="docutils literal notranslate"><span class="pre">schema.yml</span></code> file under the <code class="docutils literal notranslate"><span class="pre">models</span></code> top-level
key, and define tests exactly as you would for a <code class="docutils literal notranslate"><span class="pre">source</span></code> table. See
<code class="docutils literal notranslate"><span class="pre">models/ferc1/out_ferc1__yearly_steam_plants_fuel_by_plant_sched402</span></code> for an
example of
this pattern.</p>
<p>Note: when adding a model, it will be stored as a SQL <code class="docutils literal notranslate"><span class="pre">view</span></code> in the file
<code class="docutils literal notranslate"><span class="pre">$PUDL_OUTPUT/pudl_dbt_tests.duckdb</span></code>.</p>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="metadata.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Metadata editing guide</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="data_validation_quickstart.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Data validation quickstart</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2016-2026, Catalyst Cooperative, CC-BY-4.0
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Data validation reference</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#common-workflows">Common workflows</a></li>
<li><a class="reference internal" href="#pudl-specific-design-choices">PUDL Specific Design Choices</a></li>
<li><a class="reference internal" href="#branch-builds">Branch builds</a><ul>
<li><a class="reference internal" href="#kicking-off-a-branch-build">Kicking off a branch build</a></li>
<li><a class="reference internal" href="#getting-fresh-row-counts-from-a-branch-build">Getting fresh row counts from a branch build</a></li>
</ul>
</li>
<li><a class="reference internal" href="#running-dbt-directly">Running dbt directly</a></li>
<li><a class="reference internal" href="#data-validation-in-our-integration-tests">Data validation in our integration tests</a></li>
<li><a class="reference internal" href="#debugging-data-validation-failures">Debugging data validation failures</a><ul>
<li><a class="reference internal" href="#general-strategies-and-tools">General strategies and tools</a><ul>
<li><a class="reference internal" href="#use-dbt-helper-validate">Use <code class="docutils literal notranslate"><span class="pre">dbt_helper</span> <span class="pre">validate</span></code></a></li>
<li><a class="reference internal" href="#inspect-the-sql-query-for-the-test-and-run-it-yourself">Inspect the SQL query for the test and run it yourself</a><ul>
<li><a class="reference internal" href="#run-once-using-the-shell">Run once using the shell</a></li>
<li><a class="reference internal" href="#run-inside-a-duckdb-session">Run inside a duckdb session</a></li>
<li><a class="reference internal" href="#dealing-with-terrible-failure-row-output">Dealing with terrible failure row output</a></li>
</ul>
</li>
<li><a class="reference internal" href="#debugging-and-fixing-row-count-failures">Debugging and fixing row count failures</a></li>
</ul>
</li>
<li><a class="reference internal" href="#debugging-quantile-checks">Debugging quantile checks</a></li>
</ul>
</li>
<li><a class="reference internal" href="#applying-pre-defined-validations-to-existing-data">Applying pre-defined validations to existing data</a><ul>
<li><a class="reference internal" href="#pre-defined-tests">Pre-defined tests</a></li>
<li><a class="reference internal" href="#tests-defined-within-pudl">Tests defined within PUDL</a></li>
</ul>
</li>
<li><a class="reference internal" href="#adding-new-tables">Adding new tables</a><ul>
<li><a class="reference internal" href="#using-dbt-helper-update-tables">Using <code class="docutils literal notranslate"><span class="pre">dbt_helper</span> <span class="pre">update-tables</span></code></a></li>
<li><a class="reference internal" href="#initial-data-tests">Initial data tests</a></li>
<li><a class="reference internal" href="#checking-for-entirely-null-columns">Checking for entirely null columns</a></li>
</ul>
</li>
<li><a class="reference internal" href="#defining-new-data-validation-tests">Defining new data validation tests</a><ul>
<li><a class="reference internal" href="#how-do-i-write-a-new-dbt-test">How do I write a new dbt test?</a></li>
<li><a class="reference internal" href="#testing-your-new-test">Testing your new test</a></li>
<li><a class="reference internal" href="#creating-intermediate-tables-for-a-test">Creating intermediate tables for a test</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=11fc87b4"></script>
    <script src="../_static/doctools.js?v=fd6eb6e6"></script>
    <script src="../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script src="../_static/scripts/furo.js?v=46bd48cc"></script>
    </body>
</html>