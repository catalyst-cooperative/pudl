version: 2
sources:
  - name: pudl
    tables:
      - name: core_rus7__yearly_statement_of_operations
        data_tests:
          - expect_columns_not_all_null
          - expect_columns_ratio:
              arguments:
                numerator_column: opex_report_month
                denominator_column: opex_ytd
                min_ratio: .05
                max_ratio: .2
              config:
                error_if: ">40000" # TODO: Worth keeping if >20% of data violates?
              description: "Monthly spending should roughly equal 1/12 of the YTD budget (5-20% range)."
          - expect_columns_ratio:
              arguments:
                numerator_column: opex_ytd
                denominator_column: opex_ytd_budget
                min_ratio: .75
                max_ratio: 1.25
              config:
                error_if: ">42000" # TODO: Worth keeping if >20% of data violates?
              description: "Budgeted spending and YTD spending should be roughly equivalent."
        columns:
          - name: report_date
          - name: borrower_id_rus
          - name: borrower_name_rus
          - name: opex_type
          - name: opex_group
          - name: opex_report_month
            # data_tests:
            #   - dbt_expectations.expect_column_min_to_be_between:
            #       arguments:
            #         min_value: 0.0 # TODO: This is widely violated. Keep or adjust expectation?
          - name: opex_ytd
            # data_tests:
            #   - dbt_expectations.expect_column_min_to_be_between:
            #       arguments:
            #         min_value: 0.0 # TODO: This is widely violated. Keep or adjust expectation?
          - name: opex_ytd_budget
            # data_tests:
            #     - dbt_expectations.expect_column_min_to_be_between:
            #         arguments:
            #           min_value: 0.0 # TODO: This is widely violated. Keep or adjust expectation?
          - name: is_total
