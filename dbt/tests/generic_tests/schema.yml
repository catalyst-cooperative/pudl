version: 2

macros:
  - name: check_column_correlation
    description: Check the correlation between two columns
    arguments:
      - name: column1
        type: string
        description: The name of the first column
      - name: column2
        type: string
        description: The name of the second column
      - name: correlation_coef
        type: float
        description: The correlation coefficient to check for
  - name: check_row_counts_per_partition
    description: Check that the number of rows in each partition is as expected
    arguments:
      - name: table_name
        type: string
        description: The name of the table to check
      - name: partition_column
        type: string
        description: The name of the column to partition by
  - name: expect_includes_all_value_combinations_from
    description:
      Check that all values in a column or set of columns are the same
      as the same set of columns in another table. Similar to a foreign key
      constraint, but rather than check if values from the model table exist in a comparison table,
      this checks if the comparison table has values that don't exist in the model table.
    arguments:
      - name: compare_df_name
        type: string
        description: The name of the table to compare columns with
      - name: compare_cols
        type: list
        description: A list of column names present in both tables. The test will succeed only if all combinations of column values present in at least one row in the comparison table are present in this table.
  - name: expect_column_quantile_values_to_be_between
    description: Check that the quantile values of a column are within a range
    arguments:
      - name: quantile
        type: float
        description: The quantile to check
      - name: weight_column
        type: string
        description: The name of the column to use as weights
      - name: min_value
        type: float
        description: The minimum value for the quantile
      - name: max_value
        type: float
        description: The maximum value for the quantile
      - name: group_by
        type: string
        description: The name of the column to group by
      - name: row_condition
        type: string
        description: The condition to filter rows by
      - name: strictly
        type: boolean
        description: Whether the values should be strictly between the min and max values
  - name: no_null_rows
    description: Check that there are no null rows in the table
  - name: not_all_null
    description: Check that not all values in a column are null
