"""update sec ownership tables

Revision ID: 9cf18d96207d
Revises: 2be9c446753f
Create Date: 2025-04-07 13:10:51.420234

"""
from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision = '9cf18d96207d'
down_revision = '2be9c446753f'
branch_labels = None
depends_on = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('core_sec10k__assn_exhibit_21_subsidiaries_and_filers',
    sa.Column('subsidiary_company_id_sec10k', sa.Text(), nullable=False, comment='PUDL-assigned ID for subsidiaries extracted from SEC 10k Ex. 21 attachments. May not be stable over time.'),
    sa.Column('central_index_key', sa.Text(), nullable=True, comment='Identifier of the company in SEC database.'),
    sa.PrimaryKeyConstraint('subsidiary_company_id_sec10k', name=op.f('pk_core_sec10k__assn_exhibit_21_subsidiaries_and_filers'))
    )
    op.create_table('out_sec10k__parents_and_subsidiaries',
    sa.Column('filename_sec10k', sa.Text(), nullable=True, comment='Unique portion of the filename associated with the SEC 10-K filing in the EDGAR database. The full source URL can be reconstructed by prepending https://www.sec.gov/Archives/edgar/data/ and adding the .txt file type extension.'),
    sa.Column('subsidiary_company_name', sa.Text(), nullable=True, comment='Name of subsidiary company.'),
    sa.Column('subsidiary_company_location', sa.Text(), nullable=True, comment='Location of subsidiary company.'),
    sa.Column('subsidiary_company_id_sec10k', sa.Text(), nullable=True, comment='PUDL-assigned ID for subsidiaries extracted from SEC 10k Ex. 21 attachments. May not be stable over time.'),
    sa.Column('fraction_owned', sa.Float(), nullable=True, comment='Proportion of generator ownership attributable to this utility.'),
    sa.Column('parent_company_central_index_key', sa.Text(), nullable=True, comment='Central index key (CIK) of the parent company.'),
    sa.Column('parent_company_name', sa.Text(), nullable=True, comment='Name of the parent company.'),
    sa.Column('filing_date', sa.Date(), nullable=True, comment='Date filing was submitted, reported at a daily frequency.'),
    sa.Column('report_date', sa.Date(), nullable=True, comment='Date reported.'),
    sa.Column('parent_company_phone_number', sa.Text(), nullable=True, comment='Phone number of the parent company.'),
    sa.Column('parent_company_city', sa.Text(), nullable=True, comment='City the parent company is located in.'),
    sa.Column('parent_company_name_change_date', sa.Text(), nullable=True, comment='Date of last name change of the parent company.'),
    sa.Column('parent_company_name_former', sa.Text(), nullable=True, comment='Former name of the parent company.'),
    sa.Column('parent_company_state', sa.Text(), nullable=True, comment='State the parent company is located in.'),
    sa.Column('parent_company_state_of_incorporation', sa.Text(), nullable=True, comment='State the parent company is incorporated in.'),
    sa.Column('parent_company_street_address', sa.Text(), nullable=True, comment='Street address of the parent company.'),
    sa.Column('parent_company_address_2', sa.Text(), nullable=True, comment='Second line of the parent company address.'),
    sa.Column('parent_company_zip_code', sa.Text(), nullable=True, comment='Five digit US Zip Code of the parent company.'),
    sa.Column('parent_company_zip_code_4', sa.Text(), nullable=True, comment='Four digit US Zip Code suffix of the parent company.'),
    sa.Column('parent_company_utility_id_eia', sa.Text(), nullable=True, comment='The EIA utility ID of the parent company.'),
    sa.Column('parent_company_utility_name_eia', sa.Text(), nullable=True, comment='The EIA reported utility name of the parent company.'),
    sa.Column('subsidiary_company_central_index_key', sa.Text(), nullable=True, comment='Central index key (CIK) of the subsidiary company.'),
    sa.Column('subsidiary_company_phone_number', sa.Text(), nullable=True, comment='Phone number of the subsidiary company.'),
    sa.Column('subsidiary_company_city', sa.Text(), nullable=True, comment='City the subsidiary company is located in.'),
    sa.Column('subsidiary_company_name_change_date', sa.Text(), nullable=True, comment='Date of last name change of the subsidiary company.'),
    sa.Column('subsidiary_company_name_former', sa.Text(), nullable=True, comment='Former name of the subsidiary company.'),
    sa.Column('subsidiary_company_state', sa.Text(), nullable=True, comment='State the subsidiary company is located in.'),
    sa.Column('subsidiary_company_state_of_incorporation', sa.Text(), nullable=True, comment='State the subsidiary company is incorporated in.'),
    sa.Column('subsidiary_company_street_address', sa.Text(), nullable=True, comment='Street address of the subsidiary company.'),
    sa.Column('subsidiary_company_address_2', sa.Text(), nullable=True, comment='Second line of the subsidiary company address.'),
    sa.Column('subsidiary_company_zip_code', sa.Text(), nullable=True, comment='Five digit US Zip Code of the parent company.'),
    sa.Column('subsidiary_company_zip_code_4', sa.Text(), nullable=True, comment='Four digit US Zip Code suffix of the parent company.'),
    sa.Column('subsidiary_company_utility_id_eia', sa.Text(), nullable=True, comment='The EIA utility ID of the subsidiary company.'),
    sa.Column('subsidiary_company_utility_name_eia', sa.Text(), nullable=True, comment='The EIA reported utility name of the subsidiary company.')
    )
    op.create_table('core_sec10k__assn_exhibit_21_subsidiaries_and_eia_utilities',
    sa.Column('subsidiary_company_id_sec10k', sa.Text(), nullable=False, comment='PUDL-assigned ID for subsidiaries extracted from SEC 10k Ex. 21 attachments. May not be stable over time.'),
    sa.Column('utility_id_eia', sa.Integer(), nullable=True, comment='The EIA Utility Identification number.'),
    sa.ForeignKeyConstraint(['utility_id_eia'], ['core_eia__entity_utilities.utility_id_eia'], name=op.f('fk_core_sec10k__assn_exhibit_21_subsidiaries_and_eia_utilities_utility_id_eia_core_eia__entity_utilities')),
    sa.PrimaryKeyConstraint('subsidiary_company_id_sec10k', name=op.f('pk_core_sec10k__assn_exhibit_21_subsidiaries_and_eia_utilities'))
    )
    with op.batch_alter_table('core_sec10k__parents_and_subsidiaries', schema=None) as batch_op:
        batch_op.add_column(sa.Column('subsidiary_company_name', sa.Text(), nullable=True, comment='Name of subsidiary company.'))
        batch_op.add_column(sa.Column('subsidiary_company_location', sa.Text(), nullable=True, comment='Location of subsidiary company.'))
        batch_op.add_column(sa.Column('subsidiary_company_id_sec10k', sa.Text(), nullable=True, comment='PUDL-assigned ID for subsidiaries extracted from SEC 10k Ex. 21 attachments. May not be stable over time.'))
        batch_op.drop_column('street_address')
        batch_op.drop_column('address_2')
        batch_op.drop_column('incorporation_state')
        batch_op.drop_column('parent_company_central_index_key')
        batch_op.drop_column('taxpayer_id_irs')
        batch_op.drop_column('company_id_sec10k')
        batch_op.drop_column('central_index_key')
        batch_op.drop_column('company_name_old')
        batch_op.drop_column('company_name_raw')
        batch_op.drop_column('state')
        batch_op.drop_column('utility_id_eia')
        batch_op.drop_column('city')
        batch_op.drop_column('industry_name_sic')
        batch_op.drop_column('name_change_date')
        batch_op.drop_column('industry_id_sic')
        batch_op.drop_column('files_sec10k')
        batch_op.drop_column('location_of_incorporation')

    with op.batch_alter_table('core_sec10k__quarterly_exhibit_21_company_ownership', schema=None) as batch_op:
        batch_op.add_column(sa.Column('parent_company_central_index_key', sa.Text(), nullable=True, comment='Central index key (CIK) of the parent company.'))
        batch_op.add_column(sa.Column('parent_company_name', sa.Text(), nullable=True, comment='Name of the parent company.'))
        batch_op.add_column(sa.Column('subsidiary_company_id_sec10k', sa.Text(), nullable=True, comment='PUDL-assigned ID for subsidiaries extracted from SEC 10k Ex. 21 attachments. May not be stable over time.'))
        batch_op.add_column(sa.Column('filing_date', sa.Date(), nullable=True, comment='Date filing was submitted, reported at a daily frequency.'))

    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    with op.batch_alter_table('core_sec10k__quarterly_exhibit_21_company_ownership', schema=None) as batch_op:
        batch_op.drop_column('filing_date')
        batch_op.drop_column('subsidiary_company_id_sec10k')
        batch_op.drop_column('parent_company_name')
        batch_op.drop_column('parent_company_central_index_key')

    with op.batch_alter_table('core_sec10k__parents_and_subsidiaries', schema=None) as batch_op:
        batch_op.add_column(sa.Column('location_of_incorporation', sa.TEXT(), nullable=True))
        batch_op.add_column(sa.Column('files_sec10k', sa.BOOLEAN(), nullable=True))
        batch_op.add_column(sa.Column('industry_id_sic', sa.TEXT(), nullable=True))
        batch_op.add_column(sa.Column('name_change_date', sa.DATE(), nullable=True))
        batch_op.add_column(sa.Column('industry_name_sic', sa.TEXT(), nullable=True))
        batch_op.add_column(sa.Column('city', sa.TEXT(), nullable=True))
        batch_op.add_column(sa.Column('utility_id_eia', sa.INTEGER(), nullable=True))
        batch_op.add_column(sa.Column('state', sa.TEXT(), nullable=True))
        batch_op.add_column(sa.Column('company_name_raw', sa.TEXT(), nullable=True))
        batch_op.add_column(sa.Column('company_name_old', sa.TEXT(), nullable=True))
        batch_op.add_column(sa.Column('central_index_key', sa.TEXT(), nullable=True))
        batch_op.add_column(sa.Column('company_id_sec10k', sa.TEXT(), nullable=True))
        batch_op.add_column(sa.Column('taxpayer_id_irs', sa.TEXT(), nullable=True))
        batch_op.add_column(sa.Column('parent_company_central_index_key', sa.TEXT(), nullable=True))
        batch_op.add_column(sa.Column('incorporation_state', sa.TEXT(), nullable=True))
        batch_op.add_column(sa.Column('address_2', sa.TEXT(), nullable=True))
        batch_op.add_column(sa.Column('street_address', sa.TEXT(), nullable=True))
        batch_op.drop_column('subsidiary_company_id_sec10k')
        batch_op.drop_column('subsidiary_company_location')
        batch_op.drop_column('subsidiary_company_name')

    op.drop_table('core_sec10k__assn_exhibit_21_subsidiaries_and_eia_utilities')
    op.drop_table('out_sec10k__parents_and_subsidiaries')
    op.drop_table('core_sec10k__assn_exhibit_21_subsidiaries_and_filers')
    # ### end Alembic commands ###
