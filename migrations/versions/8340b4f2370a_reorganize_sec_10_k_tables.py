"""Reorganize SEC 10-K tables.

Revision ID: 8340b4f2370a
Revises: 5c0ceadf2411
Create Date: 2025-03-28 10:17:56.036856

"""
from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision = '8340b4f2370a'
down_revision = '5c0ceadf2411'
branch_labels = None
depends_on = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    with op.batch_alter_table('core_sec10k__changelog_company_name', schema=None) as batch_op:
        batch_op.add_column(sa.Column('company_name_old', sa.Text(), nullable=True, comment='Name of company prior to name change.'))
        batch_op.add_column(sa.Column('company_name_new', sa.Text(), nullable=True, comment='Name of company after name change.'))
        batch_op.alter_column('central_index_key',
               existing_type=sa.TEXT(),
               nullable=True)
        batch_op.drop_column('company_name')

    with op.batch_alter_table('core_sec10k__quarterly_company_information', schema=None) as batch_op:
        batch_op.add_column(sa.Column('filer_count', sa.Integer(), nullable=False, comment='A counter indicating which observation of company data within an SEC 10-K filing header the record pertains to.'))
        batch_op.add_column(sa.Column('incorporation_state', sa.Text(), nullable=True, comment='Two letter state code where company is incorporated.'))
        batch_op.add_column(sa.Column('sec10k_type', sa.Text(), nullable=True, comment='Specific version of SEC 10-K that was filed. 10-k: the standard annual report. 10-k/a: an amended version of the annual report. 10-k405: filed to report insider trading that was not reported in a timely fashion. 10-k405/a: an amended version of the 10-k405. 10-kt: submitted in lieu of or in addition to a standard 10-K annual report when a company changes the end of its fiscal year (e.g. due to a merger) leaving the company with a longer or shorter reporting period. 10-kt/a: an amended version of the 10-kt. 10-ksb: the annual report for small businesses, also known as penny stocks. 10-ksb/a: an amended version of the 10-ksb.'))
        batch_op.add_column(sa.Column('business_street_address', sa.Text(), nullable=True, comment="Street address of the company's place of business."))
        batch_op.add_column(sa.Column('business_street_address_2', sa.Text(), nullable=True, comment="Second line of the street address of the company's place of business."))
        batch_op.add_column(sa.Column('business_city', sa.Text(), nullable=True, comment="City where the company's place of business is located."))
        batch_op.add_column(sa.Column('business_state', sa.Text(), nullable=True, comment="State where the company's place of business is located."))
        batch_op.add_column(sa.Column('business_zip_code', sa.Text(), nullable=True, comment="Zip code of the company's place of business."))
        batch_op.add_column(sa.Column('business_zip_code_4', sa.Text(), nullable=True, comment="Zip code suffix of the company's place of business."))
        batch_op.add_column(sa.Column('business_postal_code', sa.Text(), nullable=True, comment="Non-US postal code of the company's place of business."))
        batch_op.add_column(sa.Column('mail_street_address', sa.Text(), nullable=True, comment="Street portion of the company's for mailing address."))
        batch_op.add_column(sa.Column('mail_street_address_2', sa.Text(), nullable=True, comment="Second line of the street portion of the company's mailing address."))
        batch_op.add_column(sa.Column('mail_city', sa.Text(), nullable=True, comment="City of the company's mailing address."))
        batch_op.add_column(sa.Column('mail_state', sa.Text(), nullable=True, comment="State of the company's mailing address."))
        batch_op.add_column(sa.Column('mail_zip_code', sa.Text(), nullable=True, comment="Zip code of the company's mailing address."))
        batch_op.add_column(sa.Column('mail_zip_code_4', sa.Text(), nullable=True, comment="Zip code suffix of the company's mailing address."))
        batch_op.add_column(sa.Column('mail_postal_code', sa.Text(), nullable=True, comment="Non-US postal code of the company's mailing address."))
        batch_op.alter_column('filename_sec10k',
               existing_type=sa.TEXT(),
               nullable=False)
        batch_op.alter_column('central_index_key',
               existing_type=sa.TEXT(),
               nullable=True)
        batch_op.drop_column('street_address')
        batch_op.drop_column('state')
        batch_op.drop_column('zip_code_4')
        batch_op.drop_column('company_name_former')
        batch_op.drop_column('sec10k_version')
        batch_op.drop_column('address_2')
        batch_op.drop_column('state_of_incorporation')
        batch_op.drop_column('report_date')
        batch_op.drop_column('name_change_date')
        batch_op.drop_column('city')
        batch_op.drop_column('zip_code')

    with op.batch_alter_table('core_sec10k__quarterly_filings', schema=None) as batch_op:
        batch_op.add_column(sa.Column('sec10k_type', sa.Text(), nullable=True, comment='Specific version of SEC 10-K that was filed. 10-k: the standard annual report. 10-k/a: an amended version of the annual report. 10-k405: filed to report insider trading that was not reported in a timely fashion. 10-k405/a: an amended version of the 10-k405. 10-kt: submitted in lieu of or in addition to a standard 10-K annual report when a company changes the end of its fiscal year (e.g. due to a merger) leaving the company with a longer or shorter reporting period. 10-kt/a: an amended version of the 10-kt. 10-ksb: the annual report for small businesses, also known as penny stocks. 10-ksb/a: an amended version of the 10-ksb.'))
        batch_op.drop_column('sec10k_version')

    with op.batch_alter_table('out_sec10k__parents_and_subsidiaries', schema=None) as batch_op:
        batch_op.add_column(sa.Column('company_name_old', sa.Text(), nullable=True, comment='Name of company prior to name change.'))
        batch_op.add_column(sa.Column('incorporation_state', sa.Text(), nullable=True, comment='Two letter state code where company is incorporated.'))
        batch_op.drop_column('state_of_incorporation')
        batch_op.drop_column('company_name_former')

    with op.batch_alter_table('out_sec10k__quarterly_company_information', schema=None) as batch_op:
        batch_op.add_column(sa.Column('sec10k_type', sa.Text(), nullable=True, comment='Specific version of SEC 10-K that was filed. 10-k: the standard annual report. 10-k/a: an amended version of the annual report. 10-k405: filed to report insider trading that was not reported in a timely fashion. 10-k405/a: an amended version of the 10-k405. 10-kt: submitted in lieu of or in addition to a standard 10-K annual report when a company changes the end of its fiscal year (e.g. due to a merger) leaving the company with a longer or shorter reporting period. 10-kt/a: an amended version of the 10-kt. 10-ksb: the annual report for small businesses, also known as penny stocks. 10-ksb/a: an amended version of the 10-ksb.'))
        batch_op.add_column(sa.Column('company_name_old', sa.Text(), nullable=True, comment='Name of company prior to name change.'))
        batch_op.add_column(sa.Column('incorporation_state', sa.Text(), nullable=True, comment='Two letter state code where company is incorporated.'))
        batch_op.drop_column('state_of_incorporation')
        batch_op.drop_column('sec10k_version')
        batch_op.drop_column('company_name_former')

    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    with op.batch_alter_table('out_sec10k__quarterly_company_information', schema=None) as batch_op:
        batch_op.add_column(sa.Column('company_name_former', sa.TEXT(), nullable=True))
        batch_op.add_column(sa.Column('sec10k_version', sa.TEXT(), nullable=True))
        batch_op.add_column(sa.Column('state_of_incorporation', sa.TEXT(), nullable=True))
        batch_op.drop_column('incorporation_state')
        batch_op.drop_column('company_name_old')
        batch_op.drop_column('sec10k_type')

    with op.batch_alter_table('out_sec10k__parents_and_subsidiaries', schema=None) as batch_op:
        batch_op.add_column(sa.Column('company_name_former', sa.TEXT(), nullable=True))
        batch_op.add_column(sa.Column('state_of_incorporation', sa.TEXT(), nullable=True))
        batch_op.drop_column('incorporation_state')
        batch_op.drop_column('company_name_old')

    with op.batch_alter_table('core_sec10k__quarterly_filings', schema=None) as batch_op:
        batch_op.add_column(sa.Column('sec10k_version', sa.TEXT(), nullable=True))
        batch_op.drop_column('sec10k_type')

    with op.batch_alter_table('core_sec10k__quarterly_company_information', schema=None) as batch_op:
        batch_op.add_column(sa.Column('zip_code', sa.TEXT(), nullable=True))
        batch_op.add_column(sa.Column('city', sa.TEXT(), nullable=True))
        batch_op.add_column(sa.Column('name_change_date', sa.DATE(), nullable=True))
        batch_op.add_column(sa.Column('report_date', sa.DATE(), nullable=False))
        batch_op.add_column(sa.Column('state_of_incorporation', sa.TEXT(), nullable=True))
        batch_op.add_column(sa.Column('address_2', sa.TEXT(), nullable=True))
        batch_op.add_column(sa.Column('sec10k_version', sa.TEXT(), nullable=True))
        batch_op.add_column(sa.Column('company_name_former', sa.TEXT(), nullable=True))
        batch_op.add_column(sa.Column('zip_code_4', sa.TEXT(), nullable=True))
        batch_op.add_column(sa.Column('state', sa.TEXT(), nullable=True))
        batch_op.add_column(sa.Column('street_address', sa.TEXT(), nullable=True))
        batch_op.alter_column('central_index_key',
               existing_type=sa.TEXT(),
               nullable=False)
        batch_op.alter_column('filename_sec10k',
               existing_type=sa.TEXT(),
               nullable=True)
        batch_op.drop_column('mail_postal_code')
        batch_op.drop_column('mail_zip_code_4')
        batch_op.drop_column('mail_zip_code')
        batch_op.drop_column('mail_state')
        batch_op.drop_column('mail_city')
        batch_op.drop_column('mail_street_address_2')
        batch_op.drop_column('mail_street_address')
        batch_op.drop_column('business_postal_code')
        batch_op.drop_column('business_zip_code_4')
        batch_op.drop_column('business_zip_code')
        batch_op.drop_column('business_state')
        batch_op.drop_column('business_city')
        batch_op.drop_column('business_street_address_2')
        batch_op.drop_column('business_street_address')
        batch_op.drop_column('sec10k_type')
        batch_op.drop_column('incorporation_state')
        batch_op.drop_column('filer_count')

    with op.batch_alter_table('core_sec10k__changelog_company_name', schema=None) as batch_op:
        batch_op.add_column(sa.Column('company_name', sa.TEXT(), nullable=False))
        batch_op.alter_column('central_index_key',
               existing_type=sa.TEXT(),
               nullable=False)
        batch_op.drop_column('company_name_new')
        batch_op.drop_column('company_name_old')

    # ### end Alembic commands ###
