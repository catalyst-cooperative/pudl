"""Reorganize SEC 10-K tables

Revision ID: f01cc3a84cc6
Revises: 5c0ceadf2411
Create Date: 2025-03-28 17:38:57.777156

"""
from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision = 'f01cc3a84cc6'
down_revision = '5c0ceadf2411'
branch_labels = None
depends_on = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('core_sec10k__assn_sec10k_filers_and_eia_utilities',
    sa.Column('central_index_key', sa.Text(), nullable=True, comment='Identifier of the company in SEC database.'),
    sa.Column('utility_id_eia', sa.Integer(), nullable=True, comment='The EIA Utility Identification number.'),
    sa.ForeignKeyConstraint(['utility_id_eia'], ['core_eia__entity_utilities.utility_id_eia'], name=op.f('fk_core_sec10k__assn_sec10k_filers_and_eia_utilities_utility_id_eia_core_eia__entity_utilities'))
    )
    op.create_table('core_sec10k__parents_and_subsidiaries',
    sa.Column('company_id_sec10k', sa.Text(), nullable=True, comment='PUDL-assigned ID for companies that file SEC Form 10-K or are referenced in exhibit 21 attachments to Form 10-K. May not be stable over time.'),
    sa.Column('filename_sec10k', sa.Text(), nullable=True, comment='Name of filing as provided by SEC data portal.'),
    sa.Column('report_date', sa.Date(), nullable=True, comment='Date reported.'),
    sa.Column('central_index_key', sa.Text(), nullable=True, comment='Identifier of the company in SEC database.'),
    sa.Column('utility_id_eia', sa.Integer(), nullable=True, comment='The EIA Utility Identification number.'),
    sa.Column('street_address', sa.Text(), nullable=True, comment='Physical street address.'),
    sa.Column('address_2', sa.Text(), nullable=True, comment='Second line of the address.'),
    sa.Column('city', sa.Text(), nullable=True, comment='Name of the city.'),
    sa.Column('state', sa.Text(), nullable=True, comment='Two letter US state abbreviation.'),
    sa.Column('company_name_raw', sa.Text(), nullable=True, comment='Uncleaned name of company.'),
    sa.Column('name_change_date', sa.Date(), nullable=True, comment='Date of last name change of the company.'),
    sa.Column('company_name_old', sa.Text(), nullable=True, comment='Name of company prior to name change.'),
    sa.Column('industry_name_sic', sa.Text(), nullable=True, comment='Text description of Standard Industrial Classification (SIC)'),
    sa.Column('industry_id_sic', sa.Text(), nullable=True, comment="Four-digit Standard Industrial Classification (SIC) code identifying the company's primary industry. SIC codes have been replaced by NAICS codes in many applications, but are still used by the SEC. See e.g. https://www.osha.gov/data/sic-manual for code definitions."),
    sa.Column('incorporation_state', sa.Text(), nullable=True, comment='Two letter state code where company is incorporated.'),
    sa.Column('location_of_incorporation', sa.Text(), nullable=True, comment="Location of the company's incorporation. This can be a full US state name, a state abbreviation, the name of a foreign country, etc. Not yet standardized / cleaned."),
    sa.Column('taxpayer_id_irs', sa.Text(), nullable=True, comment='Taxpayer ID of the company with the IRS.'),
    sa.Column('files_sec10k', sa.Boolean(), nullable=True, comment='Indicates whether the company files an SEC 10-K.'),
    sa.Column('parent_company_central_index_key', sa.Text(), nullable=True, comment="Central index key (CIK) of the company's parent company."),
    sa.Column('fraction_owned', sa.Float(), nullable=True, comment='Proportion of generator ownership attributable to this utility.'),
    sa.ForeignKeyConstraint(['utility_id_eia'], ['core_eia__entity_utilities.utility_id_eia'], name=op.f('fk_core_sec10k__parents_and_subsidiaries_utility_id_eia_core_eia__entity_utilities'))
    )
    op.drop_table('core_sec10k__assn__sec10k_filers_and_eia_utilities')
    op.drop_table('out_sec10k__parents_and_subsidiaries')
    with op.batch_alter_table('core_sec10k__changelog_company_name', schema=None) as batch_op:
        batch_op.add_column(sa.Column('company_name_old', sa.Text(), nullable=True, comment='Name of company prior to name change.'))
        batch_op.add_column(sa.Column('company_name_new', sa.Text(), nullable=True, comment='Name of company after name change.'))
        batch_op.alter_column('central_index_key',
               existing_type=sa.TEXT(),
               nullable=True)
        batch_op.drop_column('company_name')

    with op.batch_alter_table('core_sec10k__quarterly_company_information', schema=None) as batch_op:
        batch_op.add_column(sa.Column('filer_count', sa.Integer(), nullable=False, comment='A counter indicating which observation of company data within an SEC 10-K filing header the record pertains to.'))
        batch_op.add_column(sa.Column('incorporation_state', sa.Text(), nullable=True, comment='Two letter state code where company is incorporated.'))
        batch_op.add_column(sa.Column('sec10k_type', sa.Text(), nullable=True, comment='Specific version of SEC 10-K that was filed. 10-k: the standard annual report. 10-k/a: an amended version of the annual report. 10-k405: filed to report insider trading that was not reported in a timely fashion. 10-k405/a: an amended version of the 10-k405. 10-kt: submitted in lieu of or in addition to a standard 10-K annual report when a company changes the end of its fiscal year (e.g. due to a merger) leaving the company with a longer or shorter reporting period. 10-kt/a: an amended version of the 10-kt. 10-ksb: the annual report for small businesses, also known as penny stocks. 10-ksb/a: an amended version of the 10-ksb.'))
        batch_op.add_column(sa.Column('business_street_address', sa.Text(), nullable=True, comment="Street address of the company's place of business."))
        batch_op.add_column(sa.Column('business_street_address_2', sa.Text(), nullable=True, comment="Second line of the street address of the company's place of business."))
        batch_op.add_column(sa.Column('business_city', sa.Text(), nullable=True, comment="City where the company's place of business is located."))
        batch_op.add_column(sa.Column('business_state', sa.Text(), nullable=True, comment="State where the company's place of business is located."))
        batch_op.add_column(sa.Column('business_zip_code', sa.Text(), nullable=True, comment="Zip code of the company's place of business."))
        batch_op.add_column(sa.Column('business_zip_code_4', sa.Text(), nullable=True, comment="Zip code suffix of the company's place of business."))
        batch_op.add_column(sa.Column('business_postal_code', sa.Text(), nullable=True, comment="Non-US postal code of the company's place of business."))
        batch_op.add_column(sa.Column('mail_street_address', sa.Text(), nullable=True, comment="Street portion of the company's for mailing address."))
        batch_op.add_column(sa.Column('mail_street_address_2', sa.Text(), nullable=True, comment="Second line of the street portion of the company's mailing address."))
        batch_op.add_column(sa.Column('mail_city', sa.Text(), nullable=True, comment="City of the company's mailing address."))
        batch_op.add_column(sa.Column('mail_state', sa.Text(), nullable=True, comment="State of the company's mailing address."))
        batch_op.add_column(sa.Column('mail_zip_code', sa.Text(), nullable=True, comment="Zip code of the company's mailing address."))
        batch_op.add_column(sa.Column('mail_zip_code_4', sa.Text(), nullable=True, comment="Zip code suffix of the company's mailing address."))
        batch_op.add_column(sa.Column('mail_postal_code', sa.Text(), nullable=True, comment="Non-US postal code of the company's mailing address."))
        batch_op.alter_column('filename_sec10k',
               existing_type=sa.TEXT(),
               nullable=False)
        batch_op.alter_column('central_index_key',
               existing_type=sa.TEXT(),
               nullable=True)
        batch_op.drop_column('company_name_former')
        batch_op.drop_column('sec10k_version')
        batch_op.drop_column('zip_code_4')
        batch_op.drop_column('state_of_incorporation')
        batch_op.drop_column('zip_code')
        batch_op.drop_column('city')
        batch_op.drop_column('state')
        batch_op.drop_column('report_date')
        batch_op.drop_column('name_change_date')
        batch_op.drop_column('address_2')
        batch_op.drop_column('street_address')

    with op.batch_alter_table('core_sec10k__quarterly_filings', schema=None) as batch_op:
        batch_op.add_column(sa.Column('sec10k_type', sa.Text(), nullable=True, comment='Specific version of SEC 10-K that was filed. 10-k: the standard annual report. 10-k/a: an amended version of the annual report. 10-k405: filed to report insider trading that was not reported in a timely fashion. 10-k405/a: an amended version of the 10-k405. 10-kt: submitted in lieu of or in addition to a standard 10-K annual report when a company changes the end of its fiscal year (e.g. due to a merger) leaving the company with a longer or shorter reporting period. 10-kt/a: an amended version of the 10-kt. 10-ksb: the annual report for small businesses, also known as penny stocks. 10-ksb/a: an amended version of the 10-ksb.'))
        batch_op.drop_column('sec10k_version')

    with op.batch_alter_table('out_sec10k__quarterly_company_information', schema=None) as batch_op:
        batch_op.add_column(sa.Column('filer_count', sa.Integer(), nullable=False, comment='A counter indicating which observation of company data within an SEC 10-K filing header the record pertains to.'))
        batch_op.add_column(sa.Column('filing_date', sa.Date(), nullable=True, comment='Date filing was submitted, reported at a daily frequency.'))
        batch_op.add_column(sa.Column('incorporation_state', sa.Text(), nullable=True, comment='Two letter state code where company is incorporated.'))
        batch_op.add_column(sa.Column('sec10k_type', sa.Text(), nullable=True, comment='Specific version of SEC 10-K that was filed. 10-k: the standard annual report. 10-k/a: an amended version of the annual report. 10-k405: filed to report insider trading that was not reported in a timely fashion. 10-k405/a: an amended version of the 10-k405. 10-kt: submitted in lieu of or in addition to a standard 10-K annual report when a company changes the end of its fiscal year (e.g. due to a merger) leaving the company with a longer or shorter reporting period. 10-kt/a: an amended version of the 10-kt. 10-ksb: the annual report for small businesses, also known as penny stocks. 10-ksb/a: an amended version of the 10-ksb.'))
        batch_op.add_column(sa.Column('business_street_address', sa.Text(), nullable=True, comment="Street address of the company's place of business."))
        batch_op.add_column(sa.Column('business_street_address_2', sa.Text(), nullable=True, comment="Second line of the street address of the company's place of business."))
        batch_op.add_column(sa.Column('business_city', sa.Text(), nullable=True, comment="City where the company's place of business is located."))
        batch_op.add_column(sa.Column('business_state', sa.Text(), nullable=True, comment="State where the company's place of business is located."))
        batch_op.add_column(sa.Column('business_zip_code', sa.Text(), nullable=True, comment="Zip code of the company's place of business."))
        batch_op.add_column(sa.Column('business_zip_code_4', sa.Text(), nullable=True, comment="Zip code suffix of the company's place of business."))
        batch_op.add_column(sa.Column('business_postal_code', sa.Text(), nullable=True, comment="Non-US postal code of the company's place of business."))
        batch_op.add_column(sa.Column('mail_street_address', sa.Text(), nullable=True, comment="Street portion of the company's for mailing address."))
        batch_op.add_column(sa.Column('mail_street_address_2', sa.Text(), nullable=True, comment="Second line of the street portion of the company's mailing address."))
        batch_op.add_column(sa.Column('mail_city', sa.Text(), nullable=True, comment="City of the company's mailing address."))
        batch_op.add_column(sa.Column('mail_state', sa.Text(), nullable=True, comment="State of the company's mailing address."))
        batch_op.add_column(sa.Column('mail_zip_code', sa.Text(), nullable=True, comment="Zip code of the company's mailing address."))
        batch_op.add_column(sa.Column('mail_zip_code_4', sa.Text(), nullable=True, comment="Zip code suffix of the company's mailing address."))
        batch_op.add_column(sa.Column('mail_postal_code', sa.Text(), nullable=True, comment="Non-US postal code of the company's mailing address."))
        batch_op.add_column(sa.Column('source_url', sa.Text(), nullable=True, comment='URL pointing to the original source of the data in the record.'))
        batch_op.alter_column('filename_sec10k',
               existing_type=sa.TEXT(),
               nullable=False)
        batch_op.alter_column('central_index_key',
               existing_type=sa.TEXT(),
               nullable=True)
        batch_op.alter_column('report_date',
               existing_type=sa.DATE(),
               nullable=True)
        batch_op.drop_column('company_name_former')
        batch_op.drop_column('sec10k_version')
        batch_op.drop_column('zip_code_4')
        batch_op.drop_column('state_of_incorporation')
        batch_op.drop_column('zip_code')
        batch_op.drop_column('city')
        batch_op.drop_column('state')
        batch_op.drop_column('name_change_date')
        batch_op.drop_column('address_2')
        batch_op.drop_column('street_address')

    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    with op.batch_alter_table('out_sec10k__quarterly_company_information', schema=None) as batch_op:
        batch_op.add_column(sa.Column('street_address', sa.TEXT(), nullable=True))
        batch_op.add_column(sa.Column('address_2', sa.TEXT(), nullable=True))
        batch_op.add_column(sa.Column('name_change_date', sa.DATE(), nullable=True))
        batch_op.add_column(sa.Column('state', sa.TEXT(), nullable=True))
        batch_op.add_column(sa.Column('city', sa.TEXT(), nullable=True))
        batch_op.add_column(sa.Column('zip_code', sa.TEXT(), nullable=True))
        batch_op.add_column(sa.Column('state_of_incorporation', sa.TEXT(), nullable=True))
        batch_op.add_column(sa.Column('zip_code_4', sa.TEXT(), nullable=True))
        batch_op.add_column(sa.Column('sec10k_version', sa.TEXT(), nullable=True))
        batch_op.add_column(sa.Column('company_name_former', sa.TEXT(), nullable=True))
        batch_op.alter_column('report_date',
               existing_type=sa.DATE(),
               nullable=False)
        batch_op.alter_column('central_index_key',
               existing_type=sa.TEXT(),
               nullable=False)
        batch_op.alter_column('filename_sec10k',
               existing_type=sa.TEXT(),
               nullable=True)
        batch_op.drop_column('source_url')
        batch_op.drop_column('mail_postal_code')
        batch_op.drop_column('mail_zip_code_4')
        batch_op.drop_column('mail_zip_code')
        batch_op.drop_column('mail_state')
        batch_op.drop_column('mail_city')
        batch_op.drop_column('mail_street_address_2')
        batch_op.drop_column('mail_street_address')
        batch_op.drop_column('business_postal_code')
        batch_op.drop_column('business_zip_code_4')
        batch_op.drop_column('business_zip_code')
        batch_op.drop_column('business_state')
        batch_op.drop_column('business_city')
        batch_op.drop_column('business_street_address_2')
        batch_op.drop_column('business_street_address')
        batch_op.drop_column('sec10k_type')
        batch_op.drop_column('incorporation_state')
        batch_op.drop_column('filing_date')
        batch_op.drop_column('filer_count')

    with op.batch_alter_table('core_sec10k__quarterly_filings', schema=None) as batch_op:
        batch_op.add_column(sa.Column('sec10k_version', sa.TEXT(), nullable=True))
        batch_op.drop_column('sec10k_type')

    with op.batch_alter_table('core_sec10k__quarterly_company_information', schema=None) as batch_op:
        batch_op.add_column(sa.Column('street_address', sa.TEXT(), nullable=True))
        batch_op.add_column(sa.Column('address_2', sa.TEXT(), nullable=True))
        batch_op.add_column(sa.Column('name_change_date', sa.DATE(), nullable=True))
        batch_op.add_column(sa.Column('report_date', sa.DATE(), nullable=False))
        batch_op.add_column(sa.Column('state', sa.TEXT(), nullable=True))
        batch_op.add_column(sa.Column('city', sa.TEXT(), nullable=True))
        batch_op.add_column(sa.Column('zip_code', sa.TEXT(), nullable=True))
        batch_op.add_column(sa.Column('state_of_incorporation', sa.TEXT(), nullable=True))
        batch_op.add_column(sa.Column('zip_code_4', sa.TEXT(), nullable=True))
        batch_op.add_column(sa.Column('sec10k_version', sa.TEXT(), nullable=True))
        batch_op.add_column(sa.Column('company_name_former', sa.TEXT(), nullable=True))
        batch_op.alter_column('central_index_key',
               existing_type=sa.TEXT(),
               nullable=False)
        batch_op.alter_column('filename_sec10k',
               existing_type=sa.TEXT(),
               nullable=True)
        batch_op.drop_column('mail_postal_code')
        batch_op.drop_column('mail_zip_code_4')
        batch_op.drop_column('mail_zip_code')
        batch_op.drop_column('mail_state')
        batch_op.drop_column('mail_city')
        batch_op.drop_column('mail_street_address_2')
        batch_op.drop_column('mail_street_address')
        batch_op.drop_column('business_postal_code')
        batch_op.drop_column('business_zip_code_4')
        batch_op.drop_column('business_zip_code')
        batch_op.drop_column('business_state')
        batch_op.drop_column('business_city')
        batch_op.drop_column('business_street_address_2')
        batch_op.drop_column('business_street_address')
        batch_op.drop_column('sec10k_type')
        batch_op.drop_column('incorporation_state')
        batch_op.drop_column('filer_count')

    with op.batch_alter_table('core_sec10k__changelog_company_name', schema=None) as batch_op:
        batch_op.add_column(sa.Column('company_name', sa.TEXT(), nullable=False))
        batch_op.alter_column('central_index_key',
               existing_type=sa.TEXT(),
               nullable=False)
        batch_op.drop_column('company_name_new')
        batch_op.drop_column('company_name_old')

    op.create_table('out_sec10k__parents_and_subsidiaries',
    sa.Column('filename_sec10k', sa.TEXT(), nullable=True),
    sa.Column('report_date', sa.DATE(), nullable=True),
    sa.Column('central_index_key', sa.TEXT(), nullable=True),
    sa.Column('utility_id_eia', sa.INTEGER(), nullable=True),
    sa.Column('street_address', sa.TEXT(), nullable=True),
    sa.Column('address_2', sa.TEXT(), nullable=True),
    sa.Column('city', sa.TEXT(), nullable=True),
    sa.Column('state', sa.TEXT(), nullable=True),
    sa.Column('company_name_raw', sa.TEXT(), nullable=True),
    sa.Column('company_name_former', sa.TEXT(), nullable=True),
    sa.Column('industry_id_sic', sa.TEXT(), nullable=True),
    sa.Column('state_of_incorporation', sa.TEXT(), nullable=True),
    sa.Column('location_of_incorporation', sa.TEXT(), nullable=True),
    sa.Column('files_sec10k', sa.BOOLEAN(), nullable=True),
    sa.Column('parent_company_central_index_key', sa.TEXT(), nullable=True),
    sa.Column('fraction_owned', sa.FLOAT(), nullable=True),
    sa.Column('name_change_date', sa.DATE(), nullable=True),
    sa.Column('company_id_sec10k', sa.TEXT(), nullable=True),
    sa.Column('industry_name_sic', sa.TEXT(), nullable=True),
    sa.Column('taxpayer_id_irs', sa.TEXT(), nullable=True),
    sa.ForeignKeyConstraint(['utility_id_eia'], ['core_eia__entity_utilities.utility_id_eia'], name='fk_out_sec10k__parents_and_subsidiaries_utility_id_eia_core_eia__entity_utilities')
    )
    op.create_table('core_sec10k__assn__sec10k_filers_and_eia_utilities',
    sa.Column('central_index_key', sa.TEXT(), nullable=True),
    sa.Column('utility_id_eia', sa.INTEGER(), nullable=True),
    sa.ForeignKeyConstraint(['utility_id_eia'], ['core_eia__entity_utilities.utility_id_eia'], name='fk_core_sec10k__assn__sec10k_filers_and_eia_utilities_utility_id_eia_core_eia__entity_utilities')
    )
    op.drop_table('core_sec10k__parents_and_subsidiaries')
    op.drop_table('core_sec10k__assn_sec10k_filers_and_eia_utilities')
    # ### end Alembic commands ###
