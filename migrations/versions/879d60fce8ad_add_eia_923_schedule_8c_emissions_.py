"""Add EIA-923 Schedule 8C Emissions Control Equipment Operations table.

Revision ID: 879d60fce8ad
Revises: d629674ba279
Create Date: 2025-11-06 12:36:01.747348

"""
from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision = '879d60fce8ad'
down_revision = 'd629674ba279'
branch_labels = None
depends_on = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('_core_eia923__emissions_control',
    sa.Column('plant_id_eia', sa.Integer(), nullable=False, comment='The unique six-digit facility identification number, also called an ORISPL, assigned by the Energy Information Administration.'),
    sa.Column('report_year', sa.Integer(), nullable=False, comment='Four-digit year in which the data was reported.'),
    sa.Column('acid_gas_removal_efficiency', sa.Float(), nullable=True, comment='Percent removal efficiency for acid gas emissions'),
    sa.Column('annual_nox_emission_rate_lb_per_mmbtu', sa.Float(), nullable=True, comment='Actual controlled (or uncontrolled) nitrogen oxides emission rate. Based on data from CEMS where possible.'),
    sa.Column('data_maturity', sa.Text(), nullable=True, comment='Maturity of the source data published by EIA that is reflected in this record. EIA releases data incrementally over time, including monthly updates, annual year-to-date updates, provisional early releases of annual data, and final annual release data that is not expected to change further. Records sourced from multiple upstream EIA datasets may have no well defined data maturity. Records whose values have been inferred within PUDL will also have no data maturity.'),
    sa.Column('environmental_equipment_name', sa.Text(), nullable=True, comment='Type of equipment or strategy for the control of air emissions.'),
    sa.Column('fgd_electricity_consumption_mwh', sa.Float(), nullable=True, comment='Electric power consumed by the flue gas desulfurization unit (in MWh).'),
    sa.Column('fgd_sorbent_consumption_1000_tons', sa.Float(), nullable=True, comment='Quantity of flue gas desulfurization sorbent used, to the nearest 0.1 thousand tons.'),
    sa.Column('hours_in_service', sa.Integer(), nullable=True, comment='Total hours the emissions control was in service during the reporting year, rounded to the nearest hour.'),
    sa.Column('mercury_control_id_eia', sa.Text(), nullable=True, comment='Mercury control identification number. This ID is not a unique identifier.'),
    sa.Column('mercury_emission_rate_lb_per_trillion_btu', sa.Float(), nullable=True, comment='Actual controlled (or uncontrolled) mercury emission rate, based on data from CEMS, where possible.'),
    sa.Column('mercury_removal_efficiency', sa.Float(), nullable=True, comment='Percent removal efficiency for mercury emissions rounded to nearest 0.1 percent of weight'),
    sa.Column('nox_control_id_eia', sa.Text(), nullable=True, comment='Nitrogen oxide control identification number. This ID is not a unique identifier.'),
    sa.Column('operational_status', sa.Text(), nullable=True, comment='The operating status of the asset. For generators this is based on which tab the generator was listed in in EIA 860.'),
    sa.Column('ozone_season_nox_emission_rate_lb_per_mmbtu', sa.Float(), nullable=True, comment='Actual controlled (or uncontrolled) nitrogen oxides emission rate during the ozone season (May to September)'),
    sa.Column('particulate_control_id_eia', sa.Text(), nullable=True, comment='Particulate matter control identification number. This ID is not a unique identifier.'),
    sa.Column('particulate_emission_rate_lb_per_mmbtu', sa.Float(), nullable=True, comment='Average annual emission removal rate for particulate matter.'),
    sa.Column('particulate_removal_efficiency_tested', sa.Float(), nullable=True, comment='The tested efficiency for the removal of particulate matter of an equipment or strategy.'),
    sa.Column('particulate_removal_efficiency_annual', sa.Float(), nullable=True, comment='Particulate removal efficiency, based on the annual operating factor, which is defined as annual fuel consumption (MMBtu) divided by the product of the boiler design firing rate (MMBtu per hour) and hours of operation per year.'),
    sa.Column('particulate_test_date', sa.Date(), nullable=True, comment='Date of the latest efficiency test for the removal of particulate matter.'),
    sa.Column('so2_control_id_eia', sa.Text(), nullable=True, comment='Sulfur dioxide control identification number. This ID is not a unique identifier.'),
    sa.Column('so2_removal_efficiency_tested', sa.Float(), nullable=True, comment='Removal efficiency for sulfur dioxide (to the nearest 0.1 percent by weight) at tested rate at 100 percent load.'),
    sa.Column('so2_removal_efficiency_annual', sa.Float(), nullable=True, comment='Removal efficiency for sulfur dioxide (to the nearest 0.1 percent by weight) based on designed firing rate and hours in operation (listed as a percentage).'),
    sa.Column('so2_test_date', sa.Date(), nullable=True, comment='Date of most recent test for sulfur dioxide removal efficiency.'),
    sa.ForeignKeyConstraint(['data_maturity'], ['core_pudl__codes_data_maturities.code'], name=op.f('fk__core_eia923__emissions_control_data_maturity_core_pudl__codes_data_maturities')),
    sa.ForeignKeyConstraint(['plant_id_eia'], ['core_eia__entity_plants.plant_id_eia'], name=op.f('fk__core_eia923__emissions_control_plant_id_eia_core_eia__entity_plants')),
    sa.PrimaryKeyConstraint('plant_id_eia', 'report_year', name=op.f('pk__core_eia923__emissions_control'))
    )
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_table('_core_eia923__emissions_control')
    # ### end Alembic commands ###
