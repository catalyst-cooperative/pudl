"""restructure sec company info tables

Revision ID: 1fbcbb757cc9
Revises: b2acd10c5d2b
Create Date: 2025-03-05 14:29:50.294320

"""
from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision = '1fbcbb757cc9'
down_revision = 'b2acd10c5d2b'
branch_labels = None
depends_on = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('core_sec10k__changelog_company_name',
    sa.Column('central_index_key', sa.Text(), nullable=False, comment='Identifier of the company in SEC database.'),
    sa.Column('report_date', sa.Date(), nullable=False, comment='Date reported.'),
    sa.Column('company_name', sa.Text(), nullable=True, comment='Name of company submitting SEC 10k filing.'),
    sa.Column('name_change_date', sa.Date(), nullable=True, comment='Date of last name change of the company.'),
    sa.Column('company_name_former', sa.Text(), nullable=True, comment='Former name of company.'),
    sa.PrimaryKeyConstraint('central_index_key', 'report_date', name=op.f('pk_core_sec10k__changelog_company_name'))
    )
    op.create_table('out_sec10k__quarterly_company_information',
    sa.Column('central_index_key', sa.Text(), nullable=False, comment='Identifier of the company in SEC database.'),
    sa.Column('report_date', sa.Date(), nullable=False, comment='Date reported.'),
    sa.Column('filename_sec10k', sa.Text(), nullable=True, comment='Name of filing as provided by SEC data portal.'),
    sa.Column('utility_id_eia', sa.Integer(), nullable=True, comment='The EIA Utility Identification number.'),
    sa.Column('utility_name_eia', sa.Text(), nullable=True, comment='The name of the utility.'),
    sa.Column('phone_number', sa.Text(), nullable=True, comment='Phone number for utility contact 1.'),
    sa.Column('city', sa.Text(), nullable=True, comment='Name of the city.'),
    sa.Column('company_name', sa.Text(), nullable=True, comment='Name of company submitting SEC 10k filing.'),
    sa.Column('name_change_date', sa.Date(), nullable=True, comment='Date of last name change of the company.'),
    sa.Column('film_number', sa.Text(), nullable=True, comment='Document control number used in the SEC database.'),
    sa.Column('fiscal_year_end', sa.Text(), nullable=True, comment="The end date of an SEC filing company's fiscal year, in MMDD format."),
    sa.Column('sec10k_version', sa.Text(), nullable=True, comment='Specific version of SEC 10k filed.'),
    sa.Column('company_name_former', sa.Text(), nullable=True, comment='Former name of company.'),
    sa.Column('company_id_irs', sa.Text(), nullable=True, comment='ID of the company with the IRS.'),
    sa.Column('organization_name', sa.Text(), nullable=True, comment='SEC standardized type of organization of the company.'),
    sa.Column('sec_act', sa.Text(), nullable=True, comment='SEC Act through which the form was enacted, e.g. 1934 act.'),
    sa.Column('sec_file_number', sa.Text(), nullable=True, comment='Filing number used internally by the SEC commission to track filing.'),
    sa.Column('industry_description_sic', sa.Text(), nullable=True, comment='Text description of Standard Industrial Classification (SIC)'),
    sa.Column('industry_id_sic', sa.Text(), nullable=True, comment="Four-digit Standard Industrial Classification (SIC) code identifying the company's primary industry. SIC codes have been replaced by NAICS codes in many applications, but are still used by the SEC. See e.g. https://www.osha.gov/data/sic-manual for code definitions."),
    sa.Column('state', sa.Text(), nullable=True, comment='Two letter US state abbreviation.'),
    sa.Column('state_of_incorporation', sa.Text(), nullable=True, comment='Two letter state code where company is incorporated.'),
    sa.Column('street_address', sa.Text(), nullable=True, comment='Physical street address.'),
    sa.Column('address_2', sa.Text(), nullable=True, comment='Second line of the address.'),
    sa.Column('zip_code', sa.Text(), nullable=True, comment='Five digit US Zip Code.'),
    sa.ForeignKeyConstraint(['utility_id_eia', 'report_date'], ['core_eia860__scd_utilities.utility_id_eia', 'core_eia860__scd_utilities.report_date'], name=op.f('fk_out_sec10k__quarterly_company_information_utility_id_eia_core_eia860__scd_utilities')),
    sa.PrimaryKeyConstraint('central_index_key', 'report_date', name=op.f('pk_out_sec10k__quarterly_company_information'))
    )
    with op.batch_alter_table('core_sec10k__quarterly_company_information', schema=None) as batch_op:
        batch_op.add_column(sa.Column('central_index_key', sa.Text(), nullable=False, comment='Identifier of the company in SEC database.'))
        batch_op.add_column(sa.Column('phone_number', sa.Text(), nullable=True, comment='Phone number for utility contact 1.'))
        batch_op.add_column(sa.Column('city', sa.Text(), nullable=True, comment='Name of the city.'))
        batch_op.add_column(sa.Column('company_name', sa.Text(), nullable=True, comment='Name of company submitting SEC 10k filing.'))
        batch_op.add_column(sa.Column('name_change_date', sa.Date(), nullable=True, comment='Date of last name change of the company.'))
        batch_op.add_column(sa.Column('film_number', sa.Text(), nullable=True, comment='Document control number used in the SEC database.'))
        batch_op.add_column(sa.Column('fiscal_year_end', sa.Text(), nullable=True, comment="The end date of an SEC filing company's fiscal year, in MMDD format."))
        batch_op.add_column(sa.Column('sec10k_version', sa.Text(), nullable=True, comment='Specific version of SEC 10k filed.'))
        batch_op.add_column(sa.Column('company_name_former', sa.Text(), nullable=True, comment='Former name of company.'))
        batch_op.add_column(sa.Column('company_id_irs', sa.Text(), nullable=True, comment='ID of the company with the IRS.'))
        batch_op.add_column(sa.Column('organization_name', sa.Text(), nullable=True, comment='SEC standardized type of organization of the company.'))
        batch_op.add_column(sa.Column('sec_act', sa.Text(), nullable=True, comment='SEC Act through which the form was enacted, e.g. 1934 act.'))
        batch_op.add_column(sa.Column('sec_file_number', sa.Text(), nullable=True, comment='Filing number used internally by the SEC commission to track filing.'))
        batch_op.add_column(sa.Column('industry_id_sic', sa.Text(), nullable=True, comment="Four-digit Standard Industrial Classification (SIC) code identifying the company's primary industry. SIC codes have been replaced by NAICS codes in many applications, but are still used by the SEC. See e.g. https://www.osha.gov/data/sic-manual for code definitions."))
        batch_op.add_column(sa.Column('state', sa.Text(), nullable=True, comment='Two letter US state abbreviation.'))
        batch_op.add_column(sa.Column('state_of_incorporation', sa.Text(), nullable=True, comment='Two letter state code where company is incorporated.'))
        batch_op.add_column(sa.Column('street_address', sa.Text(), nullable=True, comment='Physical street address.'))
        batch_op.add_column(sa.Column('address_2', sa.Text(), nullable=True, comment='Second line of the address.'))
        batch_op.add_column(sa.Column('zip_code', sa.Text(), nullable=True, comment='Five digit US Zip Code.'))
        batch_op.alter_column('report_date',
               existing_type=sa.DATE(),
               nullable=False)
        batch_op.alter_column('filename_sec10k',
               existing_type=sa.TEXT(),
               nullable=True)
        batch_op.drop_column('filer_count')
        batch_op.drop_column('company_information_fact_name')
        batch_op.drop_column('company_information_block_count')
        batch_op.drop_column('company_information_fact_value')
        batch_op.drop_column('company_information_block')

    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    with op.batch_alter_table('core_sec10k__quarterly_company_information', schema=None) as batch_op:
        batch_op.add_column(sa.Column('company_information_block', sa.TEXT(), nullable=False))
        batch_op.add_column(sa.Column('company_information_fact_value', sa.TEXT(), nullable=False))
        batch_op.add_column(sa.Column('company_information_block_count', sa.INTEGER(), nullable=False))
        batch_op.add_column(sa.Column('company_information_fact_name', sa.TEXT(), nullable=False))
        batch_op.add_column(sa.Column('filer_count', sa.INTEGER(), nullable=False))
        batch_op.alter_column('filename_sec10k',
               existing_type=sa.TEXT(),
               nullable=False)
        batch_op.alter_column('report_date',
               existing_type=sa.DATE(),
               nullable=True)
        batch_op.drop_column('zip_code')
        batch_op.drop_column('address_2')
        batch_op.drop_column('street_address')
        batch_op.drop_column('state_of_incorporation')
        batch_op.drop_column('state')
        batch_op.drop_column('industry_id_sic')
        batch_op.drop_column('sec_file_number')
        batch_op.drop_column('sec_act')
        batch_op.drop_column('organization_name')
        batch_op.drop_column('company_id_irs')
        batch_op.drop_column('company_name_former')
        batch_op.drop_column('sec10k_version')
        batch_op.drop_column('fiscal_year_end')
        batch_op.drop_column('film_number')
        batch_op.drop_column('name_change_date')
        batch_op.drop_column('company_name')
        batch_op.drop_column('city')
        batch_op.drop_column('phone_number')
        batch_op.drop_column('central_index_key')

    op.drop_table('out_sec10k__quarterly_company_information')
    op.drop_table('core_sec10k__changelog_company_name')
    # ### end Alembic commands ###
